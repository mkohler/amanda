2004-06-22  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* Amanda 2.4.4p3 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.4p3).
	* News: Changes in release 2.4.4p3.

2004-05-10  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/planner.c: Log L_DISK for autoflush disk.

2004-04-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/amanda.h: #include "amanda-int.h" only if !CONFIGURE_TEST.

2004-04-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* config/acinclude.m4i (AX_CREATE_STDINT_H) : New macro.
	* configure.in: Use AX_CREATE_STDINT_H(common-src/amanda-int.h).
	* common-src/amanda.h: include "common-src/amanda-int.h".
	* changer-src/scsi-cam.c: Change u_int32_t for uint32_t.
	* client-src/amandad-krb4.c: Change u_int32_t for uint32_t.
	* common-src/krb4-security.c: Change u_int32_t for uint32_t.
	* common-src/krb4-security.h: Change u_int32_t for uint32_t.
	* common-src/protocol.h: Change u_int32_t for uint32_t.
	* common-src/security.c: Change u_int32_t for uint32_t.

2004-04-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Fix for automake 1.8.4.
	* config/acinclude.m4i: Fix for automake 1.8.4.

2004-04-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Result of autoupdate.

2004-04-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* config/config.guess: Update from automake 1.8.
	* config/config.sub: Update from automake 1.8.
	* config/depcomp: Update from automake 1.8.
	* config/install-sh: Update from automake 1.8.
	* config/missing: Update from automake 1.8.
	* config/mkinstalldirs: Update from automake 1.8.
	* config/ltmain.sh: Update from libtool-1.5.6.
	* config/libtool.m4i: Update from libtool-1.5.6.

2004-04-26  Marc Mengel <mengel@fnal.gov>

	* tape-src/output-rait.c: Verify reads correctly.

2004-04-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (continue_dumps): Fix deadlock if holding disk
	  fill up when in degraded mode.

2004-04-23  Eric Siegerman <eric_97@pobox.com>

	Bug fix: amflush would run, and consume a tape, even if there
	were no Amanda directories waiting to be flushed:
	* common-src/sl.c (is_empty_sl): New function to test
	  whether a list is empty.
	* common-src/sl.h (is_empty_sl): Prototype.
	* server-src/amflush.sh (main): Use is_empty_sl(),
	  rather than ==NULL, to test emptiness of datestamp_list.

2004-04-23  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (setup_estimate): Typo.

2004-04-22  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Fix by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/planner.c (setup_estimate): Only ask for level 0 estimate
	  if strategy is noinc.

2004-04-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Documentation from Paul Bijnens <paul.bijnens@xplanation.com>

	* man/amoverview.8.in: Document results.

2004-04-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/amoverview.pl.in: Print last two characters.

2004-04-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-disk.sh.in: Fix for sh compatibility.

2004-04-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Fix by John Koyle <jkoyle@rfpdepot.com>

	* common-src/protocol.c: Fix EAGAIN on Linux.

2004-03-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c: Do labelstr check in correct order.

2004-02-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Reported by Allen Liu <allen@bellglobal.com>

	* server-src/amverifyrun.sh.in: Replace '-e' test by '-f'.

2004-02-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c: Verify the tape is listed in the tapelist file.
	* server-src/taper.c: Ditto
	* NEWS: * amanda will not use a tape if it's label is not in the
	          tapelist file (eg. after an amrmtape).

2004-02-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Philippe Charnier <charnier@xp11.frmug.org>

	* server-src/amtrmidx.c: Add '\n'.

2004-02-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/set_commands.c (cd_glob): Fix memory leak.

2004-02-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/set_commands.c (cd_dir, set_directory): Fix memory leak.
	* recover-src/uscan.l: Fix double amfree.

2004-01-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* Makefile.am (EXTRA_DIST): Add contrib/mkamandisk.

2004-01-29  Christoph Pospiech <pospiech@de.ibm.com>

        * configure.in (AC_CONFIG_FILES): Add changer-src/chg-iomega.pl.
        * changer-src/Makefile.am (libexec_SCRIPTS) Add chg-iomega.
        * changer-src/chg-iomega.pl.in: New changer script.
        * docs/TAPE.CHANGERS: Document chg-iomega.
	* contrib/mkamandisk: Script to format iomega disk.
	* NEWS: New chg-iomega changer script.

2004-01-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* restore-src/amidxtaped.c (scan_init): Remove the log file if it exit.

2004-01-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Set GNUTAR_LISTED_INCREMENTAL_DIRX.
	* example/amanda.conf.in: Update record documentation.
	* man/amanda.8.in: Update record documentation.

2004-01-13  Greg Troxel  <gdt@t...>

	* common-src/krb4-security.c (errstr;): Make krb4 work on 64-bit
	  platforms.  Essentially, change 'unsigned long' to u_int32_t for
	  on-the-wire representation of checksums, declaring that the wire
	  protocol is defined by existing use of unsigned long on 32-bit
	  machines.

	  Modify the data/control handshake similarly, defining a
	  'net_timeval' that uses int32_t rather than long.  Cleanup a latent
	  bug in handshake code that didn't cause trouble before when
	  everything was the same type.

	  This change preserves interoperability with the previous code
	  on 32 bit machines.  (It is likely that 64/64 interoperability
	  was ok, but unlikely that it was important to anyone, given
	  the low population of amanda-krb users.)

2004-01-14  Stefan G. Weichinger <monitor@oops.co.at>

	* docs/INSTALL: Add config for xinetd.

2004-01-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* Amanda 2.4.4p2 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.4p2).


2004-01-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (handle_result): Detect bad estimate (-1).
	* server-src/planner.c (analyze_estimate): Don't schedule level
	  if the estimate is bad.

2003-12-19  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/Makefile.am (EXTRA_DIST): Add amandad-krb4.c,
	  sendbackup-krb4.c and sendbackup-krb4.h.
	* common-src/Makefile.am (EXTRA_DIST): Add krb4-security.c and
	  krb4-security.h.
	* server-src/Makefile.am (EXTRA_DIST): Add dumper-krb4.c.
	* NEWS: Kerberos 4 support integrated and functional again.

2003-12-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	patch by Greg Troxel <gdt@ir.bbn.com>
             and Beverly Schwartz <bschwart@bbn.com>

	Original *krb4* files are taken form the amanda-krb repository.

	Add kerberos 4 support.
	* client-src/amandad-krb4.c: New file.
	* client-src/amandad.c: Fix close of req_pipe[0]/rep_pipe[1].
	* client-src/sendbackup-krb4.c: New file.
	* client-src/sendbackup-krb4.h: New file.
	* client-src/sendbackup.c: Use options->krb4_auth.
	* common-src/amanda.h: Fix for initgroups.
	* common-src/krb4-security.c: New file.
	* common-src/krb4-security.h: New file.
	* common-src/token.h: Use HAVE_SHQUOTE_DECL.
	* configure.in: Enhance finding krb libs.
	* server-src/diskfile.c: Fix.
	* server-src/dumper-krb4.c: New file.
	* server-src/getconf.c: Define HOSTNAME_INSTANCE.

2003-12-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/HOWTO-FILE-DRIVER: New file.
	* docs/TAPE.CHANGERS: Explain chg-disk.
	* docs/Makefile.am (pkgdata_DATA): add HOWTO-FILE-DRIVER.

2003-12-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/SYSTEM.NOTES: Add a note about sendsize coredump on AIX.

2003-11-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Jean-Christian SIMONETTI <simonetti@echo.fr>

	* changer-src/chg-disk.sh.in: New changer script.
	* changer-src/Makefile.am (libexec_SCRIPTS): Add chg-disk.
	* configure.in (AC_CONFIG_FILES): Add changer-src/chg-disk.sh.
	* NEWS: new chag-disk changer script to use with the file: driver.

2003-11-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/tapetype.c: extern int optind.
	* tape-src/tapeio.c: extern int optind.

2003-11-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by C.Scheeder <christoph.scheeder@scheeder.de

	* changer-src/sense.c (SenseType): Add "DAT AutoChanger" and "C1537A".

2003-11-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c: Print the tape size.
	* server-src/amstatus.pl.in: print % of tape use.

2003-11-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c (copy_dumptype): Copy in/exclude only if seen.

2003-11-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/reporter.c (output_tapeinfo): Fix printing of new tape.

2003-11-25  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c (taperscan_slot): Deal with label not in
	  tapelist case.
	* server-src/amtape.c (taperscan_slot): Ditto.
	* server-src/taper.c (taperscan_slot): Ditto.

2003-11-24  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (handle_taper_result): Empty tapeq in TAPE_ERROR
	  and BOGUS case.

2003-11-24  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (handle_taper_result): Always call
	  continue_dumps() in TRYAGAIN case.

2003-11-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-chio.pl.in (getTapeStatus): Set $drives[$num] to 0
	if no tape in drive.

2003-11-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/Makefile.am (pkgdata_DATA): Add HOWTO-AFS.

2003-11-18  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Mitch Collinsworth <mitch@ccmr.cornell.edu>

	* client-src/selfcheck.c: Skip accessibility check for AFS entries.
	* docs/HOWTO-AFS: New file.

2003-11-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amadmin.c (tape): Display the next new tapes.
	* server-src/reporter.c (output_tapeinfo): Ditto.

2003-10-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/Makefile.am (pkgdata_DATA): Add chg-scsi.notes.

2003-10-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c (taperscan_slot): Set found=3 if new tape.
	* server-src/amcheck.c (taper_scan): Handle found==3.
	* server-src/amtape.c (taperscan_slot): Set found=3 if new tape.
	* server-src/amtape.c (taper_scan): Handle found==3.
	* server-src/taper.c (taperscan_slot): Set found=3 if new tape.
	* server-src/taper.c (taper_scan): Handle found==3.

2003-10-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c: Use stralloc(optarg).
	* tape-src/ammt.c: Use stralloc(optarg).
	* tape-src/tapetype.c: Use stralloc(optarg).

2003-10-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Jay Fenlason <fenlason@redhat.com>

	* server-src/dumper.c: Don't set SIGCHLD to SIG_IGN.

2003-10-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Andrew Rucker Jones <arjones@simultan.dyndns.org>

	* client-src/sendbackup-gnutar.c (AM_SIZE_RE): Fix regex for samba3.

2003-10-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amadmin.c (find): Call find_dump to allow dynamic disklist.
	* server-src/amindexd.c: Call find_dump to allow dynamic disklist.
	* server-src/amtrmidx.c:  Call find_dump to allow dynamic disklist.
	* server-src/diskfile.c (add_disk): Set device and todo.
	* server-src/find.c: Build disklist dynamicaly from log files.
	* server-src/find.h (find_dump): New prototype.
	* NEWS: 'amadmin find' list disk removed from the disklist.
	* NEWS: amrecover can recover a disk removed from the disklist file.

2003-10-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amlogroll.c: set_pname("amlogroll").

2003-10-24  Todd M. Kover <kovert@omniscient.com>

	* add amqde for "quick and dirty estimates" under gnutar (program
	  that will traverse the filesystem rather than invoke gnutar).
	  controlled via configure option --with-qde.  This really wants to
	  be configured in the server.

2003-10-24  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverify.sh.in: Fix usage message.
	* common-src/fileheader.c (print_header): fprintf to outf.
	* server-src/tapefile.c (lookup_last_reusable_tape): Check for
	  tp->datestamp > 0.
	* server-src/amadmin.c (disklist_one): Don't print ':' on device line.

2003-10-22  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* client-src/amandates.c (finish_amandates): Call error() if the
	  close of amdf fail.
	* common-src/amflock.c (create_lock): Return -1 if the close of f fail.
	* common-src/amflock.c (read_lock): Don't set f to NULL if the close
	  fail.
	* server-src/tapefile.c (write_tapelist): Return 1 if the close of
	  tapef fail.

2003-10-14  John R. Jackson (jrj@purdue.edu)

	* docs/SYSTEM.NOTES: Add FreeBSD 5.1 note about setting the UDP packet
	  size, compliments of Nicolas Ecarnot <nicolas.ecarnot@accim.com>.

2003-10-14  John R. Jackson (jrj@purdue.edu)

	* client-src/sendsize.c: Handle case where PID's get re-used.

2003-10-14  John R. Jackson (jrj@purdue.edu)

	* configure.in: Need to check for sys/gscdds.h on AIX to enable
	  SCSI changer.

2003-10-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/genversion.c (prundefvar): New macro to print an
	  undefined variable.
	* common-src/genversion.c: Print undefined variable.
	* server-src/amcheck.c: Improve message for no LPRCMD defined.

2003-07-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* restore-src/amidxtaped.c: Don't clear re_label before checking
	  for the changer.

2003-07-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Scott Mcdermott <smcdermott@questra.com>

	* changer-src/chg-zd-mtx.sh.in (initial_poll_delay): New config
	  variable to add a pause after a tape loading.
	* News: New initial_poll_delay config in chg-zd-mtx.

2003-07-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Fix by John E. Hein <jhein@timing.com>

	* changer-src/chg-manual.sh.in: Quote @EGREP@.
	* changer-src/chg-null.sh.in: Quote @EGREP@.

2003-07-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.sh.in: Remove files before runnig amplot.awk.
	* amplot/amplot.awk: Parse 'flush line', fix tape_wait line.
	* server-src/driver.c (read_flush): Write a 'flush size' to the
	  debug file.

2003-07-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-chio.pl.in: Fix next/prev command.

2003-07-06  Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi.c: Added debug Information to see which sg
	 version is used
	* changer-src/scsi-linux.c: Added debug Information to see which sg
	version is used.
	Removed check if an data packet is larger than 4096 byte.

2003-07-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* client-src/client_util.c (add_include): Count include with 2 /,
	  Fix descriptor leak.

2003-06-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* Amanda 2.4.4p1 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.4p1).


2003-06-25  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Fix print spacing for idle dumpers.

2003-06-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* tape-src/tapetype.c: Avoid a numerical overflow for large tape
	  capacities.

2003-06-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Fix to failed tape.

2003-06-18  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (delay_dumps): Delay not delay forced full
	  before forced full.

2003-06-18  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-zd-mtx.sh.in: Log the changer file used.

2003-06-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/holding.c: Skip lost+found directories on holding disks.

2003-06-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverify.sh.in: Do not advance to next tape.

2003-06-10  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	patch by Eric Siegerman <eric_97@pobox.com>

	* server-src/planner.c: Make promote_hills() honour maxpromotedays.

2003-06-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/scsi-bsd.c: Use pDev[DeviceFD].fd instead of DeviceFD.
	* changer-src/scsi-hpux_new.c:Use pDev[DeviceFD].fd instead of DeviceFD.
	* changer-src/scsi-linux.c: Use pDev[ip].fd instead of DeviceFD.

2003-06-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amflush.c: Implement new -b and -s options.
	* man/amflush.8.in: Document it.

2003-06-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (dump_to_tape): Don't go in degraded mode if
	  taper reply DONE.

2003-06-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-rait.c: Don't call waitpid if we didn't fork.

2003-06-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverify.sh.in: Use @MAXTAPEBLOCKSIZE@ instead of 32.

2003-06-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Bug reported by Sven Rudolph <rudsve@drewag.de>

	* server-src/holding.c (mkholdingdir): New function to create a holding
	  directory.
	* server-src/holding.h (mkholdingdir): Prototype.
	* server-src/driver.c: Use mkholdingdir;
	* server-src/dumper.c: Call mkholdingdir before opening a file for
	  writing.

2003-06-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/amstatus.pl.in: Fix for missing amdump.1 or amflush.1.

2003-06-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/amstatus.pl.in: If nothing is active, it now gives the
	  status of the last run (amdump or amflush).
	* man/amstatus.8.in: Document it.

2003-05-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-file.c (check_online): Write error if opendir failed.

2003-05-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/amoverview.pl.in: Use 'amadmin <conf> disklist' instead
	  of parsing the disklist file.

2003-05-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/tapefile.c (read_tapelist,parse_tapeline): Fix for
	  previous patch.

2003-05-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* example/amanda.conf.in: Add more amrecover_changer doc.
	* man/amanda.8.in: Add more amrecover_changer doc.
	* man/amrecover.8.in: Add more amrecover_changer doc.

2003-05-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/tapefile.c (read_tapelist): Ignore blank line.
	* server-src/tapefile.c (parse_tapeline): Newer status parameter, set
	  it to '1' when reading blank line.

2003-04-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in (AC_CHECK_HEADERS): Remove linux/ftape-header-segment.h,
	  linux/ftape-vendors.h and linux/ftape.h.

2003-04-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Darin Dugan <dddugan@iastate.edu>

	* server-src/amcheck.c: Change subject in email if no error.

2003-04-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/error.c (output_error_message): Always prepend program
	  name.
	* server-src/dumper.c (process_dumpeof): 'missing size line' and
	  'missing end line' should be failed, not strange.

2003-04-15  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Fix for estimate disk.

2003-04-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/taper.c: Read holding file correctly if blocksize != 32k.

2003-04-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	New file by Robert C Dege <RDege@northropgrumman.com>

	* configure.in: Find mcutil binary.
	* configure.in (AC_CONFIG_FILES): Add changer-src/chg-mcutil.sh and
	  example/chg-mcutil.conf.
	* changer-src/Makefile (libexec_SCRIPTS): Add chg-mcutil.
	* changer-src/chg-mcutil.sh.in: New file.
	* example/Makefile (EXTRA_DIST): Add chg-mcutil.conf
	* example/chg-mcutil.conf.in: New file.

2003-04-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* man/amanda.8.in (blocksize): Document the --with-maxtapeblocksize
	  configure option.

2003-04-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverifyrun.sh.in: Run the amverify command.

2003-04-01  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/reporter.c: Get the filenumber correct.

2003-04-01  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/reporter.c: Print a postscript label for each tape used.
	* NEWS: Print a postscript label for each tape used.

2003-03-18  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in (*-sco3.2v4*): It is not like *-sco3.2v5*,
	  define DEV_PREFIX and RDEV_PREFIX.

2003-03-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Typo.

2003-03-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Gert Doering <gert@greenie.muc.de>

	* client-src/getfsent.c (get_fstab_nextentry): Compile on *-sco3.2v4*.

2003-03-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Compile on *-sco3.2v4*

2003-03-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Use '=' instead of '=='.

2003-03-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/set_commands.c (set_tape): Recognize null:, rait:, 
	  file: and tape: as driver, not host name.

2003-03-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amrmtape.sh.in: Print better output.

2003-03-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/Makefile.am (libexec_SCRIPTS): Missing \.

2003-03-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* NEWS: amrecover_changer works with chg-multi.

2003-03-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/client_util.c (add_include): If include contain 2 '/' then
	  use at asis, don't try to match it.

2003-03-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* file tape-src/output-rait.c (rait_open): Call tapefd_set_master_fd();
	* file tape-src/tapeio.c (struct tape_info): Add master_fd field.
	* file tape-src/tapeio.c (tape_info_init): Set master_fd to -1;
	* file tape-src/tapeio.c (tapefd_getinfo_host, tapefd_getinfo_disk, 
	  tapefd_getinfo_level): Return info of master_fd.
	* file tape-src/tapeio.c (tapefd_set_master_fd): New function to set
	  master_fd.
	* file tape-src/tapeio.h (tapefd_set_master_fd): Prototype.
	* NEWS: rait: works with file:

2003-03-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-file.c (file_tapefd_can_fork): New function that 
	  return 1 if the file: can be run under a forked process.
	* tape-src/output-file.h (file_tapefd_can_fork): Prototype.
	* tape-src/output-null.c (null_tapefd_can_fork): New function that 
	  return 1 if the null: can be run under a forked process.
	* tape-src/output-null.h (null_tapefd_can_fork): Prototype.
	* tape-src/output-rait.c (rait_close, rait_tapefd_ioctl): Fork only if
	* tapefd_can_fork() return 1.
	* tape-src/output-rait.c (rait_tapefd_can_fork): New function that 
	  return 1 if the rait: can be run under a forked process.
	* tape-src/output-rait.h (rait_tapefd_can_fork): Prototype.
	* tape-src/output-tape.c (tape_tapefd_can_fork): New function that 
	  return 1 if the tape: can be run under a forked process.
	* tape-src/output-tape.h (tape_tapefd_can_fork): Prototype.
	* tape-src/tapeio.c (struct virtualtape): Add xxx_tapefd_can_fork and
	  initialize vtable[];
	* tape-src/tapeio.c (tapefd_can_fork): New function to can the driver 
	  xxx_tapefd_can_fork function.
	* tape-src/tapeio.h (tapefd_can_fork): Prototype.

2003-03-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-file.c (file_tapefd_write): Call file_release(fd)
	  before opening the file for writing.

2003-03-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-zd-mtx.sh.in: Default for driveslot is 0.
	* NEWS: default driveslot for chg-zd-mtx is now 0.

2003-03-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.sh.in: New -b option for b/w postscript.
	* amplot/amplot.awk: Add 'color' to command if bw is set.
	* amplot/amplot.g: Change line 6 to line 8.
	* man/amplot.8: Document -b option.
	* NEWS: Document amplot -b option.

2003-03-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/extract_list.c: Fix the name of the
	  amidxtaped.<timestamp>.debug file.

2003-02-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Eric Doutreleau <Eric.Doutreleau@int-evry.fr>

	* restore-src/amidxtaped.c: Use the device sent by the changer.

2003-02-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* restore-src/amidxtaped.c: Remove lock 'unlink(conf_logfile)' on
	  all failure path.

2003-02-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Martin Forssen <maf@appgate.com>

	* server-src/changer.c (changer_label): Do not amfree(rest).

2003-02-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* Amanda 2.4.4 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.4).

2003-02-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/client_util.c: Print error except ENOENT for 
	  exclude/include files.

2003-02-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/tapetype.c: Use %ld to print some variable.

2003-02-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c (init_defaults): conf_printer.s must be set 
	  with stralloc("").

2003-02-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* tape-src/tapetype.c: Document -c option.

2003-02-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-zd-mtx.sh.in:Print "are you sure your drive slot is n"

2003-02-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/tapefile.c (read_tapelist): return 1 if can't open the 
	  tapelist file.

2003-02-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* man/amtapetype.8.in: Add doc from a mail by John R. Jackson.

2003-02-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c: New -a option.
	* man/amcheck.8.in: Document it.
	* NEWS: Document it.

2003-02-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amindexd.c (build_disk_table): Compare the level.

2003-02-10  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* tape-src/tapetype.c: New -c argument to do only the compression test.
	  Better detection of compression.
	* man/amtapetype.8.in: Document -c argument.

2003-02-09  John R. Jackson (jrj@purdue.edu)

	* tape-src/tapetype.c: Allocate the I/O buffers on page boundaries.
	  This helps performance on some OS's.

2003-02-08  John R. Jackson (jrj@purdue.edu)

	* restore-src/amrestore.c: Clean up strtol() argument processing.

2003-02-08  John R. Jackson (jrj@purdue.edu)

	* docs/INSTALL: Clean up supporting package versions and URL's.

2003-02-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/Makefile.am (pkgdata_DATA): Add HOWTO-CYGWIN.html.

2003-02-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Christophe Kalt <kalt@taranis.org>

	* client-src/sendbackup-dump.c: New AM_SIZE_RE for NetApp.
	* client-src/sendsize.c: New re_size for NetApp.

2003-02-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Fix by Colin Henein <cmh@orange-carb.org>

	* common-src/amanda.h: Fix for the where S_ISDIR is not defined.

2003-02-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Doug Kingston <dpk@randomnotes.org>

	* configure.in (NEED_SETUID_CLIENT): Set to false on *-pc-cygwin.
	* configure.in (WANT_SETUID_CLIENT): Set if NEED_SETUID_CLIENT != false.
	* client-src/Makefile.am: Don't chmod u+s if WANT_SETUID_CLIENT.

2003-02-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Andrew Rucker Jones <arjones@simultan.dyndns.org>

	* man/amtapetype.8.in: Fix example.

2003-01-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* Amanda 2.4.4b1 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.4b1).

2003-01-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/amanda.h: #define S_ISDIR if not already defined.

2003-01-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	File from Doug Kingston <dpk@randomnotes.org>

	* docs/HOWTO-CYGWIN.html: New file.

2003-01-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Define WANT_RUNTIME_PSEUDO_RELOC on cygwin
	* client-src/Makefile.am: AM_LDFLAGS="-Wl,-enable-runtime-pseudo-reloc"
	  if WANT_RUNTIME_PSEUDO_RELOC.
	* recover-src/Makefile.am: Ditto.

2003-01-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-rait.h: #define stralloc strdup
	* tape-src/output-rait.c: Revert patch of 2003-01-26, we don't have
	  vstralloc in standalone.

2003-01-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Reported by Doug Kingston <dpk@randomnotes.org>

	* recover-src/Makefile.am: Set AM_YFLAGS instead of YFLAGS.

2003-01-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-rait.c (tapeio_next_devname): Use vstralloc.

2003-01-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-scsi-chio.c: Change strdup to stralloc.
	* changer-src/chg-scsi.c: Ditto.
	* changer-src/scsi-aix.c: Ditto.
	* changer-src/scsi-bsd.c: Ditto.
	* changer-src/scsi-cam.c: Ditto.
	* changer-src/scsi-changer-driver.c: Ditto.
	* changer-src/scsi-hpux_new.c: Ditto.
	* changer-src/scsi-irix.c: Ditto.
	* changer-src/scsi-linux.c: Ditto.
	* changer-src/scsi-solaris.c: Ditto.
	* changer-src/sense.c: Ditto.
	* tape-src/output-rait.c: Ditto.

2003-01-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/taper.c (read_file): Don't count header in filesize.

2003-01-25  John R. Jackson (jrj@purdue.edu)

	* tape-src/tapeio.c: Fix tape_access() and tape_stat() problem caused
	  by indeterminate compiler order of evaluation.

2003-01-25  John R. Jackson (jrj@purdue.edu)

	* restore-src/amidxtaped.c: Log errno when tape_stat fails.
	* restore-src/amrestore.c: Ditto.
	* tape-src/output-rait.c: Ditto.

2003-01-24  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: print an usage by tape.

2003-01-23  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/extract_list.c (add_extract_item, delete_extract_item): 
	  Check also for level when comparing label.

2003-01-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/dumper.c (update_dataptr): Loop if rc == 0.

2003-01-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	Do not build chg-scsi-chio, it is buggy.
	* changer-src/Makefile.am (libexec_PROGRAMS): remove $(CHIO_SCSI).
	* changer-src/Makefile.am (EXTRA_PROGRAMS): add $(CHIO_SCSI).

2003-01-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: disable amrestore if --without-server is set.

2003-01-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/amandad.c: Use the dbfd macro instead of the external
	  variable db_fd.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* client-src/sendbackup-gnutar.c: Use save_errno instead of errno.
	* common-src/debug.c: Move most declaration inside #ifdef DEBUG_CODE.
	* server-src/amindexd.c: dup db_fd() to stderr.
	* server-src/conffile.c: Don't call error() if the config file does not
	  exist, just write to stderr and set got_parserror.

2003-01-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/amrecover.c: Fix memory leak.

2003-01-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	Add new maxpromoteday option in a dumptype.
	* NEWS: Document it.
	* example/amanda.conf.in: Give an example
	* man/amanda.8.in: Document it.
	* server-src/amadmin.c: Print it in the disklist subcommand.
	* server-src/conffile.c: read it.
	* server-src/conffile.h (dumptype_t): Add maxpromoteday and
	  s_maxpromoteday.
	* server-src/diskfile.c (read_diskline): Copy maxpromoteday from
	  dumptype_t to disk_t.
	* server-src/diskfile.h (disk_t):  Add maxpromoteday.
	* server-src/planner.c (promote_highest_priority_incr): Don't promote
	  a disk if est(dp)->next_level0 > dp->maxpromoteday.

2003-01-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Reported by Josh More <jmore@remote-print.com>

	* client-src/client_util.c (add_exclude, add_include): Remove the
	  need for MAXPATHLEN.

2003-01-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Fix by Josh More <jmore@remote-print.com>

	* tape-src/output-tape.c: Add a ; after f = MT_UNLOAD

2003-01-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c (handle_response): Print 'request timed out' or
	  'reply timed out'.
	* server-src/dumper.c (sendbackup_response): Print 'request timeout' or
	  'reply timeout'.

2003-01-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/protocol.h (proto_t): Add prevstate field.
	* common-src/protocol.c: Keep prevstate up to date.
	* server-src/planner.c (handle_result): Use prevstate to write
	  Request or Estimate timeout.

2003-01-01  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Undo patch of 2002-11-27. That doesn't work well for the planner.

	* common-src/amanda.h (days_diff): Revert to old macro.
	* server-src/amadmin.c: Undo Fix for newer days_diff.
	* server-src/planner.c: Undo Fix for newer days_diff.

2003-01-01  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/client_util.c: Fix memory leak reported by valgrind.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* common-src/amfeatures.c: Ditto.
	* common-src/debug.c: Ditto.
	* common-src/file.c: Ditto.
	* common-src/security.c: Ditto.
	* recover-src/amrecover.c: Ditto.
	* recover-src/extract_list.c: Ditto.
	* recover-src/set_commands.c: Ditto.
	* recover-src/uparse.y: Ditto.
	* recover-src/uscan.l: Ditto.
	* server-src/amcheck.c: Ditto.
	* server-src/amindexd.c: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/amlogroll.c: Ditto.
	* server-src/amtape.c: Ditto.
	* server-src/amtrmidx.c: Ditto.
	* server-src/amtrmlog.c: Ditto.
	* server-src/changer.c: Ditto.
	* server-src/conffile.c: Ditto.
	* server-src/diskfile.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/driverio.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/find.c: Ditto.
	* server-src/getconf.c: Ditto.
	* server-src/holding.c: Ditto.
	* server-src/logfile.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/reporter.c: Ditto.
	* server-src/tapefile.c: Ditto.
	* server-src/taper.c: Ditto.

2002-12-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.awk: Many fix.

2002-12-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (promote_highest_priority_incremental): Promote
	  a disk > balanced size if no full today. Do not promote a disk it's
	  the only disk due that day and no full today.

2002-12-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Brad Roberts <braddr@puremagic.com>

	* server-src/amflush.c: Remove 2 redundant amfree call after remove_sl.
	* server-src/holding.c (get_flush): Ditto.

2002-12-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c: New taperalgo configuration keyword.
	* server-src/conffile.h: Ditto.
	* man/amanda.8.in: Document it.
	* server-src/driver.c (startaflush): New function to start a flush to
	  tape.

2002-12-23  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Parse features from PORT-WRITE line.

2002-12-19  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	Don't use the G flag for samba backup restore by tar.
	* recover-src/extract_list.c (enum dumptypes): Add IS_SAMBA_TAR.
	* recover-src/extract_list.c (extract_files_child): Set dumptype to
	  IS_SAMBA_TAR if it's a SAMBA backup. Don't pass the G flag to tar
	  if it's IS_SAMBA_TAR.
	
2002-12-18  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.awk: Parse line with features, parse ENDFLUSH line.

2002-12-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (promote_highest_priority_incremental): Newer
	  algorithm that reduce the number of level 0 by hosts on a single day.

2002-12-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.awk: Parse newer log lines.

2002-12-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/selfcheck.c: Typo.

2002-12-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/reporter.c (output_stats): Typo.

2002-12-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/reporter.c: Print an usage by tape.

2002-12-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/tapeio.c (do_read): Init count to 0.

2002-12-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/Makefile.am: Install tapetype program as amtapetype.
	* docs/TAPETYPES: Change for amtapetype.
	* man/amtapetype.8.in: New man page
	* man/Makefile.am: Install it.
	* configure.in (AC_CONFIG_FILES): Add man/amtapetype.8.

2002-12-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/ammt.c (optind): Add prototype.
	* tape-src/amdd.c (optind): Add prototype.

2002-12-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/arglist.h (printf_arglist_function,
	  printf_arglist_function1, printf_arglist_function2): Define if
	  STDC_HEADERS is not defined.

2002-12-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: New --date option to display datestamp.
	* server-src/amstatus.pl.in: Increase some field size.
	* server-src/amstatus.pl.in: The host field adjust it's length to the
	 largest.

2002-11-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amanda.h (days_diff): Don't add a half day.
	* server-src/amadmin.c: Fix for newer days_diff.
	* server-src/planner.c: Fix for newer days_diff.

2002-11-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* tape-src/tapetype.c: Cast time_t to long for printing.

2002-11-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c: Write a "amflush: start at ???" line.
	* server-src/amstatus.pl.in: parse the "amflush: start at ???" line.

2002-11-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (delay_dumps): Use ap_snprintf.

2002-11-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/debug.c: Most of the code must in #ifdef DEBUG_CODE.
	* client-src/client_util.c: Use AMANDA_TMPDIR instead of AMANDA_DBGDIR.

2002-11-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/TAPE.CHANGERS: Sync with 2.5.0
	* changer-src/chg-juke.sh.in: New changer from 2.5.0
	* changer-src/chg-rait.sh.in: New changer from 2.5.0
	* changer-src/chg-null.sh.in: New changer from 2.5.0
	* changer-src/Makefile.am: Install them.
	* configure.in (AC_CONFIG_FILES): Add chg-juke.sh.in, chg-rait.sh.in and
	  chg-null.sh.in

2002-11-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c: Cleanup.

2002-11-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amadmin.8.in: Document new --days option of balance subcommand.

2002-11-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (days_diff): Make next_level0 more acurate.
	* server-src/amadmin.c (balance): Improve output.

2002-11-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c: Add Retry and Skip command to amrecover.

2002-11-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* tape-src/output-tape.c (tape_tapefd_fsf): Must not be static.

2002-11-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: Fix for LPRCMD not defined.

2002-11-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Orion Poplawski <orion@colorado-research.com>

	* server-src/planner.c (delay_dumps): Add the estimate size to all call
	  of delay_one_dump.

2002-11-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: Increase width of some field.

2002-11-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/scsi-solaris.c (SCSI_ExecuteCommand): Init ret to 0.

2002-11-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (delete_file): j is int.
	* changer-src/scsi-defs.h (B, B1): Check if already defined.
	* server-src/taper.c: Some cast to int.
	* tape-src/amdd.c (read_func, write_func): Complete prototype.
	* tape-src/tapeio.h (tapefd_read, tapefd_write): return ssize_t, 
	  third argument is size_t.
	* tape-src/tapeio.c: Ditto.
	* tape-src/output-file.h (file_tapefd_read, file_tapefd_write): return 
	  ssize_t, third argument is size_t.
	* tape-src/output-file.c: Ditto.
	* tape-src/output-null.h (null_tapefd_read, null_tapefd_write): return 
	  ssize_t, third argument is size_t.
	* tape-src/output-null.c: Ditto.
	* tape-src/output-rait.h (rait_read, rait__write): return ssize_t,
	  third argument is size_t.
	* tape-src/output-rait.c: Ditto.
	* tape-src/output-tape.h (tape_tapefd_read, tape_tapefd_write): return 
	  ssize_t, third argument is size_t.
	* tape-src/output-tape.c: Ditto.

2002-11-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: socklen_t default to int.
	* common-src/dgram.c (dgram_recv): addrlen is socklen_t.
	* common-src/stream.c (stream_server): len is socklen_t.
	* recover-src/extract_list.c (add_file): j is int.

2002-11-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (test_name_len) Remove variable.
	* common-src/match.c (len_prefix): Change type to int.
	* server-src/taper.c: Use %p to print pointer.
	* tape-src/amdd.c (read_func, write_func):Change return type to ssize_t.
	* tape-src/amdd.c (debug): Renamed to debug_amdd.
	* tape-src/ammt.c (debug): Renamed to debug_ammt.

2002-11-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amidxtaped.c: Fix restore from file.

2002-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amidxtaped.c: Fix newline in string literal.

2002-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c (maxdumpsize): New option.
	* server-src/conffile.h: Ditto.
	* server-src/planner.c: Use maxdumpsize if set.
	* example/amanda.conf.in: Document it.
	* man/amanda.8.in: Document it.

2002-11-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.h (fe_amidxtaped_fsf, fe_amidxtaped_label,
	  fe_amidxtaped_device, fe_amidxtaped_host, fe_amidxtaped_disk,
	  fe_amidxtaped_datestamp, fe_amidxtaped_header, fe_amidxtaped_nargs,
	  fe_amidxtaped_config): New features.
	* common-src/amfeatures.c (am_init_feature_set): Set new features.
	* recover-src/extract_list.c: Send new protocol data to amidxtaped.
	* restore-src/Makefile.am: amidxtaped.c need libamserver.
	* restore-src/amidxtaped.c: Read new protocol data from amrecover.
	* restore-src/amidxtaped.c: Use new configuration options.
	* server-src/conffile.c (conf_amrecover_do_fsf,
	  conf_amrecover_check_label, conf_amrecover_changer): New config.
	* server-src/conffile.h: New config options.
	* example/amanda.conf.in: Document them.
	* man/amanda.8.in: Document them.

2002-11-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* autogen: touch config/config.h.in
	* configure.in: Patch from autoupdate-2.53 and LIBOBJS.
	* common-src/Makefile.am: Build versuff.o before version.o
	* recover-src/Makefile.am: Remove work around for automake-1.2

2002-11-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

        * configure.in: Remove --disable-libtool.
        * */Makefile.am: Remove WANT_LIBTOOL.

2002-11-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/chg-scsi.c (config_name, config_dir): Remove declaration.
	* server-src/amadmin.c: Ditto.
	* server-src/amcheck.c: Ditto.
	* server-src/amcleanupdisk.c: Ditto.
	* server-src/amflush.c: Ditto.
	* server-src/amindexd.c: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/amlogroll.c: Ditto.
	* server-src/amtape.c: Ditto.
	* server-src/amtrmidx.c: Ditto.
	* server-src/amtrmlog.c: Ditto.
	* server-src/diskfile.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/getconf.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/reporter.c: Ditto.
	* server-src/taper.c: Ditto.
	* server-src/conffile.c: (config_name, config_dir): Add declaration.

2002-11-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amrestore.8: Amrestore doesn't use a changer.

2002-11-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in (SHELL): Don't set it, libtool do it.

2002-10-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/ltmain.sh, config/libtool.m4i: Update from libtool 1.4.3.

2002-10-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amrestore.c: New '-l <label>' flag, Do a rewind and
	  check the label before restoring.
	* man/amrestore.8: Document -l flag.

2002-10-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in (AM_HAVE_MT_FLAGS, AM_HAVE_MT_FILENO, AM_HAVE_MT_BLKNO,
	  AM_HAVE_MT_DSREG,AM_HAVE_MT_ERREG): Rename to HAVE_MT_FLAGS,
	  HAVE_MT_FILENO, HAVE_MT_BLKNO, HAVE_MT_DSREG and HAVE_MT_ERREG.
	* tape-src/output-tape.c: Ditto.

2002-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Undo patch of 2002-10-24. They are needed by amrecover.

	* client-src/getfsent.h (open_fstab, close_fstab, get_fstab_nextentry,
	  is_local_fstype): Add Prototype.
	* client-src/getfsent.c (open_fstab, close_fstab, get_fstab_nextentry,
	  is_local_fstype): remove Prototype.

2002-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
        Patch by Paul Bijnens <paul.bijnens@xplanation.com>

        * tape-src/tapetype.c: Detects and warns the user if the tape drive
	  has hardware compression enabled.

2002-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amrestore.c: New '-f <fileno>' flag, Do a rewind and
	  'fsf <fileno>' if -f is set.
	* man/amrestore.8: Document -f flag.

2002-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.h (fe_amindexd_fileno_in_OLSD,
	  fe_amindexd_fileno_in_ORLD): New amfeatures.
	* common-src/amfeatures.c (am_init_feature_set): Set
	  fe_amindexd_fileno_in_OLSD and fe_amindexd_fileno_in_ORLD.
	* recover-src/amrecover.h (struct DIR_ITEM): Add fileno.
	* recover-src/display_commands.c (add_dir_list_item): Set fileno
	  in struct DIR_ITEM.
	* recover-src/display_commands.c (suck_dir_list_from_server): Read
	  fileno if fe_amindexd_fileno_in_OLSD is set.
	* recover-src/extract_list.c (struct EXTRACT_LIST): Add fileno.
	* recover-src/extract_list.c (add_file): Read fileno if
	  fe_amindexd_fileno_in_ORLD is set.
	* recover-src/extract_list.c (delete_file): Read fileno if
	  fe_amindexd_fileno_in_ORLD is set.
	* server-src/amindexd.c (opaque_ls): Write fileno if
	  fe_amindexd_fileno_in_OLSD or fe_amindexd_fileno_in_ORLD are set.

2002-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Doug Kingston <dpk@pobox.com>

	* configure.in (NEED_PATH_ENV, IGNORE_UID_CHECK, IGNORE_FSTAB,
	  DONT_SUID_ROOT): Defined if on *-pc-cygwin.
	* client-src/Makefile.am: Fix for cygwin.
	* client-src/getfsent.c: Don't use fstab if IGNORE_FSTAB.
	* client-src/killpgrp.c: Don't suid(0) if DONT_SUID_ROOT.
	* client-src/rundump.c: Don't suid(0) if DONT_SUID_ROOT.
	* client-src/runtar.c: Don't suid(0) if DONT_SUID_ROOT.
	* client-src/selfcheck.c (check_suid): Don't check uid if
	  IGNORE_UID_CHECK.
	* common-src/alloc.c (safe_env): Add PATH to ENV if NEED_PATH_ENV.
	* recover-src/amrecover.c: Don't check uid if IGNORE_UID_CHECK.

2002-10-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/getfsent.h (open_fstab, close_fstab, get_fstab_nextentry,
	  is_local_fstype): Remove Prototype.
	* client-src/getfsent.c (open_fstab, close_fstab, get_fstab_nextentry,
	  is_local_fstype): Add Prototype.

2002-10-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amindexd.c: New FEATURES command that read the features
	  set from the client and reply the features set of the server.
	* recover-src/amrecover.h: include "amfeatures.h"
	* recover-src/amrecover.c: Send the FEATURES command to the server
	  and read it's features set.

2002-10-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/Makefile.am: Work around for CYGWIN.
	* server-src/Makefile.am: Ditto.

2002-10-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: Remove empty command from $program_transform_name.

2002-10-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (READ_TIMEOUT): Increased to 240*60.

2002-10-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* Amanda 2.4.3 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.3).

2002-09-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/getfsent.c (open_fstab): Check if MNTTAB is defined.

2002-09-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* NEWS: Changes in release 2.4.3.

2002-09-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverifyrun.sh.in: New program.
	* man/amverifyrun.8.in: Man page for amverifyrun.
	* configure.in (AC_OUTPUT): add man/amverifyrun.8 and
	  server-src/amverifyrun.sh.
	* man/Makefile.am (SERVER_MAN_PAGES): Add amverifyrun.8.
	* man/amanda.8.in: Add amdd, ammt and amverifyrun in SEE ALSO.
	* man/amverify.8.in: Add amverifyrun(8) in SEE ALSO.
	* server-src/Makefile.am (sbin_SCRIPTS): Add amverifyrun.

2002-09-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverify.sh.in: Accept runtapes as a third argument.
	* man/amverify.8.in: Document it.

2002-09-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/missing: Updated from automake-1.5.

2002-09-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/config.guess: Updated from ftp://ftp.gnu.org/gnu/config/
	* config/config.sub: Updated from ftp://ftp.gnu.org/gnu/config/

2002-09-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendsize.c (getsize_dump): Print the fstype.
	* client-src/sendbackup-dump.c (start_backup): Print the fstype.

2002-09-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by  Florian Hars <hars@bik-gmbh.de>

	* changer-src/chg-zd-mtx.sh.in: Fix default value for cleancycle.

2002-09-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (extract_files): print tape drive
	  and host before asking to load tape.

2002-09-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/taper.c (read_file): Initialize file,
	  stat(file.cont_filename) before opening it.
	  
2002-09-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverify.sh.in: Don't check that the device is
	  a character device, it could be a file: or rait:

2002-09-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.c (am_set_default_feature_set):
	  fe_rep_options_sendbackup_options is a default feature.

2002-09-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Sort a disk in datestamp order.

2002-09-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Text by Jean-Francois Malouin <Jean-Francois.Malouin@bic.mni.mcgill.ca>

	* docs/EXCLUDE: Improve documentation.

2002-09-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: Fix compilation error if LPRCMD is not defined.

2002-08-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* Amanda 2.4.3b4 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.3b4).
	* NEWS: Changes in release 2.4.3b4.

2002-08-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Jason Brooks <jason0@mail.wrs.com>

	* docs/chg-scsi.notes: New document.
	* changer-src/chg-scsi.c: Adding printout of "emubarcode" values
	  in the debug file.
	* changer-src/scsi-changer-driver.c: Added dlt8000 and L500 to
	  ChangerIO[].
	* changer-src/sense.c: Added dlt8000 and L500 to SenseType[].

2002-08-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* tape-src/output-null.c (null_tape_stat, null_tape_access): Use 
	  "/dev/null" instead of filename.

2002-08-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/scsi-hpux.c: Add amanda copyright.

2002-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/uparse.y: Fix compiler warning.

2002-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amtrmidx.c: Continue if a directory doesn't exist.

2002-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in (tapecycle): Improve documentation.

2002-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Works with features.

2002-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.c (am_feature_to_string): Return the string
	  "UNKNOWNFEATURE" if no features.
	* common-src/amfeatures.c (am_string_to_feature): Return NULL if the
	  string is "UNKNOWNFEATURE".

2002-08-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/file.c (debug_agets): line_free was badly set when
	the buffer size in increased.

2002-07-19  John R. Jackson (jrj@purdue.edu)

	* common-src/amanda.h: Fix bad #define.

2002-07-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by David Munro <D.Munro@surrey.ac.uk>

	* common-src/sl.c (new_sl): Alloc (sl_t) instead of (sl_t *).
	  
2002-06-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Bug reported by
	  Jonathan R. Johnson <Jonathan.Johnson@MinnetonkaSoftware.com>

	* server-src/reporter.c: Fix psfname filename.

2002-05-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup.c: Don't do compression if it is server side.
	* client-src/sendbackup-dump.c: Ditto.
	* client-src/sendbackup-gnutar.c: Ditto.

2002-05-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Manuel Bouyer <bouyer@antioche.lip6.fr>

	* server-src/taper.c (detach_buffers): Fix compilation with mmap.

2002-04-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (extract_files): Set dump_device_name
	  after the call of okay_to_continue.

2002-04-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	New features to describe the OPTIONS line of a REP packet.
	* common-src/amfeatures.h: Add fetures fe_rep_options_maxdumps,
	  fe_rep_options_hostname, fe_rep_options_features and
	  fe_rep_options_sendbackup_options.
	* common-src/amfeatures.c (am_init_feature_set): Add
	  fe_rep_options_features.
	* client-src/selfcheck.c: Write REP packet according to server features.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.

2002-04-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.h: 
	     Rename fe_g_options_maxdump  to fe_req_options_maxdumps
	     Rename fe_g_options_hostname to fe_req_options_hostname
	     Rename fe_g_options_features to fe_req_options_features
	* common-src/amfeatures.c: Ditto
	* server-src/amcheck.c: Ditto
	* server-src/dumper.c: Ditto
	* server-src/planner.c: Ditto

2002-04-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: Check if it can send features, hostname or
	  maxdumps on the global options line. Don't send hostname and
	  maxdumps for a noop service.
	* server-src/dumper.c: Ditto.
	* server-src/planner.c: Ditto.

2002-04-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup.c: (optionstr): Add srvcomp-best and
	  srvcomp-fast options.

2002-04-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c (start_host): Check the todo bit before
	  sending noop REQ.

2002-04-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (parse_options, parse_g_options): Check
	  for duplication options.
	* client-src/client_util.h (COMPR_SERVER_FAST, COMPR_SERVER_BEST):
	  Declare.
	* client-src/selfcheck.c: Check for COMPR_FAST or COMPR_BEST.

2002-04-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/selfcheck.c (host):Remove variable,use g_options->hostname.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.

2002-04-20  Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-aix.c: Fixed bug with the setting of the GSC driver
	  Added detection and setting of device type tape/robot
	* changer-src/scsi-bsd.c: Added detection and setting of device 
	  type tape/robot
	* changer-src/scsi-cam.c: Added detection and setting of device 
	  type tape/robot
	* changer-src/scsi-hpux_new.c: Added detection and setting of device 
	  type tape/robot
	* changer-src/scsi-linux.c: Added detection and setting of device 
	  type tape/robot
	* changer-src/scsi-solaris.c: Added detection and setting of device 
	  type tape/robot
	* changer-src/scsi-irix.c: Added detection and setting of device 
	  type tape/robot
	* changer-src/scsi-changer-driver.c: Now there is an device handler
	  for an generic tape and an generic robot.
	  The result length from the read element status is now checked
	  and only fields which are in this area are used.. (Some librarys
	  retrun only 4 byte, expected are 52)
	* changer-src/scsi-defs.h: Fixed the some defines in 
	  ElementStatusPage_T, 

2002-04-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (parse_g_options) New function to parse
	  the global options string.
	* client-src/client_util.h (parse_g_options): Prototype.
	* client-src/selfcheck.c: use parse_g_options.
	* client-src/sendbackup.c: use parse_g_options.
	* client-src/sendsize.c: use parse_g_options.

2002-04-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.c: Improve message for missing features.

2002-04-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	Add many features.
	* common-src/amfeatures.c (am_set_default_feature_set): New function
	  to set the default features set.
	* common-src/amfeatures.h (am_set_default_feature_set): Prototype.
	* common-src/amfeatures.h: Rename amanda_feature_auth_keyword to
	  fe_options_auth.
	* client-src/client_util.c: Check features.
	* server-src/amcheck.c: Ditto.
	* server-src/diskfile.c: Ditto.
	* server-src/driverio.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/diskfile.h (optionstr): Change prototype.
	* client-src/sendsize.c: Fix compiler warning.

2002-04-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.c: Renamed from features.c
	* common-src/amfeatures.h: Renamed from features.h
	* common-src/Makefile.am: Rename features to amfeatures.
	* client-src/amandad.c: Ditto.
	* client-src/client_util.h: Ditto.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* server-src/amcheck.c: Ditto.
	* server-src/diskfile.h: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/taper.c: Ditto.

2002-04-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c: Default dumporder set to "ttt".
	* server-src/driver.c: If dumporder is too short, use t and T.
	* man/amanda.8.in: Default dumporder set to "ttt".

2002-04-13  John R. Jackson (jrj@purdue.edu)

	* common-src/features.c: Add amanda_feature_auth_keyword feature so
	  authorization in the OPTIONS string is backward compatible.
	* common-src/features.h: Ditto.
	* client-src/client_util.c: Ditto.
	* client-src/client_util.h: Ditto.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* server-src/diskfile.c: Ditto.

2002-04-13  John R. Jackson (jrj@purdue.edu)

	* server-src/diskfile.c: Fix memory leak.

2002-04-13  John R. Jackson (jrj@purdue.edu)

	* common-src/features.c: New file.  Add support for feature sets so
	  different Amanda versions can work together.
	* common-src/features.h: Ditto.
	* common-src/Makefile.am: Ditto.  Add "features" test program.
	* client-src/amandad.c: Add "noop" service to return the feature set.
	* client-src/selfcheck.c: Accept and return a feature set in OPTIONS.
	  Improve parsing.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* common-src/error.c: Use strcasecmp.
	* common-src/protocol.c: Use dbprintf for PROTO_DEBUG and improve
	  messages.  Improve parsing.
	* common-src/security.c: Improve parsing.
	* server-src/amcheck.c: Ask for client features via "noop" before
	  doing the real "selfcheck" service requests.  Improve parsing.
	* server-src/amflush.c: Minor coding format cleanup.
	* server-src/diskfile.c: Initialize the features hosttype field.
	* server-src/diskfile.h: Add the features hosttype field.
	* server-src/driver.c: Save the features from the schedule.  Clean
	  up some error messages.
	* server-src/driverio.c: Add features string to several commands.
	* server-src/dumper.c: Deal with features string in commands.  Improve
	  parsing.
	* server-src/planner.c: Ask for client features via "noop" before
	  doing the real "sendsize" service requests.  Improve parsing.
	* server-src/server_util.c: Minor coding cleanup.
	* server-src/server_util.h: Increase the number of args allowed on
	  commands.
	* server-src/taper.c: Deal with features string in commands.  Improve
	  parsing.

2002-04-11  John R. Jackson (jrj@purdue.edu)

	* common-src/stream.c: Clean up an error message.

2002-04-09  John R. Jackson (jrj@purdue.edu)

	* server-src/driver.c: Fix send of QUIT to taper when it is down.

2002-04-07  John R. Jackson (jrj@purdue.edu)

	* server-src/reporter.c: Move column routines to conffile.c so amcheck
	  can use them in its tests.  Do not abort on several failures, but
	  generate messages in the FAILURE AND STRANGE DUMP SUMMARY section.
	* server-src/conffile.c: Move column routines to here.
	* server-src/conffile.h: Ditto.
	* server-src/amcheck.c: Add several config file tests.
	* server-src/logfile.c: Change "reporter" to "amreport".

2002-04-07  John R. Jackson (jrj@purdue.edu)

	* configure.in: Add /usr/local/sbin to LOCPATH.

2002-03-31  John R. Jackson (jrj@purdue.edu)

	* server-src/amcheck.c: Send maxdumps and hostname in packet OPTIONS.

2002-03-31  John R. Jackson (jrj@purdue.edu)

	* changer-src/scsi-defs.h: Fix compiler warning and bug it was hiding.
	* changer-src/scsi-solaris.c: Ditto.

2002-03-31  John R. Jackson (jrj@purdue.edu)

	* client-src/amandad.c: Add relative timestamps to a lot of debug
	  file messages, and add more messages, to better track what is
	  going on.  Various general cleanup.
	* client-src/calcsize.c: Ditto.
	* client-src/client_util.c: Ditto.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup-dump.c: Ditto.
	* client-src/sendbackup-gnutar.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendbackup.h: Ditto.
	* client-src/sendsize.c: Ditto.
	* common-src/Makefile.am: Ditto.
	* common-src/amanda.h: Ditto.
	* common-src/clock.c: Ditto.
	* common-src/clock.h: Ditto.
	* common-src/debug.c: Ditto.
	* common-src/dgram.c: Ditto.
	* common-src/error.c: Ditto.
	* common-src/pipespawn.c: Ditto.
	* common-src/security.c: Ditto.
	* common-src/stream.c: Ditto.
	* common-src/util.c: Ditto.
	* man/amanda.8.in: Ditto.
	* restore-src/amidxtaped.c: Ditto.
	* restore-src/amrestore.c: Ditto.
	* server-src/amindexd.c: Ditto.
	* server-src/getconf.c: Ditto.
	* server-src/planner.c: Ditto.

2002-03-31  John R. Jackson (jrj@purdue.edu)

	* client-src/sendsize.c: Pay attention to the spindle number.

2002-03-30  John R. Jackson (jrj@purdue.edu)

	* server-src/planner.c: General delay_dumps code cleanup.

2002-03-30  John R. Jackson (jrj@purdue.edu)

	* server-src/planner.c: Make sure individual dumps larger than a tape
	  are not added back into the schedule.  Found by Uncle George
	  <gatgul@voicenet.com>.

2002-03-29  John R. Jackson (jrj@purdue.edu)

	* man/amanda.8.in: Move "comment" in tapetype after inclusion of
	  previous definition.  Found by Uncle George <gatgul@voicenet.com>.

2002-03-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (fixup_relative): New function to prepend 
	  the dirname if relative.
	* client-src/client_util.c (build_exclude, build_include): Use 
	  fixup_relative.
	* client-src/client_util.c (parse_options): Do not prepend the dirname.
	* client-src/selfcheck.c (check_options): Don't generate ERROR for samba
	  if optional is set.

2002-03-24  John R. Jackson (jrj@purdue.edu)

	* common-src/debug.c: Change dbopen() message slightly to match what
	  amdump generates, making it easier to parse.

2002-03-24  John R. Jackson (jrj@purdue.edu)

	* common-src/Makefile.am: Move clock routines to common-src so
	  everyone may use them.
	* server-src/Makefile.am: Ditto.

2002-03-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup-gnutar.c: Fix use of no_record.

2002-03-24  Thomas Hepper ( th@ant.han.de)
	* changer-src/chg-scsi-chio.c: Fixed problems introduced by the agets change
	* client-src/sendbackup-dump.c: Fixed compile problem on AIX, no_record
	  is no longeer defined, ist is now options->no_record.

2002-03-24  John R. Jackson (jrj@purdue.edu)

	* client-src/amandad.c: Make sure argv[0] is valid before using it.
	* restore-src/amidxtaped.c: Ditto.
	* server-src/amindexd.c: Ditto.

2002-03-24  John R. Jackson (jrj@purdue.edu)

	* client-src/client_util.c: Use the Amanda memory allocation code.
	* client-src/sendbackup-gnutar.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* common-src/match.c: Ditto.
	* recover-src/amrecover.c: Ditto.
	* recover-src/display_commands.c: Ditto.
	* recover-src/extract_list.c: Ditto.
	* restore-src/amidxtaped.c: Ditto.
	* server-src/amflush.c: Ditto.
	* server-src/disk_history.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/list_dir.c: Ditto.
	* common-src/amanda.h: Always pass the source file and line number
	  to the memory routines to make it easier to debug.
	* common-src/alloc.c: Ditto.
	* common-src/file.c: Ditto.
	* common-src/dgram.c: Ditto.
	* common-src/dgram.h: Ditto.

2002-03-24  Thomas Hepper ( th@ant.han.de)
	* changer-src/chg-scsi.c: Fixed problems introduced by the agets change
	* changer-src/chg-scsi.c (MapBarCode): Fixed error in eof handling
	  eof was not correctly detected, now use the feof function.
	* changer-src/scsi-aix.c (SCSI_OS_Version()): New function to print
	  the rcsid 
	* changer-src/scsi-aix.c: same as above
	* changer-src/scsi-cam.c: same as above
	* changer-src/scsi-hpux_new.c: same as above
	* changer-src/scsi-irix.c: same as above
	* changer-src/scsi-linux.c: same as above
	* changer-src/scsi-solaris.c: same as above
	* changer-src/scsi-changer-driver.c (DLT448ElementStatus()): Fixed 
	  error messages. Fixed some errors with the barcode handling.

2002-03-23  John R. Jackson (jrj@purdue.edu)

	* changer-src/chg-scsi-chio.c: Use agets instead of fgets.
	* changer-src/chg-scsi.c: Use agets instead of fgets.
	* client-src/client_util.c: Use agets instead of fgets.
	* recover-src/amrecover.c: Clean up output on EOF.
	* recover-src/extract_list.c: Use agets instead of direct stdio.
	  Clean up output on EOF.  Add '?' help.
	* recover-src/set_commands.c: Quote the new device in the verify
	  output to make it stand out.
	* server-src/amflush.c: Clean up output on EOF.  Clean up output
	  when multiple holding disk areas selected.  Clean up parsing.
	  Loop until valid user response.
	* server-src/find.c: Do not complain if log file is missing for
	  a new (datestamp == 0) tape.
	* server-src/holding.c: Use agets instead of fgets. Clean up
	  interactive input and output.

2002-03-23  John R. Jackson (jrj@purdue.edu)

	* client-src/selfcheck.c: Fix a compiler warning.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.

2002-03-23  John R. Jackson (jrj@purdue.edu)

	* client-src/getfsent.c (close_fstab()): Call endfsent() instead
	  of fclose(), if available.

2002-03-23  John R. Jackson (jrj@purdue.edu)

	* common-src/dbprintf (debug_printf): Make sure errno is preserved
	  across dbprint() calls.

2002-03-23  John R. Jackson (jrj@purdue.edu)

	* configure.in: Add -R$dir as well as -L$dir on Solaris when processing
	  --with-libraries to support shared libraries of support products.

2002-03-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/tapefile.c (write_tapelist): Write to a temp file and
	  rename it.
	* server-src/amlabel.c: Do not rename the tapelist file.
	* server-src/taper.c (label_tape): Do not rename the tapelist file.

2002-03-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (parse_options): Do not check if the
	  exclude file exist, it's done later.

2002-03-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (parse_options): Parse exclude-optional and
	  include-optional.
	* client-src/client_util.h (option_t): New exclude_optional and
	  include_optional field.
	* man/amanda.8.in: Document optional.
	* server-src/amadmin.c (disklist_one): Display optional.
	* server-src/conffile.c: Parse optional keyword.
	* server-src/conffile.h (dumptype_t): New exclude_optional and
	  include_optional field.
	* server-src/diskfile.c (read_diskline): Copy optional bits.
	* server-src/diskfile.c (optionstr): Print optional bits.
	* server-src/diskfile.h (disk_t): New exclude_optional and
	  include_optional field.
	* server-src/planner.c (getsize): Use new sendsize format if optional
	  bits are used.

2002-03-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (dump_to_tape): Call start_degraded_mode() if
	  taper failed.

2002-03-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (extract_files_setup): Add ^$ to host.

2002-03-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch from Michael Frankowski <mfrankow@winternet.com>

	* client-src/sendbackup-gnutar.c: Test for subdir before dbprintf.

2002-03-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (init_options): New function.
	* client-src/client_util.h (init_options): Prototype.
	* client-src/sendsize.c (main): Use init_options.

2002-03-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client-util.c: Check for include and exclude files.

2002-03-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Fix.
	* server-src/conffile.c(get-compress): Change message for bad
	  compress argument.

2002-03-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Fix.

2002-03-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup-dump.c: use amdevice as argument to
	  amname_to_fstype.

2002-03-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* Amanda 2.4.3b3 released
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.3b3)

2002-03-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* ReleaseNotes: New file.
	* NEWS: New item for 2.4.3b3.

2002-03-07 John R. Jackson (jrj@purdue.edu)

	* changer-src/chg-zd-mtx.sh.in: Allow whitespace on a VolumeTag line.
	  Compliments of Christopher McCrory <chrismcc@pricegrabber.com>.

2002-03-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/amrecover.h (list_disk): Prototype.
	* recover-src/set_commands.c (list_disk): New function.
	* recover-src/uparse.y: parse LISTDISK.
	* recover-src/uscan.l: listdisk keyword.
	* recover-src/help.c: help for listdisk.
	* man/amrecover.8.in: Doc for listdisk.
	* server-src/amindexd.c: New LISTDISK command.
	* docs/INDEXING: Document LISTDISK command.

2002-03-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Better output for autoflush.

2002-03-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Fix.

2002-03-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (disklist_one): Print dp->device.
	* server-src/amcheck.c (start_host): Send device if specified.
	* server-src/amstatus.pl.in: Parse line with device.
	* server-src/diskfile.c (parse_diskline): Parse device.
	* server-src/diskfile.c (match_disklist): Match on device.
	* server-src/diskfile.h (disk_t): New field device.
	* server-src/driverio.c: (dumper_cmd): Send device.
	* server-src/dumper.c (main): Parse device in request.
	* server-src/dumper.c (start_dump): New device argument, send
	  device to client.
	* server-src/planner.c (getsize): Send device to client.
	* server-src/server_util.h (MAX_ARGS): Set it to 12.
	* client-src/client_util.c (add_include, build_exclude, build_include,
	  parse_options): New device argument.
	* client-src/client_util.h (build_exclude,build_include,parse_options):
	  New prototype.
	* client-src/selfcheck.c: Use device.
	* client-src/sendbackup-dump.c: Use device.
	* client-src/sendbackup-gnutar.c: Use device.
	* client-src/sendbackup.c: Use device.
	* client-src/sendbackup.h (start_backup): New device argument.
	* client-src/sendsize.c: Use device.
	* man/amanda.8.in: Document new disklist syntax.
	* example/disklist: Give example.

2002-03-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Write "wait to flush" only if waittaper
	  is requested.

2002-03-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Fix for failed tape.

2002-02-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in: Document multiple exclude.
	* man/amanda.8.in: Document include.

2002-02-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client-util.c (add_include): Include are glob expression.

2002-02-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/debug.c (debug_open); Don't try to renmae an already
	  renamed file.

2002-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c (dump_configuration): Print multiple
	  exclude and include.

2002-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (add_exclude, add_include): Typo.

2002-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (build_include, build_exclude): Fix for
	  bad eof detection.

2002-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (get_name): Create a file name.
	* client-src/client_util.c (build_name): Remove old files,
	  build an unused file name.
	* client-src/client_util.c (add_exclude): Add an exclude pattern to
	  the exclude file.
	* client-src/client_util.c (add_include): Add an include to the
	  include file.
	* client-src/client_util.c (build_exclude): Concat all excludes in
	  one file.
	* client-src/client_util.c (build_include): Concat all includes in
	  one file.
	* client-src/client_util.h (build_exclude, build_include): Prototype.
	* client-src/selfcheck.c.diff (check_options): Call build_exclude
	  and build_include.
	* client-src/sendsize.c.diff: Call gtar with one
	  exclude file/include file.
	* client-src/sendbackup-gnutar.c.diff: Call gtar with one
	  exclude file/include file.

2002-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amanda.h (amfree): Change e local variable to e__errno.
	* common-src/amanda.h (strappend): Change t local variable to t_t_t.

2002-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendsize.c: Set include_file and include_list to NULL
	  when using old protocol.
	* client-src/sendbackup-gnutar.c: Include "." when using old protocol.

2002-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.h (dumptype_t): Add include_file and include_list.
	* server-src/conffile.c: Read include.
	* server-src/diskfile.h (disk_t): Add include_file and include_list.
	* server-src/diskfile.c (optionstr): Add include to the optionstr.
	* server-src/amadmin.c (disklist_one): Print include.
	* server-src/planner.c: Use new protocol if include is used.
	* client-src/client_util.h (option_t): Add include_file and include_list
	* client-src/client_util.c (parse_options): Parse include.
	* client-src/selfcheck.c (check_options): Print ERROR if include are
	  used for SAMBA or DUMP.
	* client-src/sendsize.c: Send include to gnutar.
	* client-src/sendbackup-gnutar.c: Send include to gnutar.

2002-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (parse_options): Check that files from 
	  'exclude list' exist'.
	* client-src/selfcheck.c (check_options): Give ERROR if multiple 
	  exclude are used with samba or if exclude are used with DUMP.

2002-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client_src/client_util.c (parse_options): Function to parse
	  the option string.
	* client_src/client_util.h (parse_options): Prototype.
	* client_src/client_util.h (option_t): Struct for options.
	* client_src/Makefile.am: Compile client_util.
	* client_src/selfcheck.c: Use new option_t and multiple exclude.
	* client_src/sendbackup.h: Use new option_t and multiple exclude.
	* client_src/sendbackup.c: Use new option_t and multiple exclude.
	* client_src/sendbackup-dump.c: Use new option_t and multiple exclude.
	* client_src/sendbackup-gnutar.c: Use new option_t and multiple exclude.
	* client_src/sendsize.c: Use new option_t and multiple exclude.
	* server-src/conffile.h: Use sl_t for exclude_file and exclude_list.
	* server-src/conffile.c: Multiple exclude.
	* server-src/diskfile.h: Use sl_t for exclude_file and exclude_list.
	* server-src/diskfile.c: Multiple exclude.
	* server-src/planner.c: Multiple exclude.

2002-02-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/pipespawn.c (pipespawnv): New funtion taking an
	  argv argument.
	* common-src/pipespawn.h (pipespawnv): Prototype.

2002-02-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h: Use sl_t instead of holding_t
	* server-src/holding.c: Ditto.
	* server-src/amcleanupdisk.c: Ditto.
	* server-src/amflush.c: Ditto.
	* server-src/find.c: Ditto.
	* server-src/planner.c: Ditto.

2002-02-11 John R. Jackson (jrj@purdue.edu)

	* configure.in: AIX needs the "other" getconf argument to find out
	  about large file support (XBS5_ILP32_OFFBIG instead of LFS).

2002-02-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/sl.h: New header file
	* common-src/sl.c: New file for list of string struct.
	* common-src/Makefile.am: Compile sl.c

2002-02-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/chg-zd-mtx.sh.in: Don't use '^' in expr match argument.

2002-02-10 John R. Jackson (jrj@purdue.edu)

	* configure.in: Add new file-pad tapetype option to take the place
	  of a positive/negative blocksize.  Blocksize may now only be
	  positive.  File-pad defaults to "true" which pads the last tape
	  record like it always has.
	* man/amanda.8.in: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/conffile.c: Ditto.  Fix typo in conffile test program.
	* server-src/conffile.h: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/taper.c: Ditto.

2002-02-10 John R. Jackson (jrj@purdue.edu)

	* configure.in: Save the ./configure args and display them in the
	  version string (e.g. amandad*debug and "amadmin xx version").
	* common-src/genversion.c: Ditto.

2002-02-10 John R. Jackson (jrj@purdue.edu)

	* common-src/alloc.c: Fix type mismatch issues discovered by splint
	  (www.splint.org).  Compliments of jens persson <jens@persson.cx>.
	* common-src/debug.c: Ditto.
	* common-src/dgram.c: Ditto.
	* common-src/file.c: Ditto.
	* common-src/fileheader.c: Ditto.
	* common-src/fileheader.h: Ditto.
	* common-src/getcwd.c: Ditto.
	* common-src/match.c: Ditto.
	* common-src/security.c: Ditto.
	* common-src/stream.c: Ditto.
	* common-src/strstr.c: Ditto.
	* common-src/token.c: Ditto.
	* recover-src/amrecover.c: Ditto.
	* recover-src/display_commands.c: Ditto.
	* recover-src/extract_list.c: Ditto.
	* recover-src/set_commands.c: Ditto.
	* server-src/reporter.c: Ditto.

2002-02-10 John R. Jackson (jrj@purdue.edu)

	* changer-src/chg-zd-mtx.sh.in: Major cleanup and general overhaul.
	* docs/TAPE.CHANGERS: Cleanup.

2002-02-09 John R. Jackson (jrj@purdue.edu)

	* common-src/arglist.h: Clean up gcc detection of printf style variable
	  argument list functions.
	* changer-src/scsi-changer-driver.c: Ditto.
	* common-src/debug.c: Ditto.
	* common-src/error.c: Ditto.
	* common-src/snprintf.c: Ditto.
	* common-src/token.c: Ditto.
	* common-src/token.h: Ditto.
	* server-src/amindexd.c: Ditto.
	* server-src/conffile.c: Ditto.
	* server-src/diskfile.c: Ditto.
	* server-src/logfile.c: Ditto.
	* server-src/logfile.h: Ditto.
	* server-src/server_util.c: Ditto.

2002-02-09 John R. Jackson (jrj@purdue.edu)

	* configure.in: Must look in both strings.h and string.h when trying
	  to find function declarations (strncasecmp was not found on AIX
	  but is really there and our override caused a mismatch error).

2002-02-09 John R. Jackson (jrj@purdue.edu)

	* configure.in: Add code to test for a type defined in other than the
	  autoconf expected locations.  Use it to look for socklen_t.

2002-02-08 John R. Jackson (jrj@purdue.edu)

	* server-src/amadmin.c (check_dumpuser): Make it fatal to attempt to
	  do an operation that would alter any files when run as someone other
	  than the dump user from amanda.conf.  This should prevent files from
	  ending up with incorrect ownership.

2002-02-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amrecover.8.in (settape): Document that the hostname is required
	  if the protocol (tape:, file:, rait:, null:) is specified.
	* man/amrecover.8.in (settape): Document that it is posible to
	  change the tape device when asked to load tape.

2002-02-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.c (scan_holdingdir): Create the list in
	  datestamp order.

2002-02-02 John R. Jackson (jrj@purdue.edu)

	* configure.in: Add unistd.h to list of places to look for ruserok()
	  declaration.  Reported by John Koenig <jfkoenig@vipb.com> on ALPHA
	  running OSF1 v5.1

2002-02-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Reported by Roland E. Lipovits <rel@lipo.at0.net>

	* server-src/amstatus.pl.in: Don't double-counts the failed
	  estimate partitions.

2002-01-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: New --with-maxtapeblocksize with a default of 32.
	* common-src/amanda.h: MAX_TAPE_BLOCK_KB is defined in amanda.h

2002-01-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/fileheader.c (build_header): Never write the
	  BLOCKSIZE= line.
	* common-src/fileheader.c (parse_file_header): Do not parse the
	  BLOCKSIZE= line.

2002-01-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/fileheader.c (build_header): Write the BLOCKSIZE= line
	  after the dd if=... line.
	* common-src/fileheader.c (parse_file_header): Ignore unknown line.

2002-01-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c: Init code to 0.

2002-01-29 John R. Jackson (jrj@purdue.edu)

	* tape-src/output-tape.c (tape_tapefd_fsf): Some systems cannot deal
	  with large stack variables, so allocate tape I/O buffers dynamically.
	* tape-src/tapeio.c (tapefd_rdlabel): Ditto.

2002-01-25 John R. Jackson (jrj@purdue.edu)

	* server-src/driver.c: Log non-zero exit codes and signals from all
	  the dumpers and taper.

2002-01-25 John R. Jackson (jrj@purdue.edu)

	* server-src/amindexd.c: Clean up reporting of errors by gethostby*()
	  functions.  Make sure they always report what they were trying to
	  look up, and don't bother reporting errno (it would be h_errno).
	* server-src/dumper.c: Ditto.
	* server-src/planner.c: Ditto.

2002-01-17  Thomas Hepper <th@ant.han.de>

	* changer-src/scsi-changer-driver.c (DecodeSense): Check if it is
	  an normal or an extended result from request sense, and only
	  print the correct infos for the detected type.
	* changer-src/scsi-changer-driver.c (RequestSense): Use the passed
	  pointer to store the result from request sense. Do not allocate
	  an own buffer. Fixed the bufer size which is passed to teh SCSI
	  function.
	* changer-src/scsi-changer-driver.c (ChangerStatus): Use the macros
	  for setting the device to use for query, don't use fix values.
	* changer-src/scsi-changer-driver.c (SCSI_Run): skip the sleep
	  if the status is ok, only sleep if we will loop.
	* changer-src/scsi-changer-driver.c (DebugPrint): Print an timestamp
	  to see how many time is used between the prints and so see where
	  the time is gone.

2002-01-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/fileheader.h (dumpfile_t): Add blocksize field.
	* common-src/fileheader.h (build_header): Change prototype.
	* common-src/fileheader.c (fh_init): blocksize default to
	  DISK_BLOCK_BYTES.
	* common-src/fileheader.c (parse_file_header): Parse BLOCKSIZE= line.
	* common-src/fileheader.c (build_header): Remove blocksize parameter,
	  write the BLOCKSIZE= line.
	* tape-src/tapeio.c: set file.blocksize, Change call to build_header.
	* restore-src/amrestore.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/taper.c: Ditto.
	* server-src/holding.c: Ditto.

2002-01-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/scsi-changer-driver.c (SCSI_ReadElementStatus):
	  set ret to -1.

2002-01-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c: Check for dp->todo.

2002-01-10   Thomas Hepper <th@ant.han.de>

        * changer-src/scsi-changer-driver.c: Fixed prototype for SCSI_ReadElementStatus
        * changer-src/scsi-changer-driver.c (eject_tape): Fixed error in the rewind 
        * changer-src/scsi-changer-driver.c (unload): Fixed error in the rewind logic
        * changer-src/scsi-changer-driver.c (load): Fixed error in the rewind logic
        * changer-src/scsi-changer-driver.c (GetElementStatus): Fixed error in the parameter list to SCSI_ReadElementStatus
        * changer-src/scsi-changer-driver.c (SCSI_ReadElementStatus): Changed the logic, if the size for DescriptorSize
	  is 0 try to get the size the old way, if this parameter greate 0 take this value as the size for the data
	  buffer which is used to hold the result. May fix a problem with an HP changer
	* changer-src/scsi-defs.h: Updated the structs for the different element types (Media Changer, Storage, Tape, Import)


2002-01-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Harlan Stenn <Harlan.Stenn@pfcs.com>

	* changer-src/chg-scsi.c: Typo.

2002-01-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/Makefile.am: Run `perl -c' on perl script.
	* client-src/Makefile.am: Ditto.
	* server-src/Makefile.am: Ditto.

2002-01-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Reported by Geert Uytterhoeven <geert@linux-m68k.org>

	* README: Amanda compile on Linux/m68k.

2002-01-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/chg-rth.pl.in: Typo. fi -> }.

2002-01-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Harlan Stenn <Harlan.Stenn@pfcs.com>

	* changer-src/chg-chio.pl.in: Typo. fi -> }.
	* changer-src/chg-chio.pl.in (prefix, exec_prefix): Set correctly.
	* changer-src/chg-chio.pl.in (max_picker): Init to -1.

2002-01-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (okay_to_continue_tape): Ignore \n
	  at end of string.

2002-01-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amoverview.pl.in: Ignore some line from amadmin.

2002-01-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* Amanda 2.4.3b2 released
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.3b2)
	* NEWS: New feature of amanda-2.4.3b2

2002-01-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* tape-src/output-tape.c (tape_tapefd_rewind, tape_tapefd_unload):
	  Init rc to -1.
	* changer-src/scsi-irix.c (SCSI_OpenDevice): Cast to int.
	* common-src/match.c (clean_regex): Cast to int.

2001-12-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/ltconfig: Remove.
	* config/ltmain.sh, config/libtool.m4i: Update from libtool 1.4.2.
	* config/config.guess: Update from
	  ftp://ftp.gnu.org/gnu/config/config.guess.
	* config/config.sub: Update from
	  ftp://ftp.gnu.org/gnu/config/config.sub.
	* config/depcomp, config/install-sh, config/missing,
	  config/mkinstalldirs: Update from automake 1.5.
	* config/Makefile.am (EXTRA_DIST): Remove ltconfig.

2001-12-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Harlan Stenn <Harlan.Stenn@pfcs.com>

	* configure.in: Add missing [.

2001-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c: Do not go in degraded mode in nodump mode.
	* server-src/conffile.c:Check many options to be sure they are positive.

2001-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/chg-scsi.c (get_relative_target): return -1;
	* changer-src/scsi-irix.c (SCSI_ExecuteCommand): Remove Zero variable.
	* common-src/amanda.h: include strings.h if HAVE_STRINGS_H is defined.
	* server-src/amadmin.c (info_one): Remove lev0date variable.
	* server-src/amadmin.c (import_db): Remove vers_comment variable.
	* server-src/amindexd.c (main): Remove arg_len variable.
	* server-src/amtrmidx.c (main): Remove level_position and
	  datestamp_position variables.
	* server-src/changer.c (changer_current): Remove checked variable.
	* server-src/conffile.c (read_confline): Check value of RESERVE.
	* server-src/conffile.c (get_tapetype): Check value of LENGTH and
	  FILEMARK.
	* server-src/diskfile.h: bit field of 1 bit must be unsigned.
	* server-src/driver.c (main): Don't check the value of RESERVE.
	* server-src/driver.c (find_diskspace): Remove as_pref variable.
	* server-src/driverio.c (getresult): cast cmd_t.
	* server-src/dumper.c (update_dataptr): save_type is a filetype_t.
	* server-src/find.c (search_logfile): Remove host_undo_ch and
	  disk_undo_ch variables.
	* server-src/holding.c (pick_datestamp): Remove result variable.
	* server-src/server_util.c (getcmd): Loop on a cmd_t variable.
	* server-src/taper.c (tape_writer_side): Remove out_open variable.
	* tape-src/tapeio.c (tapefd_close): Cast to (void *).

2001-12-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amrestore.c: Fix compiler warning.
	* changer-src/chg-scsi.c: Ditto.
	* common-src/fileheader.c: Ditto.
	* changer-src/scsi-changer-driver.c: Ditto.
	* changer-src/scsi-defs.h: Ditto.
	* client-src/selfcheck.c: Ditto.

2001-12-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: Set MAX_TAPE_BLOCK_KB on linux.

2001-12-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Blaz Zupan <blaz@amis.net>

	* changer-src/chg-zd-mtx.sh.in: typo.

2001-12-20 Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-changer-driver.c: Return error if the find_empty returns an error
	  In function LogSense try to reset the error counter. Fixed wrong pDev struct pointer in
	  TapeStatus. Must be INDEX_TAPECTL and not INDEX_TAPE at the start of the function

2001-12-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/selfcheck.c (check_access): New function (old check_file 
	  function).
	* client-src/selfcheck.c (check_file): Check that the filename is a 
	  file.
	* client-src/selfcheck.c (check_dir): Check that dirname is a directory.

2001-12-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Henning Schmiedehausen <henning@forge.intermeta.de>

	* common-src/file.c (safe_cd): Create the AMANDA_DBGDIR and 
	  AMANDA_TMPDIR directory.

2001-12-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/Makefile.am (pkgdata_DATA): Include RAIT and VTAPE-API.

2001-12-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverify.sh.in: Check that @AMANDA_TMPDIR@ exist.
	* server-src/amrmtape.sh.in: Ditto.

2001-12-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/Makefile.am: fix setting of libexec_PROGRAMS.

2001-12-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Work with amflush log.

2001-12-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (nodump): new argument, Don't start the dumpers
	  if set.
	* server-src/holding.c (get_flush): chdir to original cwd.
	* server-src/reporter.c: accept driver and amflush line in log.
	* server-src/amflush.c: exec driver to do the flushing.

2001-12-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Fixup for estimate, write flush line.

2001-12-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c (output_summary): Set origsize and 
	  outsize correctly.

2001-12-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (start_some_dumps): Fixup length of dumporder.

2001-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c: You can change the tape device
	  between each tape.

2001-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amrestore.c (restore): try to find the next chunk
	  in the current directory.

2001-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* example/amanda.conf.in: typo.

2001-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	
	Patch by Roland E. Lipovits <rel@lipo.at0.net>
	* example/amanda.conf.in: typo.

2001-12-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c, server-src/taper.c: Replace TRY_AGAIN
	by TRYAGAIN.

2001-11-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* Amanda 2.4.3b1 released
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.3b1)
	* NEWS: New feature of amanda-2.4.3

2001-11-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.c (lookup_host): Match must be exact.

2001-11-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c: Add host, disk, datestamp and level on
	FLUSH line. Add datestamp on DUMP line.
	* server-src/driver.c (read_flush): Read new format of FLUSH line.
	* server-src/driver.c (read_schedule): Read new format of DUMP line.
	* server-src/amflush.c: Write a datestamp on stderr.
	* server-src/amdump.sh.in: Write a datestamp on stderr.
	* server-src/amstatus.pl.in: Works with autoflush.

2001-11-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c (autoflush): New configuration options.
	* server-src/conffile.h (autoflush): New configuration options.
	* man/amanda.8.in: Document it.
	* example/amanda.conf.in: Document it.
	* server-src/holding.h (get_flush, pick_datestamp, pick_all_datestamp,
	cleanup_holdingdisk): New prototype.
	* server-src/holding.c (scan_holdingdir, cleanup_holdingdisk,
	get_flush): New function.
	* server-src/holding.c (pick_datestamp, pick_all_datestamp): New
	verbose argument.
	* server-src/amcleanupdisk.c: Change call to pick_all_datestamp.
	* server-src/amflush.c: Change call to pick_all_datestamp.
	* server-src/find.c: Change call to pick_all_datestamp.
	* server-src/planner.c: Write FLUSH line to driver, the schedule
	line contain the keyword DUMP.
	* server-src/planner.c: Add datestamp to SUCCESS and FAIL line.
	* server-src/amstatus.pl.in: New parsing of DUMP line.
	* server-src/driverio.h: New datestamp field in sched_t;
	* server-src/driver.c (build_diskspace): New function to build a
	assignedhd_t from an holding file.
	* server-src/driver.c (read_flush): New function to read the list
	of files to flush.
	* server-src/driver.c (read_schedule): Parse the keyword DUMP.
	* server-src/driver.c: Add datestamp to FAIL line.
	* server-src/dumper.c: Add datestamp to FAIL line.
	* server-src/reporter.c (timedata_t, repdata_t) : Major change of
	structure.
	* server-src/taper.c: Add datestamp to FAIL line.

2001-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c: New dumporder configuration.
	* server-src/conffile.h: Likewise.
	* server-src/driver.c (start_some_dumps): Use dumporder to
	select the next disk to dump.
	* example/amanda.conf.in: Give an example of dumporder.
	* man/amanda.8.in: Document it.

2001-11-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/amrecover.h (cd_glob, cd_regex, cd_dir): New prototypes.
	* recover-src/set_commands.c (cd_glob, cd_regex, cd_dir): New functions.
	* recover-src/uparse.y: Add new token CDX, call cd_glob instead
	of set_directory for cd command, call cd_regex for cdx command.
	* recover-src/uscan.l: On cdx string return CDX token.
	* recover-src/help.c: Document it.
	* man/amrecover.8.in: Document it.

2001-11-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/taper.c: Backport from 2.5.0 the change to use only
	one cmd_t type for all program.
	* server-src/server_util.h: Likewise.
	* server-src/server_util.c: Likewise.
	* server-src/dumper.c.orig: Likewise.
	* server-src/dumper.c: Likewise.
	* server-src/driverio.h: Likewise.
	* server-src/driverio.c: Likewise.
	* server-src/driver.c: Likewise.
	* server-src/amflush.c: Likewise.

2001-11-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: Backport from 2.5.0 the change to allow
	the "[host [disk]*]*" arguments on command.
	* server-src/planner.c: Likewise.
	* server-src/logfile.h: Likewise.
	* server-src/logfile.c: Likewise.
	* server-src/find.h: Likewise.
	* server-src/find.c: Likewise.
	* server-src/diskfile.h: Likewise.
	* server-src/diskfile.c: Likewise.
	* server-src/amtrmidx.c: Likewise.
	* server-src/amindexd.c: Likewise.
	* server-src/amflush.c: Likewise.
	* server-src/amdump.sh.in: Likewise.
	* server-src/amcheck.c: Likewise.
	* server-src/amadmin.c: Likewise.
	* restore-src/amrestore.c: Likewise.
	* man/amrestore.8: Likewise.
	* man/amflush.8.in: Likewise.
	* man/amdump.8.in: Likewise.
	* man/amcheck.8.in: Likewise.
	* man/amanda.8.in: Likewise.
	* man/amadmin.8.in: Likewise.
	* common-src/match.c: Likewise.
	* common-src/amanda.h: Likewise.

2001-10-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/Makefile.am: add amdd.8 and ammt.8 to EXTRA_DIST.

2001-09-26 John R. Jackson (jrj@purdue.edu)

	* server-src/reporter.c: Fix problem when column sizes are negative.

2001-09-21 John R. Jackson (jrj@purdue.edu)

	* server-src/Makefile.am: Add -I../common-src so genversion.h can be
	  found (since it is built on the fly).  Only fails when build is done
	  in a different directory than the sources.

2001-09-17 John R. Jackson (jrj@purdue.edu)

	* server-src/getconf.c: Add capabilities to amgetconf to return
	  build environment values and also to open and close a debug file
	  (e.g. for scripts).
	* man/amgetconf.8.in: Ditto.
	* changer-src/chg-scsi.c: Ditto.
	* common-src/amanda.h: Ditto.
	* common-src/debug.c: Ditto.
	* common-src/error.c: Ditto.
	* server-src/dumper.c: Ditto.

2001-09-17 John R. Jackson (jrj@purdue.edu)

	* server-src/planner.c: Make sure we do not attempt to bump beyond
	  level 9.

2001-09-15 Thomas Hepper (th@ant.han.de)
	* changer-src/chg-scsi.c: Added new config option autoinv, 
	if not set no auto inventory will be done if the label db is out of 
	sync. Reworked MapBarCode, now the parameters are passed as a struct 
	and the result is returned in this struct (MBC_T), 
	also removed some duplicate/nonsens code from MapBarCode
	Changed the definitions for slot_file. It was used duplicate, 
	1. as the config file set by amanda.conf, and second set by the
	config option in the chg-scsi config file. Now the file from
	amanda.conf is called chg_scsi_conf. and changer_file is renamed 
	to slot_file.
	Added check if cleanfile is not set, if true clean_file is set to NULL
	Now return if tape_device is not in the range 0-9.
	Added some checks if we have all informations like slot_file, 
	devices etc. Fixed and error in the search function, 
	if the searched vol is already loaded return the correct info 
	and not 'label not found'. Fixed error in the parameter passing 
	to get_relative_slot. If the option was -slot last we where 
	1 above the end parameter..

	* changer-src/scsi-bsd.c: Fix compile problems.
	* changer-src/scsi-changer-driver.c: Fixed the last problems :-) 
	for the label/barcode handling...
	* changer-src/scsi-defs.h: Added new struct MBC_T
	* changer-src/sense.c: Added some more messages for Exabyte 210 lib

2001-09-01 John R. Jackson (jrj@purdue.edu)

	* client-src/sendsize.c: Fix memory allocation problem.

2001-08-31 John R. Jackson (jrj@purdue.edu)

	* server-src/amindex.c: Fix memory leak.  Compliments of Robert Minsk
	  <egbert@centropolisfx.com>.
	* server-src/logfile.c: Fix memory leak.  Compliments of Robert Minsk
	  <egbert@centropolisfx.com>.

2001-08-30 John R. Jackson (jrj@purdue.edu)

	* server-src/planner.c: Fix problem with maintenance of total level
	  0 size when disk being brought back into the schedule was not doing
	  a level 0.  Compliments of Robert Minsk <egbert@centropolisfx.com>.

2001-08-24 John R. Jackson (jrj@purdue.edu)

	* server-src/amverify.sh.in: Fix missing backtick error.

2001-08-24 John R. Jackson (jrj@purdue.edu)

	* server-src/taper.c: Allocate buffers on page boundaries.

2001-08-22 John R. Jackson (jrj@purdue.edu)

	* tape-src/Makefile.am: Add chown/chgrp rules for ammt/amdd install
	  so they end up like all the other Amanda programs.

2001-08-16 John R. Jackson (jrj@purdue.edu)

	* docs/Makefile.am: Fix PORTS.USAGE -> PORT.USAGE typo.

2001-08-16 John R. Jackson (jrj@purdue.edu)

	* configure.in: Change release name to "2.4.2p2-tapeio".  Add missing
	  CAM header checks from the 2.5 branch.

2001-08-15 Thomas Hepper (th@ant.han.de)
	* changer-src/chg-scsi.c. Removed version 1 DB support from mapBarCode. Changed the way parameter
	are given to MapBarCode and returned from there. No a struct is passed where all infos
	will be returned to the calling function.
	If eject is set we will not call LogSense in chg-scsi because it is also called in the
	eject function.
	* changer-src/scsi-defs.h: Added struct MBC_T used by MapBarCode.
	* changer-src/scsi-changer-driver.c: Changed all calls to MapBarCode to the new way

2001-08-14 John R. Jackson (jrj@purdue.edu)

	* docs/EXCLUDE: New document from Andrew Hall <ahall@secureworks.net>
	  describing how to set up and use GNU tar exclusions.
	* docs/Makefile.am: Added EXCLUDE and PORT.USAGE.

2001-08-14 John R. Jackson (jrj@purdue.edu)

	* docs/PORT.USAGE: New document about how Amanda ports are used.

2001-08-14 John R. Jackson (jrj@purdue.edu)

	* common-src/stream.c: Add stream_client_privileged() function to
	  get a privileged port and fail if one is not available.  The older
	  stream_client() function gets a (non-privileged) port in the
	  configured portrange, if set and possible, else anything available.
	* common-src/stream.h: Prototypes.
	* recover-src/amrecover.c: Use stream_client_privileged() instead of
	  stream_client().
	* recover-src/extract_list.c: Ditto.
	* configure.in: Added several more port range sanity checks.  Added
	  --with-tcpportrange as an alias for --with-portrange.

2001-08-09 Thomas Hepper (th@ant.han.de)
	* changer-src/chg-scsi.c: Added check in MapBarCode if the labelfile
	parameter is empty, and if yes return. 
	Added global variable do_inventory, and if set do an inventory before
	exit.
	In MapBarCode changed the way the UPDATE_SLOT is done, now it uses
	the slot number passed to MapBarCode to find and update the record.
	* changer-src/scsi-changer-driver.c: Added def. for BreeceHill Q7
	Added global variables which are set by the tape_rdlabel function
	in eject/unload.
	Reworked the way how the updates of the labelfile are done.
	* docs/TAPE.CHANGERS: Added note about solaris 8 and the sgen driver.

2001-08-09 John R. Jackson (jrj@purdue.edu)

	* tape-src/output-tape.c: Missed a reference to TAPE_BLOCK_BYTES
	  while doing the tapetype "blocksize" changes.

2001-08-01 John R. Jackson (jrj@purdue.edu)

	* client-src/selfcheck.c: Fix typos I introduced into the PC subdir
	  patch.
	* client-src/sendbackup-gnutar.c: Ditto.
	* client-src/sendsize.c: Ditto.

2001-08-01 Marko Injac <marko.injac@mail.insert.si> via John R. Jackson (jrj@purdue.edu)

	* client-src/findpass.c: Allow backup of subdirs of PC shares for
	  amanda-2.4.1beta1 by Greg Shebert amanda-hackers list Tue Feb 1,
	  2000.  Ported to amanda-2.4.2p2 on debian potato by Marko Injac.
	* client-src/findpass.h: Ditto.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup-gnutar.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* docs/SAMBA: Ditto.

2001-08-01 John R. Jackson (jrj@purdue.edu)

	* client-src/sendsize.c: Prefix each debug line with sendsize process
	  information to make picking out the output from a particular estimate
	  run easier when maxdumps > 1.

2001-08-01 John R. Jackson (jrj@purdue.edu)

	* server-src/amcheck.c: Unlink the temp files as soon as they are
	  created so they always go away when amcheck terminates.  Use
	  pipespawn() instead of system() to call the MAILER program.

2001-08-01 John R. Jackson (jrj@purdue.edu)

	* common-src/debug.c: Only rename files that end in ".debug".

2001-08-01 John R. Jackson (jrj@purdue.edu)

	* common-src/pipespawn.c: Show empty pipespawn() args as "".

2001-07-31 John R. Jackson (jrj@purdue.edu)

	* server-src/conffile.h: Add support for tapetype "blocksize" keyword.
	* server-src/conffile.c: Add tapetype "blocksize" keyword.  Use
	  DISK_BLOCK_KB where appropriate instead of TAPE_BLOCK_SIZE.  Disallow
	  negative tape length and tapemark size.
	* client-src/sendbackup.c: Use new STREAM_BUFSIZE constant.  Use -1
	  for new default buffer size flag.
	* common-src/alloc.c: Add new amtable_free() function.  Adjust args
	  to amtable_alloc() to be consistent with amtable_free().
	* common-src/amanda.h: Add new am_round() and am_floor() macros.
	  Define new DISK_BLOCK_KB, DISK_BLOCK_BYTES, MAX_TAPE_BLOCK_KB,
	  MAX_TAPE_BLOCK_BYTES constants.  Remove TAPE_BLOCK_SIZE and
	  TAPE_BLOCK_BYTES.
	* common-src/fileheader.c: Change write_header() to build_header().
	  Add blocksize arg.  Get rid of unused fill_buffer() function.
	* common-src/fileheader.h: Ditto.
	* common-src/stream.c: Use negative value to indicate default buffer
	  size.
	* common-src/stream.h: Add NETWORK_BLOCK_BYTES and STREAM_BUFSIZE
	  constants.  Remove DATABUF_SIZE and DEFAULT_SIZE.
	* man/amanda.8.in: Document the new "blocksize" tapetype keyword.
	  Document that "length" in tapetype has meaning to some output
	  drivers.  Fix "bumpdays" and "speed" defaults.  Document new "file:"
	  output driver record length data file.
	* man/amrestore.8: Add new "-b blocksize" arg.  Add description of
	  how to catalogue the images on a tape.
	* recover-src/amrecover.c: DEFAULT_SIZE -> -1.
	* recover-src/extract_list.c: DEFAULT_SIZE -> -1.  Use DISK_BLOCK_BYTES
	  instead of TAPE_BLOCK_BYTES for the header size.
	* restore-src/amrestore.c: Add new "-b blocksize" arg.  Document how
	  the header is handled.  Deal with arbritrary tape record sizes.
	* server-src/amlabel.c: Use the tapetype blocksize.
	* server-src/driver.c: Use DISK_BLOCK_KB where appropriate instead of
	  TAPE_BLOCK_SIZE.
	* server-src/dumper.c: Use DISK_BLOCK_BYTES and DISK_BLOCK_KB as
	  appropropriate instead of older constants.  Rewrite disk I/O buffer
	  management.  Never pad output stream (e.g. to holding disk).  Use
	  -1 for default stream buffer size.
	* server-src/holding.c: Change TAPE_BLOCK_BYTES to DISK_BLOCK_BYTES.
	  Use fullread() instead of fill_buffer().
	* server-src/planner.c: Use tapetype blocksize instead of constant
	  for tape length calculations.
	* server-src/taper.c: Support tapetype blocksize.  Only pad writes if
	  blocksize is negative.  Reorganize shared memory buffers to put
	  data on page boundaries.  Try reducing tapebuf count if allocation
	  fails.
	* tape-src/output-file.c: Maintain record size information.  Use mask
	  and flags from caller.
	* tape-src/output-null.c: Use new amtable_alloc() arg order.
	* tape-src/output-rait.c: Use new amtable_alloc() arg order.  Add
	  private version of amtable_free() for standalone build.  Fix off
	  by one and other table allocation problems.
	* tape-src/output-rait.h: Maintain file descriptor count in the
	  structure.
	* tape-src/tapeio.c: Support tapetype blocksize.  Use new
	  amtable_alloc() arg order.  Fix some error message text.  
	* tape-src/tapeio.h: New prototypes with blocksize arg.
	* tape-src/tapetype.c: Add "-b blocksize" arg.  Fix some end case
	  aborts.

2001-07-31 Ben Lewis (bhlewis@purdue.edu) via John R. Jackson (jrj@purdue.edu)

	* configure.in: Add missing CAM header checks from the 2.5 branch.

2001-07-30 John R. Jackson (jrj@purdue.edu)

	* configure.in: Add CAM SCSI support section from the 2.5 branch.

2001-07-30 Ben Lewis (bhlewis@purdue.edu) via John R. Jackson (jrj@purdue.edu)

	* recover-src/amrecover.c: Improve the "Unexpected server end of file"
	  message.

2001-07-30 Ben Lewis (bhlewis@purdue.edu) via John R. Jackson (jrj@purdue.edu)

	* man/amanda.8.in: Document includefile.
	* man/amdump.8.in: Add note that local crontab documention should be
	  checked for proper syntax.
	* man/amrecover.8.in: Document use of PAGER environment variable.
	* man/amrestore.8: Document that GNU tar must be used as some vendor
	  tar programs cannot read GNU tar format.
	* docs/FAQ: Update location of online FAQ.

2001-07-25 John R. Jackson <jrj@purdue.edu>

	* docs/TAPE.CHANGER: Changes from Ben Lewis (bhlewis@purdue.edu) to
	  document the new (but optional) searchable features.

2001-07-20 John R. Jackson <jrj@purdue.edu>

	* common-src/security.c: Use NUM_STR_SIZE instead of hard coded
	  constant.
	* common-src/versuff.c.in: Ditto.

2001-07-19 John R. Jackson <jrj@purdue.edu>

	* common-src/error.c: Add new function errordump() that acts like
	  error() but calls abort() to (try to) drop core.
	* common-src/amanda.h: Prototype.
	* common-src/alloc.c: Call errordump() instead of error() for some
	  memory allocation failures to aid traceback.

2001-07-19 John R. Jackson <jrj@purdue.edu>

	* server-src/amadmin.c: Improve the error message when read_conffile()
	  fails.
	* server-src/amcheck.c: Ditto.
	* server-src/amcleanupdisk.c: Ditto.
	* server-src/amflush.c: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/amlogroll.c: Ditto.
	* server-src/amtape.c: Ditto.
	* server-src/amtrmidx.c: Ditto.
	* server-src/amtrmlog.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/getconf.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/reporter.c: Ditto.
	* server-src/taper.c: Ditto.

2001-07-19 John R. Jackson <jrj@purdue.edu>

	* server-src/driverio.c: Make the name "ps" reports match the dumper
	  name (e.g. "dumper3").

2001-07-18 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-chio.pl.in: Try to unload the drive before moving
	  a tape back to a slot.  Fixes a problem on Ecrix AutoPAK devices.
	  Patch compliments of Sam Leffler <sam@errno.com>.

2001-07-18 John R. Jackson <jrj@purdue.edu>

	* server-src/amverify.sh.in: Change to the Amanda temp directory
	  instead of the config directory.  In addition to making amverify
	  act like most other Amanda programs, this gets around an
	  xfsrestore bug.

2001-07-18 John R. Jackson <jrj@purdue.edu>

	* man/amanda.8.in: Describe the .amandahosts format better.  Clean up
	  a couple of minor typos.

2001-07-13 John R. Jackson <jrj@purdue.edu>

	* common-src/dgram.h: Improve UDP datagram size calculation.
	* server-src/amcheck.c: Break up large requests into pieces.
	* server-src/planner.c: Break up large requests into pieces.

2001-07-12 John R. Jackson <jrj@purdue.edu>

	* tape-src/amdd.c: Use tapefd_close() in amdd if the file was
	  opened with tape_open().  This does any necessary output driver
	  cleanup (such as moving the current file position for "file:").

2001-07-12 John R. Jackson <jrj@purdue.edu>

	* Makefile.am: Fix automake warning.

2001-07-11 John R. Jackson <jrj@purdue.edu>

	* tape-src/tapetype.c: Use tapefd_write() instead of write().

2001-07-11 John R. Jackson <jrj@purdue.edu>

	* common-src/file.c: Fix a memory leak.  Grab exponentially larger
	  chunks of memory up to a point, then level out.

2001-07-11 John R. Jackson <jrj@purdue.edu>

	* tape-src/tapetype.c: Only report a pass summary when stderr is not
	  a tty.  Deal with some obscure end cases.

2001-07-10 John R. Jackson <jrj@purdue.edu>

	* server-src/Makefile.am: Backport development branch chg-scsi code
	  to 2.4.2.
	* changer-src/chg-scsi.c: Ditto.
	* changer-src/libscsi.h: Ditto.
	* changer-src/scsi-aix.c: Ditto.
	* changer-src/scsi-bsd.c: Ditto.
	* changer-src/scsi-cam.c: Ditto.
	* changer-src/scsi-changer-driver.c: Ditto.
	* changer-src/scsi-defs.h: Ditto.
	* changer-src/scsi-hpux.c: Ditto.
	* changer-src/scsi-hpux_new.c: Ditto.
	* changer-src/scsi-irix.c: Ditto.
	* changer-src/scsi-linux.c: Ditto.
	* changer-src/scsi-solaris.c: Ditto.
	* changer-src/sense.c: Ditto.

2001-07-10 John R. Jackson <jrj@purdue.edu>

	* server-src/amcheck.c: Move user name check before attempt to create
	  temp files so more appropriate error message is generated.

2001-07-09 John R. Jackson <jrj@purdue.edu>

	* common-src/dgram.c: Fix error end case unitialized variable.

2001-07-05 John R. Jackson <jrj@purdue.edu>

	* docs/TAPE.CHANGERS: Minor docs/TAPE.CHANGERS update to clarify
	  that -slot and -eject unload and put the current tape away.

2001-07-02 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-manual.sh.in: Add yet another ONLINEREGEX, this one
	  compliments of Nick (n_hibma@qubesoft.com) for some FreeBSD variant.

2001-06-29 John R. Jackson <jrj@purdue.edu>

	* tape-src/tapeio.c: Move the device name parsing routines from the
	  RAIT module to tapeio and make them generic.  This allows one
	  module to open another, e.g. rait:{null:,z1,z2,z3}.  Maintain
	  both the original open flags and mask and use them on the real open.
	* tape-src/amdd.c: Make sure this compiles "stand-alone".  To do so,
	  use: gcc -Wall -DNO_AMANDA amdd.c output-rait.c output-tape.c.
	  Abort as soon as one of the open calls fails instead of waiting
	  for read/write to report a bad file descriptor.
	  Pass a mask to the open function in case the output is created.
	* tape-src/ammt.c: Make sure this compiles "stand-alone".  To do so,
	  use: gcc -Wall -DNO_AMANDA ammt.c output-rait.c output-tape.c.
	* tape-src/output-file.c: Maintain both the original open flags and
	  mask and use them on the real open.
	* tape-src/output-null.c: Ditto.
	* tape-src/output-file.h: Change to non-prototype declaration of
	  file_tape_open() to deal with the optional mask parameter.
	* tape-src/output-null.h: Ditto.
	* tape-src/output-tape.h: Ditto.
	* tape-src/tapeio.h: Ditto.  Add device name parsing prototypes.
	* tape-src/output-rait.c: Make sure this compiles "stand-alone".
	  Maintain both the original open flags and mask and use them on the
	  real open.
	* tape-src/output-rait.h: Make sure this compiles "stand-alone".
	* tape-src/output-tape.c: Make this part of the "stand-alone" compile
	  of ammt and amdd since it knows all the proper ioctl operations.
	  Maintain both the original open flags and mask and use them on the
	  real open.

2001-06-27 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-manual.sh.in: Add "bs=32k" to the dd command so
	  some kernels would not complain about the tape block being larger
	  than the buffer.
	* changer-src/chg-mtx.sh.in: Ditto.

2001-06-21 John R. Jackson <jrj@purdue.edu>

	* server-src/planner.c: If the compression rate is very small (such
	  as zero after some types of errors) and FORCE_FULL is set, a path
	  is taken that (among other bad things) generates a schedule that
	  driver cannot read (syntax errors).
	* server-src/conffile.c: Do not allow negative comprate values.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* server-src/holding.c: Use fullread() instead of read() to read the
	  holding disk file.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* server-src/amtape.c: Document "slot advance" in the help output.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* server-src/amindexd.c: Minor gethostbyaddr() argument change to be
	  consistent with other Amanda usage.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* server-src/amverify.sh.in: Better cross platform tar detection.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* server-src/amverify.sh.in: More of the vrestore vs. 'b' flag change.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* recover-src/amrecover.c: Add more debugging to guess_disk()
	  function to better track how the disk is determined from the
	  current working directory.  Report current working directory in
	  error message.  Change "Trying" to "Trying disk" to distinguish
	  this from host attempts.
	* recover-src/set_commands.c: Remove redundant amfree() call.  Remove
	  redundant "OISD /" exchange.  Change "Trying" to "Trying host" to
	  distinguish this from disk attempts.

2001-06-18 John R. Jackson <jrj@purdue.edu>

	* recover-src/extract_list.c: Do not pass a 'b' (blocking) factor
	  flag to vrestore.  Some versions do not like it.

2001-06-18 John R. Jackson <jrj@purdue.edu>

	* common-src/dgram.c: Use a sin_addr arg to inet_ntoa() like all the
	  other Amanda code.
	* common-src/stream.c: Ditto.

2001-06-18 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-manual.sh.in: Add yet another online regex.  Found
	  by George Herson <gherson@snet.net>.

2001-06-01 John R. Jackson <jrj@purdue.edu>

	* server-src/amindexd.c (build_disk_table): Make sure a holding disk
	  image is used rather than a copy also on tape, if both exist.

2001-05-29 John R. Jackson <jrj@purdue.edu>

	* server-src/reporter.c: Fix PostScript output to only show what went
	  on the tape, not what the total amount dumped.  Compliments of
	  Joshua Baker-LePain <jlb17@duke.edu>.

2001-05-18 John R. Jackson <jrj@purdue.edu>

	* client-src/patch-system.sh.in: Missed a reference to kamanda in the
	  last patch.  Compliments of Tom Schutter <t.schutter@att.net>.

2001-05-16 John R. Jackson <jrj@purdue.edu>

	* client-src/patch-system.sh.in: Go ahead and update /etc/services
	  on a client even if the services themselves are not turned on to
	  inetd.  Compliments of Tom Schutter <t.schutter@att.net>.  Add
	  the TCP port for amandad for future use.

2001-05-15 John R. Jackson <jrj@purdue.edu>

	* restore-src/amidxtaped.c: Call tape_stat() instead of stat() to
	  decide if an image is a file or a tape.

2001-05-14 John R. Jackson <jrj@purdue.edu>

	* client-src/amandad.c: Fix hang when the incoming packet size is
	  larger than the pipe buffer.  Also fix a buffer overflow bug.

2001-05-11 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-scsi.c: Add support for "-slot advance".

2001-05-11 John R. Jackson <jrj@purdue.edu>

	* common-src/util.c (bind_portrange): Log a debug message stating
	  explicitly that all ports in the requested range were busy, or
	  that a specific port failed bind() for an unexpected reason.

2001-05-11 John R. Jackson <jrj@purdue.edu>

	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.2p2)

2001-05-10 John R. Jackson <jrj@purdue.edu>

	* changer-src/scsi-changer-driver.c: Fix routine name in diagnostic
	  messages for DLT4000Eject.

2001-05-07 John R. Jackson <jrj@purdue.edu>

	* client-src/sendbackup-dump.c: Do not use full path to sed.  Found by
	  Roland E. Lipovits (rel@lipo.at0.net).

2001-05-04 John R. Jackson <jrj@purdue.edu>

	* config/depcomp: Fix problem with argument processing and update to
	  latest version.

2001-04-25 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-rth.pl.in: Add exec_prefix back since it is usually
	  used to define sbindir.  Sigh.  Include X=X assignments to get rid
	  of the Perl warnings.
	* server-src/amoverview.pl.in: Ditto.

2001-04-24 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-chio.pl.in: Remove unused exec_prefix to get rid of
	  warning message.  Patch from Nick Hibma <n_hibma@qubesoft.com>.

2001-04-23 John R. Jackson <jrj@purdue.edu>

	* client-src/selfcheck.c: Allow Samba shares with no password.
	* client-src/sendbackup-gnutar.c: Ditto.
	* client-src/sendsize.c: Ditto.

2001-04-21 John R. Jackson <jrj@purdue.edu>

	* tape-src/output-tape.c: Fix IRIX field reference (patch from Marc
	  W. Mengel <mengel@fnal.gov>).

2001-04-13 John R. Jackson <jrj@purdue.edu>

	* example/amanda.conf.in: Fix multiple holding disks comment.
	* example/amanda.conf.chg-scsi.in: Ditto, plus bring this file into
	  sync with the base version.

2001-04-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/getfsent.h (search_fstab): New prototype.
	* client-src/getfsent.c (search_fstab): New arg check_dev, skip
	entry if check_dev==1 and device stats failed.
	* client-src/getfsent.c (open_fstab for linux): Open MOUNTED.
	* client-src/getfsent.c (close_fstab for linux): close MOUNTED.
	* client-src/getfsent.c (get_fstab_nextentry for linux): parse MOUNTED.
	* client-src/getfsent.c (amname_to_devname, amname_to_dirname,
	amname_to_fstype): Call search_fstab sequentialy with 1 and 0
	for check_dev.

2001-04-10 John R. Jackson <jrj@purdue.edu>

	* docs/INSTALL: Update location to GNUPLOT per Lars Hecking
	  <lhecking@nmrc.ie>.

2001-04-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/config.guess: Upgrade from ftp://ftp.gnu.org/pub/gnu/config
	* config/config.sub: Upgrade from ftp://ftp.gnu.org/pub/gnu/config
	* config/mkinstalldirs: Upgrade from automake CVS.

2001-04-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/depcomp: new file for automake.

2001-04-03 John R. Jackson <jrj@purdue.edu>

	* Makefile.am: Remove *.test.c from the distribution.

2001-04-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Upgrade to the 2.5.0 code.

	* changer-src/chg-zd-mtx.sh.in: Added barcode reader support,
	>9 tape slot support, variable for 'offline' or 'ONLINE'
	return value of tape device, and multi-config support.  Moved
	all user settable variables to 'changerfile'.conf in the
	amanda config directory.  Added commented out example of .conf
	file into script.
	* NEWS: updated chg-zd-mtx.sh.in changer.

2001-04-02 John R. Jackson <jrj@purdue.edu>

	* NEWS: Initial notes for 2.4.2p2.

2001-03-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/getfsent.c (search_fstab): If the device doesn't 
	exist, it will take the entry from /etc/mtab.

2001-03-26 John R. Jackson <jrj@purdue.edu>

	* server-src/amtape.c: Do not rewind for slot "advance".  Do not report
	  device name (which is bogus) for slot "advance".

2001-03-23 John R. Jackson <jrj@purdue.edu>

	* example/amanda.conf.in: Add warning that the sample amanda.conf
	  will not work as is and must be edited to match the installation.

2001-03-21 John R. Jackson <jrj@purdue.edu>

	* recover-src/extract_list.c (extract_files_child): Fix problem that
	  caused xfsrestore arg list to not be NULL terminated.

2001-03-19 John R. Jackson <jrj@purdue.edu>

	* configure.in: Add --with-debug-days (default is 4) and remove
	  --with-pid-debug-files.
	* common-src/Makefile.am: Clean up test program dependencies.
	* common-src/debug.c: Create timestamped debug file names and remove
	  files older (based on file name) than --with-debug-days.  Rename old
	  style names to new style (based on modification time) the first time
	  they are seen.
	* common-src/file.c: Use construct_datestamp() instead of private code.
	* common-src/genversion.c: Display AMANDA_DEBUG_DAYS and remove
	  DEBUG_FILE_WITH_PID.
	* common-src/util.c: Move construct_datestamp to here and add new
	  function construct_timestamp.  Change time used to build string to
	  be an optional parameter instead of always getting it in the routine.
	* common-src/util.h: Add prototypes.
	* server-src/amcleanupdisk.c: Change construct_datestamp call to pass
	  indication that it should get the current time.
	* server-src/amflush.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/server_util.c: Remove construct_datestamp (now in util.c).
	* server-src/server_util.h: Remove prototype.

2001-03-15 John R. Jackson <jrj@purdue.edu>

	* server-src/planner.c (analyze_estimate): Do not do an incremental
	  if FORCE_NO_BUMP is set and the last dump was a level 0.

2001-03-14 John R. Jackson <jrj@purdue.edu>

	* server-src/amcheck.c: Change message from NOTE to WARNING when
	  the hold file exists.
	* man/amcheck.8.in: Ditto.

2001-03-14 John R. Jackson <jrj@purdue.edu>

	* client-src/selfcheck.c: Send smbclient via pipe instead of command
	  line arg.  Various minor cleanups.  Use pipespawn instead of system()
	  to clean up quoting problems and be consistent with sendsize and
	  sendbackup.
	* client-src/sendbackup-dump.c: Send smbclient via pipe instead of
	  line arg.  Various minor cleanups.
	* client-src/sendbackup-gnutar.c: Send smbclient via pipe instead of
	  line arg.  Various minor cleanups.  Clean up listed incremental file
	  handling.
	* client-src/sendbackup.c: Various minor cleanups.
	* client-src/sendsize.c: Send smbclient via pipe instead of command
	  line arg.  Various minor cleanups.  Clean up listed incremental file
	  handling.
	* common-src/pipespawn.c: Support optional password pipe.  Various
	  minor cleanups.
	* common-src/pipespawn.h: Support optional password pipe.  Various
	  minor cleanups.
	* common-src/util.c: Backport fullread() and fullwrite() from main
	  branch.
	* common-src/util.h: Backport fullread() and fullwrite() from main
	  branch.
	* docs/SAMBA: Update and cleanup.

2001-03-13 John R. Jackson <jrj@purdue.edu>

	* recover-src/extract_list.c (extract_files_child): Fix xfsrestore
	  argument list processing.

2001-03-09 John R. Jackson <jrj@purdue.edu>

	* server-src/taper.c: Initialize tape_fd to -1 and test in a couple
	  more places.	Run normal protocol after a tape startup error (e.g.
	  "cannot overwrite") instead of just exiting to keep driver from
	  reporting a broken pipe.

2001-03-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Reported by Eric Schnoebelen <eric@cirr.com>

	* server-src/changer.c (): Fix fd leak.

2001-02-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (info_one): typo.
	* server-src/planner.c (setup_estimate): Don't re-ask for level 0
	if last_level is 0 and FORCE_NO_BUMP is set.

2001-02-27 John R. Jackson <jrj@purdue.edu>

	* common-src/stream.h: Move DATABUF_SIZE to stream.h.
	* client-src/sendbackup.c: Do not ask for a big receive buffer.
	* server-src/dumper.c: Ask for a bigger send buffer.  Minor typos.
	* server-src/taper.c: Ask for a bigger receive buffer.
	* recover-src/amrecover.c: Use stream_client instead of specific
	  (and incorrect) bind() code.
	* recover-src/extract_list.c: Ditto.

2001-02-27 John R. Jackson <jrj@purdue.edu>

	* common-src/dgram.c: Add lots more error logging to help track down
	  problems.

2001-02-27 John R. Jackson <jrj@purdue.edu>

	* common-src/stream.c: Add lots more error logging to help track down
	  problems.

2001-02-27 John R. Jackson <jrj@purdue.edu>

	* server-src/amtape.c: Rewind after loading a slot either by slot
	  or by label.

2001-02-27 John R. Jackson <jrj@purdue.edu>

	* configure.in: Copy ssize_t type check code from main branch.

2001-02-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/SYSTEM.NOTES: change cs.umd.edu by amanda.org.

2001-02-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amindexd.c (uncompress_file): remove uncompressed
	index file if the command failed.

2001-02-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/scsi-changer-driver.c (GenericRewind): init ret to 0
	to remove compiler warning.

2001-02-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (setup_estimate): ask for level 0 for
	a new disk if force-bump is set,
	log force-bump and force-nobump command.

2001-02-21 Thomas Hepper <thqant.han.de>
	* changer-src/scsi-changer-driver.c: Do an Test Unit Ready
	  before sending SCSI commands in GenericRewind
	* changer-src/chg-scsi.c: Fixed an type in the debug print
	  of the config file

2001-02-09 John R. Jackson <jrj@purdue.edu>

	* server-src/diskfile.c: Fix core dump in test program.

2001-02-09 John R. Jackson <jrj@purdue.edu>

	* tape-src/output-file.c: Use a "data" subdirectory of the main
	  file driver device directory to hold the tape "files".  This
	  allows the status file to be moved to the main directory.
	* man/amanda.8.in: Document these changes.

2001-02-05 John R. Jackson <jrj@purdue.edu>

	* man/amanda.8.in: Fix mailto to space separated, not comma.

2001-02-03 John R. Jackson <jrj@purdue.edu>

	* .cvsignore: Add entries to keep CVS quiet.
	* */.cvsignore: Ditto.

2001-02-03 John R. Jackson <jrj@purdue.edu>

	* client-src/Makefile.am: Add CLEANFILES rule to remove *.test.c.
	* common-src/Makefile.am: Add more sources as needed to the test
	  programs so they would compile.
	* server-src/Makefile.am: Create TEST_PROGS make variable ala the
	  other Makefile.am files.
	* tape-src/Makefile.am: Add CLEANFILES rule to remove *.test.c.

2001-02-02 John R. Jackson <jrj@purdue.edu>

	* server-src/reporter.c: Fix problem with enum being unsigned on
	  some systems.

2001-01-29 John R. Jackson <jrj@purdue.edu>

	* tape-src/output-tape.c (tape_tapefd_status): Convert flag values
	  to booleans (compliments of Marc W. Mengel <mengel@fnal.gov>).
	* tape-src/tapeio.c (tape_fsf): Use ap_snprintf instead of snprintf
	  (also compliments of Marc).

2001-01-26 John R. Jackson <jrj@purdue.edu>

	* changer-src/Makefile.am: Double up the references to libamanda to
	  handle systems that put regex in strange places.
	* client-src/Makefile.am: Ditto.
	* recover-src/Makefile.am: Ditto.
	* restore-src/Makefile.am: Ditto.
	* server-src/Makefile.am: Ditto.
	* tape-src/Makefile.am: Ditto.

2001-01-24 John R. Jackson <jrj@purdue.edu>

	* docs/VTAPE-API: Added.

2001-01-23 John R. Jackson <jrj@purdue.edu>

	* configure.in: Add tapeio switch from Marc Mengel <mengel@fnal.gov>,
	  enhance and add "null" and "file" output drivers.  Change all
	  tape changers (except chg-scsi) to use amdd and ammt.  Change all
	  tape changers (except chg-scsi) to log and use a consistent
	  error reporting scheme.  Fix various bugs along the way.  Add new
	  chg-multi config option, posteject, which is an optional script
	  to call after each "tape" is ejected (e.g. to use to start a
	  CDROM writer).  Remove special code for tapedev of /dev/null
	  (now handled by the "null" output driver).  Changed the taper
	  protocol to pass the host/disk/level so the write can send that
	  along to the output driver.  Fairly major rework of amrestore
	  to clean up tape/non-tape and other oddities.
	* changer-src/chg-chio.pl.in: Ditto.
	* changer-src/chg-chs.sh.in: Ditto.
	* changer-src/chg-manual.sh.in: Ditto.
	* changer-src/chg-mtx.sh.in: Ditto.
	* changer-src/chg-multi.sh.in: Ditto.
	* changer-src/chg-rth.pl.in: Ditto.
	* changer-src/chg-zd-mtx.sh.in: Ditto.
	* client-src/sendbackup.c: Ditto.
	* common-src/alloc.c: Ditto.
	* common-src/amanda.h: Ditto.
	* docs/INTERNALS: Ditto.
	* man/Makefile.am: Ditto.
	* man/amanda.8.in: Ditto.
	* man/amdd.8: Ditto.
	* man/ammt.8: Ditto.
	* restore-src/amrestore.c: Ditto.
	* server-src/amcheck.c: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/amtape.c: Ditto.
	* server-src/amverify.sh.in: Ditto.
	* server-src/conffile.c: Ditto.
	* server-src/conffile.h: Ditto.
	* server-src/taper.c: Ditto.
	* tape-src/Makefile.am: Ditto.
	* tape-src/amdd.c: Ditto.
	* tape-src/ammt.c: Ditto.
	* tape-src/output-file.c: Ditto.
	* tape-src/output-file.h: Ditto.
	* tape-src/output-null.c: Ditto.
	* tape-src/output-null.h: Ditto.
	* tape-src/output-rait.c: Ditto.
	* tape-src/output-rait.h: Ditto.
	* tape-src/output-tape.c: Ditto.
	* tape-src/output-tape.h: Ditto.
	* tape-src/tapeio.c: Ditto.
	* tape-src/tapeio.h: Ditto.
	* tape-src/tests/amtapeio.test.000: Ditto.
	* tape-src/tests/amtapeio.test.001: Ditto.
	* tape-src/tests/amtapeio.test.002: Ditto.
	* tape-src/tests/amtapeio.test.003: Ditto.
	* tape-src/tests/amtapeio.test.004: Ditto.
	* tape-src/tests/amtapeio.test.005: Ditto.
	* tape-src/tests/amtapeio.test.006: Ditto.
	* tape-src/tests/amtapeio.test.007: Ditto.
	* tape-src/tests/amtapeio.test.008: Ditto.
	* tape-src/tests/amtapeio.test.009: Ditto.
	* tape-src/tests/amtapeio.test.010: Ditto.
	* tape-src/tests/amtapeio.test.011: Ditto.
	* tape-src/tests/amtapeio.test.012: Ditto.
	* tape-src/tests/amtapeio.test.013: Ditto.
	* tape-src/tests/amtapeio.test.014: Ditto.
	* tape-src/tests/amtapeio.test.015: Ditto.
	* tape-src/tests/amtapeio.test.016: Ditto.
	* tape-src/tests/amtapeio.test.017: Ditto.
	* tape-src/tests/amtapeio.test.018: Ditto.
	* tape-src/tests/cleartape: Ditto.
	* tape-src/tests/newtest: Ditto.
	* tape-src/tests/rerun: Ditto.
	* tape-src/tests/runtest: Ditto.
	* tape-src/tests/testdist: Ditto.
	* tape-src/tests/torture: Ditto.

2001-01-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h (sched_t): new field no_space.
	* server-src/driver.c (start_some_dumps): don't start a disk if
	  no_space is set.
	* server-src/driver.c (continue_dumps): set no_space if it's the
	  only active dumpers, case c.
	* server-src/driver.c (read_schedule): set no_space to 0.

2001-01-23 John R. Jackson <jrj@purdue.edu>

	* configure.in: Test for setmntent.
	* client-src/getfsent.c: Add some support for Redhat 7 /etc/fstab
	  changes that indirectly reference the device for a file system.

2001-01-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.4.2p1)

2001-01-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* NEWS: 2.4.2p1 is a bug fix release.

2001-01-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/INSTALL: Notes about tar-1.13.19

2001-01-07  Thomas Hepper <th@ant.han.de>

	* changer-src/chg-scsi.c: Moved defs. for config_t and changer_t
	into scsi-defs.h
	New option havebarcode to force the reading of the barcode labels
	* changer/src/scsi-changer-driver.c: GenericBarCode now returns
	true/false depending on the setting of havebarcode.
	Removed EXB230DElementStatus, the exsisting Exabyte function works.
	Fixed more warnings from -Wshadow

2001-01-04 John R. Jackson <jrj@purdue.edu>

	* common-src/error.c (error): If the debug file pointer is set, log
	  any fatal error message to it and close the file so it has a good
	  trace of what happened and when.

2001-01-04 John R. Jackson <jrj@purdue.edu>

	* client-src/killpgrp.c: Calls to error() do not need a newline.

2001-01-04 John R. Jackson <jrj@purdue.edu>

	* man/amanda.8.in: Try to make it clearer that dumpcycle and maxdumps
	  changes in the main part of the config file must appear before any
	  dumptype definitions, and also that inherited dumptypes must appear
	  before their reference.

2001-01-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (continue_dumps): Don't reduce est_size if
	  it is already larger than holding space allocated.
	* server-src/dumper.c: Better handling of ENOSPC from open() and
	  write_tapeheader().

2001-01-04 John R. Jackson <jrj@purdue.edu>

	* server-src/conffile.c (main): Fix conffile test program so it builds
	  and works again.

2001-01-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/scsi-defs.h (ChangerCMD_T): replace array function
	  pointer by enumerated pointers.
	* changer-src/scsi-changer-driver.c: Use new calling convention.

2001-01-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Better support for TRY-AGAIN and
	  ABORT-FINISHED result.

2001-01-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Andreas F Mueller <afm@othello.ch>

	* server-src/amadmin.c (force_no_bump_one): Fix message.

2000-12-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (analyze_estimate): pick incremental level
	if no estimate of level 0.

2000-12-24 John R. Jackson <jrj@purdue.edu>

	* server-src/getconf.c: Fix free() of static text string (BUGGY) when
	  the parameter being looked up is bad.

2000-12-23 David Wolfskill  <dhw@whistle.com>

        * server-src/amcheck.c (start_server_check): Change directory
          writable check to be for the tapelist directory instead of
	  the config file directory.  Remove config file directory test.
        * man/amcheck.8.in: Add mention of tapelist directory and do
	  some other directory writable cleanup.

2000-12-13 John R. Jackson <jrj@purdue.edu>

	* docs/Makefile.am: Removing entries for missing RAIT/VTAPE-API files.

2000-12-13 John R. Jackson <jrj@purdue.edu>

	* tape-src/tapeio.c: De-commit the RAIT feature from 2.4.2.  It will
	  be in 2.5 and 2.4.2-multitape.
	* tape-src/tapeio.h: Ditto.
	* tape-src/Makefile.am: Ditto.

2000-12-12 John R. Jackson <jrj@purdue.edu>

	* client-src/sendbackup-gnutar.c: Fix regex pattern to accept blanks
	  or tabs.

2000-12-12 John R. Jackson  <jrj@purdue.edu> and Marc Mengel <mengel@fnal.gov>

	* Makefile.am: Work around problem with automake 1.4 not including
	  pkgdata_DATA.
	* docs/RAIT: New file.
	* docs/VTAPE-API: New file.
	* docs/Makefile.am: Include RAIT and VTAPE-API in distribution.
	  Work around problem with automake 1.4 not including pkgdata_DATA.
	* tape-src/output-rait.h: New File providing RAIT virtual tape type.
	* tape-src/output-rait.c: New File providing RAIT virtual tape type.
	* tape-src/Makefile.am: Add output-rait.c.
	* tape-src/tapeio.c: Major Surgery.
	  (vtable): New static table of virtual tape types.
	  (fdtable): New static table mapping file descriptors.
	  (tapefd_fsf_ioctl): Renamed tapefd_fsf, with added ioctl argument.
	  (tapefd_rewind_ioctl): Likewise.
	  (tapefd_unload_ioctl): Likewise.
	  (tapefd_weof_ioctl): Likewise.
	  (tapefd_status_ioctl): Likewise.
	  (tape_open): Now is a virtual tape table lookup and call.
	  (tape_access): Now is a switch through virtual tape table.
	  (tape_stat): Likewise.
	  (tapefd_close): Likewise.
	  (tapefd_fsf): Likewise.
	  (tapefd_read): Likewise.
	  (tapefd_rewind): Likewise.
	  (tapefd_resetofs): Likewise.
	  (tapefd_unload): Likewise.
	  (tapefd_status): Likewise.
	  (tapefd_weof): Likewise.
	  (tapefd_write): Likewise.
	  (plain_tape_access): Rename of tape_access.
	  (plain_tape_open): Likewise.
	  (plain_tapefd_read): Likewise.
	  (plain_tape_stat): Likewise.
	  (plain_tapefd_write): Likewise.
	  (plain_tapefd_close): Likewise.
	  (plain_tapefd_fsf): Now calls tapefd_fsf_ioctl with &ioctl().
	  (plain_tapefd_rewind): Likewise.
	  (plain_tapefd_resetofs): Likewise.
	  (plain_tapefd_unload): Likewise.
	  (plain_tapefd_status): Likewise.
	  (plain_tapefd_weof): Likewise.

2000-12-07 Thomas Hepper <th@ant.han.de>

	changer-src/scsi-changer-driver.c: Added Exabyte 230D Sense Handler
	(patch from Gary Algier gaa@ulticom.com)
	Fixed some compile warnings (-Wshadow)
	changer-src/scsi-solaris.c: Changed the return Value from 
	SCSI_ExecuteCommand to the value of Command.uscsi_status if
	the return value of the ioctl is > 0

2000-12-04 John R. Jackson  <jrj@purdue.edu>

	server-src/amdump.sh.in: Temporary fix for $LOGNAME vs whoami problem.

2000-12-04 John R. Jackson  <jrj@purdue.edu>

	* common-src/security.c: Make the "./security" test code available
	  for normal operation by #define so it can be seen in, e.g., the
	  */amandad*debug file.

2000-12-04 John R. Jackson  <jrj@purdue.edu>

	* server-src/conffile.c (read_conffile_recursively): If the file name
	  for the includefile directive is not absolute, make it relative to
	  the configuration directory.

2000-12-03 John R. Jackson  <jrj@purdue.edu>

	* restore-src/amrestore.c: Fix header when compression is included.
	  Use "fast" option for -c and add new -C option to get "best".
	* man/amrestore.8: Document the new option, the compression level,
	  and clean up some nroff issues.

2000-11-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* Amanda 2.4.2 released
	
2000-11-22 John R. Jackson  <jrj@purdue.edu>

	* contrib/dbbackup.ksh: Deal with adm being a symlink.
	* contrib/dbbackup.tcl: Update for Tcl 8.3 and newer Oratcl versions.

2000-11-22 John R. Jackson  <jrj@purdue.edu>

	* Makefile.am: Forgot to add contrib/sst/README.Amanda to the list
	  of files to put in a distribution.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* recover-src/extract_list.c (extract_files_child): Add support for
	  XFSRESTORE.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c: Minor message wording changes.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* configure.in: Forgot to check in this part of new amgetconf.8.in.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* contrib/sst/README.Amanda: New file of Amanda specific sst notes.
	* contrib/sst/sst.c: Attempt at letting gcc compile sst.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* man/amgetconf.8.in: New man page.
	* man/Makefile.am: Add support for amgetconf.8.in.
	* man/amadmin.8.in: Update for 2.4.2 and do general cleanup.
	* man/amanda.8.in: Ditto.
	* man/amcheck.8.in: Ditto.
	* man/amcheckdb.8.in: Ditto.
	* man/amcleanup.8.in: Ditto.
	* man/amdump.8.in: Ditto.
	* man/amflush.8.in: Ditto.
	* man/amlabel.8.in: Ditto.
	* man/amrecover.8.in: Ditto.
	* man/amreport.8.in: Ditto.
	* man/amrestore.8: Ditto.
	* man/amrmtape.8.in: Ditto.
	* man/amstatus.8.in: Ditto.
	* man/amtape.8: Ditto.
	* man/amtoc.8.in: Ditto.
	* man/amverify.8.in: Ditto.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* contrib/sst/sst.c (sst_ioctl): Allow non-root users to use sst.

2000-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amdump.sh.in: exit if amgetconf exit with status != 0.
	* server-src/amcleanup.sh.in: ditto
	* server-src/amstatus.pl.in: ditto

2000-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (start_some_dumps): don't check free_kps if
	curusage == 0.
	* server-src/driver.c (free_kps): remove the kludge.

2000-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c: It's an error to have a negative chunksize.
	* man/amanda.8.in: remove documentation of negative chunksize.
	* example/amanda.conf.in: ditto
	* example/amanda.conf.chg-scsi.in:ditto
	* NEWS: negative chunksize is no longer supported.

2000-11-03 John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c (handle_taper_result): the holding disk entry
	should not be removed just because taper could not write it out in
	the "too many taper retries" case.  It should be left for amflush.

2000-11-01 John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: use common form for getting the first
	line of a file/pipe.  Sed is more portable than head.

2000-11-01 John R. Jackson  <jrj@purdue.edu>

	* common-src/security.c (bsd_security_ok): Same fix for amwait_t !=
	int as applied a while back to changer.c.  Compliments of John E.
	Hein <jhein@timing.com>.

2000-10-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/selfcheck.c (check_disk): Write an appropriate
	message if the disk name start with '//' and the program is DUMP
	or SAMBA is not compiled in.

2000-10-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (continue_dumps): set estimate to more than
	what is already use instead of setting no_hold=1 when a disk
	don't fit on holding disk.

2000-10-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: add '&' when calling &usage()
	or &dump_size().

2000-10-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	reported by The Hermit Hacker <scrappy@hub.org>

	* changer-src/chg-chio.pl.in: remove unused $libexecdir.

2000-10-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	reported by The Hermit Hacker <scrappy@hub.org>

	* changer-src/chg-chio.pl.in: remove comma after LOG,
	typo: r should be 0.

2000-10-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/INDEXING: doc updated.

2000-10-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/scsi-defs.h: prototype SCSI_Inquiry, PrintInquiry, 
	DecodeSCSI, ChangerReplay, BarCode and MapBarCode.
	* changer-src/scsi-linux.c: fix compiler warning.
	* changer-src/scsi-changer-driver.c: fix compiler warning.

2000-10-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/chg-scsi.c: remove rcsid.
	* changer-src/scsi-aix.c: remove rcsid, add amanda Copyright.
	* changer-src/scsi-bsd.c: remove rcsid, add amanda Copyright.
	* changer-src/scsi-changer-driver.c: remove rcsid, add amanda Copyright.
	* changer-src/scsi-defs.h: add amanda Copyright.
	* changer-src/scsi-hpux.c: remove rcsid.
	* changer-src/scsi-hpux_new.c: remove rcsid, add amanda Copyright.
	* changer-src/scsi-irix.c: remove rcsid, add amanda Copyright.
	* changer-src/scsi-linux.c: remove rcsid, add amanda Copyright.
	* changer-src/scsi-solaris.c: remove rcsid, add amanda Copyright.

2000-10-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* AUTHORS: add Thomas Hepper.

2000-10-14  Thomas Hepper <th@ant.han.de>

	* changer-src/scsi-changer-driver.c: Added support for the TreeFrog
	library (barcode support), fixed some signal 11 problems in the
	output of chg-scsi -status
	Removed unused variables
	* changer-src/chg-scsi.c: same
	* changer-src/scsi-defs.h: same

2000-10-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverify.sh.in: grep only the first line of the header.

2000-10-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverify.sh.in: verify with tar even if the
	server and the client are not configured with the same path.

2000-10-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* NEWS: A new `ctimeout' keyword in amanda.conf to replace
	the CHECK_TIMEOUT constant in amcheck.c.

2000-10-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: Don't set tape_ok to 0 if
	tape_wrlabel is successful.

2000-10-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/taper.c: amfree(strclosing).

2000-10-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: --with-samba-user is deprecated.
	* docs/SAMBA: the username is now on the amandapass file.
	* NEWS: the username is now on the amandapass file.
	* client-src/findpass.c (findpass): accept "*" as diskname.
	* client-src/selfcheck.c (check_disk): call to samba changed.
	* client-src/sendsize.c (getsize_smbtar): ditto.
	* client-src/sendbackup-gnutar.c (start_backup): ditto.
	* recover-src/extract_list.c (extract_files_child): ditto.
	
2000-10-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (write_tapeheader): set errno = ENOSPC
	and return -1 if is not fully written.

2000-10-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/taper.c: give better message when failing
	to open a chunk.

2000-10-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.c (headqueue_disk): new function to
	insert at the head of the queue.
	* server-src/diskfile.h (headqueue_disk): prototype.
	* server-src/driver.c (handle_taper_result,dump_to_tape):
	insert with headqueue_disk() after a TRY-AGAIN.

2000-10-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (do_dump): wait for index compress
	process to terminate before renaming the index file.

2000-10-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* AUTHORS: fix my email address.

2000-09-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: Don't accept -m or -M option if MAILER
	is not defined.
	* server-src/reporter.c: Need a -f optionn if MAILER is not defined.

2000-09-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	patch by <jeg@time.ucsc.edu>

	* server-src/reporter.c (output_summary): check for tape_labels.

2000-09-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amindexd.c: use strcasecmp to compare hostname.

2000-09-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: fix plural misuse.

2000-09-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in: add all pages in the SEE ALSO section.

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup.c: set estr=NULL if the exclude
	file doesn't exist.

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup-gnutar.c: use exclude string estr 
	instead of "estr".

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amreport.8.in: amreport does not rotate the log.
	* man/amrestore.8: note on holdingdisk.
	* restore-src/amrestore.c: update usage.
	* server-src/amrmtape.sh.in: update usage.
	* server-src/amverify.sh.in.usage: update usage.

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amoverview.pl.in: update usage information,
	-config is no longer needed for ccompatibility with other program.
	* man/amoverview.8.in: -config is no longer needed.

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (usage): show disklist command.

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* example/amanda.conf.in: chunk should not be larger than
	MAX_FILE_SIZE - 1Mb.

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendsize.c (getsize_smbtar): remove unused debug_level 
	variable.
	* server-src/amlabel.c (main): init errstr to NULL, 
	fix compiler warning.

2000-09-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	patch by jason Thomas <jet@users.sourceforge.net>

	* tape-src/tapetype.c: fix help message.

2000-09-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	patch by Rudolf Cejka <cejkar@users.sourceforge.net>

	* common-src/file.c (mkpdir): check p != NULL
	* man/amstatus.8.in: typo

2000-09-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	patch by Rudolf Cejka <cejkar@users.sourceforge.net>

	* client-src/calcsize.c:sets correct program name,
	prevent coredumps and some improrer command line error mesages

2000-09-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amanda.h: prototype clean_regex().
	* common-src/match.c: new function clean_regex() that escape
	all non-alphanumeric character.
	* recover-src/extract_list.c (add_file, delete_file): use clean_regex().

2000-09-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: (start_server_check): check for the oldlog
	directory.

2000-09-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amtrmlog.c: better check of the oldlog directory.

2000-09-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: (start_server_check): don't check the tape
        if tapedev is /dev/null.

2000-09-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c (output_tapeinfo): test reversed for run_tapes.

2000-08-01  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* client-src/sendbackup-gnutar.c (start_backup) <taropt>:
	NULL-terminate it correctly.

2000-07-18 John R. Jackson  <jrj@purdue.edu>

	* changer-src/chg-chio.pl.in (do_time): fix chg-chio.pl timestamp
	function to return a string instead of writing to stdout.

2000-07-18 John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c (file_reader_side): detach and destroy shared
	memory areas on an error condition.  Found by Patrik Andersin
	<cat@iki.fi>.

2000-07-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendsize.c (getsize_dump,getsize_gnutar): set 
	dumppid to the return value of pipespawn.

2000-06-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup.c (parse_options): set efile.

2000-06-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/list_dir.c (add_dir_list_item): add at head of list.

2000-06-12  Jeroen Ruigrok van der Werven  <asmodai@wxs.nl>

	* server-src/amlabel.c (main): Do not amfree(config_name).

2000-06-03 Thomas Hepper <th@ant.han.de>

	* changer-src/scsi-defs.h: Add missing defines which are used by the
	sense handler
	* changer-src/scsi-solaris.c: Added patch to limit the recursion
	in Scsi_ExecuteCommand.

2000-06-02 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.c (pick_datestamp): convert ch to upper.

2000-05-28  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* client-src/sendbackup-gnutar.c: Ignore `socket ignored' GNU tar
	messages.

2000-05-27 Ian Turner <vectro@pipeline.com>
	* client-src/sendbackup.c (pipespawn): Moved to...
	* common-src/pipespawn.c: ... new file.  Redirect all std
	streams.  Support skipping arguments.
	* common-src/pipespawn.h (pipespawn, skip_argument): Declare.
	* common-src/Makefile.am (noinst_HEADERS): Added pipespawn.h.
	(libamanda_la_SOURCES): Added pipespawn.c.
	* client-src/sendbackup-dump.c, client-src/sendbackup-gnutar.c:
	Adjust.

2000-04-20 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: typo

2000-04-20  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* recover-src/Makefile.am (LDADD): Removed libamtape.
	Reported by Paul Yeatman <pyeatman@ucsd.edu>

2000-04-16 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/taper.c: don't crash if the tapelist file
	doesn't exist.

2000-04-09  Frank Wojcik  <fwojcik@lucent.com>

	* server-src/taper.c (detach_buffers): Fixed typo in error message.

	* server-src/amrmtape.sh.in: Fix occurrence of `Infofile', that
	should have been `InfoFile'.

2000-04-09  Davide Marchignoli  <marchign@di.unipi.it>

	* server-src/conffile.h (confparm_t): Added CTIMEOUT.
	* server-src/conffile.c: Added ctimeout support.  Default to 30.
	* example/amanda.conf.in: Likewise.
	* man/amanda.8.in: Documented it.
	* server-src/amcheck.c: Use ctimeout from configuration file instead
	of CHECK_TIMEOUT.

2000-04-09  Stan Brown  <stanb@awod.com>

	* recover-src/amrecover.c (guess_disk): Omit DEV_PREFIX only if
	it is actually a prefix of fsname.

2000-04-09  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* server-src/amlabel.c (main): Check label *after* writing end mark.
	
2000-03-06 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: don't crash if the tapelist file
	doesn't exist.

2000-02-12 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: "0 dumpers busy" should be "0 dumper busy".

2000-02-08 Thomas Hepper <th@ant.han.de>

	* changer-src/scsi-linux.c (SCSI_ExecuteCommand) : Direction for the 
	memcpy for the sense result was wrong, so every time the sense result
	was 0x0.....

	* changer-src/scsi-changer-driver.c (GenericElementStatus) : Added
	flag to signal if it is either a tape drive or a library. 

2000-01-31 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (force_one, force_bump_one): FORCE_FULL
	and FORCE_BUMP are mutually exclusive.

2000-01-30  Thomas Hepper <th@ant.han.de>

	* changer-src/chg-scsi.c : Exit it tapedev in amanda.conf is not a 
	number. 

2000-01-21  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* server-src/amstatus.pl.in (prefix, exec_prefix): Refer to them
	twice to avoid warnings of possible typo.

	* amplot/amplot.awk: Ignore dumper's RQ-MORE-DISK.
	Reported by David Wolfskill <dhw@whistle.com>
	* amplot/amplot.awk: Handle taper's TRY-AGAIN like TAPE-ERROR.

	* server-src/amstatus.pl.in: Compute and display TRY-AGAIN tape
	errors.
	Reported by David Wolfskill <dhw@whistle.com>

	* man/amtoc.8.in: Document -w.

2000-01-21  David Wolfskill  <dhw@whistle.com>

	* server-src/amtoc.pl.in: Add `-w' to add new lines and form feeds.

2000-01-21  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* man/amlabel.8.in: Tapes are no longer requested in reverse order
	of amlabeling.
	Reported by Brad Guillory <round@baileylink.net>

	* server-src/amstatus.pl.in: New option --stats, to display
	statistics about dumpers and taper.
	* man/amstatus.8.in: Document it.

2000-01-21  David Wolfskill  <dhw@whistle.com>

	* server-src/amstatus.pl.in: Sort dumpers by number.

2000-01-21  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* server-src/amstatus.pl.in: Remove bogus (?) line `$$host=1'.

	* configure.in (MAILER): Warn or print an error if not found,
	depending on whether server code is disabled or not.

	* server-src/reporter.c (output_tapeinfo): Report used tapes
	regardless of tape errors.

	* config/acinclude.m4i (CF_WAIT): Simplify the test.  Declare wait()
	in the global scope.

2000-01-21  Garrett Wollman  <wollman@khavrinen.lcs.mit.edu>

	* config/acinclude.m4i (CF_WAIT): Avoid warnings on systems
	where `union wait' works but is deprecated.

2000-01-21  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* recover-src/uscan.l (settape): Recognize it.
	* recover-src/uparse.y: Parse it.
	* recover-src/amrecover.h (set_tape): Declare it.
	* recover-src/set_commands.c (set_tape): Implement it.
	* recover-src/help.c (help_list): Document it.
	* man/amrecover.8.in: Likewise.
	* recover-src/extract_list.c (extract_files): Warn if tape device is
	/dev/null.
	* recover-src/amrecover.c (tape_device_name): Default to
	server-determined default.

2000-01-17  Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-changer-driver.c : Typo in CheckMove fixed .

2000-01-17  Thomas Hepper <th@ant.han.de>

	* configure.in: check for scsi/sg.h on linux, and if true
	enable sg support

	* changer-src/chg-scsi.c : New option -trace for debuging...
	new option changer_ident to set the internal driver for the changer

	* hanger-src/scsi-hpux_new.c: New function Tape_Status.
	returns the status of the tape. (loaded/empty etc)
	* changer-src/scsi-aix.c : Dummy function for Tape_Status
	* changer-src/scsi-bsd.c : Dummy function for Tape_Status
	* changer-src/scsi-irix.c : Dummy function for Tape_Status
	* changer-src/scsi-solaris.c : Dummy function for Tape_Status
	* changer-src/scsi-linux.c : Added better support for the sg driver.
	* changer-src/scsi-changer-driver.c : New driver for ADIC SDX and DLT448
	librarys
	new function SDXMove for SDX library
	new function CheckMove to check if a move is legal based on the infs
	we get from the Mode Sense command
	* changer-src/scsi-defs.h : Added types returned by Tape_Status

2000-01-16  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* server-src/driver.c (handle_dumper_result): When failed, set
	dp->inprogress to 0, not 1.

2000-01-13  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* configure.in: Recognize alpha*-*-linux-* and sparc*-*-linux-*.

	* tape-src/Makefile.am (../common-src/libamanda.$(LIB_EXTENSION)):
	Allow for `make tapetype' before libamanda is built.

	* server-src/amoverview.pl.in: Year doesn't take just 2 bytes.

2000-01-06  David Wolfskill  <dhw@whistle.com>

	* docs/TAPETYPES: Typo.

2000-01-06  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* docs/TAPETYPES: Removed all tapetype entries.  Pointed to
	example/amanda.conf, to the mailing list archives and to the on-line
	tapetype list.  Explained the meaning of length, filemark and speed,
	and how to build and use the tapetype utility.

1999-12-12 John R. Jackson  <jrj@purdue.edu>

	* configure.in: egrep was having trouble with quoting on some systems.
	Broke it apart into multiple unquoted statements.  Also, changed the
	script to run the steps on all dump tests and added "Label" as another
	line to ignore.

1999-12-12 John R. Jackson  <jrj@purdue.edu>

	* tape-src/tapetype.c: tweak the algorithm to write files in both
	passes and compute the tape mark size as the difference.  Never
	report a negative tape mark size.  Various other minor cleanup.

1999-11-29  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* client-src/sendbackup-gnutar.c (re_table): #if out the debugging
	Samba messages unless SAMBA_VERSION < 2.

1999-11-29  John E.P.Hynes  <john@hytronix.ne.mediaone.net>

	* client-src/sendbackup-gnutar.c (re_table): Update for Samba 2.0.6.

1999-11-10 John R. Jackson  <jrj@purdue.edu>

	* recover-src/extract_list.c: report the tape server host in the
	  message to check the amidxtaped.debug file.	If extract_list_child
	  fails (such as when amidxtaped fails to read the tape), ask if
	  things should continue instead of aborting.

1999-11-11  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* server-src/driverio.c (update_info_dumper): Discard information on
	older same- or higher-level dumps.
	* server-src/driver.c (dump_to_tape): Add comment that _dumper must
	be called before _taper.

	* docs/FAQ: Sometimes FQDNs are wrong for amandahosts.

1999-11-10 John R. Jackson  <jrj@purdue.edu>

	* server-src/amindexd.c (build_disk_table): need to clear the old
	  disk history list before building a new one.

1999-11-10 John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c (label_tape): issue a warning when tapedev is
	  set to /dev/null.
	* server-src/amcheck.c (start_server_check): make warning message
	  text the same for amcheck and taper when tapedev is /dev/null.

1999-11-10 John R. Jackson  <jrj@purdue.edu>

	* server-src/amcleanupdisk.c (main): try to remove empty holding disk
	  areas.
	* server-src/holding.c (scan_holdingdisk): do not automatically remove
	  empty holding disk areas since this function is called by various
	  utilities and a dump might be in progress.

1999-11-10  James FitzGibbon  <james@targetnet.com>

	* server-src/infofile.c (put_info): d.size should have been
	d.dsize.

1999-11-09 John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c (start_server_check): test tapedev for
	  "/dev/null" and issue warning that dumps will be thrown away.

1999-11-02  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* common-src/amflock.c (struct flock): Do not assume the fields are
	declared in any particular order.
	Reported by Sean Kelly <kelly@plutotech.com>

	* Makefile.am (EXTRA_DIST): Added contrib/set_prod_link.pl.
	* docs/INSTALL: Likewise.

1999-11-02  Ricardo Malta  <rmalta@bigfoot.com>
	
	* contrib/set_prod_link.pl: Create the links for a configuration
	with --with-suffix.

1999-11-02  Nicolas Mayencourt  <Nicolas.Mayencourt@cui.unige.ch>

	* server-src/amtoc.pl.in: Correct a bug for total report.

1999-11-01 John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c (find_diskspace): make noisy holding space log
	  message conditional on HOLD_DEBUG.

1999-11-01 John R. Jackson  <jrj@purdue.edu>

	* server-src/amcleanupdisk.c (main): do not free the config name (it
	  was never alloc-d).

1999-10-24  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* common-src/debug.c: Do not assume stderr is a compile-time
	constant.  On glibc 2.2 (RedHat Linux 6.1), it is not.

1999-10-11  Nicolas Mayencourt  <Nicolas.Mayencourt@cui.unige.ch>

	* server-src/amtoc.pl.in: Add new options -i and -t.  Print original
	size, instead of size on tape.

1999-10-07 John R. Jackson  <jrj@purdue.edu>

	* common-src/stream.c (stream_server): remove reference to portrange
	  variable.  Compliments of Randy Dees <rrd@amherst.com>.

1999-10-03 John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c (main): now that multiple results can come back
	  from taper and dumper without a handshake (e.g. NO-ROOM), we need to
	  process them all rather than just the first one.  Call the new
	  areads_dataready() function to peek and see if more data is ready.
	* common-src/amanda.h: declare areads_dataready().
	* common-src/file.c: define areads_dataready().  Fix some variable
	  types.  Fix a buffer expansion problem.  Add code to the test
	  program to force buffer expansion to be checked out.

1999-10-03 John R. Jackson  <jrj@purdue.edu>

	* common-src/file.c (areads_getbuf): fix a buffer allocation problem.

1999-10-03 John R. Jackson  <jrj@purdue.edu>

	* common-src/amflock.c (main): do not use aclose() in the configure
	  test case.  During configure we do not have areads_relbuf()
	  available and it makes configure think all the tests have failed.

1999-10-03 John R. Jackson  <jrj@purdue.edu>

	* common-src/amanda.h: protect the close macros and areads* from
	  out of range file descriptors.
	* common-src/file.c: ditto.

1999-10-02 John R. Jackson  <jrj@purdue.edu>

	* server-src/amindexd.c (build_disk_table): only "OK" results from
	  find_dump should be considered.

1999-10-02 John R. Jackson  <jrj@purdue.edu>

	* common-src/file.c (areads): when NO-ROOM became advisory and didn't
	  participate in a full handshake, it exposed a problem in areads()
	  where a static buffer was shared among all I/O.  Changed it to use
	  a separate buffer for each file descriptor.  Enhanced the test
	  program to check out the code.
	* common-src/amanda.h: ditto
	* restore-src/amidxtaped.c: minor areads/agets comment typo.
	* server-src/amindexd.c: ditto

1999-10-02 John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c: delete #define of HOLD_DEBUG, it was increasing
	  the size of the amdump log file by a factor of 10 or more.  Anyone
	  who needs it can define it in CFLAGS or some other way.

1999-09-29 John R. Jackson  <jrj@purdue.edu>

	* server-src/dumper.c (do_dump): closed the dump messages file too
	  soon.

1999-09-23  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* recover-src/extract_list.c (samba_extract_method): Default to
	SAMBA_TAR, for similarity with other restore programs.
	(extract_files_child): If restore with SMBCLIENT is enabled, explain
	that Samba shares will be restored to the SMB share.

1999-09-22 John R. Jackson  <jrj@purdue.edu>

	* configure.in: wrong variable when processing LIBRARY_DIRS.  Fix
	  compliments of John M. Vogtle <jmvogtle@kodak.com>.

1999-09-19 John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: this script is important enough it should
	  not depend on having perl installed.  Clean up the AIX "mt status"
	  code.  Test for presense of other restore programs and check that
	  they are executable during processing.

1999-09-19 John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: put back an "mt status" wait loop I
	  erroneously removed, but protect it from AIX.

1999-09-19 John R. Jackson  <jrj@purdue.edu>

	* common-src/util.c: fix math in bind_portrange so ports requested
	  are between those the caller passed and make sure port 0 does not
	  accidentally get requested, which returns a non-privileged port.
	* common-src/dgram.c: bind_portrange last port argument is inclusive.
	* common-src/stream.c: ditto.
	* recover-src/amrecover.c: ditto.
	* recover-src/extract_list.c: ditto.

1999-09-19 John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c: do not send a FILE_WRITE to the taper when the
	  tape queue is empty during a TRYAGAIN (driver core dumped).

1999-09-19 John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c: fix protocol problems when out of tape.  Add
	  FAKE_TAPE_ERROR debugging code to simulate tape errors.  Fix problem
	  with command line argument processing.

1999-09-18 John R. Jackson  <jrj@purdue.edu>

	* configure.in: several compress/uncompress variables were not being
	  set properly.

1999-09-18 John R. Jackson  <jrj@purdue.edu>

	* client-src/sendbackup.c: pclose returns a child exit status of the
	  pipe, not an errno, so do not try to strerror it.
	  Have the index child process exit with the pclose exit code.
	  Treat index failures as strange rather than fatal so the dump gets
	  fully processed.  It's more important to have the dump image than
	  to skip it just because indexing had a (possibly unrelated) problem.

1999-09-15 John R. Jackson  <jrj@purdue.edu>

	* server-src/amtoc.pl.in: handle an image failing on one tape and
	  succeeding on the next.

1999-09-15 John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: generalize the "driver: state" parsing
	  so it can handle current and future information.

1999-09-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server/driver.c (main): use the holding disk even if the
	datestamped directory already exist.

1999-09-14  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* configure.in: Get snapshot date from SNAPSHOT file, if it exists.
	(VERSION): Add the date to it.
	(SNAPSHOT_STAMP): AC_SUBST to the SNAPSHOT file, if it exists.
	* Makefile.am (EXTRA_DIST): Added $(SNAPSHOT_STAMP).
	(config.status): Depend on $(SNAPSHOT_STAMP).
	(SNAPSHOT): Dummy rule to allow reconfigure if it's removed.

	* config/Makefile.am: Remove all traces of acconfig.h.

	* server-src/changer.c (changer_command): Fix for amwait_t != int.

1999-09-13  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* config/acinclude.m4i: Added comments for config/config.h.in to all
	AC_DEFINEs.
	* configure.in: Likewise.
	* config/acconfig.h: Deleted.
	* autogen: Updated.

1999-09-13 John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: protect against uname not returning
	  anything.

1999-09-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c (start_server_check): use tapefile instead of
	conf_tapelist to open the file (we no longer cd to the config file).

1999-09-11 John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c: sigh -- it was right the first time.

1999-09-11 John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c: lost a few too many lines with the amlogroll
	  changes to amreport.

1999-09-11 John R. Jackson  <jrj@purdue.edu>

	* server-src/amindex.c: minor memory leak.

1999-09-11 John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c: remove duplicated code.

1999-09-11 John R. Jackson  <jrj@purdue.edu>

	* server-src/Makefile.am: use new amlogroll utility to rename the log
	  file to the datestamped name.
	* server-src/amcheck.c: ditto.
	* server-src/amcleanup.sh.in: ditto and call all utilities with the
	  config file name as an argument.
	* server-src/amdump.sh.in: ditto and call all utilities with the
	  config file name as an argument.
	* server-src/amflush.c: ditto.
	* server-src/amlogroll.c: new utility.
	* server-src/driverio.c: ditto and call all utilities with the
	  config file name as an argument.
	* server-src/reporter.c: ditto.

1999-09-10 John R. Jackson  <jrj@purdue.edu>

	* client-src/rundump.c: minor compiler warnings.
	* common-src/security.c: minor compiler warnings.
	* server-src/amindexd.c: minor compiler warnings.
	* server-src/conffile.c: minor compiler warnings.

1999-09-10 John R. Jackson  <jrj@purdue.edu>

	* client-src/sendsize.c: typo in previous patch and pick a better
	  variable name (ala other similar code).

1999-09-10 John R. Jackson  <jrj@purdue.edu>

	* client-src/amandad.c: clean up error messages after a fork or exec*
	  failure.
	* client-src/rundump.c: ditto.
	* client-src/runtar.c: ditto.
	* client-src/sendbackup.c: ditto.
	* client-src/sendsize.c: ditto.
	* restore-src/amidxtaped.c: ditto.
	* server-src/amflush.c: ditto.

1999-09-07 John R. Jackson  <jrj@purdue.edu>

	* configure.in: Add --with-tmpdir to ./configure and use it for
	  all Amanda temporary files.  Default --with-dbgdir to --with-tmpdir.
	  Move libexec/getconf to sbin/amgetconf and add an optional
	  config parameter.  Add optional config parameter to several
	  other programs.
	  Add debugging to chg-chio.
	  Call new safe_cd() function in most programs to cd to --with-tmpdir
	  so if they drop core, it goes to a known spot.  Rename existing
	  core files so more than one failure may be tracked.  Remove most
	  chdir() and umask() calls (umask is set in safe_cd).
	* amplot/amplot.sh.in: ditto.
	* changer-src/chg-chio.pl.in: ditto.
	* changer-src/chg-chs.sh.in: ditto.
	* changer-src/chg-manual.sh.in: ditto.
	* changer-src/chg-mtx.sh.in: ditto.
	* changer-src/chg-multi.sh.in: ditto.
	* changer-src/chg-rth.pl.in: ditto.
	* changer-src/chg-scsi-chio.c: ditto.
	* changer-src/chg-scsi.c: ditto.
	* changer-src/chg-zd-mtx.sh.in: ditto.
	* client-src/amandad.c: ditto.
	* client-src/calcsize.c: ditto.
	* client-src/killpgrp.c: ditto.
	* client-src/rundump.c: ditto.
	* client-src/runtar.c: ditto.
	* client-src/selfcheck.c: ditto.
	* client-src/sendbackup-gnutar.c: ditto.
	* client-src/sendbackup.c: ditto.
	* client-src/sendsize.c: ditto.
	* common-src/alloc.c: ditto.
	* common-src/amanda.h: ditto.
	* common-src/amflock.c: ditto.
	* common-src/debug.c: ditto.
	* common-src/file.c: ditto.
	* common-src/genversion.c: ditto.
	* common-src/security.c: ditto.
	* config/acconfig.h: ditto.
	* dumper-src/gnutar.pl.in: ditto.
	* restore-src/amidxtaped.c: ditto.
	* server-src/Makefile.am: ditto.
	* server-src/amadmin.c: ditto.
	* server-src/amcheck.c: ditto.
	* server-src/amcheckdb.sh.in: ditto.
	* server-src/amcleanup.sh.in: ditto.
	* server-src/amcleanupdisk.c: ditto.
	* server-src/amdump.sh.in: ditto.
	* server-src/amflush.c: ditto.
	* server-src/amfreetapes.sh.in: ditto.
	* server-src/amindex.c: ditto.
	* server-src/amindex.h: ditto.
	* server-src/amindexd.c: ditto.
	* server-src/amlabel.c: ditto.
	* server-src/amrmtape.sh.in: ditto.
	* server-src/amstatus.pl.in: ditto.
	* server-src/amtape.c: ditto.
	* server-src/amtrmidx.c: ditto.
	* server-src/amtrmlog.c: ditto.
	* server-src/amverify.sh.in: ditto.
	* server-src/changer.c: ditto.
	* server-src/changer.h: ditto.
	* server-src/conffile.h: ditto.
	* server-src/diskfile.c: ditto.
	* server-src/driver.c: ditto.
	* server-src/driverio.c: ditto.
	* server-src/dumper.c: ditto.
	* server-src/find.c: ditto.
	* server-src/getconf.c: ditto.
	* server-src/holding.c: ditto.
	* server-src/infofile.c: ditto.
	* server-src/logfile.c: ditto.
	* server-src/planner.c: ditto.
	* server-src/reporter.c: ditto.
	* server-src/tapefile.c: ditto.
	* server-src/taper.c: ditto.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* common-src/Makefile.am: change OBJ_EXTENSION to OBJEXT in line
	  related to the "security" test tool.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* changer-src/chg-chio.pl.in: add -w to #! line to catch more errors.
	* client-src/amandad.c: fix some compiler warnings.
	* common-src/protocol.c: fix some compiler warnings.
	* recover-src/display_commands.c: fix some compiler warnings.
	* recover-src/extract_list.c: fix some compiler warnings.
	* restore-src/amrestore.c: fix some compiler warnings.
	* server-src/conffile.c: fix some compiler warnings.
	* server-src/diskfile.c: fix some compiler warnings.
	* server-src/holding.c: fix some compiler warnings.
	* server-src/planner.c: fix some compiler warnings.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* recover-src/extract_list.c: add VRESTORE and VXRESTORE support.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* common-src/stream.c: make sure errno is returned properly from
	  stream_client() and stream_server().
	* client-src/sendbackup.c: report errors from stream_server() and
	  abort.
	* server-src/taper.c: ditto.
	* recover-src/extract_list.c: make sure errno is preserved.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* client-src/amandad.c: clean up a couple of debugging messages.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* recover-src/amrecover.c: add missing ntohs calls.  Reported by
	  Kent Kalnasy <kkalnasy@ms.washington.edu>
	* recover-src/extract_list.c: ditto.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* configure.in: make sure the dump and restore programs are defined
	  in pairs, do not allow just the dump program without restore.
	* client-src/sendbackup-dump.c: assume restore program is present
	  if dump program is.
	* common-src/genversion.c: assume restore program is present if
	  dump program is.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* common-src/genversion.c: CLIENT_LOGIN has to be defined so there
	  is no point testing for it.
	* server-src/conffile.c: ditto.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: add SMBCLIENT, VRESTORE, VXRESTORE
	  and XFSRESTORE support.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* server-src/conffile.c: add several common abbreviations to config
	  file processing.

1999-09-01 John R. Jackson  <jrj@purdue.edu>

	* server-src/amtoc.pl.in: allow multiple -s entries.

1999-09-01 John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c: handle/report a common columnspec syntax
	  error instead of dumping core.

1999-09-01 John R. Jackson  <jrj@purdue.edu>

	* man/amanda.8.in: typo in columnspec description.

1999-09-01 John R. Jackson  <jrj@purdue.edu>

	* common-src/dgram.h: expressions in #define should be protected by
	  parenthesis.

1999-08-25  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/chg-chs.sh.in (changerdev): Pass it as -f flag to CHS.
	* docs/TAPE.CHANGERS: Document it.
	Reported by Mike Horansky <moho@stanford.EDU>

	* server-src/conffile.c (read_dumptype): Renamed from get_dumptype.
	Extended to support reading a named dumptype from a specified FILE.
	(get_dumptype): Use read_dumptype.
	(main): Read disklist, so that custom dumptypes are shown.
	* server-src/conffile.h (read_dumptype): Declare.
	* server-src/diskfile.c (read_diskline): Use read_dumptype if
	dumptype starts with `{'.
	* man/amanda.8.in (disklist): Document it.
	* NEWS: Likewise.
	* example/disklist: Exemplify it.

1999-08-23 John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c (copy_template_file): make sure all data is
	  written to label template pipeline.

1999-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Peter Conrad <conrad@opus5.de>

	* docs/INTERNALS: documented splitting of dumps across multiple
	  holding disks.
	* server-src/conffile.c: make sure that disksize and chunksize
	  are multiple of TAPE_BLOCK_SIZE.
	* server-src/diskfile.c (find_disk): new function to see if a
	  given disk is contained in a list structure.
	* server-src/diskfile.h (find_disk): prototype.
	* server-src/driverio.h (RQ_MORE_DISK): Added message.
	* server-src/driverio.h (free_assignedhd): prototype.
	* server-src/driverio.h (assignedhd_t): new data structure.
	* server-src/driverio.c (cmdstr): added comamnd RQ-MORE-DISK.
	* server-src/driverio.c (dumper_cmd): Modified format of CONTINUE
	* server-src/driverio.c (free_assignedhd): new function to free an
	  array of assignedhd_t.
	* server-src/driver.c (roomq): new queue to replace stoppedq.
	* server-src/driver.c (find_diskspace, assign_holdingdisk, 
	  adjust_diskspace, delete_diskspace): rewrite.
	* server-src/driver.c (continue_dumps): new function to determine
	  which dump should be continued.
	* server-src/driver.c (handle_taper_result): call continue_dumps
	  to restart a roomq dump.
	* server-src/driver.c (handle_dumper_result): some rewrite, 
	  modified semantics of NO_ROOM, new message RQ-MORE-DISK.
	* server-src/dumper.c (main): Modified parsing of FILE_DUMP, 
	  handling of use.
	* server-src/dumper.c (write_dataptr): NO-ROOM is informational only,
	  trucate the file to a multiple of TAPE_BLOCK_BYTES.
	* server-src/dumper.c (update_dataptr): rewrite to emit RQ-MORE-DISK
	  command.

1999-08-16  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/Makefile.am: Replace .o with OBJEXT.  List sources
	explicitly, instead of LDADDing the corresponding objects.
	(OBJ_EXTENSION): Wipe out, use OBJEXT.

	* configure.in: Call AC_OBJEXT.
	(LTLIBOBJS, LTALLOCA): Define, according to ac_objext.
	* common-src/Makefile.am (libamanda_la_LIBADD): Use them.
	(libamanda_a_LIBADD): Use LIBOBJS and ALLOCA.

	* common-src/Makefile.am (genversion.o): Revert last change, it was
	just a bug in automake's --disable-dependency-tracking.

1999-08-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* README (platforms): Added OpenBSD.
	Reported by Ian Darwin <ian@sq.com>
	(platforms): Added SunOS 5.7.

1999-08-15  Derek Ney <derek@hipgraphics.com>, Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (SAMBA_DEBUG_LEVEL): New macro, "0" for
	Samba >= 2, "3" for older ones.
	(getsize_smbtar): Use `du' if SAMBA_VERSION >= 2, and the
	appropriate SAMBA_DEBUG_LEVEL.

1999-08-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/Makefile.am (genversion.o): Depend on genversion.c
	too.  It seems that IRIX's make doesn't work without it.
	Reported by Brian Cuttler <brian@wadsworth.org>

1999-08-15  Jon LaBadie  <jon@jgcomp.com>

	* tape-src/tapetype.c: Speed it up by using larger sections in the
	second pass.

1999-08-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amanda.8.in (skip-full, incronly): Document existing bugs.

	* server-src/conffile.c (init_defaults): Default disksize to 0.
	* man/amanda.8.in (holdingdisk use): Document it.
	Reported by Grant Beattie <Grant.Beattie@fulcrum.com.au>

	* server-src/planner.c (setup_estimate): Typo.
	(next_level0): Typo.

	* config/ltconfig, config/ltmain.sh: Update from libtool 1.3.3.

	* example/amanda.conf.in: Clarify holdingdisk::use 0.

	* config/missing: Update from automake 1.4a.

1999-07-04 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in: typo.

1999-06-29  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amrestore.8: Document holding-file usage.

1999-06-25  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Makefile.am (pkgdata_DATA): Install COPYRIGHTs.
	(EXTRA_DIST): Remove docs/*.
	* docs/Makefile.am: New file.
	(pkgdata_DATA): Install all docs.
	* configure.in: Output docs/Makefile.
	Suggested by Paul L. Lussier <plussier@baynetworks.com>

	* docs/FAQ (selfcheck time-out): NIS services, inetd rebooting,
	keyboard time-out, lsof.

	* server-src/amverify.sh.in (HEADER): Use `sed 1q'  instead of the
	not-that-portable `head -1'.
	Reported by Andrew Lare <lare@eos913c.gsfc.nasa.gov>

1999-06-20  Thomas Hepper <th@ant.han.de>

	* changer-src/chg-scsi.c: 2 new config keywords, changerident/tapeident
	
	* changer-src/scsi-changer-driver.c: deleted the linux driver at the
	beginning, (wrong window on cut and paste .......)

	* changer-src/scsi-defs.h: new element in Changer_IO which describes
	the type of device which is handled by this entry (tape/robot)

	* changer-src/scsi-changer-driver.c: New parameter to OpenDevice
	to override the selection of the driver for this device. (See
	also docs/TAPE.CHANGERS)

1999-06-19  Alexander Zangerl  <az@Austria.EU.net>

	* client-src/sendbackup-dump.c (re_table): Match Solaris vxdump
	output.

1999-06-18  Thomas Hepper <th@ant.han.de>

	* server-src/changer.c: (changer_find) check if serachlabel is NULL
	if yes don't print it to the debug file

	* changer-src/scsi-solaris.c: (SCSI_ExecuteCommand) Add missing
	parameter to DecodeExtSense.

	* changer-src/scsi-aix.c: (SCSI_ExecuteCommand) Add missing
	parameter to DecodeExtSense.

	* changer-src/scsi-hpux.c: Added static char rcsid[] = ...
	* changer-src-/chg-scsi.c: dito
	* changer-src/scsi-changer-driver.c: dito

1999-06-17  Thomas Hepper <th@ant.han.de>

	* configure.in: Add new example files amanda.conf.chg-scsi, 
	chg-scsi-linux.conf, chg-scsi-solaris.conf, chg-scsi-hpux.conf

	* changer-src/chg-scsi-chio.c: Add parameter to find_empty

	* changer-src/chg-scsi.c: Changed the way files are opened, added
	FILE *debug_file because now it is possible to send some output to
	stdout. (scsi-changer-driver.c).
	(ask_clean) return 0  if result from get_clean_state is < 0
	if get_current_slot returns < 0 try to find the used slot by asking
	the robot. (happens if no slot file is available, or slot file is empty)
	
	* changer-src/scsi-changer-driver.c: New tape/robot types.
	(find_empty) new parameter to specify range where to search.
	More checks for NULL pointer ....
	(DumpDev) new function to print the info for the device struct.
	(ChangerStatus) some more output ....
	
	* changer-src/scsi-linux.c: Complete rewrite of SCSI_OpenDevice.

	* common-src/debug.c: (debug_fp) new function to return the FILE *
	to the debug file.

	* contrib/sst/sst.c: Removed the inquiry call, this is handled by
	chg-scsi. The old version will hang if for example no tape is loaded.
	
	* contrib/sst/Makefile: New Makefile, the old one does not work if not
	the complete SUNdrv kit is installed.


1999-06-15  Adam Hammer  <hammer@math.purdue.edu>

	* server-src/amverify.sh.in: Wait until device becomes ready after
	rewinding.

1999-06-15  Bjrn Brezger <Bjoern.Brezger@uni-konstanz.de>, Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/calcsize.c (ROUND): Rewrite, it was broken.
	Reported by Erik Lindahl <erik@theophys.kth.se>

1999-06-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/conffile.h: Changed all `long's to `int's, as they
	broke get_number et al on 64bit platforms.
	Reported by Erik Lindahl <erik@theophys.kth.se>

	* configure.in (bcopy, bzero): Oops, ICE_CHECK_DECL already checks
	for availability.

	* configure.in (bcopy, bzero): Check whether they're available.
	* common-src/amanda.h (bcopy, bzero): If not, use memmove and
	memset.
	Reported by Grant Beattie <Grant.Beattie@fulcrum.com.au>

	* server-src/amcheck.c (start_server_check): If info file does not
	exist, explain that it is supposed to be created on the next run.

1999-06-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/tapefile.c (lookup_last_reusable_tape): Fix order of
	arguments in match() invocation.
	From Anthony Worrall <Anthony.Worrall@reading.ac.uk>

1999-06-08  Mike Grupenhoff <kashmir@munge.com>

	* restore-src/amrestore.c: second arg to restore() is a char *, not
	a string_t.  Adjust prototype accordingly.

1999-06-07  Mike Grupenhoff <kashmir@munge.com>

	* common-src/util.c (bind_portrange): function that attempts
	to bind a network connection to a port in a given range.
	* common-src/util.h: prototype bind_portrange().
	* common-src/dgram.c (bind_reserved): remove, superceeded by
	bind_portrange().
	(dgram_bind): use bind_portrange() instead of bind_reserved(), and
	try user specified ports first, then reserved ports, then regular
	ports.
	* common-src/dgram.h: remove prototype for bind_reserved().
	* common-src/stream.c (stream_server, stream_client): use
	bind_portrange() instead of bind_reserved(), and try user
	specified ports first, then reserved ports, then regular
	ports.
	* recover-src/amrecover.c (main): use bind_portrange() instead
	of bind_reserved(), and verify that the port it gives us is
	a reserved one.
	* recover-src/extract_list.c (extract_files_setup): use
	bind_portrange() instead of bind_reserved(), and verify that
	the port it gives us is a reserved one.

1999-06-07  Mark F. Vlems  <mvlems@vbox.xs4all.nl>

	* server-src/amindexd.c (reply, lreply, fast_lreply): Return code 0
	of printf does not imply an error on some systems (Openstep) even if
	the number of written characters is more than 0.  The weakened error 
	check has no implication for the correct implementations of printf.

1999-06-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/driver.c (dump_to_tape): Tell hard from soft
	(retryable) failures in both dumper and taper results, and behave
	accordingly.

	* docs/SYSTEM.NOTES: On Trusted Solaris, the format of inetd.conf is 
	slightly different.
	Reported by Julian Stevens <julian.stevens@baedsl.co.uk>

1999-06-01  John Williams  <williams@morinda.com>

	* changer-src/scsi-hpux.c (eject_tape): Enable it, it works.

1999-06-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/INSTALL: Point to the patches page.  Update version numbers.

	* example/config.site: Document UDPPORTRANGE.

1999-06-01  Jens Persson  <jens.persson@btj.se>

	* configure.in (UDPPORTRANGE): Set from --with-udpportrange.
	* config/acconfig.h: Add UDPPORTRANGE.
	* common-src/dgram.c: Implement it.

1999-05-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/ltconfig, config/ltmain.sh, config/libtool.m4i: Updated
	to libtool 1.3.2 plus a few patches.
	* config/config.guess, config/config.sub: Ditto.

1999-05-25  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ (tar-patch): Mention sparse file problem.

	* recover-src/uscan.l: #undef `ECHO' after #include amanda.h; some
	system header files may define it.
	Reported by Dan Lipofsky <danlip@cyc.com>

	* */Makefile.am: Do not define ACLOCAL_M4, COMPILE or
	AMANDA_CFLAGS.
	* Makefile.am: Create acinclude.m4 in the top-level directory.
	* config/Makefile.am: Create link to acconfig.h in the top-level
	directory.
	* configure.in: Add AMANDA_CFLAGS to CFLAGS.
	* common-src/Makefile.am: Create genversion.h with #defines, to
	avoid genversion-specific CPPFLAGS.
	* common-src/genversion.c: #include genversion.h
	* common-src/version.h: VERSION_COMMENT must be const, as in
	version.c.

1999-05-24  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amcheck.c (main): if we reap a bogus pid, print
	out the error message we generate, instead of whatever junk
	happens to be in the buffer.

1999-05-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amindex.h: Keep P macro expression in a single line.
	Reported by Patrick Harrold <patrickh@nasco-inc.com>

	* common-src/Makefile.am (statfs_LDADD): Added alloc.obj.

	* common-src/statfs.c (STATFS_SCALE, sys/statvfs.h): If f_frsize is
	zero, use f_bsize.  It now works with GNU libc 2.1.
	Reported by Heikki Vatiainen <hessu@cs.tut.fi>

1999-05-22 Alex Pilosov <alex@pilosoft.com>

	* server-src/amindexd.c (is_dump_host_valid): sanitize_name(host)
	before doing a stat.
	* server-src/tapefile.c (lookup_nb_tape): init pos to 0.

1999-05-19 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: take the orig size from the SUCCESS line.
	use value from the infofile only the datestamp are equal.
	Write all available value.

1999-05-15 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (pick_inclevel): check for base_level+1 if
	we don't have estimate for base_level. Needed for FORCE_BUMP.
	* server-src/planner.c (promote_highest_priority_incremental):
	Don't promote if we don't have level 0 estimate. No more need
	to check for skip_full, DS_NOFULL, DS_INCRONLY or FORCE_BUMP.

1999-05-15 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c: ignore SIGPIPE
	* server-src/driver.c: ignore SIGPIPE
	* server-src/driverio.c (taper_cmd, dumper_cmd): return 0 on error, 
	1 on success.
	* server-src/driverio.h (taper_cmd, dumper_cmd): prototype.

1999-05-14  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/TAPE.CHANGERS (chg-rth): URL for chs is no longer valid.

1999-05-10  Mike Grupenhoff <kashmir@munge.com>

	* client-src/sendsize.c (getsize_dump): print out the strerror
	if we can't exec killpgrp.

1999-05-07 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* example/amanda.conf.in: typo

1999-05-05  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amverify.sh.in (pecho): new function.  Like echo
	but doesn't append newline, and supports \r, etc.  Implemented
	using perl.
	* server-src/amverify.sh.in: use pecho where we used to use echo -n,
	etc.  It's nearly impossible to figure out which echo needs what
	flags and also know if it supports \r.  So we just punt and use
	perl.

1999-04-29 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (when_overwrite): return a big number (1024)
	if the tape is not reusable.

1999-04-29  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/ltconfig, config/ltmain.sh, config/libtool.m4i: Updated
	from libtool 1.3.

1999-04-25  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/versuff.c.in: Adjust constness to match version.h.

	* docs/SYSTEM.NOTES: Recommend GNU tar for Linux.

1999-04-25 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amdump.sh.in: execute amtrmlog.

1999-04-22 John R. Jackson  <jrj@purdue.edu>

	* configure.in: add --with-broken-fsf to use a read() loop instead
	of the fsf ioctl on some broken systems.
	* config/acconfig.h: ditto
	* tape-src/tapeio.c (tapefd_fsf): ditto

1999-04-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: Typo
	* docs/SAMBA: Update on samba-largefs patch.
	* docs/FAQ: New FAQ about promotion of full dumps.

1999-04-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* tape-src/tapeio.c (tape_open): Retry after EBUSY and EINTR too.
	Comment out test that would set filename to /dev/null.

1999-04-18  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/WISHLIST: Global reformat.  Removed fixed issues.  Added
	auto-flush mode.

1999-04-17 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/server_util.c: new file for utility function. 
	New function construct_datestamp.
	* server-src/server_util.h: ditto
	* server-src/makefile.am: link server_util.c with libamserver.
	* amcleanupdisk.c (construct_datestamp): remove function.
	* server-src/driver.c: ditto
	* server-src/dumper.c: ditto
	* server-src/amflush.c: ditto
	* server-src/planner.c: ditto

1999-04-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/UPGRADE: Update URL for archived message.

1999-04-07 John R. Jackson  <jrj@purdue.edu>

	* tape-src/tapeio.c: allow tapedev to be /dev/null.
	* server-src/taper.c: allow tapedev to be /dev/null.
	* man/amanda.8.in: allow tapedev to be /dev/null.

1999-04-06 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c (TextRule): Fix to write the full string.

1999-04-06  David Mankins <dm@k12-nis-2.bbn.com>

	* common-src/security.c (bsd_security_ok): if an .amandahosts
	file is missing or unreadable, log this fact to the debug file
	instead of claiming that a user doesn't have permission.

1999-04-01 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: -t should read the tapelist to validate
	the label.

1999-03-30  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* patches/samba-largefs.patch: updated to patch that ended up
	installed in the Samba CVS tree

	* patches/tar-1.12.patch: patch the configure script so that it
	requires autoconf and autoheader to be run; improve the
	printf_long_long test so that it doesn't get false positives because 
	of endianness

	* changer-src/scsi-chio.c: since we do not support FreeBSD 3's
	camlib.h interface, #ifdef out all the code
	Reported by Francis Lam <Francis.Lam@Leitch.com>

	* configure.in (VXSYSLOCPATH): apparently a complex path expression
	gets AC_PATH_PROGS confused; set the path beforehand
	Reported by Francis Lam <Francis.Lam@Leitch.com>

1999-03-28 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: compiler warning.

1999-03-28 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amtrmlog.c: new program to move unused log 
	to logdir/oldlog.
	* server-src/Makefile.am: install amtrmlog.
	* server-src/find.h: declare find_log().
	* server-src/find.c(find_log): new function to return an array of
	all the logfile name that are still needed.
	* server-src/find.c(search_logfile): special case if output_find==NULL,
	return 1 if it the logfile fir the label.

1999-03-25  Neil Crellin  <neil@wallaby.cc>

	* docs/TAPE.CHANGERS (chg-chs): URL for chs

1999-03-25  Alexandre Oliva  <oliva@dcc.unicamp.br>, Tom Schutter  <tom@platte.com>, Cloyce D. Spradling  <cloyce@headgear.org>

	* patches/samba-largefs.patch: updated for Samba 2.0.*

1999-03-25  Charles Owens  <owensc@enc.edu>

	* changer-src/chg-chio.pl.in (changeTape): do not print status to
	both stdout and stderr; this causes failures on FreeBSD

1999-03-21  Elmar Bartel  <bartel@Informatik.TU-Muenchen.DE>

	* conffile.h, conffile.c: new columnspec option
	* reporter.c: use it
	* man/amanda.8.in: description and example
	* example/amanda.conf.in: ditto

1999-03-20  Dahn Nilsson <dahn.nilsson@maxlab.lu.se>

	* configure.in: SAMBA_VERSION is not set correctly.

1999-03-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendbackup-dump.c (re_table): generalize a bit some of
	the regular expressions, so as to make us more adaptable to future
	minor changes and bugfixes the the output format of some dumps

1999-03-15 Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi.c: If the open of the TapeDevice fails
	the programm is not terminated.
	* changer-src/scsi-aix.c: The wrong ident string was checked
	for 0 termination.
	* changer-src/scsi-bsd.c: see scsi-aix.c
	* changer-src/scsi-linux.c: see scsi-aix.c
	* changer-src/scsi-solaris.c: see scsi-aix.c
	* changer-src/scsi-changer-driver.c: Added some more debug prints.
	Wrong fd passwd to LogSense.
	* docs/TAPE.CHANGERS: added note about linux and aha1542

1999-03-15   Michael Povel  <mcp@ladyada.han.de>
	* server-src/amlabel.c: Wrong parameter to changer_label
	* server-src/amtape.c: New function update_one_slot,
	update_labeldb
	* server-src/changer.c: Changed slotsp from int to char, some
	debug prints.
	* server-src/changer.h: Changed prototype for changer_label

1999-03-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/ltconfig, config/ltmain.sh: updated from libtool 1.2f
	* config/libtool.m4i, config/config.guess, config/config.sub: ditto
	* configure.in: dropped AC_PROG_RANLIB, as suggested by libtoolize

1999-03-14  Mathias Herberts  <Mathias.Herberts@ago.fr>

	* man/amrecover.8.in: document mode and setmode

1999-03-14  Jon Stevens  <jon@clearink.com>

	* common-src/security.c (bsd_security_ok): increase the verbosity of 
	failed authentication messages

1999-03-14  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (powerpc-*-linux-*): supported platform
	* README: ditto
	Reported by Jon Stevens <jon@clearink.com>

1999-03-07 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (startup_dump): rename dumpname to progname. 
	the function will use the parameter progname instead of the
	global variable.

1999-03-06  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (openbsd): according to Ralf Gebhart
	<rgebhart@cybernet-ag.net>, sparc-unknown-openbsd2.3 is supported;
	I assume other openbsd platforms work too.

1999-03-05 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: set SAMBA_VERSION
	* client-src/sendbackup-gnutar.c (start_backup): use -q flag
	if SAMBA_VERSION >= 2

1999-03-05 Mathias Herberts <Mathias.Herberts@ago.fr>

	* recover-src/amrecover.h (set_mode, show_mode) declare new functions.
	* recover-src/amrecover.h (SAMBA_SMBCLIENT, SAMBA_TAR) define new
	constant.
	* recover-src/extract_list.c: declare variable samba_extract_method.
	* recover-src/extract_list.c (extract_files_child): set dumptype 
	according to samba_extract_method.
	* recover-src/help.c (help_list): print help for new command mode
	and showmode.
	* recover-src/set_commands.c (set_mode, show_mode): new functions.
	* recover-src/uscan.l:
	* recover-src/uparse.y:

1999-03-04  Thomas Hepper <th@ant.han.de>
	* configure.in Check if samba tar accept the q option
	* changer-src/chg-scsi.c New command -status. Display slot status.
	add debug prints to parse_args. Missing {} in case COM_SLOT 
	add put_current_slot if reset was successfull
	* changer-src/aix.c Init struct pwork with 0's.
	Fixed error in copy of the product indent form the inquiry
	* changer-src/scsi-bsd.c see aix.c
	* changer-src/scsi-hpux_new.c see aix.c
	* changer-src/scsi-irix.c see aix.c
	* changer-src/scsi-linux.c see aix.c
	* changer-src/scsi-solaris.c see aix.c
	* changer-src/scsi-changer-driver.c New function TerminatString,
	places 0 from the end of a string until first char/num
	Fixed wrong parameter for GenericRewind in LogSense
	In GenericElementStatus terminate VOL Tag String with 0
	New function CHangerStatus. dumps changer info on stdout.
	* changer-src/scsi-defs.h VolTag[TAG_SIZE+1] to have place for
	terminating 0
	* client-src/sendbackup-gnutar.c Add option q to tar call if
	samba tar understand q option
	* config/acconfig.h New define if samba tar accepts q option
	* docs/TAPE.CHANGERS Add note on how to init the labelfile	


1999-03-03  Ralf Fassel <ralf@akutech.de>

	* common-src/conffile.h: bit field of length 1 should be unsigned int,
	not int.

1999-03-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: new parameter level to update_info_taper().
	* server-src/driverio.c (update_info_taper): use parameter instead
	of sched(dp)->level.
	* server-src/driver.c: call update_info_taper with level parameter.
	* server-src/amflush.c: call update_info_taper with level parameter.
	no longer need to create a sched_t struct.

1999-03-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: remove declaration of inparallel, cmdstr()
	and childstr(), declare init_driverio(), add inparallel parameter
	to startup_dump_processes().
	* server-src/driverio.c (init_driverio): new function to initialize
	dmptable and taper.
	* server-src/driverio.c (childstr): scan for all dumpers (MAX_DUMPERS)
	instead of only inparallel
	* server-src/driverio.c (startup_dump_processes): new parameter
	inparallel is used instead of global variable.
	* server-src/driver.c (main): call init_driverio.
	* server-src/driver.c (main): call startup_dump_processes with
	inparallel parameter.
	* server-src/amflush.c (main): call init_driverio.

1999-03-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amrmtape.sh.in: work with "last_level" and 
	"consecutive_runs" in the ouput of "amadmin export".

1999-02-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/WISHLIST: protocol between the driver and dumpers.

1999-02-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amtoc.pl.in: output the datestamp of each dump, because
	amflush can flush the same disk multiple date.

1999-02-27  Thomas Hepper <th@ant.han.de>
	* server-src/amlabel.c fixed call to changer_label

1999-02-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h: declare struct holding_t.  Remove
	declaration of insert_dirname, scan_holdingdisk.  Declare
	new function free_holding_list.  pick_datestamp and 
	pick_all_datestamp now return (holding_t *).
	* server-src/holding.c (insert_dirname): new parameter holding_list
	where we add the name. Can add more than MAX_DIRS name.
	* server-src/holding.c (free_holding_list): new function to free
	a holding list.
	* server-src/holding.c (scan_holdingdisk): new parameter holding_list.
	* server-src/holding.c (pick_all_datestamp, pick_datestamp): return
	a list instead of a (char **).
	* server-src/find.c (search_holding_disk): use the list return by
	pick_all_datestamp.
	* server-src/amflush.c: use the list return by pick_datestamp.
	* server-src/amcleanupdisk.c (check_disks): use the list return by
        pick_all_datestamp.

1999-02-26 Thomas Hepper <th@ant.han.de>

	* changer-src/chg-scsi.c Added global structs for the openend
	devices. Added new options label and search for the barcode
	support. New function MapBarCode, map barcode from reader
	to amanda tape labels.
	*changer-src/scsi-aix.c Error in copying SCSI ident fixed. 
	A space mut not be the end of the string...
	* changer-src/scsi-bsd.c same as scsi-aix.c 
	* changer-src/scsi-irix.c same as scsi-aix.c 
	* changer-src/scsi-solaris.c same as scsi-aix.c 
	* changer-src/scsi-hpux_new.c same as scsi-aix.c 
	* changer-src/scsi-linux.c same as scsi-aix.c , fixed
	error in check if we open an sg device.
	* changer-src/scsi-changer-driver.c Removed LookupFunction
	and LookupDevice functions .
	* docs/TAPE.CHANGERS update info about chg-scsi

1999-02-26  Michael Povel  <mcp@ladyada.han.de>

	* server-src/amcheck.c Added debug output for barcode
	support
	* server-src/amlabel.c Added debug output, inform chg-scsi
	on new label
	* server-src/amtape.c Added debug output, inform chg-scsi
	on new label
	* server-src/changer.c Added debug output, filled function
	changer-label with live, label search should work now

1999-02-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.c (addfd): bug fixe.

1999-02-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendbackup-gnutar.c: new regexp for SAMBA
	Reported by Grzegorz Mucha <grzegorz.mucha@solidex.com.pl>

1999-02-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amtoc.pl.in: minor fixes for multi-tape runs

1999-02-17  Nicolas Mayencourt  <Nicolas.Mayencourt@cui.unige.ch>

	* server-src/amtoc.pl.in: complete, backward-incompatible rewrite;
	command-line arguments changed
	* man/amtoc.8.in: ditto

1999-02-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/chg-multi.sh.in: minor portability changes
	* docs/TAPE.CHANGERS: originally by James da Silva

1999-02-17  Jean-Francois Dockes <dockes@cdkit.remcomp.fr>

	* changer-src/chg-multi.sh.in: various portability changes and
	general fixes, particularly for multieject; new cycle mode
	* docs/TAPE.CHANGERS: detailed description of chg-multi
	* example/chg-multi.conf: updated; added reference to
	docs/TAPE.CHANGERS for details

1999-02-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: remove declaration of addfd.
	* server-src/driverio.c (addfd): 2 new arguments, readset and maxfd,
	don't use global variable.
	* server-src/driverio.c (startup_tape_process, startup_dump_process):
	call addfd with new argument.

1999-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.c (startup_tape_process): new taper_program 
	argument.
	* server-src/driverio.h: remove declaration of taper_program.
	* server-src/driver.c (main): declare taper_program.
	* server-src/driver.c: call startup_tape_process with the new 
	taper_program argument.
	* server-src/amflush.c (run_dumps): declare taper_program.
	* server-src/amflush.c (run_dumps): call startup_tape_process with 
	the new taper_program argument.

1999-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.c (startup_dump_process, startup_dump_processes):
	new dumper_program argument.
	* server-src/driverio.h: remove declaration of dumper_program.
	* server-src/driver.c: declare dumper_program.
	* server-src/driver.c: call startup_dump_process and 
	startup_dump_processes with the new dumper_program argument.

1999-02-15  Thomas Hepper <th@ant.han.de>

	* changer-src/scsi-changer-driver.c forget to increment retry
	in SCSI_* functions
	* changer-src/chg-scsi.c (clean_tape) added sleep(60) after
	loading the cleaning tape and before unloading

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/list_dir.h: remove global variable dir_list, declare
	new function get_dir_list.
	* server-src/list_dir.c (get_dir_list): new function to return dir_list.
	* server-src/amindexd.c (opaque_ls): use get_dir_list.

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

        * server-src/holding.h: remove declaration of get_letter_from_user()
        and select_dir().
        * server-src/holding.c: remove function get_letter_from_user() and
        select_dir().
        * server-src/holding.c (pick_datestamp): return empty array instead
        of calling exit if no directory are found.
        * server-src/amflush.c (get_letter_from_user): new function copied
        from holding.c.
        * server-src/amflush.c (confirm): write a message and exit if no
        directory were found.

1999-02-14  Thomas Hepper <th@ant.han.de>

	* changer-src/scsi-changer-driver.c New function SCSI_Move
	removed move in GenericMove, call now SCSI_Move
	Now check in GenericMove if the move is legal, based on the info
	from the device capabilities page
	* changer-src/scsi-linux.c (SCSI_OpenDevice) check if the device
	is an sg device, or an link to an sg device. If no set SCSI flag to 0
	Set timeout for SCSI commands, the default will not work if there is an
	IES on slow changers, if not set high maschine hangs with lot of SCSI  bus
	resets.....

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amindexd.c: remove duplication inclusion of version.h.
	Include tapefile.h to get read_tapelist() prototype.
	* server-src/amindexd.c (build_disk_table): remove a plethora of
	unused local vars.
	* server-src/planner.c: FORCE_FULL command was not cleared.

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c (flush_holdingdisk): don't update the database
	when flushing a partial dump.

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h (get_dumpfile): new function
	* server-src/holding.c (get_dumpfile): new function to fill a
	dumpfile_t struct from a holding file.

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: compiler warning: too many arguments for format

1999-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: remove the label from the tapefile in
	case it was already there (-f).

1999-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c: make sure holding files are not larger
	that chunksize.

1999-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcleanupdisk.c: new program to scan and find temporary
	file on holding disks.
	* server-src/Makefile.am (libexec_PROGRAMS): add amcleanupdisk.
	* server-src/amcleanup.sh.in: call amcleanupdisk.

1999-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.c (pick_all_datestamp): new function to return
	all datestamp in the holding disks.
	* server-src/holding.h: declare pick_all_datestamp.

1999-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.h (host_t): new start_t field.
	* server-src/diskfile.c (read_diskline): set start_t to 0.
	* server-src/driver.c (start_some_dumps): Don't start a dump if 
	the host->start_t > now.
	* server-src/driver.c (start_some_dumps): set host->start_t to 15 sec 
	in the future when starting a FILE_DUMP.
	* server-src/driver.c (dump_to_tape): set host->start_t to 15 sec in 
	the future when starting a PORT_DUMP.

1999-02-12  Thomas Hepper <th@ant.han.de>
	* changer-src/Makefile.am added tape-src to the include list
	* changer-src/chg-scsi.c removed the changes for not using the
	statfile.
	* changer-src/scsi-aix.c Added debug output in SCSI_ExecuteCommand
	added size parameter to the SCSI_Inquiry call
	* changer-src/scsi-bsd.c added size parameter to the SCSI_Inquiry call
	* changer-src/scsi-hpux_new.c same as above 
	* changer-src/scsi-irix.c same as above
	* changer-src/scsi-solaris.c same as above
	* changer-src/scsi-linux swich from ioctl interface to sg interface.
	Not full tested yet !!
	* changer-src/scsi-changer-driver.c Added new structs for new devices.
	complete rewrite of Sense Handling. Removed now unused functions.
	Added first functions for Barcode reader support.
	Now use MODE_SENSE to get the number of Drives/Slots/Robots.
	Split up functions in SCSI functions (prefix SCSI, Generic functions,
	prefix Generic. Not complete yet). Rewrite of GenericElementStatus
	* changer-src/scsi-defs.h added new structs, reordered some defines.
	* changer-src/chg-scsi-chio.c New file(copy of chg-scsi.c). 
	Too difficult to maintain chg-scsi and chg-scsi-chio from one file

1999-02-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amlabel.c (main): try to read just-written tape label
	back; if wrendmark overwrote the label, suggest using a
	non-rewinding device
	* tape-src/tapeio.c (tape_wrendmark): would not close tape device if 
	wrendmark failed

1999-02-10  Paul Bijnens  <Paul.Bijnens@lant.be>

	* server-src/amoverview.pl.in: Y2K fix in output to user
	* server-src/amtoc.pl.in (print_info): ditto

1999-02-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (getsize_dump): do not redirect standard
	output of estimator to /dev/null if we HAVE_DUMP_ESTIMATE

1999-02-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* NEWS: fix description of incronly: it won't really perform full
	backups

	* NEWS: support for ufsdump -S, incronly strategy and new chunksize
	default

	* server-src/conffile.c (init_holdingdisk_defaults, chunksize):
	default to 1Gb
	* example/amanda.conf.in: ditto
	* man/amanda.8.in: ditto

	* configure.in (amanda_cv_dump_estimate): check for support for -S
	too, and define HAVE_DUMP_ESTIMATE as the estimate switch, if any
	* client-src/sendsize.c (re_size): new regexps for Solaris ufsdump
	-S and Samba `du'.  Restrict regexp that matched Digital Unix'
	dump -E so that it doesn't match smbclient's output any more.
	Move some regexps around, and only define them if the corresponding
	dump program is available

1999-02-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* example/amanda.conf.in: document the behavior of relative
	exclude-list files
	* man/amanda.8.in: ditto

	* man/amanda.8.in (exclude list): the GNU tar flag is
	--exclude-from, not --exclude-list
	Reported by Tom Schutter <tom@platte.com>

1999-02-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendbackup-gnutar.c (re_table): ignore `session request 
	to' message printed by Samba 2.0.0

1999-01-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amanda.8.in (comprate): it is not used when there is history
	information; useful for large disks that compress little
	Reported by job bogan <job@piquin.uchicago.edu>

1999-01-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Makefile.am: select which SUBDIRS to descend to here
	* client-src/Makefile.am: removed if WANT_CLIENT
	* tape-src/Makefile.am: removed if WANT_TAPE
	* server-src/Makefile.am: removed if WANT_SERVER
	* changer-src/Makefile.am: ditto
	* restore-src/Makefile.am: removed if WANT_RESTORE
	* recover-src/Makefile.am: removed if WANT_RECOVER
	* amplot/Makefile.am: removed if WANT_AMPLOT

1999-01-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* NEWS: chg-scsi ports and Samba 2.0.0 support

	* configure.in (USE_AMANDAHOSTS): enable by default
	* example/config.site: ditto
	* docs/INSTALL: ditto
	* NEWS: ditto

	* docs/INSTALL: updated URLs for GNU packages and Samba
	* docs/SAMBA: note that Samba 2.0.0 is supported

	* docs/SYSTEM.NOTES (HP/UX): what does `Link severed' mean?

1999-01-27  Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-changer-driver.c SCSI_ReadElementStatus
	A while loop has to start with while, not if .....

1999-01-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Makefile.am (EXTRA_DIST): sst was added within contrib

	* ltmain.sh, ltconfig, libtool.m4i: updated from libtool CVS
	* configure.in: AC_SUBST LIBTOOL_DEPS
	* Makefile.am: regen libtool if neded

	* Makefile.am: declare that we want automake 1.4 and we're a foreign 
	package

	* configure.in: require autoconf 2.13, and use
	AC_VALIDATE_CACHED_SYSTEM_TUPLE instead of
	AC_VALIDATE_CACHE_SYSTEM_TYPE
	* config/acinclude.m4i: removed AC_VALIDATE_CACHE_SYSTEM_TYPE

	* configure.in (SAMBA_CLIENT): updated check for smbclient to
	support Samba 2.0.0

1999-01-26  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amdump.sh.in (runuser): set to LOGNAME if defined, and
	to the output of whoami otherwise
	Reported by Tom Schutter <tom@platte.com>

1999-01-26	Thomas Hepper <th@ant.han.de>	
	* Makefile.am Added sst driver files to EXTAR_DIST

1999-01-26	Thomas Hepper <th@ant.han.de>	
	* changer-src/chg-scsi.c If statfile is not set try to get the info
	about the current loaded tape direct from the changer.
	Fixed debug output for the eject value if > 1
	* changer-src/libscsi.h Prototype for GetCurrentSlot
	* changer-src/scsi-aix.c If the Device we open is not a changer or tape
	return NULL, so that the above function can abort. New eject per mtio ioctl.
	* changer-src/scsi-bsd.c see scsi-aix.c
	* changer-src/scsi-linux.c see scsi-aix.c
	* changer-src/scsi-hpux_new.c see scsi-aix.c
	* changer-src/scsi-irix.c see scsi-aix.c
	* changer-src/scsi-solaris.c see scsi-aix.c and added a retry loop for
	the execution of SCSI commands.
	* changer-src/scsi-changer-driver.c New Function SCSI_ReadElementStatus
	split ReadElementStatus in device and device independed part
	New EXB120ElementStatus, renamed ReadElementStatus in GenericElementStatus
	added EXB 120 and DLT7000 to the devices list.
	Removed the linked list for the element status. Now every element
	type has its own array allocated in the *ElementStatus functions.
	Check in the functions which sends SCSI commands if the fd is able to
	receive SCSI commands.
	In GenericEject check which type of eject to use (ioctl/SCSI)
	New GetCurrentSlot, try to get the info about the loaded tape direct from
	the changer.
	* changer-src/scsi-chio.c Add function GetCurrentSlot (not well tested yet)
	* changer-src/scsi-defs.h Added missing decl. in MediumTransportElementDescriptor_T
	for LITTLE_ENDIAN_BITFIELDS
	new field from in ElementInfo_T
	* changer-src/sci-hpux.c EMpty function GetCurrentSlot, do we still need scsi-hpux.c ?
	* docs/TAPE.CHANGERS added some notes for HP-UX, expanded list of tested devices
	
1999-01-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c (init_defaults): default value of runspercycle
	is 0.
	* server-src/amadmin.c (balance): use default value of runspercycle.
	* server-src/planner.c (main): use default value of runspercycle.

1999-01-22  Martin Apel <apel@tecmath.de>

	* example/amanda.conf.in: explanation of incronly strategy.
	* man/amanda.8.in: explanation of incronly strategy.
	* server-src/amadmin.c: recognize incronly strategy
	* server-src/conffile.c: read the incronly strategy in the
	configuration file.
	* server-src/conffile.h: definition of DS_INCRONLY
	* server-src/planner.c: Do planning for incronly strategy:
	If the force flag is set perform a full dump, otherwise do
	normal incremental processing but avoid full dumps.
	* server-src/tapefile.c: Bugfix so only tapes which match
	the regular expression for tape labels in the current 
	configuration are considered for writing.

1999-01-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: require autoconf 2.12.2

	* changer-src/Makefile.am (LDADD): add libamtape, because
	tapefd_rdlabel() is used in scsi-changer-driver.c

	* server-src/planner.c (output_scheduleline): removed `or historical
	data' from `no estimate' message; historical data doesn't matter any 
	more
	Reported by Giorgos Vlachos <Giorgos.Vlachos@eurodyn.com>

1999-01-20  Todd Pfaff  <pfaff@mcmaster.ca>
	
	* client-src/sendbackup-gnutar.c: more Samba 2.0.0 messages

	* client-src/sendbackup-gnutar.c: new Samba 2.0.0 message 

1999-01-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c: use ap_snprintf instead of snprintf.
	* server-src/amflush.c: rotation of new amflush log was broken.

1999-01-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: always call output_stats(), the problem is
	that degraded_mode is set if amflush fills the tape.

1999-01-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c: write debuging info to $logdir/amflush
	instead of /dev/null if we run in background.
	* server-src/amcleanup.sh.in: rename $logdir/amflush.

1999-01-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: fix a divide by zero error.

1999-01-10  Thomas Hepper <th@ant.han.de>
        * rewite of the scsi-changer-driver.c and the os depnedent
          parts. Removed one layer of functions (Move, Eject, Clean ...)

1999-01-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: report the current dump when reporting
	the busy time of each dumper.

1998-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c: open temporary holding file with O_TRUNC flags
	and with mode 0600.

1998-12-28  John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c: do not drop core generating labels if the
	tape label is not defined, e.g. in degraded mode (compliments of
	Jan L. Peterson <jlp@Part.NET>).

1998-12-28  John R. Jackson  <jrj@purdue.edu>

	* server-src/amtape.c: initialize two strings to NULL to avoid a
	core dump, compliments of G. Allen Morris III <gam3@acm.org>.

1998-12-27  John R. Jackson  <jrj@purdue.edu>

	* man/amreport.8.in: remove reference to 8.5x11 paper size for the
	3-hole binder.

1998-12-27  John R. Jackson  <jrj@purdue.edu>

	* example/3hole.ps: new lbl-templ file for 3 hole punch reports
	* example/Makefile.am: add 3hole.ps

1998-12-22  Thomas Hepper <th@icem.de>

	* docs/TAPE.CHANGERS Update notes about chg-scsi
	* changer-src/chg-scsi.c Added new config option tapestatus,
	if set the tape log pages are written to this file.
	changed parameter list for get_clean_state/ask_clean,
	* changer-src/libscsi.h changed parameter list for get_clean_state
	* changer-src/scsi-changer-driver.c Added new functions OpenDevice
	CloseDevice LookupDevice. 
	Added new functions to read and decode the Tape LOG Pages.
	Tape Eject and ready check is now done by SCSI calls

	* changer-src/scsi-aix.c
	* changer-src/scsi-bsd.c
	* changer-src/scsi-hpux_new.c
	* changer-src/scsi-hpux.c
	* changer-src/scsi-irix.c
	* changer-src/scsi-solaris.c
	Changed all SCSI_OpenDevice/SCSI_CloseDevice functions so that they
	fit to the new OpenDevice/CloseDevice calls. Removed mtio.h from 
	includes, remove Tape_Ready and Tape_Eject
	* changer-src/scsi-chio.c
	* changer-src/scsi-defs.h

	For all changer-src files, removed tabs, run indent (from xemacs)
 	Added emacs variables to the end (no tab, gnu style)

1998-12-21  John R. Jackson  <jrj@purdue.edu>

	* man/amanda.8.in: document the lbl-templ tapetype option.

1998-12-21  John R. Jackson  <jrj@purdue.edu>

	* man/amreport.8.in: fix formatting problem.

1998-12-20  John R. Jackson  <jrj@purdue.edu>

	* configure.in: define NEED_RESETOFS unless LFS (large file system
	support) is available.
	* config/acconfig.h: add NEED_RESETOFS tag.
	* server-src/taper.c: only reset the tape offset if NEED_RESETOFS
	is defined and only once per 2 GBytes.

1998-12-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amlabel.c (main): datestamp for new tapes is now 0
	* server-src/tapefile.c (reusable_tape): recognize datestamp 0 as
	reusable
	* man/amlabel.8.in: document that tapes are added to tapelist

1998-12-19  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: instead of just displaying why no
	dumpers were busy, display reason(s) why N+1 were not busy.

1998-12-18  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: add statistics about how much time
	taper and each dumper is busy, how much time N dumpers are busy
	and why no dumpers were busy.

1998-12-18  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: fix two perl warnings.

1998-12-18  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: fix two minor typos.  Add percentage
	display to the summary comparing real and estimated size and real
	versus total estimate (showing how well the estimates are doing and
	a rough guess at how far along the run is).  Also the percentage of
	total holding disk space in use.

1998-12-18  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: take the --file argument as is if it
	is an absolute path.

1998-12-18  John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c: call short_dump_state() one last time before
	quitting so amstatus gets a last good status.  Tell taper to quit
	after the dumpers since it writes more information to the amdump
	file (helps prevent mixed messages).

1998-12-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/Makefile.am (noinst_DATA): removed; bogus
	* config/config.guess, config/config.sub: config/install-sh,
	config/mkinstalldirs: updated to current pre-2.13 autoconf CVS tree
	* patches/autoreconf.patch: removed
	* config/libtool/libtool.m4: renamed to config/libtool.m4i
	* config/acinclude.m4: renamed to config/acinclude.m4i
	* config/Makefile.am (EXTRA_DIST): updated to reflect changes
	* autogen: build config/acinclude.m4  by concatenating acinclude.m4i
	and libtool.m4i
	* configure.in: no longer test whether libtool is installed; require 
	newer autoconf
	* config/ltconfig, config/ltmain.sh, config/libtool.m4i: updated to
	libtool 1.2d
	* amplot/Makefile.am (EXTRA_DIST): no longer needed
	* changer-src/Makefile.am (chg_scsi_SOURCE): move scsi-defs.h closer 
	to the beginning of the list
	* docs/INSTALL: fixed URL to gnuplot; recommend autoconf and
	automake from CVS

1998-12-14  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (BSD SCSI): test ... -a ... is not portable, and less 
	so when written test ... -a test ... :-)

1998-12-14  Thomas Hepper <th@icem.de>

	* changer-src/Makefile.am Added scsi-bsd.c
	* changer-src/chg-scsi.c Initialize *scsitapedevice
	* changer-src/scsi-changer-driver.c remove LITTLE_ENDIAN_BITFILEDS
	defenition
	changed RequestSense to pRequestSense (there is a function 
	called RequestSense)
	changed error handling in ResetStatus (fix for IRIX)
	FIxed length handling for the pages in ReadElemtStatus
	* changer-src/scsi-chio.c get_clean_state only returns 0, the
	ioctl to get the clean flag is not portable ;-(
	changed all (f)printf to dbprintf

	* changer-src/scsi-defs.h ElementStatusData_T is for BIG and
	LITTLE endian the same ...

	* changer-src/scsi-bsd.c New file for FreeBSD

	* changer-src/scsi-irix.c Clean up in the return handling
	changed RequestSense to pRequestSense
	Removed unused function TapeStatus

	* changer-src/scsi-linux.c changed RequestSense to pRequestSense
	Removed unused function TapeStatus

	* changer-src/scsi-solaris.c changed RequestSense to pRequestSense
	Removed unused function TapeStatus

	* config/acconfig.h added def for BSD_LIKE_SCSI

	* configure.in Added check for ENDIAN type AC_C_BIGENDIAN
	added sys/scsiio.h and check for BSD SCSI interface

1998-12-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (handle_dumper_result): rename .tmp files
	when receiving ABORT_FINISHED.

1998-12-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (start_some_dumps): Use the holdp returned
	by find_diskspace for a big_dumper in degraded mode.

1998-12-11  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES (Ultrix): recommend gcc or egcs
	(IRIX): patch for xfsdump estimates

1998-12-10  John R. Jackson  <jrj@purdue.edu>

	* common-src/amflock.c (main): remove call set_pname() for
	CONFIGURE_TEST since error.o is not linked in.

1998-12-10  John R. Jackson  <jrj@purdue.edu>

	* common-src/amflock.c (main): report CONFIGURE_TEST error messages to
	stderr.

1998-12-10  John R. Jackson  <jrj@purdue.edu>

	* common-src/amflock.c (main): call set_pname() for CONFIGURE_TEST.
	* configure.in: do not set up pname global for lnlock CONFIGURE_TEST.

1998-12-09  Henning P. Schmiedehausen  <henning@tanstaafl.de>

	* client-src/sendbackup.c (parse_options): Added check whether the
	pathname of the exclude file is relative and if yes, use the
	mountpoint of the filesystem as anchor.  So you can put your exclude
	file in the root of the filesystem to backup.
	* client-src/sendsize.c (getsize_gnutar): added the same check as
	above so sendsize uses the same exclude file.

1998-12-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.c (size_holding_files): return size in KB.
	* server-src/driver.c (adjust_diskspace): use KB returned by
	size_holding_files.
	* server-src/driver.c: rename .tmp file
	* server-src/dumper.c: do not rename .tmp file. let the driver do it.

1998-12-09  John R. Jackson  <jrj@purdue.edu>

	* common-src/stream.c (stream_server): do not request a reserved port
	if we are root but PORTRANGE is defined.  Also, clean up the code
	and make sure *portp is -1 on all error returns.

1998-12-08  John R. Jackson  <jrj@purdue.edu>

	* Makefile.am: add the user-contributed area.
	* contrib/README: describe the user-contributed area.
	* contrib/dbbackup.README: README for Oracle database backup system.
	* contrib/dbbackup.ksh: Oracle database backup system wrapper.
	* contrib/dbbackup.sql: Oracle database backup system setup commands.
	* contrib/dbbackup.tcl: Oracle database backup system main body.

1998-12-08  John R. Jackson  <jrj@purdue.edu>

	* amplot/Makefile.am: fix install rule when DESTDIR is non-null,
	compliments of Henning P. Schmiedehausen <hps@tanstaafl.de>.

1998-12-08  John R. Jackson  <jrj@purdue.edu>

	* configure.in: fix reversed code for --with-amrecover, compliments
	of Yar Tikhiy <yar@radio-msu.net>.

1998-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/fileheader.h (dumpfile_t): new is_partial field.
	* common-src/fileheader.c: add codee for new is_partial field.
	* server-src/holding.h (rename_tmp_holding): declare new function.
	* server-src/holding.c (rename_tmp_holding): new function.
	* server-src/dumper.c (do_dump): return 1 if succeded, otherwise 0.
	* server-src/dumper.c (main): open .tmp when dumping to disk, 
	rename .tmp if do_dump return 1.
	* server-src/dumper.c (update_dataptr): open .tmp for new chunk.
	* server-src/amstatus.pl.in (dump_size): return size of .tmp file.

1998-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* NEWS: document new force-bump, force-no-bump and unforce-bump 
	command in amadmin.

1998-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.c (size_holding_files): new function to
	return the sum of the size of all chunk of an image.
	* server-src/holding.h (size_holding_files): declare.
	* server-src/driver.c (adjust_diskspace): use size_holding_files 
	instead of doing a stat of only the first chunk.

1998-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c: new force-bump, force-no-bump and unforce-bump
	command.
	* man/amadmin.8.in: document them.

1998-12-05  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ (large filesystems): fixed reference to results missing
	(results missing): updated to 64Kb UDP packets

1998-12-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/infofile.h: rename PLANNER_FORCE to FORCE_FULL
	* server-src/planner.c: rename PLANNER_FORCE to FORCE_FULL
	* server-src/amadmin.c: rename PLANNER_FORCE to FORCE_FULL

1998-12-01  John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c: make -t mean do the tape checks, add new -l
	option for doing just the local server (non-tape) checks.  Have -w
	turn on -t.  Have -cs (or -sc) do both server and client checks.
	* man/amcheck.8.in: document above changes and clean up some minor
	formatting issues.

1998-11-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (start_some_dumps): In degraded mode,
	a big dumper should do high priority dump before low priority.
	* server-src/driver.c (sort_by_priority_reversed): sort by
	time if priority is equal.

1998-11-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/infofile.h: declare FORCE_BUMP and FORCE_NO_BUMP
	as command.
	* server-src/amadmin.c (force_one,unforce_one,info_one): work
	with info.command with bit operator.
	* server-src/planner.c (setup_estimate): work with info.command 
	with bit operator, support for FORCE_BUMP and FORCE_NO_BUMP command.

1998-11-27  Thomas Hepper    <th@icem.de>

	* changer-src/scsi-aix.c Some changes in the error handling in
	scsi command execution
	* changer-src/scsi-changer-driver.c More debug prints.
	removed Endian16/Endian24 (replaced with macros)
	* changer-src/scsi-chio.c make get_clean_state work on linux
	* changer-src/scsi-defs.h  added macros for converting from/to
	SCSI CDB MSB type
	* docs/TAPE.CHANGERS add note about AIX and chg-scsi

1998-11-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c(export_one): export the last_level and
	consecutive_runs field.
	* server-src/amadmin.c(import_one): import the last_level and
	consecutive_runs field.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amlabel.c: insist on being run as the dump user (ala
	amlabel) to keep permissions straight.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amadmin.c: fix minor message format problem.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amlabel.c: insist on being run as the dump user (ala
	amflush) to keep permissions straight.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amrmtape.sh.in: insist on being run as the dump user (ala
	amdump) to keep permissions straight.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amadmin.c: issue a warning for update commands that might
	leave ownership incorrect.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c: add a "-t" option to disable tape tests in the
	server checks.  This lets server checks be done without mounting a
	tape.  Add lots more sanity checks, in particular, ownership and
	permissions of the index area and text format database.  Warn if
	amcheck is not run as the dump user listed in amanda.conf.  Minor
	consistency cleanup in the messages.
	* man/amcheck.8.in: document the changes.

1998-11-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amcleanup.sh.in (logdir/amdump): arrange that it is
	renamed if it exists, even if no log file could be found.

1998-11-19  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/ltmain.sh, config/ltconfig, config/libtool/libtool.m4:
	updated to current CVS libtool

1998-11-19  John R. Jackson  <jrj@purdue.edu>

	* server-src/conffile.c (get_holdingdisk, init_holdingdisk_defaults):
	set the default chunksize and the "0" and "-1" special chunksizes
	to 64 KBytes less than the maximum to allow the final read at EOF.
	* server-src/dumper.c (main): leave the chunksize as it is when it
	comes in except to truncate it to a 32 KByte boundary.
	* man/amanda.8.in: add some chunksize comments and clean up a few
	minor odds and ends.

1998-11-19  John R. Jackson  <jrj@purdue.edu>

	* recover-src/amrecover.c (main): use set_host to find the initial
	host name so we get the same alias resolution at startup as the
	sethost command.
	* recover-src/set_commands.c (set_host): report alternate names being
	attempted and only clear the directory list if a host is found.

1998-11-19  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/driverio.c (update_info_dumper): do not update
	compression or dump rates when called from
	update_failed_dump_to_date
	Reported by Michael Schmitz <mschmitz@sema.de>

1998-11-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (main): reduce the size of the chunksize by
	2 blocks.

1998-11-18  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: hack for paxutils was not working; fixed

1998-11-18  Michael Povel  <mcp@ladyada.han.de>

	* server-src/changer.h added new functions:changer_query
	,changer_search,changer_find, changer_label
	* server-src/changer.c added changer_query, changer_search,
	changer_find, changer_label
	* server-src/amcheck.c (taper_scan) now uses changer_find 
	* server-src/amtape.c (load_label and taper_scan) now use changer_find
	* server-src/taper.c (taper_scan) now uses changer_find
	* server-src/amlabel.c (main) added call to changer_label
	which is only an empty dummy at the moment

1998-11-18  Thomas Hepper <th@icem.de>

	* changer-src/chg-scsi.c Added debug print option
	* changer-src/chg-scsi.c If the load fails do not continue
	* changer-src/scsi-aix.c changed #include <config.h> to <amanda.h>
	* changer-src/scsi-aix.c Added debug prints to SCSI_ExecuteCommand
	* changer-src/scsi-changer-driver.c changed #include <config.h> to 
	#include <amanda.h>
	* changer-src/scsi-changer-driver.c Added debugging prints
	* changer-src/scsi-changer-driver.c Remove unused funktion TestUnitReady
	* changer-src/scsi-chio.c added missing funktion Tape_Ready
	* changer-src/scsi-hpux.c removed #include "config.h", is already done
	in amanda.h
	* changer-src/scsi-hpux_new.c  changed #include <config.h> to 
	#include <amanda.h>
	* changer-src/scsi-irix.c changed #include <config.h> to 
	#include <amanda.h>
	* changer-src/scsi-linux.c changed #include <config.h> to 
	#include <amanda.h>
	* changer-src/scsi-solaris.c changed #include <config.h> to 
	#include <amanda.h>

1998-11-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c: disable HAVE_DUMP_ESTIMATE if SAMBA_CLIENT
	is defined

1998-11-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/tapefile.c (lookup_last_reusable_tape): Wrong order
	to shift the tpsave array.

1998-11-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* example/amanda.conf.in: document that infofile is supposed to be a
	directory with the default database format
	* docs/FAQ: New questions: `infofile update failed' and `using the
	same host in different configurations'

1998-11-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	changer-src/scsi-linux.c (Tape_Ready): typo, the argument Device
	to the SCSI_CloseDevice() is not defined, I changed it to tapedev.

1998-11-17  Brendan M Coffey <bcoffey@connix.com>

	* common-src/stream.c (stream_server): add requested send and receive
	socket size parameters.
	* common-src/stream.h (stream_server): ditto
	* server-src/taper.c (file_reader_side): set a large receive socket
	buffer size.
	* client-src/sendbackup.c (main): set a large send and receive socket
	buffer size for the data path, use defaults for the message and index
	paths.

1998-11-16  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/scsi-solaris.c (Tape_Ready): typo in Thomas' patch

1998-11-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/infofile.h (get_dumpdate): rename record parameter to info.
	* server-src/infofile.h (get_info): rename record parameter to info.
	* server-src/infofile.h (put_info): rename record parameter to info.
	* server-src/infofile.c (get_dumpdate): rename rec parameter to info.
	* server-src/infofile.c (zero_info): rename ip parameter to info.
	* server-src/infofile.c (get_info): rename record parameter to info.
	* server-src/infofile.c (put_info): rename record parameter to info.
	* server-src/infofile.c (dump_rec): rename r parameter to info.
	* server-src/infofile.c (dump_db): rename record variable to info.
	* server-src/planner.c (last_level): rename ip parameter to info.
	* server-src/planner.c (next_level0): rename ip parameter to info.
	* server-src/planner.c (runs_at): rename ip parameter to info.
	* server-src/planner.c (askfor): rename inf parameter to info.
	* server-src/planner.c (setup_estimate): rename inf variable to info.
	* server-src/driverio.c (update_info_dumper): rename inf parameter 
	to info.
	* server-src/driverio.c (update_info_taper): rename inf parameter 
	to info.
	* server-src/amadmin.c (next_level0): rename ip parameter to info.
	* server-src/amadmin.c (force_one): rename inf variable to info.
	* server-src/amadmin.c (unforce_one): rename inf variable to info.
	* server-src/amadmin.c (delete_one): rename inf variable to info.
	* server-src/amadmin.c (info_one): rename inf variable to info.
	* server-src/amadmin.c (due_one): rename inf variable to info.
	* server-src/amadmin.c (balance): rename inf variable to info.

1998-11-11  Thomas Hepper <th@icem.de>

	* configure.in: amanda_cv_hpux_scsi was double defined.
	Replaced it in the chio check with amanda_cv_hpux_scsi_chio
	* docs/TAPE.CHANGERS: update the notes about chg-scsi
	* changer-src/chg-scsi.c: Unload the cleaning tape only
	if it is loaded
	Pass the changerdev and tapedev Tape_Ready, so we can check
	if changerdev=tapedev. In this case the fd is already open.
	* changer-src/scsi-aix.c: cleanup and first parts are running :-)
	* changer-src/scsi-changer-driver.c: Pass back the scsi status
	field to the calling function, not the result from the ioctl
	if the return form the ioctl is >= 0
	* changer-src/scsi-hpux.c: Add additional param to Tape_Ready
	fill Tape_Ready with live 
	* changer-src/scsi-hpux_new.c: Return the scsi status if 
	the ioctl result is >=0. Add new Parameter to Tape_Ready
	* changer-src/scsi-irix.c: same as scsi-hpux_new.c
	* changer-src/scis-linux.c: Add additional param to Tape_Ready
	* changer-src/scsi-solaris.c: same as scsi-hpux_new.c

1998-11-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (main): redo my patch about total_disksize that
	Alexendre has undone, only the 2.4.1 branch was broken.

1998-11-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/driver.c (main): total_disksize was only added after
	the loop terminated, i.e., when hdp was NULL -> crash.  fixed.

1998-11-09  John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c (main): ignore SIGPIPE so if a child process
	dies we do not also go away.  Also fix a core dump if amanda.conf
	cannot be processed, and clean up a few error messages.

1998-11-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/infofile.h (struct info_s): add last_level and
	consecutive_runs.
	* server-src/infofile.c: support new last_level and consecutive_runs
	* server-src/planner.c (last_level): return ip->last_level.
	* server-src/planner.c (runs_at): return ip->consecutive_runs.
	* server-src/driverio.c (update_info_dumper): update inf.last_level
	and inf.consecutive_runs.

1998-11-09  Mike Grupenhoff <kashmir@munge.com> 
	* client-src/sendbackup-dump.c (start_backup): don't close indexf
	if it was never open
	* client-src/sendbackup-gnutar.c (start_backup): ditto

1998-11-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (main): add hdp->disksize to total_disksize
	even when we create the datestamp dir. (reserve was unusable).

1998-11-07  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (GNUTAR): accept tar from Free paxutils, the new name
	of GNU tar

1998-11-07  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/scsi-solaris.c: added missing #endif

	* configure.in: merge with camlib.h patch from Oct 31.
	remove all uses of test ... -a ...; this is not portable.
	(AC_CHECK_HEADERS) added header files for Linux and Solaris

1998-11-07  Thomas Hepper  <th@icem.de>

	* changer-src/chg-scsi: Add config option scsidev
	* changer-src/chg-scsi: Remove function tape_ready
	* changer-src/chg-scsi: Add new parameter tapedev to function
	ask_clean
	* changer_src/scsi-hpux.c: changed HAVE_HPUX_SCSI to 
	HAVE_HPUX_SCSI_CHIO, changed in configure.in too
	* changer-src/libscsi.h: Expand definition for get_clean_state
	* new files in /changer-src:
	scsi-aix.c, scsi-changer-driver.c, scsi-defs.h
	scsi-hpux_new.c, scsi-irix.c, scsi-linux.c, scsi-solaris.c
	* configure.in checks for scsi ioctl added, check for header files
	for the scsi suport added
	* config/acconfig.h new:
	HAVE_HPUX_LIKE_SCSI, HAVE_HPUX_SCSI_CHIO, HAVE_LINUX_LIKE_SCSI
	HAVE_IRIX_LIKE_SCSI, HAVE_SOLARIS_LIKE_SCSI, HAVE_AIX_LIKE_SCSI
	       removed: HAVE_HPUX_SCSI
	* changer-src/Makefile.am: New conditional for building chg-scsi-chio
	and chg-scsi. chg-scsi-chio is the old chg-scsi

1998-11-05  John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: tolerate extra amtape output.

1998-11-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/amrecover.c: remove declaration of errstr.

1998-11-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amindexd.c (build_disk_table): call find_dump() instead
	of popen("amadmin <conf> find ...")

1998-11-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h: rename dir_list to holding_list because
	dir_list is also declared in amflush.c
	* server-src/holding.c: ditto
	* server-src/find.c: ditto

1998-11-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: remove warning.

1998-11-04  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/taper.c (read_file): if a new tape cannot be found,
 	report a no-tape error to the log file and exit, just like it does
 	for the first tape

1998-11-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (pick_inclevel): return base_level even
	when the estimate failed.
	* server-src/planner.c (output_scheduleline): test for degr_size
	instead of degr_level.

1998-11-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (last_level): update last_date otherwise only
	level 0 or the highest is returned.

1998-11-03  Mike Grupenhoff  <kashmir@munge.com>

	* common-src/alloc.c: const arguments to the stralloc functions
	* common-src/amanda.h: update stralloc prototypes for const
	poisoning

1998-11-03  John R. Jackson  <jrj@purdue.edu>

	* server-src/dumper.c (do_dump): do not report FAILED back to driver
	when it sent us ABORT.  Clean up and send back ABORT-FINISHED.

1998-11-03  John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c (handle_dumper_result): do not abort a dumper
	that reports NO-ROOM if taper is busy since some holding disk space
	will eventually be released (this code it not used when PORT-DUMP is
	in progress).

1998-11-03  John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c (write_buffer): calling lseek after every tape
	write is wasteful and makes utilities like lsof less useful.  Only
	reset the offset when the amount written is about to go over 2 GBytes.

1998-11-02  John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c (main, start_degraded_mode): fix rounding problem
	that made the code think there was a little room for full dumps in
	degraded mode, and fix the code that decides whether to do a full dump
	in degraded mode.

1998-11-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: initialize variable to remove warning.

1998-11-02  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/Makefile.am (CLIENT_SCRIPTS): rename to
 	CLIENT_SCRIPTS_OPT, because *_SCRIPTS is interpreted by automake
	* configure.in (CLIENT_SCRIPTS): ditto
	Reported by Thomas Hepper <Thomas.Hepper@icem.de>

	* configure.in (LIBTOOL_M4): no longer defined
	(LIBTOOL_M4_MACRO_DIR): defined assuming CWD is top_srcdir
	* Makefile.am (ACLOCAL_M4_FROM_SRCDIR): relative to srcdir
	(ACLOCAL_M4): defined and created using ACLOCAL_M4_FROM_SRCDIR
	Reported by Thomas Hepper <Thomas.Hepper@icem.de>
	
	* client-src/sendbackup.c (backup_program): rename to
	gnutar_program, that's the name it should have had from the
	beginning
	* client-src/sendbackup-gnutar.c (backup_program): ditto

1998-10-31  Michael Schmitz <mschmitz@iname.com>

	* configure.in: let configure check whether strcasecmp is
 	present
	* common-src/strcasecmp.c: new file which contains a definition
	of strcasecmp
	* common-src/amanda.h: added code to declare strcasecmp in
 	case it's not declared in a standard header

1998-10-31  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (snprintf): arrange that it is included in the
	distribution automatically
	* common-src/Makefile.am (EXTRA_DIST): removed, not needed

	* changer-src/Makefile.am (libexec_SCRIPTS): would only be enabled
	if WANT_CHG_SCSI

	* configure.in (NO_SCSI_CHANGER_MODE): chg-scsi does not support the
 	new FreeBSD 3.0 chio.h, so disable it if camlib.h is found.
	* docs/SYSTEM.NOTES (FreeBSD 3.0): add a note about this
	(SunOS 4.x): libtool will no longer find incorrect library versions

1998-10-30  John R. Jackson  <jrj@purdue.edu>

	* common-src/security.c (bsd_security_ok): change error message to
	reflect that it is a host name we were looking up rather than an
	address (also makes the two similar messages unique).

1998-10-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: Debian 2's dump uses /var/lib/dumpdates 

1998-10-28  John R. Jackson  <jrj@purdue.edu>

	* recover-src/set_commands.c (set_host): if the host given by the user
	does not work, try the canonical name and aliases returned by
	gethostbyname.

1998-10-28  John R. Jackson  <jrj@purdue.edu>

	* configure.in: use "df /" instead of just "df" when trying to find
	the device that has the root file system to avoid things like NFS
	hangs that df sometimes suffers from.

1998-10-27  Mike Grupenhoff <kashmir@munge.com>

	* common-src/stream.c (stream-client): add a 'localport' argument
	in which we can get the port this stream is bound to locally
	* common-src/stream.h (stream-client): update prototype
	* server-src/dumper.c: update stream-client calls

1998-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/amandad.c (main): better logging of received packet,
	do not send a P_ACK when the received packet is not a P_REQ.

1998-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/amandad.c (main): terminate immediately if started
	by a P_ACK packet without sending a P_NAK packet.

1998-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.h (dtimeout): new keyword 
	* server-src/conffile.c (dtimeout): ditto
	* server-src/dumper.c: use dtimeout instead of READ_TIMEOUT
	* example/amanda.conf.in: document it
	* man/amanda.8.in: ditto
	* NEWS: ditto

1998-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (sendbackup_response): a nak error will
	be a TRY-AGAIN instead of a FAILED.

1998-10-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: move declaration of vtbl_no, datestr
	and slotcommand to the main function.

1998-10-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: remove declaration of pname.

1998-10-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheckdb.sh.in: modify to match new tapelist file
	format (keyword reuse and no-reuse). Probably no-one use this
	program.

1998-10-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (handle_dumper_result): Add sleep time
	when a dumper failed, it could be a temporary network problem,
	such as NIS or NFS, better wait a few seconds before retrying.

1998-10-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: remove declaration of argc et argv.
	* server-src/driverio.h (getresult): add parameters result_argc, 
	result_argv and max_arg.
	* server-src/driverio.c (getresult): use new parameters.
	* server-src/amflush.c (flush_holdingdisk, run_dumps): declare
	and use result_argc and result_argv instead of global variables
	argc and argv.
	* server-src/driver.c (main, handle_taper_result, 
	handle_dumper_result, dump_to_tape): ditto

1998-10-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: do not be quite so accurate in matching
	the log file lines since messages may be intermixed.  Turn on perl
	-w switch and make first cut at cleaning up warnings.

1998-10-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: remove datestamp declaration.
	* server-src/amcheck.c: remove 'extern' to datestamp declaration.
	* server-src/amflush.c: declare datestamp.
	* server-src/amtape.c: remove 'extern' to datestamp declaration.
	* server-src/driver.c: declare datestamp.
	* server-src/dumper.c: remove 'extern' to datestamp declaration.
	* server-src/reporter.c: remove 'extern' to datestamp declaration.

1998-10-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: remove declaration of tok.
	* server-src/amflush.c (flush_holdingdisk,run_dumps): declare
	tok locally.
	* server-src/driver.c (main, handle_taper_result, handle_dumper_result,
	dump_to_tape): declare tok locally.

1998-10-23  John R. Jackson  <jrj@purdue.edu>

	* configure.in: disable the -E and -h dump estimate checks if $DUMP
	is not executable.

1998-10-19  John R. Jackson  <jrj@purdue.edu>

	* server-src/amindexd.c (is_config_valid): fix core dump by moving
	amfree of conf_dir later in case it is needed in an error message.

1998-10-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: remove declaration of curlinenum,
	curlog, curprog and curstr.

1998-10-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c (main): move declaration of diskqp from
	global to local.

1998-10-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c (main): move declaration of mailout and 
	tempfname from global to local.

1998-10-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (search_logfile): remove declaration

1998-10-15  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amadmin.c (reuse, no-reuse): don't core dump if tape
	label not found

1998-10-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.h: remove declaration of holdingdisks and 
	num_holdingdisks, declare getconf_holdingdisks().
	* server-src/conffile.c: define getconf_holdingdisks(),
	* server-src/holding.c: use getconf_holdingdisks
	* server-src/find.c: ditto
	* server-src/amcheck.c: ditto
	* server-src/amflush.c: ditto
	* server-src/driver.c ditto

1998-10-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c: remove verbose and force_parameters
	variables.

1998-10-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c: remove declaration of pid.
	* server-src/dumper.c(do_dump): move declaration of runtime, 
	dumptime, compresspid, indexpid and killerr from global to local.

1998-10-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c: remove declaration of total_waiting and
	result_socket.
	* server-src/planner.c(main): move declaration of initial_size from
	global to local.

1998-10-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h,server-src/driver.c: move declaration
	of big_dumpers, degraded_mode and reserved_space from 
	driverio.h to driver.c

1998-10-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h (optionstr): remove declaration

1998-10-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in (SAMBA_CLIENT): fix typo

1998-10-14  John R. Jackson  <jrj@purdue.edu>

	* restore-src/amrestore.c (read_file_header): make a couple of error
	messages clearer that they refer to problems with a header rather
	than the image data.

1998-10-13  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/Makefile.am (libamclient_a_SOURCES): missing since
	clean-up; re-added

1998-10-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/INTERNALS (driver and dumper): document <dumpdate> in 
	FILE-DUMP and PORT-DUMP request, document <chunksize> in 
	FILE-DUMP request.

1998-10-12  John R. Jackson  <jrj@purdue.edu>

	* server-src/amtape.c (usage, main, show_device): apply patch from
	Chris Jones <cjones@clydesdale.math.montana.edu> to support "device"
	as an option to return the drive device name as reported by the
	changer.
	* man/amtape.8: document the new "device" option.
	* server-src/amverify.sh.in: use the new amtape "device" option to
	better handle tape changers.  Overhaul for general cleanup and some
	security issues, plus amverify now tries to support non-tar images.
	* man/amverify.8.in: document non-tar image issues.

1998-10-08  John R. Jackson  <jrj@purdue.edu>

	* example/amanda.conf.in: fix runspercycle example and comments

1998-10-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (SAMBA_CLIENT): try to find it by default; minimal
 	checking
	* client-src/Makefile.am (WANT_SAMBA): use automake conditionals to
 	enable findpass.o
	* docs/SAMBA: document that --with-smbclient is no longer required
	to enable SAMBA support
	
	* docs/FAQ: about inconsistencies in active filesystems

1998-10-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/DUMPER-API: add `no-record' option to the `backup' command.

1998-10-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/DUMPER-API: subdivise section 3.1.

1998-10-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/DUMPER-API: New `index-<mode>' options.
	define `support parse-estimate' and `support parse-backup' subcommand.
	New 'estimate-direct', `estimate-parse', `backup-direct' and
	`backup-parse' options.
	Remove PARSE keyword from estimate and backup command.

1998-10-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/DUMPER-API: define PARSE keyword in stderr of the backup
	command

1998-10-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/Makefile.am (EXTRA_DIST): make sure the man-pages that are not 
	generated by autoconf get into the distribution

1998-10-02  Josef Karthauser  <joe@pavilion.net>

	* changer-src/chg-chio.pl.in (getTapeParams): fix regular expression 
	for $line; the trailing `s' of slots was missing

1998-10-02  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: fix error message.

1998-10-02  John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c (write_file): fix a problem with tha taper
	stats where the times were all the same.  The wallclock_str function
	returns a pointer to a static area so it cannot be called more
	than once as an argument to a function.

1998-10-01  John R. Jackson  <jrj@purdue.edu>

	* common-src/protocol.c (parse_integer): allow negative numbers.

1998-10-01  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: add timestamps.

1998-10-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/DUMPER-API: define `support index', to be used instead of the
 	previous `index-*' sub-commands

1998-09-30  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/Makefile.am (libexec_PROGRAMS, sbin_SCRIPTS): don't use 
	backslashes for continuation; this seems to break automake :-(

1998-09-30  John R. Jackson  <jrj@purdue.edu>

	* man/amanda.8.in: minor typo in "reserve" description.

1998-09-29  John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c (end_tape): do not rewind the tape when done.

1998-09-29  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (WANT_CLIENT, WANT_RESTORE, WANT_SERVER, 
	WANT_RECOVER, WANT_TAPE, WANT_AMPLOT, WANT_CHG_SCSI): automake
	conditionals
	* amplot/Makefile.am: use them
	* changer-src/Makefile.am: ditto
	* client-src/Makefile.am: ditto
	* common-src/Makefile.am: ditto
	* man/Makefile.am: ditto
	* recover-src/Makefile.am: ditto
	* restore-src/Makefile.am: ditto
	* server-src/Makefile.am: ditto
	* tape-src/Makefile.am: ditto

	* Makefile.am: don't print commands that work around old aclocal bug

	* docs/DUMPER-API: remove environment variables, and mention a
	program that will help translating disklist entries to device names, 
	mount points and filesystem types

	* recover-src/extract_list.c (extract_files_child): do not crash
	after failing to read the dump file header
	Reported by Jose Cheng <jcheng@math.ist.utl.pt>

1998-09-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/taper.c (taperscan_slot): initialize scan_datestamp, to
 	avoid amfree of uninitialized pointer
	Reported by Lance A. Brown <brown9@niehs.nih.gov>

1998-09-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/DUMPER-API (USER, GROUP): detailed security mechanisms
	(estimate, estimate-parse): can print `KILL' after the estimate
	
	* docs/DUMPER-API: various suggestions from Eric Siegerman
 	<erics@now.com> and some explanations added
	
1998-09-27  Andy Farkas  <andyf@speednet.com.au>

	* man/amlabel.8.in (labelstr): fix typo

1998-09-26  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* recover-src/extract_list.c (extract_files_child): fix-up
 	no_initial_params if password or domain information is not found
	Reported by Jose Cheng <jcheng@math.ist.utl.pt>

	* docs/DUMPER-API: extended `index' to `index-from-output' or
 	`index-from-image', as suggested by Dale Hagglund <rdh@best.com>.
  	Explained that the dumptype option `program' is the name of the
 	wrapper program

1998-09-25  John R. Jackson  <jrj@purdue.edu>

	* configure.in: fix --with-dump-honor-nodump test.  Patch by
	Jonas Oberg <jonas@coyote.org>.

1998-09-24  John R. Jackson  <jrj@purdue.edu>

	* example/disklist: document the "spindle" and "interface" fields.
	Reported by Brendan M Coffey <bcoffey@connix.com>.

1998-09-24  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/DUMPER-API: added draft description of the DUMPER API
	* Makefile.am (EXTRA_DIST): add it to the distribution

	* config/acinclude.m4 (AC_VALIDATE_CACHE_SYSTEM_TYPE): make sure
 	cached values for host, build and target system types match with the
 	guessed ones
	* configure.in: use it

1998-09-23  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: sort the host and partition names.
	From David Wolfskill <dhw@whistle.com>.

1998-09-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/taper.c (getcmd): typo in last DEBUGging patch

1998-09-22  Tim Perkins  <Tim.Perkins@ddg.phar.cam.ac.uk>,  Alexandre Oliva <oliva@dcc.unicamp.br>

	* client-src/selfcheck.c (check_disk): fix VDUMP auto-detection

1998-09-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/chg-mtx.sh.in: replace rew with rewind
	* changer-src/chg-zd-mtx.sh.in: ditto
	Reported by Henning Holtschneider <hh@loca.net>

	* client-src/sendsize.c: remove usage of #error
	Reported by Jay Orr <orr@vss.fsi.com>

1998-09-21  John R. Jackson  <jrj@purdue.edu>

	* man/amanda.8.in: document the new "tapebufs" parameter.

1998-09-21  Kelly Setzer  <setzer@telalink.net>

	* server-src/taper.c (NBUFS): replaced with conf_tapebufs
	(THRESHOLD): now means `empty bufs' instead of `full bufs'
	* server-src/conffile.c: add support for the "tapebufs" option
	* server-src/planner.c: ditto
	* examples/amanda.conf.in: add sample "tapebufs" entry

	* server-src/amlabel.c (main): adds entry to tapelist with date
 	19700101

1998-09-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/taper.c (getcmd): print DEBUGging output to stderr
	Reported by Henning Holtschneider <hh@loca.net>

1998-09-19  Eric Doutreleau <Eric.doutreleau@int-evry.fr>

	* server-src/driverio.h (MAX_DUMPERS): increased from 15 to 63 in
	order to launch more dumper in parallel
	* example/amanda.conf.in (inparallel): Add the fact that it is
 	limited by MAX_DUMPERS

1998-09-18  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/Makefile.am (libamanda_la_LDFLAGS): use libtool
 	-release instead of -version_info, so as to encode the Amanda
 	release number in the library name.  Problems related with
 	pre-installed libraries should disappear, and separate releases can
 	now be installed into the same directory without the risk of one
 	using libraries from the other.

1998-09-18  Michael C. Povel  <Michael.Povel@hub.de>

	* changer-src/chg-scsi.c (wait_ready): new function; keeps retrying
	until success or timeout
	(ask_clean, main): use it

1998-09-18  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/selfcheck.c (check_options): don't require runtar for
 	SAMBA backups
	
	* client-src/rundump.c: fix support for VDUMP-only installation
	* client-src/selfcheck.c (check_options): fix detection of advfs
	* client-src/sendsize.c (getsize_dump): ditto
	* client-src/sendbackup-dump.c (start_backup): ditto
	Reported by Tim Perkins <Tim.Perkins@ddg.phar.cam.ac.uk>

1998-09-16  John R. Jackson  <jrj@purdue.edu>

	* man/amadmin.8.in: document that "hostname" is optional for "info".
	Reported by David Wolfskill <dhw@whistle.com>.

1998-09-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: common compile-time and link-time errors

1998-09-11  John R. Jackson  <jrj@purdue.edu>

	* server-src/tapefile.c (lookup_last_reusable_tape): use new
	calling sequence that passes how old a tape to return.  Remove
	lookup_previous_reusable_tape().
	* server-src/tapefile.h (lookup_last_reusable_tape): use new
	calling sequence that passes how old a tape to return.  Remove
	lookup_previous_reusable_tape().
	* server-src/amadmin.c (tape): use new lookup_last_reusable_tape
	calling sequence.
	* server-src/amcheck.c (taper_scan, start_server_check): use new
	lookup_last_reusable_tape calling sequence.
	* server-src/amflush.c (confirm): use new lookup_last_reusable_tape
	calling sequence.
	* server-src/amtape.c (taper_scan): use new lookup_last_reusable_tape
	calling sequence.
	* server-src/reporter.c (output_tapeinfo): use new
	lookup_last_reusable_tape calling sequence.
	* server-src/taper.c (taper_scan): use new lookup_last_reusable_tape
	calling sequence.

1998-09-11  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendbackup-gnutar.c (re_table): ignore
	`load_client_codepage' message from SAMBA

1998-09-11  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in (all): fix USE_VERSION_SUFFIXES=yes
	problems.  Reported by David Eckelkamp <davide@locutus.tradewave.com>.

	* man/amstatus.8.in (all): fix minor typos.

1998-09-10  John R. Jackson  <jrj@purdue.edu>

	* configure.in (LFS): add code that might support configuring large
	files on HP-UX.

1998-09-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/conffile.c (dump_configuration): runspercycle is not a
 	member of dumptype_t
	(init_holdingdisk_defaults): init chunksize with documented default,
 	not -1, because it wouldn't be recalculated

	* docs/INSTALL: URL for SAMBA was broken; note about 1.9.18p10 bug

1998-09-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/SAMBA: 1.9.18p10 has a bug

1998-09-09  Terje Malmedal  <tm@funcom.com>

	* common-src/stream.c (stream_server, stream_client): added
 	SO_KEEPALIVE option so we get an error if the other side crashes

1998-09-09  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (CHIO): look for chio and AC_SUBST it
	(MT, CHS): if not found, use just the program name
	
1998-09-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (last_level): return the last level
	even it is still on holding disk if reserve < 100.

1998-09-09  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/reporter.c (divzero, divzero_wide): print `#'s on
 	overflow

	* server-src/amtape.c (show_init): no longer print `scanning'
 	message
	(show_init_show, current_init_all): call show_init, then print the
 	appropriate `scanning' message
	Reported by David Wolfskill <dhw@whistle.com>

	* changer-src/chg-scsi.c (main): use new multi-configuration
	mechanism only if tape_device contains only a single digit

1998-09-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (setup_estimate): Don't write a
	"mismatch: no tapelist record, but curinfo next_level0" message
	and force a level 0 when reserve < 100.

1998-09-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h (get_amanda_names): return a filetype_t
	instead of an int.
	* server-src/holding.c (get_amanda_names): return the filetype_t
	of the file or F_UNKNOWN if it's not an amanda file.
	* server-src/find.c (search_holding_disk): Use the new return 
	type of get_amanda_names.
	* server-src/amflush.c (flush_holdingdisk): Don't write a
	"ignoring cruft file" message for chunk files,
	filetype is F_CONT_DUMPFILE.

1998-09-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (extract_files_child): don't write
	the samba password to the debug file.

1998-09-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.c (update_info_dumper): set inf.command to
	NO_COMMAND if reserve< 100 because if you force a level 0 with
	'amadmin force', it will do level 0 every days until you flush them
	to tape.

1998-09-03  Matthias Urlichs    <smurf@noris.net>

	* recover-src/uscan.l: recognize "?" as alias for "help"

	* configure.in (MAILER): recognize "mail" as well as "Mail" and
 	"mailx"

	* client-src/calcsize.c (add_file_dump, add_file_unknown): only get
 	sizes of directories and files

	* client-src/amandates.c (start_amandates): create amandates if
 	error is either EINTR or ENOENT

	* common-src/dgram.c (dgram_send_addr): handle ECONNREFUSED by not
 	dying when receiving, and retrying when sending, a packet.  The
 	server may get this error when a client reboots and hasn't started
 	inetd yet.
	* common-src/protocol.c (handle_incoming_packet): ditto

	* server-src/driver.c (read_schedule): catch cases when the time
 	goes negative.  Some operators have the bad habit of syncing clocks
 	late at night. ;-)

	* common-src/dgram.h (MAX_DGRAM): increased to 64Kb
	* NEWS: ditto
	* client-src/amandad.c (main): read the pipe from the child
 	incrementally: the pipe buffer of many OSes is shorter than
 	MAX_DGRAM.  Instead of SIGCHLD, note end-of-data by way of
 	end-of-file
	(sigchild_jump, sigchild_flag): removed
	* client-src/sendbackup.c (main): instead of fork-and-exit, tell
 	amandad to process our data by closing our end of the pipe
	
1998-09-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* NEWS: another typo (too late :-(

1998-09-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c: amanda will not use an holding disk
	if the directory with the datestamp already exist.

1998-09-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Amanda 2.4.1 released
	
1998-08-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* NEWS: typo

1998-08-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/INSTALL: update some version numbers; SAMBA 1.9.18p10 has
	fixed the bug in p8; using p8 is not recommended any more
	* docs/SAMBA: ditto

	* config/config.guess: updated to libtool 1.2b's, in order to
	auto-detect some recent architectures
	* config/config.sub: ditto

	* server-src/amcleanup.sh.in (sbindir): amreport now lives in
 	sbindir; added it to PATH and removed full pathnames to binaries

1998-08-27  Blair Zajac  <blair@gps.caltech.edu>

	* configure.in: Add the directory /usr/lib/fs/vxfs to the search
	path where configure looks for vxdump and vxrestore.  This is for
	Solaris so it can automatically handle vxfs filesystems.
	* client-src/sendbackup-dump.c: add missing last NULL argument to
	newvstralloc().
	* server-src/dumper.c: add missing last NULL argument to
	newvstralloc().
	* NEWS: reorder 2.4.1 items into most to least important for most
	users.
	* config/acconfig.h: update comment for VXDUMP and VXRESTORE to
	include systems where the Veritas filesystem is used.

1998-08-21  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amanda.8.in (nofull): only level 1 incrementals

1998-08-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/chg-mtx.sh.in (PATH): added /usr/local/bin

	* configure.in (BUILD_CHANGER_SCRIPTS_LIBEXEC): added chg-zd-mtx
	(AC_OUTPUT): ditto
	* changer-src/Makefile.am (EXTRA_SCRIPTS): ditto
	* docs/TAPE.CHANGERS (chg-zd-mtx): documented it
	(chg-mtx): mentioned chg-zd-mtx

1998-08-20  Eric Doutreleau  <Eric.Doutreleau@int-evry.fr>

	* changer-src/chg-zd-mtx.sh.in: new changer script for
	Zubkoff/Dandelion version of mtx.

1998-08-19  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SAMBA: updated; documented new patch (sambatar.diff,
 	available in the patches page) and requirements about backup user.
	* docs/INSTALL: documented new patch

1998-08-18  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (regex_s): refuse to compile if SAMBA_CLIENT
 	and HAVE_DUMP_ESTIMATE are both defined: the regexp that matches the
 	estimate from DU 4.0's dump also matches an output line from
 	smbclient, that provides an incorrect estimate.
	* docs/SYSTEM.NOTES: document the problem

1998-08-14  John R. Jackson  <jrj@purdue.edu>

	* docs/TAPE.CHANGERS: describe "advance" and clean up some spelling.

1998-08-13  Alexandre Oliva  <oliva@dcc.unicamp.br>, Marcel Hild  <hild@id-pro.de>

	* configure.in (--with-portrange): validate and define PORTRANGE
	* example/config.site: document it
	* config/acconfig.h (PORTRANGE): prepare for configure define
	* common-src/stream.c (stream_server): use PORTRANGE to limit TCP
	unreserved server sockets

1998-08-12  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: working around `dumps way too big'

1998-08-11  Alexandre Oliva  <oliva@dcc.unicamp.br>, Gunnar Gunnarsson  <gunnar@ki.ericsson.se>

	* common-src/token.h (rxquote, shquote): new functions
	* common-src/token.c (rxquote) quotes a string into an equivalent
 	regular expression
	(shquote): quotes all shell special meta-characters, so that a
 	string can be safely passed down for shell interpretation in
	system() or popen()-like calls
	* server-src/amindexd.c (build_disk_table): quote the disk_name with 
	both rxquote and shquote

1998-08-11  John R. Jackson  <jrj@purdue.edu>

	* changer-src/chg-manual.sh.in: put the debug file in DEBUG_DIR for
	security.  Clean up and enhance logging.  Fix locations of the
	changer files.	Source the changerfile into the script so it can
	override the request() function and allow alternatives to /dev/tty
	(e.g. E-mail, syslog).	Issue rewind before status (Solaris does
	not give a good status report right after a tape is loaded).

1998-08-10  Nick Hibma  <nick.hibma@jrc.it>

	* changer-src/chg-chio.pl.in: move to first slot if last is unused

1998-08-07  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* example/Makefile.am (EXTRA_DIST): add DIN-A4.ps

1998-08-07  Gnter Felkel  <G.Felkel@edelmann.de>

	* example/DIN-A4.ps: new file

1998-08-06  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* tape-src/tapetype.c (initrandombytes): use random() instead of
	rand(), its low-order bits are more random
	(main): call srandom(seed) instead of srand(seed)
	(USE_RAND): if defined, reverts to using rand() and srand(seed)

	* docs/FAQ: some notes about driving real tape changers

1998-08-05  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amreport.8.in (SYNOPSIS): replace `amtoc' with `amreport'

1998-08-04  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c: revert 1998-08-01's change, it wouldn't
	even compile, as amfree() expands to a statement, not an expression, 
	so it cannot be used as the `increment' part of a for loop.

	* server-src/planner.c (main): if runs_per_cycle is set to zero or
	negative, set it to 1, in order to avoid division by zero.
	* server-src/amadmin.c (balance): ditto

1998-08-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c: replace free(line) with amfree(line),
	because line is not ensured to be non-NULL
	
	* docs/FAQ: amandad: error receiving message
	
	* docs/FAQ: difference between skip-full and strategy nofull

1998-07-31  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: software or hardware compression?

	* server-src/driver.c (adjust_diskspace): do not abort just because
	a holding disk file is missing
	(main): report warning if holding disk directory could not be
	created, and do not use it
	Reported by Albrecht Gebhardt <agebhard@zidsrv.sci.uni-klu.ac.at>

	* example/Makefile.am (EXTRA_DIST): add 8.5x11.ps to the
	distribution
	Reported by Jason L Tibbitts III <tibbs@hpc.uh.edu>

	* server-src/conffile.c (get_holdingdisk): define chunksize 0 as
	INT_MAX/1024, and chunksize -1 as -INT_MAX/1024
	* server-src/driver.c (find_diskspace): accept negative chunksizes
	as the maximum size (in modulus) for using the holding disk
	* man/amanda.8.in (chunksize): document the usage of negative
	values, and improve the explanation of chunking
	* example/amanda.conf.in: ditto

1998-07-29  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: disk offline

1998-07-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* restore-src/amidxtaped.c (main): use tape_rewind() instead of
	running `mt'

	* server-src/amcleanup.sh.in (reporter): update to call amreport.
	(amdump.<n>) update to use the same renaming technique introduced in
 	June 30's change to amdump.

1998-07-25  Michael Graff  <explorer@vix.com>

	* changer-src/Makefile.am (install-exec-hook): support $(DESTDIR)
	* client-src/Makefile.am (install-exec-hook): ditto
	* man/Makefile.am (install-data-hook): ditto
	* recover-src/Makefile.am (install-exec-hook): ditto
	* restore-src/Makefile.am (install-exec-hook): ditto
	* server-src/Makefile.am (install-exec-hook): ditto

	* configure.in: link krb5 and com_err in for Kerberos support, if
 	they exist

1998-07-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c (copy_template_file): add braces to 
	remove warning
	* tape-src/tapeio.h: declare is_zftape to remove warning in
	amlabel.c and taper.c

1998-07-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/driver.c (any_delayed_disk): new variable, to ensure
	that we do not leave the main driver loop if there are delayed disks 
	but there are no active dumpers
	(main): instead of checking whether idle_reason is IDLE_START_WAIT,
	check whether there is any_delayed_disk for remaining in the loop
	(start_degraded_mode): set any_delayed_disk when needed
	Reported by Peter Walker <peter@talarian.com>

1998-07-23  John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c (main): handle LPRCMD being undefined.

1998-07-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/selfcheck.c (check_suid): new function to check if a
	program is SUID root.
	* client-src/selfcheck.c (check_overall): check that runtar and
	rundump are SUID root.

1998-07-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: version number set to 2.4.1

	* recover-src/Makefile.am (LDADD): libamtape imports symbols from
 	libamanda, so it must be listed first

	* changer-src/Makefile.am (LDADD): remove duplication of libamserver
 	and libamanda, as they no longer provide symbols for each other
	* server-src/Makefile.am (LDADD): ditto
	
1998-07-21  Blair Zajac  <blair@gps.caltech.edu>

	* server-src/amrmtape.sh.in: now use amanda.conf's tapelist variable
	* server-src/amcheckdb.sh.in:  now use amanda.conf's tapelist variable
	* server-src/amfreetapes.sh.in: now use amanda.conf's tapelist variable
	* server-src/amtoc.pl.in: now use amanda.conf's tapelist variable,
	make perl4 compatible

1998-07-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ (results missing): suggestions to work around the UDP
	packet size limit

1998-07-16  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ (amrecover): a config name may have to be specified
	Reported by digital messiah <dmessiah@silcon.com>

1998-07-15  Blair Zajac  <blair@gps.caltech.edu>

	* server-src/reporter.c (main): declare optind

1998-07-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: created Amanda 2.4.1 branch

	* example/amanda.conf.in: strategy noinc is not implemented yet

1998-07-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* NEWS: new runspercycle keyword
	* server-src/conffile.h: new runspercycle keyword
	* server-src/conffile.c: new runspercycle keyword
	* server-src/amadmin.c (balance): new runspercycle keyword
	* server-src/planner.c (main): new runspercycle keyword
	* man/amanda.8.in: document new runspercycle keyword
	* example/amanda.conf.in: example for new runspercycle keyword

1998-07-13  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: What to do if DUMP program is not available.
	* client-src/selfcheck.c (check_overall): if a needed program is
	missing, print an error message.
	Reported by Klaus Hoffmann <handatalog@csi.com>

	* */Makefile.am: checked library version numbers, no need for update
	
	* configure.in: version number set to 2.4.1b1

1998-07-11  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: new entries: how to label tapes, (not) spanning large
 	filesystems across tapes, how to enable index generation,
 	overwriting selected tapes, cleaning up databases, selecting tape
 	changer.
	
1998-07-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/Makefile.am (EXTRA_DIST): amreport.8 is built from .8.in

	* configure.in (AC_OUTPUT): generate chg-chio.pl
	* changer-src/Makefile.am (EXTRA_DIST): removed chg-chio.c
	* changer-src/chg-chio.c: removed, as it was confusing make
	
1998-07-10  Nick Hibma  <nick.hibma@jrc.it>, Alexandre Oliva <oliva@dcc.unicamp.br>

	* changer-src/chg-chio.pl.in: new script, created to replace old
 	chg-chio written in C
	* docs/TAPE.CHANGERS (chg-chio): document it
	* changer-src/Makefile.am (EXTRA_SCRIPTS): add chg-chio
	(EXTRA_DIST): still include chg-chio.c, just in case it is useful
	* configure.in (BUILD_CHANGER_SCRIPTS_LIBEXEC): add chg-chio
	
1998-07-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/reporter.c (main): if no arguments are given, preserve
	original behavior; require config name otherwise.  Perform better
	argument checking.
	* example/DLT.ps (DrawHost): discard additional argument introduced
	in Steven Freed's modification
	* example/EXB-8500.ps (DrawHost): ditto
	* example/HP-DAT.ps (DrawHost): ditto

	* server-src/Makefile.am (amreport_SOURCES): build from reporter.c
	(driver_SOURCES) removed, no longer needed
	* man/Makefile.am (EXTRA_DIST): added amreport.8

1998-07-08  Steven Freed  <sfreed@gilasoft.com>

	* server-src/reporter.c (usage): new function
	(main): accept command-line arguments for selecting config name,
	output file, log file name to read from, postscript file to write
	to.
	(output_summary): print tape labels list, tape section numbers and
	dump sizes.
	* server-src/amdump.sh.in: run amreport
	* server-src/amflush.c (main): ditto
	(run_dumps): ditto
	* configure.in (BUILD_SERVER_PROGS_SBIN): add amreport
	(BUILD_SERVER_PROGS_LIBEXEC): remove reporter
	* man/amreport.8.in: new file
	* man/Makefile.am (man_MANS): added amreport.8
	* example/8.5x11.ps: new file

1998-07-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Makefile.am (ACLOCAL_M4): fix ||/&& precedence problem

1998-07-07  John R. Jackson  <jrj@purdue.edu>

	* changer-src/scsi-chio.c: move #include's so this will compile on
	systems without <sys/mtio.h> (e.g. AIX).

1998-07-06  John R. Jackson  <jrj@purdue.edu>

	* client-src/sendsize.c (handle_dumpline): allow the dump block
	count estimate to be negative.  Found by Lance A. Brown
	<brown9@niehs.nih.gov> on NeXT.

	* common-src/Makefile.am, common-src/security.c: add TEST code to
	security.c so people can do "make security" and have a test program
	to track down why they are getting "access as XXX not allowed from
	YYY@ZZZ".

	* common-src/security.c (bsd_security_ok): allow the remote user
	field in .amandahosts to be empty ala .rhosts.

1998-07-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c (start_server_check): report space use for
	holding disk if a negative value is given in the use parameter.

	* server-src/driver.c (main): compute holding disk space if 
	a negative value is given in the use parameter..

	* man/amanda.8.in (use) : document negative use paramater for 
	holding disk.

	* example/amanda.conf.in (use): document negative use paramater for
	holding disk..

1998-07-04  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amanda.8.in (reserve): document it
	* example/amanda.conf.in (reserve, gigabytes): ditto
	(etimeout) negative number stands for total estimate time

	* NEWS: documented major changes since amanda 2.3.0.4

	* docs/INSTALL: refer to patch-system for editing services and
 	inetd.conf

	* docs/FAQ: added entries for common amdump and amcheck errors

	* COPYRIGHT: updated to 1998, refer to Amanda Development Team
	* AUTHORS: who is the Amanda Development Team

1998-07-03  John R. Jackson  <jrj@purdue.edu>

	* docs/SYSTEM.NOTES: add comment about using the variable device name
	on IRIX.  Otherwise, IRIX will write 4KByte physical blocks, which
	it appears to read OK, but not if you take the tape to some other
	system that does what you tell it.  Discovered by Steve E. Khoo
	(steve@gordian.com).

1998-07-02  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/planner.c (setup_estimate): handle new disks with
	skip-full correctly.

	* Makefile.am (aclocal.m4): must depend on libtool.m4, so as to
 	force it to be newer on distributions.

1998-07-01  John R. Jackson  <jrj@purdue.edu>

	* server-src/driverio.h: change reserved_space to unsigned long to
	match free_space() and avoid a compiler warning.

1998-06-30  John R. Jackson  <jrj@purdue.edu>

	* man/amanda.8.in: fix amrecover synopsis and add a short description.
	Noted by Brendan M Coffey <bcoffey@connix.com>.

	* example/amanda.conf.in: make tapecycle example fit dumpcycle value
	better.  Noted by Tom.Croll@radisys.com and suggested comments from
	Alexandre Oliva <oliva@dcc.unicamp.br>.

1998-06-30  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amdump.sh.in (maxdays): set up with tapecycle+2
	(days): loops from 1 to $maxdays, but stops if amdump.$days does not 
 	exist, so that we only rename amdump log files that exist.  This
 	prevents too long loops in case of an infinite tapecycle.
	Reported by Nick Hibma <nick.hibma@jrc.it>

1998-06-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/security.c (bsd_security_ok): accept case mismatches
 	when comparing hostnames and usernames from amandahosts, and assume
 	localuser if username is missing.
	* docs/INSTALL: clarify BSD security and amandahosts, WRT to
	non-FQDNs.
	Reported by Chris Shenton <chris@absinthe.shenton.org>

	* server-src/reporter.c (output_tapeinfo): degraded mode no longer
	implies incremental dumps only.
	Reported by Randy Dees <rrd@amherst.com>

1998-06-26  John R. Jackson  <jrj@purdue.edu>

	* configure.in: fix BSD/OS Kerberos include file location.

1998-06-26  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/ltmain.sh: install official patch to libtool 1.2a

	* configure.in: do not set max file size for Solaris 2.6, it is no
	longer used.

1998-06-26  Tim McNerney  <mumbly@netcom.com>

	* common-src/fileheader.c (parse_file_header): accept missing
	PROGRAM in tape section header, for backward compatibility.

1998-06-25  Blair Zajac  <blair@gps.caltech.edu>

	* server-src/amflush.c: fix mismatch arguments to error()

1998-06-24  Steven Freed  <sfreed@gilasoft.com>

	* configure.in (dump-honor-nodump): fix test for `-h' support

1998-06-24  Scott Mesches  <mesches@allison.Colorado.EDU>

	* example/DLT.ps: new file
	* example/Makefile.am (EXTRA_DIST): add DLT.ps

1998-06-24  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Makefile.am (EXTRA_DIST): moved CHANGES into ChangeLog

	* recover-src/extract_list.c (extract_files_child): handle
	IS_UNKNOWN dumptype as IS_DUMP

	* client-src/sendsize.c (getsize_dump): always create pipe for
 	killpgrp.

	* client-src/amandad.c (sendnak): report `UNKNOWN' error if str is
	NULL.

	* amplot/amplot.awk: ignore `interface-state'
	Reported by Peter Walker <peter.walker@talarian.com>

1998-06-24 Alexandre Oliva <oliva@dcc.unicamp.br>

	* server-src/amrmtape.sh.in: enable verbose by default; implement -q 
 	for quiet.
	* man/amrmtape.8.in: ditto
	Suggested by Nick Hibma  <nick.hibma@jrc.it>
	
1998-06-24  Nick Hibma  <nick.hibma@jrc.it>

	* server-src/amrmtape.sh.in: better error reporting for incorrect
	database entries

1998-06-24  Dan Swartzendruber <dswartz@druber.com>
	
	* server-src/conffile.h (RESERVE): new keyword.
	* server-src/conffile.c (RESERVE): ditto.
	(getconf_seen): recognize "reserve" keyword.
	(getconf_int): return value of "reserve" keyword.
	(read_confline): parse "reserve" line.
	* server-src/driverio.h (reserved_space): new global
	* server-src/driver.c (main): compute holding disk space to reserve
 	for degraded dumps.
	(start_degraded_mode): if we haven't hit degraded mode reservation
 	limit, allow full dump.
	
1998-06-18  Blair Zajac <blair@gps.caltech.edu>

	* config/ltconfig: update to 1.2a
	* config/ltmain.sh: update to 1.2a
	* config/libtool/libtool.m4: update to 1.2a

1998-06-17  John R. Jackson  <jrj@purdue.edu>

	* server-src/dumper.c (write_tapeheader): comment out some variables
	to get rid of a compiler warning.

1998-06-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (bumpsize): write wrong equation for bump
	threshold.

1998-06-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in: add info about the chunksize parameter
	of the holdingdisk.
	* man/amanda.8.in: add info about amstatus command

1998-06-13  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/Makefile.am (libamanda_version): updated
	* tape-src/Makefile.am (libtape_version): updated
	* client-src/Makefile.am (libclient_version): updated
	* server-src/Makefile.am (libserver_version): updated

	* server-src/taper.c (read_file): if switching to the next file
 	fails or there's no next file, do not send a `W' to taper writer.

	* server-src/changer.h (changer_clean): new function
	* server-src/changer.c (changer_clean): ditto

1998-06-13  Michael C. Povel  <mcp@ladyada.han.de>

	* changer-src/chg-scsi.c: added ejetct_tape and sleep for external
	tape devices, and changed some code to allow multiple drives to use
	their own slots. Also added support for reserverd slots.
	* changer-src/libscsi.h (get_clean_state, eject_tape): new functions 
	* changer-src/scsi-chio.c (get_clean_state, eject_tape): implemented 
	using Linux ioctls
	* changer-src/scsi-hpux.c (get_clean_state, eject_tape): do nothing, 
	until someone implements them
	* changer-src/scsi-proto.c (get_clean_state, eject_tape): new
	functions
	* docs/TAPE.CHANGERS: document new configuration file format
	* example/chg-scsi.conf: sample configuration file
	* example/Makefile.am: add chg-scsi.conf to the distribution
	* server-src/amtape.c: add support for `clean' command

1998-06-13  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: clean-up

	* docs/FAQ: new file
	* docs/SUNOS4.BUG: removed
	* Makefile.am: remove docs/SUNOS4.BUG and add docs/FAQ
	
	* example/amanda.conf.in (bumpmult): fixed equation for threshold
	* man/amanda.8.in (bumpsize): fix threshold example.
	problem reported by Brian McEntire <brianm@fsg1.nws.noaa.gov>

	* server-src/logfile.c (open_log): open log file with mode 0600.

	* server-src/amdump.sh.in: refuse to run if either amdump or log
	exist in logdir.
	* server-src/amflush.c (main): refuse to run if log exists.
	* server-src/amcheck.c (start_server_check): do not perform tape
 	testing if amdump and/or log exist in logdir.

1998-06-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amrestore.c (restore): fixed -p flag (and amrecover)
	should not dup2( A, B ); aclose(A) when A == B

1998-06-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (getsize_dump): use killpgrp
	unconditionally, so we're not bitten by setuid dump programs.
	* client-src/killpgrp.c: enable unconditionally.

	* tape-src/tapetype.c: new program: calculates tapetype parameters.
	* tape-src/Makefile.am (EXTRA_PROGRAMS): added tapetype.
	* example/amanda.conf.in: point to tapetype program.

1998-06-09  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SAMBA: added notes about (not) backing up registry files and
	ACLs with SAMBA.
	* docs/INSTALL: point to docs/SAMBA for usage and limitations

1998-06-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (amanda_cv_print_command): removed; using PRINT
 	instead.

1998-06-07  Todd Kover <kovert@omniscient.com>

	* add --with-owner option to allow installed binaries to be owned
	by someone other than the amanda user

	* add GB as valid holding disk size.

1998-06-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (info): don't need to specify an host.

	* server-src/amadmin.c (due): new due command to write when a
	filesystem is due ffor next level 0 or how much days it is
	overdue.

	* server-src/amstatus.pl.in (dump_size): new function to report
	the size of a dump split on multiple files.

1998-06-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (read_buffer): write a message
	when amrecover timeout waiting for amrestore to send the dump.

1998-06-04  John R. Jackson  <jrj@purdue.edu>

	* client-src/getfsent.c (main): use a dynamically allocated string
	for the lookups since dev2rdev alters it on the fly and some systems
	drop core for trying to write into read only memory.  Also add the
	capability of passing additional lookups on the command line.

	* common-src/Makefile.am, common-src/file.c (main),
	common-src/token.c (main), server-src/conffile.c (dump_configuration,
	main), server-src/diskfile.c (main), server-src/infofile.c (main):
	Clean up compiler warnings in the test programs and make them all
	work again.

1998-06-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* amplot/amplot.sh.in: modified command line argument parsing
 	mechanism, so as to prevent shell quoting problems and unportable
 	constructs.
	Reported by Chris Jones <cjones@clydesdale.math.montana.edu>

1998-06-02  John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c (main), server-src/reporter.c (main): make
	sure internal errors, such as the mail command failing, get
	reported.  In the case of amcheck, they go to stderr even if -m is
	set since there didn't seem to be anyplace better to do so and if
	this is running from a cron job it might get back to a real user.
	For reporter, the errors go to .../amdump along with everything
	else from the amdump script, and they should also go to .../log,
	except since it's reporter that's having the trouble, they probably
	will not make it into the mail report.

1998-06-01  John R. Jackson  <jrj@purdue.edu>

	* client-src/killpgrp.c: clean up minor compiler warnings by not
	building term_kill_{soft,hard} unless they are needed.

	* server-src/driverio.c (dumper_cmd): clean up compiler warning
	in printf format by forcing argument to always be long and using %ld.

	* server-src/driver.c: include <holding.h> to get declaration for
	unlink_holding_files and avoid a compiler warning.

	* common-src/amanda.h, common-src/match.c (validate_glob, match_glob,
	glob_to_regex), recover-src/amrecover.h, recover-src/extract_list.c
	(add_glob, add_regex, add_file, delete_glob, delete_regex,
	delete_file), recover-src/help.c (help_list), recover-src/uparse.y,
	recover-src/uscan.l, man/amrecover.8.in: add shell wildcard support
	for the add/delete amrecover commands.  Add addx/deletex commands
	that use regular expressions.  Support more characters in path names.

1998-06-01  Dan Swartzendruber  <dswartz@druber.com> via John R. Jackson

	* server-src/amlabel.c (main): check argc before referencing too
	far into argv for "-f".

1998-06-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: advise Linux users to use dump without
 	setuid/setgid

	* docs/INDEXING: update dumptype syntax

1998-05-29  John R. Jackson  <jrj@purdue.edu>

	* server-src/amindexd.c (uncompress_file, process_ls_dump,
	build_disk_table, is_dir_valid_opaque, opaque_ls): fix file
	descriptor leak, log the amadmin find command, fix error reporting
	from routines that do not generate system errors.
	* common-src/amanda.h: make sure errno is saved through amfree().

1998-05-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: GNU tar must be patched on HP/UX.
	* patches/tar-1.12.patch: ditto.

	* server-src/taper.c (endtape): do not log amount of used tape after 
	entering degraded mode.

	* client-src/sendsize.c (getsize_dump): pass at least argv[0] to
 	killpgrp.

1998-05-28  Paul R. Johnson  <prj@mit.edu>

	* client-src/sendbackup.c (check_status): when checking whether
	return status 1 is valid for dump, make sure it was *not* tar that
	was running.

1998-05-28  Tom Lear <toml@accesscom.com>, John R. Jackson  <jrj@purdue.edu>

	* man/amcheck.8.in: document new -Maddress command line flag.
	* server-src/amcheck.c (usage, main): add -Maddress command line
	flag to send mail to a specific address instead of mailto from
	amanda.conf.

1998-05-27  John R. Jackson  <jrj@purdue.edu>

	* man/amrestore.8: update for host/disk/date triplets.
	* recover-src/extract_list.c (extract_files_setup): pass datestamp
	argument in new position and without -d.
	* restore-src/amidxtaped.c (main): remove -d checks.
	* restore-src/amrestore.c (restore, usage, main): fix file descriptor
	leak, move datestamp to host/disk triplet and allow all to be repeated.

1998-05-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/killpgrp.c (main): wait for either SIGTERM or EOF on
	stdin.

	* client-src/sendsize.c (getsize_dump): close the other end of
 	killpgrp's stdin pipe before trying to kill it, because we just
 	can't kill it.

	* configure.in (HAVE_HPUX_SCSI): check whether sys/scsi.h actually
	supports HP/UX-like changer commands.

	* config/acconfig.h (HAVE_HPUX_SCSI): indicates HP/UX-like changer
	interface is supported.

	* changer-src/scsi-hpux.c: check for HAVE_HPUX_SCSI instead of
 	HAVE_SYS_SCSI_H.

1998-05-25  Allen Briggs  <briggs@canolog.ninthwonder.com>

	* changer-src/chg-manual.sh.in (ONLINEREGEX): add `^er=0$' for
	NetBSD's mt

1998-05-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (getsize_dump): killpgrp must be direct
 	child of sendsize, otherwise sendsize won't be able to kill it.

1998-05-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (bcopy, bzero, fread, fwrite, vfprintf, vprintf,
	vsprintf): check for these in stdlib.h
	(memmove): check for it in strings.h
	
	* common-src/amanda.h (memmove): fix declaration of memmove, so as
 	to be compatible with the ones in common-src/memmove.c and
 	regex-src/fake/memmove.c
	
	reported by Tim Potter <tpot@acsys.anu.edu.au>

1998-05-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendbackup.c (check_status): when checking whether dump 
	returned 1, make sure it was not tar; #ifdef'ed out the code that
	ignores exit status 2 from gnutar (will be compiled in only if
	IGNORE_TAR_ERRORS is defined)
	* client-src/sendbackup-gnutar.c (GNUTAR active filesystem errors): 
	updated comment; compile in GNUTAR error messages as DMP_NORMAL if
	IGNORE_TAR_ERRORS is defined; compile in SMBCLIENT error messages as 
	DMP_NORMAL if IGNORE_SMBCLIENT_ERRORS is defined.
	
1998-05-20  Tom Lear  <toml@accesscom.com>

	* client-src/sendbackup.h (tarpid): new variable, used to check
	whether it is gnutar that is running
	* client-src/sendbackup-gnutar.c (start_backup): set tarpid when
	starting gnutar
	* client-src/sendbackup.c (check_status): if gnutar returns 2,
	ignore the error

1998-05-19  Jean-Louis Martineau <martineau@IRO.UMontrealCA>

	* client-src/amandad.c: set parse_errmsg when unexpected packet
	* recover-src/amrecover.c: overflow in clean_pathname()
	* recover-src/extract_list.c: add log in delete_file().
	small bug when call clean_pathname()
	* server-src/amindexd.c: ORLD command is not working
	* server-src/dumper.c: fixe overflow

1998-05-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: do not check for MAXFILESIZE
	* config/acconfig.h: do not define MAXFILESIZE
	* server-src/conffile.c: use INT_MAX instead of MAXFILESIZE
	* example/amanda.conf.in: ditto

	* server-src/driver.c (interface_state): new function; print the
	free bandwidth for each interface.
	(short_dump_state): call interface_state before holdingdisk_state

	* ChangeLog: renamed from CHANGES.  Original entries follow.

	fix skip-incr handling so that reporter reports SKIPPED
	instead of missing result.
	-Jim Simmons <s4i@sws6.ctd.ornl.gov>

	split big dumps ( > MAXFILESIZE ) in multiple files on holding disk. 
	new chunksize parameter in holdingdisk description of 
	the amanda.conf file.
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	an amstatus command that give the current state of a run.
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	possibility to amflush multiple runs on one tape.
	possibility to select dump by datestamp in amrestore (-d datestamp).
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	amidxtrm keep index of all active tapes as listed in tapelist file.
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	the tapelist file keep every active tapes.
	"amadmin reuse" and "amadmin no-reuse" to mark tapes you want
	to keep for a long time.
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	amlabel will not overwrite an amanda tape.
	The -f flag allow to overwriting an amanda tape.
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	be consistent and use 1048576 as a dump size everyplace instead of
	100000 in some places (mostly cosmetic).  -JJ

	negative numbers are now accepted in the configuration file
	parser.  -oliva

	allow a total estimate time-out to be specified.  -oliva
	Suggested by Martyn Johnson <Martyn.Johnson@cl.cam.ac.uk>

	fix amtoc behavior in case of failed reads.
	-Niek Rijnbout <niek@knoware.nl>

	index files are now stored in a directory tree ala curinfo instead
	of a flat namespace. -JJ

	amrecover will now restore files using SAMBA.
	-Rob Riggs <rob@devilsthumb.com>

	VXDUMP needs not be run as root, so it no longer enables
	rundump automatically.  -oliva

	new `killpgrp' setuid-root program.  It is used to kill
	VDUMP, VXDUMP and XFSDUMP or with-rundump DUMP estimates in a
	safe manner.
	-Joerg Behrens <jbehren@umpa06.gwdg.de> & oliva

	fixed amrmtape so that it will delete from tapelist only the
	entry that corresponds to the specified tape, not others that
	contain the tape name as a substring.
	-Nick Hibma <nick.hibma@jrc.it> & oliva

	Added support for FreeBSD dump -h flag (honor nodump).
	-James E. Housley <housley@pr-comm.com>

	Added support for ZFTAPE on Linux.
	-Albrecht Gebhardt <agebhard@zidsrv.sci.uni-klu.ac.at>

	Added support for printing tape labels.
	-Scott Mesches <mesches@allison.Colorado.EDU>

	Do not let amrecover die because of SIGPIPE if the pager terminates
	early during a long listing.  Use the PAGER environment variable if
	available, else "more".  -JJ

	Change log() calls to log_add() so it does not conflict with the math
	function of the same name.  Replace pname global variable with two
	functions to set/get.  Get rid of libamnolog.  -JJ

	chg-chio was renamed to chg-scsi, and now it will support not
	only chio.h, but also tape changer interfaces available on
	HPUX, Solaris 2.5, IRIX and possibly others.  Currently, only
	chio and HPUX are implemented.
	-Eric Schnoebelen <eric@cirr.com>

	Numerous bugs/errors were fixed in chg-chio/chg-scsi.  it now
	properly responds to -eject requests, among other things.
	-Eric Schnoebelen <eric@cirr.com>

Version 2.4.0p1

	updated to libtool 1.2a.  -oliva

	fix kerberos encryption to work.  -Chris Ross <cross@uu.net>

	add --with-owner option to optionally not have things owned by
	the amanda user.  (meant to be in 2.4.0) -kovert

	only call initgroups() if it is available.  -oliva

	check whether GNUTAR_LISTED_INCREMENTAL_DIR is a directory.
	-oliva, reported by J.A. Gutierrez <spd@gtc1.cps.unizar.es>

	amindexd no longer considers prefixes of hostnames as valid
	hostnames. -oliva

	fix strappend2 so that it accepts a NULL first argument.
	-Rob Riggs <rob@devilsthumb.com>

	pass kerberos encryption switch to client.
	-Fredrik Jnsson <fjo@nada.kth.se>

	rename afree to amfree, to work around IRIX 6.4's afree.
	-oliva, reported Stephan P. Martin <smartin@schlund.de>

	implement `strategy skip' just like `ignore'.
	-oliva,
	reported by Michael O'Shaughnessy <mikeo@emg.sms.siemens.com>

	amcheck now checks whether COMPRESS_PATH is executable, which
	would prevent server-compression and indexing from working.
	-oliva, reported by Peter Schultze <peter@mbi.ucla.edu>

	fixed dump estimate regular expression for DU 4.0.
	-Andreas Schmitz <schmitz@theorie.physik.uni-wuppertal.de>

Version 2.4.0

	fixed memory corruption error in amtape.
	-oliva

	fixed VXDUMP support.
	-Andrew Ivanov <ivanov@mics.msu.su> & oliva

	typos fixed in chg-chs.
	-David Barr <dbarr@simplex.com>

	chg-mtx now prints error message if tapedev or changerdev must
	be defined.
	-Adrian T. Filipi-Martin <atf3r@cs.virginia.edu>

	fixed amflush problem, reported by Dietmar Goldbeck
	<dietmar@telemedia.de>  -oliva

Version 2.4.0-980319

	chg-mtx should use changer-dev if specified.
	-Steve Khoo <steve@gordian.com>

	flex-related backward-compatibility problem fixed.
	-Norman K Scherer <nsche@seros-48.hac.com>

	ported to RISCOS 4BSD.  -Harlan Stenn <Harlan.Stenn@pfcs.com>

	when amrecover starts up, it will warn you $CWD is not the root
	of the selected filesystem.  -oliva

	removed all uses of #elif, because some C compilers won't
	handle it correctly. -Gunther Felkel <G.Felkel@edelmann.de>

	fixed VDUMP-only (no DUMP defined) estimates.
	-Joern Behrens <jbehren@umpa05.gwdg.de>

	ported to UnixWare.  -Jeff Moscow <jeff@rtr.com>

	improved vxdump support so that rundump will be used for vxfs
	filesystems only, and it will be enabled automatically.  -oliva

	various portability problems fixed.

	taper will now log reason for tape error to log.<DATE> file,
	in addition to amdump.<n>.
	-Liudvikas Bukys <bukys@cs.rochester.edu>

	amflush now correctly updates the info database.  -oliva
	reported by Liudvikas Bukys <bukys@cs.rochester.edu>

	sendsize now wait()s for tar and samba child processes.  -oliva
	reported by Brian Morris <brian@mvhs.fuhsd.org>

	ensure that `amadmin find' reports multiple backups performed on
	the same day in the correct sequence.
	-Liudvikas Bukys <bukys@cs.rochester.edu>

	if backup server has multiple IP addresses, security code
	might reject it.  -Gunnar Gunnarsson <gunnar@ki.ericsson.se>

	vdump would not work.  -oliva

	kerberos support was broken.  -mike

Version 2.4.0-980222

	retry tape open on AIX if it fails with EAGAIN errno.
	-Francois Morris <Francois.Morris@lmcp.jussieu.fr>

	fix amrmtape so that it behaves well when files to amflush
	remain.  Reported by Dietmar Goldbeck <dietmar@telemedia.de>

	retry tape rewind on FreeBSD.  -Bob Willcox <bob@prm.com>

	read all output from amrestore otherwise, instead of the
	beginning of the next tape section, it would read garbage.
	-Terje Malmedal <tm@odin.funcom.com> & oliva

	formatting error in amoverview fixed.
	-Terje Malmedal <tm@odin.funcom.com>

Version 2.4.0b6p4

	use vdump to dump advfs filesystems only.  add support for vdump
	indexes.
	-Martyn Johnson <Martyn.Johnson@cl.cam.ac.uk> & oliva

	change index generation commands so that they are less prone
	to be fooled by blanks or strange characters in filenames.
	-oliva

	check whether exclude-list file exists before calling gnutar.
	If it does not, log a message to debugging file and discard it.
	selfcheck should check for that too, and print a warning message,
	but this is left for a future version.  -oliva

	fix sendbackup-gnutar crashing problem.  -oliva

	ensure that, in case of tape failure when dumping to tape, no
	incremental relative to the failed backup is performed.
	-oliva & Liudvikas Bukys <bukys@cs.rochester.edu>

	Fix buffer use and write() error handling in the index pipeline.
	-Dietmar Goldbeck <dietmar@telemedia.de>
	& Lars Fenneberg <lf@elemental.net>

	new index generation commands.  -oliva

Version 2.4.0b6p3

	accept curses and ncurses in addition to termcap for readline
	support, just as readline itself does.  -oliva

	fix NO-ROOM handling when Kerberos encryption is enabled.
	-oliva & Eric Siegerman <erics@now.com>

	patch file for automake 1.2d provided. -oliva

	sendbackup.debug now contains the argument list of child
	processes. -oliva

	wait() for child processes, such as server compressor, before
	accepting other commands.
	-Liudvikas Bukys <bukys@cs.rochester.edu>

	amrecover will print an error message if it is not run by root.
	It will not crash if you `pwd' before selecting a disk.  -oliva

	updated to libtool 1.0i. -oliva

	fixed tape block size of vxdump on HPUX 10.20.
	-Andrew Ivanov <ivanov@mics.msu.su>

	Use "a" mode instead of "w" for the fdopen of the debug file.
	-David Lamkin <drl@net-tel.co.uk>

	allow multiple concurrent gnutar backups, by fixing amandates
	locking mechanism.
	-Liudvikas Bukys <bukys@cs.rochester.edu>

	amdump should check for a hold file, as says the man-page.
	-oliva

	fix automatic enabling of USE_RUNDUMP for systems that require
	this.  xfsdump support no longer requires USE_RUNDUMP to be
	defined, rundump will be enabled and used for xfs filesystems
	even if USE_RUNDUMP is not defined, unless XFSDUMP is not defined.
	This seems to have completely solved the xfsdump problems.
	-oliva

	when USE_RUNDUMP is enabled, instead of checking for read or write
	access in selfcheck, just test for the existence of disk devices.
	-oliva

	fixed code that computed the dump size when incomplete
	writes occurred in dumper.  -Eric Siegerman <erics@now.com>

	amplot no longer crashes if there's no holding disk. -oliva

Version 2.4.0b6p2

	fix xfsdump index generation command.
	-Robert Tarrall <tarrall@bamboo.colorado.edu>

	tape device wouldn't rewind if opened O_WRONLY.
	-Palle Girgensohn <girgen@partitur.se> & oliva

	use setpgid instead of setpgrp if available
	-Mark Woodford <woodford@uniprise.com> & oliva

	chg-mtx will check whether slot 6 is a cleaning tape or not.
	-Martyn Johnson <Martyn.Johnson@cl.cam.ac.uk>

	amrmtape updated to text database.  -oliva

	incorrect NO-ROOM error when dumping directly to tape fixed.
	-oliva

	--with-user and --with-group become are now required.  -oliva

	patch-system script much more configurable.  -oliva

	amindexd must get an exact match for diskname.
	-Richard Kail <e8903122@student.tuwien.ac.at> & oliva 

	fix serial number message in amflush
	-Liudvikas Bukys <bukys@cs.rochester.edu>

	removed backslashes from inside macro calls.
	un-indented # directives.
	-Gregory Neil Shapiro <gshapiro@WPI.EDU>

	bsd-security is now enabled by default.  -oliva

	fixed estimate command for XFSDUMP.
	-Mark Radleigh <radleigh@image.ucr.edu>
	& Jeff Moskow <jeff@rtr.com>

Version 2.4.0b6p1

	documented etimeout configuration option.  -oliva&jrj

	prevent a few crashes in dumper and reporter.  -jrj

	reporter would report the same host and disk for RESULTS MISSING.
	-martineau

	fix a few file-locking configure bugs.  -oliva

	chg-multi updates and bugfixes.
	-Liudvikas Bukys <bukys@cs.rochester.edu>

Version 2.4.0b6

	amindexd bugfix -Jos Alsters <Jos.Alsters@sci.kun.nl>

	New --disable-libtool configure option, for those who really don't
	want libraries to be installed.  Shared libraries won't be
	built, of course.  -oliva

	samba-related bugfixes.
	-Klaus Thiele <kth@becker-software.com>

	xfsdump, DNS and amidxtaped bugfixes. -martineau

	exclude-list support was broken, the filename was not copied
	to the gnutar argument list.
	-Stefan Bohm <Stefan.Bohm@rp-online.de>

	chg-chio still thought it was seagate-changer, and contained a
	few bugs.  -Tim Tsai <tim@futuresouth.com>

	New file docs/RESTORE, by Daniel Moore <dmoore@jeffco.k12.co.us>

Version 2.4.0b5

	Make sure amverify waits for the tape device to be ready before it
	starts reading each section. -oliva

	Fix amrecover so that it accepts filenames with blanks.
	-J. Shirk <jshirt@ksu.edu> & oliva

	Add a TIMEOUT config file parameter to replace the hard coded value
	in planner.  -Daniel David Benson <bensond@ucdavis.edu>

	Change amrecover/amindexd/amidxtaped to require a SECURITY
	exchange if --with-bsd-security is enabled.  It is done on a
	reserved port, which means amrecover must be run as root and that
	amindexd/amidxtaped need an entry for the incoming amrecover in
	either .rhosts or .amandahosts (Kerberos is not yet supported).  --JJ

	Make our internal TEXTDB the default database style for the infofile.
	If you wish to keep using a dbm style database use the configure
	option "--with-db={db,dbm,gdbm,ndbm}".
	-scott

	Sanitise the disk name in the TEXTDB code.
	**NOTE** if your infofile database uses TEXTDB (which has only been
		 available since Amanda-2.4.0b1) and you have '/'s in the
		 first field in disklist you will need to 'amadmin export'
		 the data using the old version of Amanda, 'mv' the old
		 database out of the way and 'amadmin import' it back again
		 using the new version.  When you are happy with the new
		 version you may delete the old database.
	-scott

	Get rid of DEV_ROOT/DEV_RROOT and figure out the raw name on the
	fly by trying a leading 'r' before each path element one at a time
	until we find a character device.  This should handle all the current
	cases plus things like Solaris DiskSuite that have /dev/md/rdsk/xxx
	names.  -JJ

	Change kill logic in sendsize to try TERM first, then KILL if that
	does not get dump's attention.  This fixes a problem on AIX 4.x
	where dump was always getting a KILL and leaving orphaned message
	queues, which would eventually run the system out of resources.  -JJ

	Extensive buffer management, bug and defensive coding overhaul
	including:
	    * Use proper fgets/fread/read buffer size.
	    * Wrote agets and areads to get a line without buffer overflow
	      and changed most gets/fgets and some read calls to use it.
	    * Replaced all *scanf("...%s...") with explicit pointer work.
	    * Replaced most fixed size buffers with dynamic ones.  This has
	      no doubt introduced some memory leaks.
	    * Replaced most sprintf calls with vstralloc (new routine).
	    * Added overflow checks to some remaining explicit buffer
	      management.
	    * Made almost all read() and write() calls into loops to handle
	      short and broken up transfers.
	    * Fixed potentially uninitialized fstype field.
	    * Added more sanity checks when parsing various things, including
	      converting some assert() calls to real code.
	    * The pattern amtrmidx used to find old index files to delete
	      thought the date field was YYYY-MM-DD, but it is YYYYMMDD,
	      so no files were being deleted.
	    * Limited the number of directories listed by amflush to 26 to
	      avoid funny characters in the user prompt.
	    * Changed some of the amrecover routines to soak up the rest of
	      the continuation lines after an error.
	    * If a dumper dies, driver still tries to send a QUIT command
	      which fails because the file descriptor has been closed.
	    * Wrote afree macro that calls free and then sets the pointer
	      to NULL.  Changed most free calls to afree.
	    * Wrote aclose/afclose/apclose macros to do the associated close
	      and then set the argument to something invalid (-1 or NULL).
	    * Check the file descriptor before calling FD_ISSET in dumper.
	      Otherwise it goes to -1 on EOF and FD_* doesn't like that.
	    * Call aclose() after FD_CLR (so the descriptor is not -1).
	Odds and ends:
	    * Added some TEXTDB support code to the infofile test program.
	    * Set it up so -DPROTO_DEBUG could come from the compiler command
	      line instead of having to modify the source.
	    * Added -t command line flag code to sendbackup.c to support some
	      limited debugging.
	    * Added a test to amcheck to see if the log file is writable
	      (if it already exists).  During debugging, I keep leaving one
	      around owned by root :-).
	    * Changed upper limit on close loops from 255 to FD_SETSIZE.
	      This probably needs some more study.
	-JJ

	If krb4 auth was compiled in but not enabled, clients would hang
	forever.  -Aidan Cully <aidan@panix.com>

	Make sure SAMBA will not clear archive bits when performing an
	incremental backup, so any incremental will be a level 1.
	-martineau

	Add a LOGDIR option to amanda.conf and use it to replace the
	--with-logdir option to configure (this was only used for the
	amdump files) and the logfile option in amanda.conf.  Log
	files are now LOGDIR/log and amdump files are LOGDIR/amdump.
	Note: if there is a LOGFILE option in amanda.conf it has its
	filename removed and is used as the LOGDIR (eg, if you have
	"logfile /usr/adm/amanda/log" in amanda.conf it is translated to
	"logdir /usr/adm/amanda" instead).  This should not cause a
	problem for most sites.
	-scott

	Remove --with-dbdir option from configure.  This was only used
	to setup things for the man pages and example files.  Oh.. and
	amrmtape.  Fix this as well.
	-scott

	Remove --with-indexdir option from configure.  This is obtained
	from amanda.conf at run time.  Also fix things so that it *is*
	obtained from amanda.conf in all cases.
	-scott

	This is no longer tested on configure.in, since it is
	expressly forbidden to include kernel headers under glibc,
	according to Matthias Urlichs <smurf@noris.de>.  However, Eric
	Doutreleau <ed@cti.ecp.fr> said he needed to include this
	header file in order to build amanda on
	sparc-unknown-linux-gnu.  -oliva

	It is now possible to specify a username to be used to backup
	up with samba.
	-Jean-Louis Martineau <martinea@iro.umontreal.ca>

	Make sure dumper replies with ABORT_FINISHED when a PORT-DUMP
	is aborted because of tape error.
	-Michael C. Povel <Michael.Povel@hub.de>

	Amcheck checks only for the needed features.
	-Jean-Louis Martineau <martinea@iro.umontreal.ca>

	Performance and memory-usage improvements to amrecover.
	-Jean-Louis Martineau <martinea@iro.umontreal.ca>

	Use extended regular expressions.
	-Noel Hunt <noel@jpmorgan.com>

	Fixed regular expressions for samba support.
	-Brian Fernald <fernald@nsi.edu>

	Fixed a few bugs that caused arithmetic exceptions in planner.
	-Bob Willcox <bob@luke.pmr.com>, Evan Champion
	<evanc@synapse.net>, scott and oliva

	amrecover should now be able to handle GNUtar restores.
	-Jean-Louis Martineau <martinea@iro.umontreal.ca>, plus
	incremental (-G) patch by Lars Fenneberg <lf@elemental.net>

	Ported to SINIX (Reliant Unix V5.43).
	-Michael Schmitz <mschmitz@iname.com>

	Configure now looks for large file support and will use it under
	Solaris 2.6 and above.
	-Blair Zajac <blair@gps.caltech.edu>

	Compatibility problems fixed for:
		SCO OpenServer 5.0.2: Paul Gampe <paulg@twics.com>

Version 2.4.0b4

	New changerfile and changerdev configuration keywords, that
	allow changer scripts to be configured in the main amanda
	configuration file.  Each changer script has been adapted, so
	that it uses those flags whenever possible.  Also,
	documentation about built-in scripts has been added to
	docs/TAPE.CHANGERS.  -oliva & Eric Schnoebelen
	<eric@egsner.cirr.com>

	--with-debugging now accepts a directory name, where debugging
	files should be stored.  -John R. Jackson <jrj@cc.purdue.edu>

	Compatibility problems fixed for:
		NextStep 3.3: Fabrice GAILLARD <gaillard@ina.fr>
		SCO OpenServer V5: Christopher B. Olsen <colsen@compus.com>
		AIX: Georg Rehfeld <georg@wmd.de>

	Planner would core dump if it had to delay dumps.  -Georg
	Rehfeld <georg@wmd.de>

	Added patch for samba to support very long filenames.  -Todd
	Pfaff <todd@edge.cis.mcmaster.ca>

	Added VXDUMP support to estimate program.  -oliva & John
	R. Jackson <jrj@cc.purdue.edu>

	Fixed amflush so that it cd's to the configuration directory
	before invoking reporter.  -oliva

	driver no longer opens the infofile, so a deadlock is
	prevented.  -oliva & John R. Jackson <jrj@cc.purdue.edu>

	Fixed typo in sendbackup-dump that would prevent compilation
	if either xfsdump or vxdump were enabled.  -oliva

	Debugging messages produced by sendbackup are no longer
	included in the dump stream.  -oliva

	amrestore should wait for the child process to die before
	re-opening the tape device.  -Dietmar Braun
	<dietmar@tin-lizzy.hig>

Version 2.4.0b3 

	fixed race condition in debug file open operation.  -oliva and
	Thomas Schmeidl

	exclude-list and exclude-file are correctly handled by
	sendsize.  -oliva and Johann Klasek <jk@auto.tuwien.ac.at>

	fix some kerberos4 problems; no longer require low ports for
	kerberized connections; now use amanda@REALM instead of
	amanda.amanda@REALM in .klogin's.  -kovert

	amrecover no longer depends on GNU flex library.  -oliva

	Ensure that malloc(0) is not called.  -Wolfram Schmidt
	<Wolfram.Schmidt@iao.fhg.de>

	Compression is now performed where specified, and server
	compress best specifications are obeyed. -oliva

	genversion now correctly recognizes the selected locking scheme.
	-Thomas Schmeidl <schmeidl@nwp.kwu.siemens.de>

Version 2.4.0b2

	Several bugfixes by John R. Jackson <jrj@cc.purdue.edu>

	AIX's restore support added to amrecover.  -David B. Anderson
	<dbanders@mail.physics.utah.edu>

	Dump process would not be killed unless it supported the -E
	flag (flipped #ifdef): fixed.  -Steve Bower <sbower@raytheon.com>

	--with-testing now supports a trailing argument, that
	specifies the a string to be appended to service names.  -oliva

	Recent versions of Samba require additional arguments so that
	estimates and total sizes are logged to stdout, not to syslog.
	-Ernie Oporto <ernie_oporto@MENTORG.COM> & Norbert Holzknecht
	<Holzknecht@fs31.vdeh-bfi.de>

Version 2.4.0b1

	Improved planner backup-delaying mechanism.  -scott

	Concurrent estimates are now supported.  -oliva

	Shared library support included with GNU libtool.  -oliva

	New hard-link-based locking mechanism for operating systems
	that do not support standard locking system calls.  -scott

	New configuration file format, simpler and easier to
	extend.  -scott

	New curinfo database format that uses only text files.  The
	old dbm format is used by default, though.  -scott

	DGUX support. -Brian Harvey <bharvey@raven.phs.com>

	Tentative HPUX vxdump support.  -oliva

	Integrated amgetidx into dumper/sendbackup protocol.  This
	***breaks backward compatibility***!  -oliva

	Have sendbackup-dump and sendbackup-gnutar list the actual
	program that should be used to restore a file from a backup
	instead of just listing restore or gtar. -blair&oliva

	Have configure check for the initgroups() declaration in
	unistd.h in addition to grp.h and sys/types.h, which is where
	some OSes have the declaration. -blair

	SAMBA backups wouldn't succeed if GNUTAR listed incrementals
	were enabled.  SAMBA password file can now specify workgroup
	and may contain comments.  -oliva

	Fixed xfsdump support. -oliva

	Fixed srvcompress option. -oliva

	Fixed exclude/exclude-list support. -oliva

	Change umask to 066 before creating index file in /tmp. -oliva

	Fixed autoconf for gdbm on linux. -oliva

	configure now seeks out a few possible locations for
	kerberos4 includes and tries to find the correct path if
	the kerberos bits have been installed.  It's possible for
	someone to just specify the root of a kerberos tree for
	where the bits live, as well. -kovert

Version 2.3.0.4

	Have bsd_security_ok() in amandad return 1 when BSD security is
	not turned on.  Patch from Michael C. Grant
	<mcgrant@rascals.Stanford.EDU>.

	Add a configure option, --with-db, which lets the user specify
	the database library to use.  The available codes to look for
	are db,dbm,gdbm,ndbm.  The new configure code goes to a lot
	more length to find pairs of header files and libraries.  If a
	header file exists and the library does not, but dbm_open() is
	found by linking against -lc, then that header file is used.
	Patch from Blair Zajac <blair@gps.caltech.edu>.

	Fixed bug at line 158 where selfcheck was testing that the
	result returned by open() was nonzero.  The correct thing to do
	is check for non-negative values returned by open().  Changed
	the "ERROR" in line 169 to "OK" to prevent selfcheck from
	flagging the non-existence of /etc/amandapass as an error.
	Using "OK" in this line flags this condition as an informative
	statement rather than an error - which is to say this will be
	reported along with other errors but it isn't enough in itself
	to generate an error report.  The reason that I think this is
	the right fix is because although every Amanda client is
	capable of backing up PCs using smbclient it isn't the case
	that we will back up PCs with every Amanda client.  This also
	implies that we don't want to have /etc/amandapass files on all
	these machines either.  If an Amanda client does have a samba
	"//host/share" entry in its disklist file then selfcheck will
	flag the non-existence of the /etc/amandapass file on line 105
	when it attempts to check that partition, so I believe that
	this is a safe fix.  Patch from Michael Brantley
	<Michael-Brantley@deshaw.com>.

	Have all calls to gethostname() leave the result in character
	arrays of length 1025.  This will make sure that gethostname
	behaves correctly.  Patch from  blair Zajac
	<blair@gps.caltech.edu>.

	Have amrecover.c include history.h or readline/history.h if
	configure finds it.  Patch from blair Zajac
	<blair@gps.caltech.edu>.

	Have Amanda use cat if gzip and compress cannot be found.  In
	this case, do not #define COMPRESS_FAST_OPT, COMPRESS_BEST_OPT,
	or UNCOMPRESS_OPT as "" since cat will look look for a file by
	the name of "".  Place #ifdef's around code that uses any of
	the _OPT defines.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Rewrite amgetidx to use amandad instead of rsh/rcp.  amgetidx
	now only gets the index files from a given day.  It now takes
	two optionally arguments <on day> or <ago days>.  <on day> lets
	the user specify the day in one of the forms YYYYMMDD MMDD DD
	YYYY-MM-DD --MM-DD ---DD.  <ago days> gets the files from days
	days ago.  Have configure look for an appropriate directory to
	use for the temporary files on the clients.  Use /var/tmp, then
	/usr/tmp, and if neither of those exist, then use /tmp.  Have
	selfcheck check if the index holding directory has enough space
	in it.  Add a new program called sendindex which sends the
	index files.  Add the file docs/INDEXING which describes the
	index code.  Patch from Alan McIvor <alan@auck.irl.cri.nz>.

	Have configure set up mt to use either the -f or the -t option
	depending upon the operating system.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Include the amanda_tapetypes.txt file as docs/TAPETYPES.  File
	composed by Chris Stacey <chris@snrc.uow.edu.au>.

	Allow certain dumptypes to be kicked off at specific times.
	Add a new, optional, parameter to the dumptype description in
	the config file.  The parameter is called "starttime" and takes
	one argument which is a time of day (local timezone) formated
	as either hhmm or hmm (no `.'s, no `:'s, just an integer).
		define dumptype comp-user-2am {
			comment "Non-root partitions on fast machines"
			options compress-fast
			priority medium
			starttime 0200
		}
	Any partitions listed in disklist with this dumptype will be
	fired off no earlier than 2am.  If 2am today is less than 43200
	seconds past (12 hours ago) it will assume you meant 2am today
	and fire the dumps off right away.  But if 2am today is more
	than 12 hours in the past, it will wait till 2am tomorrow.
	Patch from Brad Huntting <huntting@misc.glarp.com>.

	Totally rewrite the socket buffering code for dumper.
	Eliminate SO_SNDTIMEO and SO_RCVTIMEO setsockopt calls.  Remove
	the check for HAVE_SO_SNDTIMEO from configure.  Add a new
	option to configure named --enable-buffered-dump to enable this
	code.  Patch from Brad Huntting <huntting@misc.glarp.com>.

	Have amflush call setsid() to detach amflush from the
	controlling terminal.  Patch from Ken Laprade
	<klaprade@harris.com>.

	Have configure correctly work on systems where dbm_open is in
	libc.  Patch from Farzad Farid <farzy@sgip.fr>.

	Patches to amrmtape which remove C style comments and let the
	script remove a tape if there is only one tape in the tapelist
	file.  Patch from Andrew A. Ivanov <IVANOV@mics.msu.su>.

	Sprintf formatting error in amgetidx fixed.  Patch from Yossi
	Gottlieb <yogo@xpert.com>.

	I'm using a Sony SDT/STL-7000 4mm DAT changer.  I could not
	find any method of directly controlling the device, except for
	simply using the 'offline' mt command for advancing to the next
	tape.  Using this method, however, I could not go beyond the
	last cassette (that is, to roll back to the first one).  This
	means the device is currently being used as a simple gravity
	changer, only able to change forward.  The chg-generic.conf
	should list the default tape device for all slots, disable
	'needeject', enable 'gravity' and enable the new option named
	'multieject'.  Patch from Yossi Gottlieb <yogo@xpert.com>.

	Update the example chg-generic.conf file to include comments
	that describe how to use the multieject feature of the script.
	Patch from Yossi Gottlieb <yogo@xpert.com>.

	Protocol seems to loop when a A_TIMEOUT occurs because
	p->reqtries was not being decremented.  Problem noted by Neal
	Becker <neal@ctd.comsat.com>.

	About half the calls to gethostname() in Amanda fail to
	null-terminate properly.  This patch makes them all
	consistent.  In addition it updates sendbackup-dump and
	sendbackup-gnutar so they handle USE_FQDN is a way consistent
	with the amindex stuff.  In particular when USE_FQDN is set,
	the dump clients will not truncate their hostname before
	putting it in the dump headers.  My patches to amflush are
	already in the Amanda betas so amflush should be able to match
	up both FQDN and non-FQDN clients against FQDN and non-FQDN
	disklist files.  I also fixed an error message that was
	attributed to gethostname when it actually came from
	getpeername.  Patches from James Mathiesen
	<james@nyc.deshaw.com>.

	I have run into the problem, on a Linux system, where the first
	time I run configure it generates valid Makefiles and Amanda
	compiles without problem.  If I run configure again, or I alter
	a Makefile.in or something which causes autoconf to be called,
	the resulting Makefiles are no good - the programs in
	server-src don't finish linking because there is no dbm
	library.  That is, the first time through configure -lgdbm is
	added to LIBS but the second, and any subsequent times, it is
	not.  Patch from Alan McIvor <alan@auck.irl.cri.nz>.

	I've just found a bug that has prevented Amanda from running on
	my site for almost one week.  Just after a dumper replied that
	it timed-out, the driver would send it another dump request.
	Then the driver would log to amdump an event of receiving a
	message from the dumper, but that message would be empty, the
	holding file for the requested filesystem would not exist, and
	driver would quit.  It turned out that the problem was that
	dumper started to close its sockets (datafd, mesgfd and outfd)
	since release 2.3.0.4b3.  outfd is initialized before invoking
	startup_dump, but it is sendbackup_response, intended to be
	invoked by the amandad protocol driver, that opens sockets and
	initializes datafd and mesgfd.  If sendbackup_response is never
	run (because the amandad request times out), datafd and mesgfd
	will not be initialized, so they may contain already closed
	(and possibly already reopened) file descriptor numbers or
	still be uninitialized, containing any garbage, but usually 0
	--- but 0 is stdin, used for reading commands from the driver,
	it should not be closed!  I've solved the problem by
	initializing them to -1 in startup_dump.  Patch from Alexandre
	Oliva <oliva@dcc.unicamp.br>.

	Include declarations for select(), bind(), connect(), fread(),
	fwrite(), getopt(), getpeername(), getsockname(), getsockopt(),
	initgroups(), listen(), lstat(), mktemp(), mktime(), puts(),
	recvfrom(), select(), sendto(), setpgrp(), setsockopt(),
	shmat(), shmctl(), shmdt(), shmget(), socketpair(), sscanf(),
	strftime(), strncasecmp(), system() if the system does not
	declare these in any header files.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Have configure correctly substitute for DB_DIR and LOG_DIR in
	example/amanda.conf when --prefix was not used.  Problem noted
	by Philippe Charnier <charnier@xp11.frmug.org>.

	Include seagate-changer.c from Larry D. Pyeatt
	<pyeatt@cs.colostate.edu>.  This program was written to control
	the Seagate/Conner/Archive autoloading DAT drive.  This drive
	normally has 4 tape capacity but can be expanded to 12 tapes
	with an optional tape cartridge.  This program may also work on
	other drives.  This program works for me under Linux with Gerd
	Knorr's <kraxel@cs.tu-berlin.de> SCSI media changer driver
	installed as a kernel module.  The kernel module is available
	at
	http://sunsite.unc.edu/pub/Linux/kernel/patches/scsi/scsi-changer*
	Since the Linux media changer is based on NetBSD, this program
	should also work for NetBSD, although I have not tried it.  It
	may be necessary to change the IOCTL calls to work on other
	OS's.

	Add a new configure option, --with-group, which tells Amanda
	the group to install all files as.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	If --with-bsd-security was not set, then dumper would not find
	the amanda/udp port to use to connect to clients.  Patch from
	Alan McIvor <alan@auck.irl.cri.nz>.

	The order of dump programs to search for (ufsdump, vdump, dump,
	backup) didn't work on AIX systems, where backup should be used
	but a program named dump exists on the system.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	The configure --with-mmap was not working properly since
	configure was using the wrong variable to see if the system had
	a working mmap().  Problem noted by Keith Mitchell
	<kmitch@weenix.guru.org>.

Version 2.3.0.4b3

	Save the results of getchar() into int's instead of char's in
	amidxtaped.c.  Patch by Blair Zajac <blair@gps.caltech.edu>.

	Fix sendbackup-gnutar so that it can be compiled with a K&R
	compiler.  Patch by Blair Zajac <blair@gps.caltech.edu>.

	Since I installed Amanda 2.3.0.4b3, I noticed some annoying
	messages in amdump:
		dumper: pid 8696 setsockopt(SO_SNDTIMEO): Invalid argument
	This is because Solaris 2.5 does declare SO_SNDTIMEO in
	sys/socket.h, but fails to setsockopt with the given
	arguments.  Unfortunately, it is not documented, so I could not
	find out the correct way to do this, so I just added a test in
	configure to check whether SO_SNDTIMEO works as expected or
	not.  Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

	Include amplot-2.2.6 written by Olafur Gudmundsson
	<ogud@tis.com> into Amanda.  Have amplot be configured using
	configure instead of amplot.conf.  It will be installed if
	gnuplot and the version of awk configure finds can handle
	variable assignment from the command line.  I also changed some
	of the command line options so that the amdump files will not
	be compressed unless amplot is told to do so on the command
	line.  It also takes a new command line option, -t, which lets
	the user set the time of the right side of the plot.  Work done
	by Blair Zajac <blair@gps.caltech.edu>.

	Made rth-changer check all system calls for valid returns.
	Patch by Blair Zajac <blair@gps.caltech.edu>.

	amrestore.c and sendbackup-common.c would do an ifdef on
	HAVE_GZIP, which was no longer being defined if Amanda was
	using gzip.  Now, define HAVE_GZIP if gzip is being used.
	Patch by Blair Zajac <blair@gps.caltech.edu>.

	Include a script, amoverview, that outputs an overview of all
	of the backups done on all of the disks.  Script written by
	Dave Disser <disser@sdd.hp.com>.

	The prototype for amname_to_fstype() is missing in
	createindex-dump.c when xfsdump is available.  Patch from Ken
	Laprade <klaprade@harris.com>.

	Apparently SGI provides a dummy libsun.a that does not really
	have anything in it.  I guess this tricks configure into adding
	it to the Makefile.  Have configure not check for libsun.a on
	SGI systems.  Patch from Ken Laprade <klaprade@harris.com>.

	The global variable overwrite in amcheck.c apparently is seen
	as a potential conflict with the overwrite() curses function
	which is apparently in SGI's libtermcap.a.  Declaring the
	variable static eliminates the warning.  Patch from Ken Laprade
	<klaprade@harris.com>.

	Add a new configure option, --with-fqdn, which allows Amanda to
	back up systems in different domains.  This requires that the
	disklist file have the fully qualified domain names (FQDNs)
	listed.  Patch from Joe Ammond <Joe.Ammond@ee.gatech.edu>.

	Include rundump, a setuid program that runs dump as root.  This
	is used under OSF1 systems.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	Install setuid files executable only by the owner and group of
	the files.  This stops other users from running these programs,
	making security tighter.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	On FreeBSD 3.0, amanda.h needs to include <sys/types.h> before
	<dirent.h>.  Problem noted by Keith Mitchell
	<kmitch@weenix.guru.org>.

	Amanda had a bug regarding the recent addition of support for
	excluding files in GNUTAR.  planner and sendsize did not
	understand each other about empty exclusion lists, so there
	were failures using gnutar, as dump does not support excludes.
	Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

	Fixed a problem in configure where DUMP was being set to
	/no/restore/available when no restore program could be found
	instead of setting RESTORE to this.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	Have no-changer and hp-changer check for the existence of the
	logging directory before trying to use it.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	Patches to have nicer looking Samba support code.  Patch from
	Michael Zucchi <cismpz@cis.unisa.edu.au>.

	Got Amanda to compile fine on a m88k-motorola-sysv4 system.
	Patches from Blair Zajac <blair@gps.caltech.edu>.

	In amandad.c, pk_t dupmsg was conflicting with dupmsg in
	/usr/include/sys/stream.h on an m88k-motorola-sysv4 system.
	Rename dupmsg to dup_msg.  To keep things consistent, rename
	inmsg to in_msg and outmsg to out_msg.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	Check for the dbm_open declaration in any header file that may
	contain it.  If it doesn't exist, then declare it and all of
	the other dbm_ functions.  Check if struct datum is declared in
	any header files and if it isn't then declare it.  Patch from
	Blair Zajac <blair@gps.caltech.edu>.

	Have runtar make sure that it is being invoked by the
	CLIENT_LOGIN user, since it is a suid executable.  Patch from
	Alexandre Oliva <oliva@dcc.unicamp.br>.

	Have selfcheck check for /etc/vdumpdates if vdump is being
	used.  Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

	If we're on an Ultrix system, then define STATFS_ULTRIX.  Patch
	by Blair Zajac <blair@gps.caltech.edu>.

	amadmin export produces a full version number (2.3.0.4b2, for
	instance), while amadmin import expects three integers
	separated by dots, so it fails to import an exported file by
	itself.  Patch by Alexandre Oliva <oliva@dcc.unicamp.br>.

	Sendsize.c would loop forever if debugging was not turned on.
	Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

	Define STATFS_OSF1 if we are on a *-dec-osf-* system.  Change
	ifdef OSF1_HANG_BUG to ifdef OSF1_VDUMP, since I'd rather not
	have too many defines floating around.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	There was a bug in selfcheck.c when Blair installed the Samba
	support.  I deleted an extra space that was added after
	SAMBA_CLIENT when the command was being put together.  Fix by
	Michael Zucchi <cismpz@cis.unisa.edu.au>.

	Add a needed ; to client-src/Makefile.am and
	server-src/Makefile.am.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	Have planner.c and amcheck.c always get the amanda port number
	even if BSD security is turned off.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	Change the way amgetidx caches host up/down information.  It
	used to stralloc() a string depending on if the host was up or
	down.  Now, create two static character arrays, one holding
	"down" and the other holding "up" and simply point the
	hostinfo->up pointer to one of the two arrays.  This should
	save a little memory.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	The Bourne shell in FreeBSD can't handle setting IFS to : and
	expanding $LOCPATH:$SYSPATH.  Create two new variables before
	their use called $LOCSYSPATH and $SYSLOCPATH.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	Have open_fstab for BSD systems return the value of setfsent.
	Patch by Blair Zajac <blair@gps.caltech.edu>.

	Configure was searching for the dump program in the following
	order: ufsdump, vdump, backup, dump.  On HP-UX systems,
	configure would find backup, which is a valid program but does
	not do what dump does.  So switch the order of the programs to
	ufsdump, vdump, dump, backup.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	Fixed some dbprintf(()) bugs in amgetidx.c.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	Have amrecover.c always declare
	    extern char *optarg;
	    extern int optind;
	This makes amrecover.c compile on Ultrix systems.  Problem
	noted by Scott Gasch <scott@cray-ymp.acm.stuorg.vt.edu>.

	Patch to configure to have it recognize gnutar version 1.11.2.
	Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

Version 2.3.0.4b2

	Have amcleanup, no-changer, and hp-changer find out where the
	logging directory, or amdump error file is from getconf instead
	of using @LOG_DIR@ or @DB_DIR@ from configure.  Problem noted
	by Joe Ammond <Joe.Ammond@ee.gatech.edu>.

	Remove VarDir=@DB_DIR@ from amrmtape.sh.in, since amrmtape
	figures out where the curinfo files are from the amanda.conf
	file.  Problem noted by Joe Ammond <Joe.Ammond@ee.gatech.edu>.

	Include rth-changer, a tape changer script for the Robotic Tape
	Handling system OEM'd by Andataco (RTH-406).  Script written by
	Erik Frederick <edf@tyrell.mc.duke.edu>.

	Add a new configure option called --with-pid-debug-files which
	has Amanda append the process ID to the debugging files placed
	in /tmp.  The PID will not be appended unless this option is
	used.  Suggestion by Joe Ammond <Joe.Ammond@ee.gatech.edu>.

	Add a new #define UNCOMPRESS_OPT to pass to UNCOMPRESS_PATH to
	get compressed standard input decompressed and pass it to
	standard output.  The configure script only recognized gzip and
	compress right now, so it will set UNCOMPRESS_OPT to -dc and
	set UNCOMPRESS_PATH to the same value as COMPRESS_PATH.  Edit
	all of the files that make use of UNCOMPRESS_PATH to also make
	use of UNCOMPRESS_OPT now.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	The readline() substitute in amrecover.c when the real
	readline() code is not available did not return to the caller
	what the user typed in.  It now does so.  Patch from Blair
	Zajac <blair@gps.caltech.edu>.

	Avoid -lnsl on Irix.  On IRIX 5.x and 6.x systems that have the
	svr4net module installed, there will be a /usr/lib/libnsl.so
	present on the system. The configure script looks for this and
	tosses into the library list if it's there.  It is not
	advisable to link against libnsl on IRIX unless you really need
	it for SVR4 networking (TLI/STREAMS). If you _do_ link against
	it, you should use include '-lc' _before_ '-lnsl'. The reason
	for this is that libnsl.so also contains the SysV TI-RPC code,
	which is RPC based on STREAMS/TLI rather than sockets. (Solaris
	2.x now uses this by default.) TI-RPC has some compatibility
	functions with the same names as older RPC functions, such as
	clnt_call(), clnt_create(), clnt_destroy(), and these conflict
	with the functions in libc.so. The main place this will hose
	you is NIS: NIS v2 expects the underlying RPC code to use
	sockets, not STREAMS, and it fails if the TI-RPC symbols in
	libnsl.so override the RPC symbols in libc.so.  Again, you
	don't need libnsl.so unless you're actually using STREAMS/TLI
	or TI-RPC, so in Amanda's case it's safe to just ignore it. If
	you _do_ need it, you must do 'cc -o foo foo.c -lc -lnsl' in
	order to make sure the linker resolves the RPC symbol
	references correctly. The primary symptom of this problem is
	that things like getpwent(), getgrent() and getnetgrent() stop
	working in an NIS environment.  To make a long story short: on
	IRIX, avoid using libnsl. Amanda doesn't need it anyway. So far
	I haven't encountered a problem with this, but you never know.
	Note from Bill Paul <wpaul@ctr.columbia.edu>.

	Include patches to have Amanda do incrementals of gnutar based
	backups.  Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

	Delete the GNUTAR_BROKEN_PIPE from configure and acconfig.h
	since no code was testing for it.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	Have configure check for the number of arguments that
	gettimeofday takes and have clock.c use the appropriate number
	of arguments.  Patch by Blair Zajac <blair@gps.caltech.edu>.

	Have sendbackup-common.c include tapeio.h instead of defining
	BUFFER_SIZE.  Fix by Philip Guenther <guenther@gac.edu>.

	Put in more support for AIX by defining AIX_BACKUP if the
	system is an AIX system.  Fix createindex-dump.c to pass the -B
	flag to restore to have it read from standard input.  Problem
	noted by Bill Paul <wpaul@ctr.columbia.edu>.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	Add a regexp for AIX 4's backup in sendbackup-dump.c and
	sendsize.c.  Patch from Bill Paul <wpaul@ctr.columbia.edu>.

	Add a comment to tapeio.h about BUFFER_SIZE and what it is used
	for and how people should not change it.  Noted by Bill Paul
	<wpaul@ctr.columbia.edu>.

	Added a --with-mmap option to force the use of mmap() instead
	of shared memory support.  Requested by wpaul@ctr.columbia.edu
	<Bill Paul>.  Patch by Blair Zajac <blair@gps.caltech.edu>.

	On FreeBSD 2.x and 3.x, the SO_SNDTIMEOUT value is too large in
	dumper.c.  Looking at the kernel source, the maximum value for
	tv_sec is about 227.  The value used is READ_TIMEOUT/4, or
	(30*60)/4 == 450 seconds.  This causes setsockopt() to return
	EDOM (Numerical argument out of domain), and again everything
	grinds to a halt.  I changed the value from READ_TIMEOUT/4 to
	READ_TIMEOUT/8, which reduces the SO_SNDTIMEO value to 225.  I
	haven't extensively tested this yet, but based on eyeballing
	the kernel source it should work.  Patch from Bill Paul
	<wpaul@ctr.columbia.edu>.

	In dumper.c:do_dump(), there is code to set the transmission
	timeout, receive buffer size and receive low water mark on the
	data socket using setsockopt().  For SO_RECVBUF, the receive
	buffer size (recbuf) is set to DATABUF_SIZE * 4, which is
	32*1024*4, or 131072.  On SunOS 4.1.x, this value is too
	large:  dumper generates a 'no buffer space available' error
	and everything grinds to a halt.  I took away the '*4', which
	reduces the size to 32767 bytes, which seems to work.  I'm
	surprised nobody else has noticed this since it breaks SunOS
	Amanda servers.  I can only surmise that people aren't using
	SunOS machines as servers these days. :)   Patch from Bill Paul
	<wpaul@ctr.columbia.edu>.

	Have Amanda include either readline.h or readline/readline.h
	Fix suggested by Neal Becker <neal@ctd.comsat.com>.

	Have --with-includes put the -I flags into $CPPFLAGS and
	$CFLAGS so that AC_CHECK_HEADERS will find other include
	files.  Problem noted by Neal Becker <neal@ctd.comsat.com>.

	Fixed common-src/Makefile.am to put the extra libamanda.a
	sources into the EXTRA_libamanda_a_SOURCES variable instead of
	EXTRA_DIST.  Fix from Tom Tromey <tromey@drip.Colorado.EDU>.

	When compiling amgetidx.c with some compilers, trigraph
	substitutions were being made when they should not have been.
	Protect the code from this.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Test for flock support in the following order:
		1) POSIX fcntl file locking
		2) flock locking
		3) lockf locking
	The common-src/flock.c file will only be used if the lockf type
	locking is needed on this system.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Have Samba support compile in only if requested by the user.
	Patch from Blair Zajac <blair@gps.caltech.edu>.

	Configure was not using $CFLAGS and $CPPFLAGS when trying to
	calculate the select argument type.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Updated amanda.h to include alloca.h if the system has it and
	if it's ok to include.  Also protect more include files with
	#ifdefs found by configure.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Linux does not use the raw device names to do backups.
	configure now checks to see if it can find a raw disk device
	file whose name is built from root's mount point.  If it can't,
	then set RDEV_PREFIX to use /dev/ instead of /dev/r.  Fix
	suggested by Brian <brian.s.mogged@uwrf.edu> and Ken Latta
	<latta@parc.xerox.com>.

	Fixed const cast message from regex.c.  Problem noted by Ken
	Laprade <klaprade@harris.com>.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Configure was not checking for the OSF1_VDUMP #ifdef used in
	Amanda.  It now will set OSF1_VDUMP if vdump is found on the
	system.  However, it does not check if the system is really a
	OSF system.  Patch from Blair Zajac <blair@gps.caltech.edu>.

	Have configure check for asm/byteorder.h for
	sparc-unknown-linux-gnu.  Problem noted by Eric Doutreleau
	<ed@cti.ecp.fr>.

	Remove the check for libintl.h from configure.  It was only
	being used for regex.c, which really didn't need it.  Patch
	from Blair Zajac <blair@gps.caltech.edu>.

	Convert all code to K&R C by trying to compile Amanda using
	/usr/bin/cc on a SunOS 4.1.1 machine.  Have configure check if
	the compiler can handle the volatile keyword and if it can't,
	#define it to empty in the config.h file.  Patch from Blair
	Zajac <blair@gps.caltech.edu>.

	Move the contents of versuff.h into version.h and remove
	versuff.h.  Add a new function called version() which returns
	the version string.  Use version() in some of the programs.
	Patch from Blair Zajac <blair@gps.caltech.edu>.

	m88k-motorola-sysv4 systems define L_FAIL, which is used by
	logfile.h.  Undefine it in logfile.h.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Include amindex-1.0 from Alan McIvor.  It includes these
	improvements over 0.3:
		Amrecover now provides the ability to restore files
		from the tapes, via the "extract" command.

		Support for gnutar based index generation (but not file
		restoration yet).

		Numerous bug fixes.

	Have amgetidx try to open a socket to the shell/tcp port on the
	remote machine and cache if it succeeds.  If it connection
	attempt succeeds, then attempt to get the index files over from
	the client.  Patch from Blair Zajac <blair@gps.caltech.edu>.

	Update patch-system to include the amidxtape service at
	10083/tcp.  Patch from Blair Zajac <blair@gps.caltech.edu>.

	Configure said that the server configuration was OK and then
	next said it wasn't.  Remove these checks.  Patch from Blair
	Zajac <blair@gps.caltech.edu>.

	Fixed building Amanda for multiple architectures in
	subdirectories of Amanda.  Problem noted by Thomas Hepper
	<Thomas.Hepper@icem.de>.

Version 2.3.0.4b1

	Fix a problem with `amadmin <conf> balance' dumping core.  If
	some disks are overdue, they are stored in the sequence array
	with a negative index.  This has the potential to cause memory
	corruption, and it makes the reported balance figures not add up
	to the same as the total.  Since overdue disks are really going
	to be candidated for today's backups, they are thrown in the
	bin for those.  Patch from Ken Laprade <klaprade@harris.com>.

	Add Samba client support using smbclient to Amanda.  Samba must
	be patched with the file patches/samba-1.9.16p2.1.patch - this
	is a patch for 1.9.16p2 of Samba, and modifies the way the
	'dir' command works, and adds totals to both the dir command
	and the tar command, via stderr.  These are used by amanda to
	estimate and count backup sizes.  This should be installed on
	an amanda 'client' host, that will act as the 'samba server'
	host.  This will most likely be the same machine as the Amanda
	master server.  Patches from Michael Zucchi
	<zucchi@cis.unisa.edu.au>.

	Amrmtape converted from Bash to Bourne shell.  Patch from Blair
	Zajac <blair@gps.caltech.edu>.

	Fix the indexing code to use "arglist.h" instead of <stdarg.h>
	Patch from Blair Zajac <blair@gps.caltech.edu>.

	Have amdump call amgetidx and amtrmidx.  Put amgetidx and
	amtrmidx into the libexec directory instead of the bin
	directory, since Amanda users will not use these by hand.
	Patch from Blair Zajac <blair@gps.caltech.edu>.

	Modified diskfile.c to match hostname in the backup header
	against the fully qualified domain name in disklist file,
	because amflush fails in a multidomain backup environment, as
	backup headers have only the hostname.  Patch from Karl
	Lehenbauer <karl@neosoft.com>.

	Have autoconf figure out if some functions are not declared and
	if they are not, then declare them.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Add security fixes to amandad.c.  It now checks the forward and
	reverse DNS names for consistency.  Added a configure option
	--amandahosts to use Michael's code to use .amandahosts instead
	of .rhosts.  Patch from Michael Douglass <mikedoug@texas.net>.

	Add amverify, a simple shell script to check Amanda tapes -
	gnutar driven backups only.  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	Add the version option to amadmin (eg amadmin <conf> version).
	Patch from Thomas Hepper <Thomas.Hepper@icem.de>.

	Add the current option to amtape (eg amtape <conf> current).
	This let's you the label of the current tape only without using
	dd.  Patch from Thomas Hepper <Thomas.Hepper@icem.de>.

	Gnutar support for amindex added.  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	Calcsize supports exclude-list (gtar).  The source was
	extracted from gnutar itself to be 100% compatible.  Patch from
	Thomas Hepper <Thomas.Hepper@icem.de>.

	Calcsize checks the file type and ignores special files and
	pipes.  Patch from Thomas Hepper <Thomas.Hepper@icem.de>.

	Calcsizes calculation for gnu tar archives had a bug (gtar file
	blocks always are a multiple of 2k).  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	`amandates.c': amdandad suffered by missing AMANDATES_FILE.
	Now it creates this file before missing it.  Patch from Thomas
	Hepper <Thomas.Hepper@icem.de>.

	`createindex-gnutar.c' added.  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	alloca(), strdup.c and getcwd added for those system who don't
	have them.  Patch from Thomas Hepper <Thomas.Hepper@icem.de>.

	A dirty hack for BSD based systems without sigaction(), see
	amanda.h.  Patch from Thomas Hepper <Thomas.Hepper@icem.de>.
 
	Add two scripts, hp-changer and no-changer. hp-changer is a
	tape changer script for a HP DAT changer. Every 10th tape a
	taper clean runs.  no-changer is a changer-like script for
	single tape streamer.  It makes Amanda see a tape changer unit
	with an infinite count of tapes (and requires an operator to
	change the tapes :-)). Every 10 tapes the operator is
	recommended to insert a cleaning tape.  Patch from Thomas
	Hepper <Thomas.Hepper@icem.de>.

	The version suffix adding is done with a seperate function
	versionsuffix() also available as standalone program.  Patch
	from Thomas Hepper <Thomas.Hepper@icem.de>.

	Several files got debug support. Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	Added an idle type file-too-large to driver.c to avoid dumping
	files to the holding disk(s) which exceed the maximum file size
	(2 GB on the most 32-bit machines).  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	Some minor bug fixes, mostly regarding missing or wrong casts
	confusing c compilers (shmat()/shmdt(), select()).  Patch from
	Thomas Hepper <Thomas.Hepper@icem.de>.

	Genversion gives some more information.  Patch from Thomas
	Hepper <Thomas.Hepper@icem.de>.

	getfsent.c and statfs.c have been cleaned up. The have to be
	checked on non-Irix/Solaris/NextStep/HPUX/AIX/Linux-systems.
	Patch from Thomas Hepper <Thomas.Hepper@icem.de>.

	Simple support if readline.a is missing.  NEVER TESTED!  Patch
	from Thomas Hepper <Thomas.Hepper@icem.de>.

	Linux requires libdb.a and ndbm.h to handle database files. Not
	really what I expected.  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.
 
	Here's a simple patch which fixes a problem that causes amflush
	to erroneously complain "ignoring cruft file" about good dump
	files on the holding disk, and fail to flush them to tape.
	This happens if your holding disk directory has a long name,
	and the dump file also has a long name (i.e. if you use
	filesystem mount points in disklist).  The problem occurs if
	the holding directory + filename exceeds 80 bytes.  The patch
	still leaves a length limitation, but at least it matches the
	size limit imposed by driver (and thus dumper & taper) of 128
	bytes.  Patch from Marion Hakanson <hakanson@cse.ogi.edu>.

	Use regex.h and regex.c from
	ftp://prep.ai.mit.edu/sh-utils-1.15.tar.gz instead of the regex
	checking code in the system.  This code includes re_comp and
	re_exec calls, so it will work on any system.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	Amadmin find reports the wrong tape file numbers after when a
	dump is amflush'ed to tape.  Patch by Ralf Fassel
	<ralf@atg.venture.de>.

	Fix a bug where dumps of disks on the Amanda server are counted
	against the available network bandwidth.  Patch from Marion
	Hakanson <hakanson@cse.ogi.edu>.

	Tell gnutar to not exit with a nonzero value if a read failed.
	This prevents backups from aborting if a file disappeared
	before gnutar could save it.  Patch from Hal Snyder
	<hal@vailsys.com>.

	Fix dumper which can cause the entire amdump run to hang after
	dumper issues a "TRY-AGAIN" message to driver while dumping
	directly to tape.  Patch from Marion Hakanson's
	<hakanson@cse.ogi.edu>.

	Added Marion Hakanson's <hakanson@cse.ogi.edu> patches to fix
	problems when amanda dumps directly to tape (i.e. when holding
	space is full, or you're backing up a huge filesystem, etc.).
	The bug occurs in the way taper determines it has succeeded
	when doing a PORT-WRITE operation (i.e. dumping directly to
	tape).  It used to assume that an EOF meant no more data --
	true if it's reading from a file, but when reading from a port
	(i.e. directly from a dump process), an EOF could signal
	abnormal exit as well as a normal one.  So, I extended the
	protocol between driver and taper when dumping directly to tape
	(see dump_to_tape() in driver.c) so the taper will wait for the
	driver to pass PORT-WRITE-SUCCESS or PORT-WRITE-FAILURE to the
	taper (since driver gets OK/not-OK from the dumper) before the
	taper records success or failure.  Note that this change
	affects only the PORT-WRITE case in taper.  FYI, the bug
	resulted in the curinfo database for a failed port-dump to have
	the tape-label & file-number fields updated with the location
	of the failed dump, even though the timestamp & dump statistics
	still have the values of the last successful dump (the latter
	fields are updated by dumper itself).

	Patches from George Scott <George.Scott@cc.monash.edu.au> to
	fix the following problems in planner.c.
	1) Initialise total_size, total_lev0 and balanced_size.  They
	are updated in analyze_estimates() but never initialised.  Zero
	them before the first call.
	2) Remove oversize dumps.   If there is a dump whose estimated
	size is larger than the tape the planner would tend to throw
	away all the other dumps and then probably generate an
	unworkable plan anyway.  (The standard 2.2.6 planner probably
	tossed these dumps fairly quickly for other reasons, but my
	next fix made this one almost mandatory!)  The fix is to drop
	these enormous dumps right at the begining.  This shouldn't be
	triggered for anyone with a sane configuration.
	3) Promote hills.  There are two ways to create a balanced
	cycle.  The first is to fill in any holes and the second is to
	remove any hills.  The original planner is good at doing the
	first but doesn't even attempt the second.  A quick look at
	"amadmin balance" would show big hills quite clearly.  This fix
	effectively does an "amadmin balance" and promotes a dump from
	one of the "hills".  This type of promotion is quite
	restricted:
	  - don't bother if we already plan to do any level 0 dumps
	  - don't promote a dump if it was going to be the only level 0
	    to be done on that run (ie, ignore hills that are only one
	    dump high)
	  - only promote one level 0 by this method
	  - don't exceed tape_length
	The key to it is the first restriction.  Large sites (with
	large numbers of disks and a large balanced_size) will have at
	least one level 0 scheduled for each day in the dump cycle and
	will already have a balanced cycle.  This code will not
	activate for them.  Small sites will probably not have a level
	0 scheduled and will benefit.  The second restriction will stop
	Amanda from constantly promoting dumps when the schedule is as
	balanced as it will go.  The third restriction will stop Amanda
	over reacting.  Promoting one dump by this method would take
	total_lev0 larger that balanced_size.  If it wouldn't then the
	first stage promotion didn't work like it should.
	4) Initialise got_estimate for all cases.  This fix was from
	der Mouse <mouse@collatz.mcrcim.mcgill.edu>.  "got_estimate"
	wasn't being initialised for skipped disks.  Later in the code
	it was being used in all cases.  The fix is to move its
	initialisation up a few lines.
	5) Explicitly ignore off-line disks.  If a disk is off-line
	when the planner is run it gets -1 for all dump sizes.  These
	were ignored at a later stage.  This fix explicitly ignores
	them up front.
	6) Ignore down machines.  If a machine is down when the planner
	is run it guesses from historical data what the size of
	tonights dump is likely to be and schedules a dump anyway.  The
	dumper then usually discovers that the machine is still down
	and ends up with a half full tape.  Unfortunately the planner
	had to delay another dump because it thought that the tape was
	full.  The fix here is for the planner to discard unavailable
	machines totally rather than just ignore the fact that they are
	unavailable.
	7) Keep at least one total.  Amanda moves level 0 dumps back to
	incrementals to try and fit everything onto the tape.
	Unfortunately if all your incrementals are too big (or your
	tape too small) it can move all of your level 0 dumps.  This
	ends up being a kind of deadlock since, unless a level 0 gets
	done, the incrementals will not reduce in size and until the
	incrementals reduce in size there will not be enough room to
	fit in a level 0.  (This is not quite accurate since a level 4
	dump can get bumped to a level 5 which reduces its size.
	However, this deadlock has happened to me and for many days in
	a row.)  The fix is to pick on the highest priority level 0 and
	not let it be moved.  This change will not affect users with
	reasonably sized tapes since Amanda would not have moved all
	their disks to incrementals.
	8) Make usage of total_lev0 consistent.  "total_lev0" is a
	double and doesn't include tape_mark's.  Make it so.

	Add a fflush(outf) to amcheck.c.  Patch from Mike Russell
	<Michael_Russell@Brown.EDU>.

	Fix problems with amhpfixdevs.  Patch from Michael Schmitz
	<mschmitz@iname.com>.

	Have DEC OSF1 use installbsd instead of install.  Patch from
	Rainer Landes <rlandes@fphws01.physik.uni-karlsruhe.de>.

	Have amcontrol take the first command line argument as the
	configuration to use.  If there are no command line arguments,
	then use daily.  Patch from Thomas Schmeidl
	<schmeidl@nwp.kwu.siemens.de>.

	Removed --atime-preserve from sendbackup-gnutar.c so that
	incremental backups of filesystems will work.  Patch from
	Alexandre Oliva <oliva@dcc.unicamp.br>.

	Change all #if __STDC__ to #ifdef __STDC__ for those systems
	that define __STDC__ to 0, such as Solaris using cc -Xt, cc
	-Xa.  Patch from Blair Zajac <blair@gps.caltech.edu>.

	Increase the socket buffer size, and set a low watter mark at
	32k.  This cut the number of syscalls done to process one 32k
	block from dozens down to 4 (select, read, lseek, write).
	Patch from Brad Huntting <huntting@glarp.com>.

	Include amindex-0.3 from Alan McIvor <alan@salan.auck.irl.cri.nz>.

	Add the "srvcompress" option to compress dumps on the tape host
	instead of on the client machines.  This may be useful when a
	fast tape host is backing up slow clients.  The patches add a
	dump-type option, analogous to "compress-fast" or
	"compress-best" - the way to use it is to create a new dumptype
	in your amanda.conf that includes "srvcompress" and use the new
	dumptype for those filesystems you wish to have compressed on
	the tape server. For example, in amanda.conf:
	    define dumptype srvcomp-user {
	    comment "Partitions on slow machines, compressed on tapehost"
	    options srvcompress
	    priority medium
	}
	Patches from Eric Volpe <epv@panix.com>.

	Increase the planner timeout for one estimate from 30 seconds
	to 120 seconds.  Patch from Michael Schmitz
	<mschmitz@iname.com>.

	The select(2) prototype on HPUX specifies 'int' as argument
	type of the filedescriptor arguments. All other systems I know
	of use 'fd_set'. This has been fixed by having configure check
	the argument type to select and adding casts to the select(2)
	calls.  Patch from Michael Schmitz  <mschmitz@iname.com>.

	Improve the diagnostic output and increase the robustness of
	the system by adding better error checking on communication
	between taper & driver, and among the two taper processes.
	Patches from Marion Hakanson <hakanson@cse.ogi.edu>.

	Convert all flock() calls to use POSIX-style locks via the
	fcntl(2) call.  This operation was prompted by the fact that
	the flock() emulation in the Amanda-provided common-src/flock.c
	was broken for read-only file descriptors, and the fcntl(2)
	locks are widely available.  This patch makes it possible to
	have a read-only lock on the /etc/amandates file on systems
	which want to use it.  I've built and tested the patched code
	on Amanda servers running on Digital Unix v3.2B (on Alpha
	hardware) and on SPARC Solaris-2.5.1.  It's also been compiled
	here on SPARC's running SunOS-4.1.3u1b, HP-UX 9.0[345], and
	NeXTstep-3.3 (NeXT hardware).  Note that the patches also
	remove all trace of the NEED_FLOCK define, and I have removed
	the file common-src/flock.c from our source tree here.  Patch
	from Marion Hakanson <hakanson@cse.ogi.edu>.

	For disk/filesystem names which are wider than 14 characters,
	have reporter print out the rightmost characters of the disk
	name, which is usually more meaningful in a daily backup
	summary.  Patch from Marion Hakanson <hakanson@cse.ogi.edu>.

	Lets amflush work in a wider variety of cases than was
	previously true (it used to work if the disklist contains only
	the first token of each hostname).  sendbackup-dump.c and
	sendbackup-gnutar.c now do not trim the domain name from the
	host name that is sent back to the server.  amflush now looks
	for an exact match, in the database.  If it can't find one it
	strips the last token off the dump header hostname and keeps
	trying until it finds a match in the disklist or runs out of
	tokens.  This also has the advantage that if gethostname()
	returns FQDNs and you specify the same FQDNs in the disklist,
	then amflush will always work.  It will also work as long as
	the disklist and gethostname() on the clients return enough
	information to be unambiguous.  Patch from James Mathiesen
	<james@deshaw.com>.

	Increase the READ_TIMEOUT in dumper.c to 30 minutes.  This
	needs to be longer than the longest amount of time dump will
	not produce output.  People have observed dumps taking more
	than 10 minutes to finish mapping some of the passes
	sometimes.  Patch from James Mathiesen <james@deshaw.com>.
	
	Added Adrian T. Filipi-Martin's <atf3r@cs.virginia.edu>
	amrmtape script, which allows you to invalidate the contents of
	an existing backup tape within the Amanda current tape
	database.  This is meant as a recovery mecanism for when a good
	backup is damaged either by faulty hardware or user error,
	i.e.  the tape is eaten by the tape drive, or the tape has been
	overwritten.  Blair Zajac wrote a quick little manual page for
	this script.

	amrmtape was using the return value from amadmin and amadmin
	was exiting with a non-zero value, causing amrmtape to quit.
	Added a return 0 statement to amadmin.c.  Patch from Blair
	Zajac <blair@gps.caltech.edu>.

	Went through all of the files and changed void main()'s to int
	main()'s.  Patch from Blair Zajac <blair@gps.caltech.edu>.

	Removed the 50 tape file limit in amcleanup and amdump.

	createindex-dump and sendbackup-dump did not always take into
	account the version suffix.  This is now handled.  Patch from
	Philippe Charnier <charnier@lirmm.fr>

	Compile and install amrecover and amrestore as client programs,
	not a server program.  The motovation for this is that
	amrecover is truly a program for all of the users on the
	system, while the remaining amanda programs could be used by
	only the system administrator.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	The program amtrmidx fails to close some of the pipes it uses,
	and this can lead to failure on systems with large numbers of
	disks with incomplete database sets, and file descriptor
	ulimits set.  Patch from Alan McIvor <alan@auck.irl.cri.nz>.

Version 2.3.0.3

	Expanded the width of the DISK column from the reporter
	output.  I like to use mount points like /export/home?? instead
	of device names to back up.  Since the width of the disk name
	field from reporter's output is pretty small, I couldn't easily
	figure out the statistics for a particular partition.  Patch
	from Blair Zajac <blair@gps.caltech.edu>.

	Included Eric Doutreleau <ed@cti.ecp.fr> patch's for amadmin to
	handle multiple tapes better.  The patch that he posted on used
	a hardwired value of 6 for runtapes, which I changed.

	Included Marion Hakanson's <hakanson@cse.ogi.edu> patches to
	amadmin.c and amadmin.8 to let amadmin use the same disk
	regular expression matching as amrestore.  So now "^/$" will
	match only the root partition, not all of the disks.

	Added a patch from George.Scott@cc.monash.edu.au which makes
	new disks and forces dump with a higher priority.

	Changed tools/munge to delete blank lines and the commented
	lines that the C preprocessor generates (i.e. # 123).  We also
	remove the space after the = sign that can be generated by cpp
	on some systems.

	Installed amindex-0.2 from Alan McIvor <alan@auck.irl.cri.nz>
	with the following patches:

		Fix problem so that rsh'ing on a hpux host works.
		Patch from Neal Becker <neal@ctd.comsat.com>.  This
		patch includes a new #define for RSH_COMMAND, which is
		set to rsh in config-common.h and defined as remsh in
		config.h-hpux.

		Fix bugs in createindex-dump.c when comparing errno to
		EINTR.  The code was using = instead of ==.  Patch from
		Neal Becker <neal@ctd.comsat.com>.  I'm guessing this
		might fix some of the runaway createindex-dump
		processes that I have seen on my system.

		On my system, we use MAE which likes to generate path
		names with spaces in them.  I patched
		createindex-dump.c so that filenames with spaces have
		the whole filename listed.  Patch from Blair Zajac
		<blair@gps.caltech.edu>.

		Patch amtrmidx.c so that backups using the mount points
		for disks instead of the device name have the /'s
		replaced with _'s.  Patch from Blair Zajac
		<blair@gps.caltech.edu>.

Version 2.3.0.2

	Changed the signals being sent to xfsdump for Irix so that it
	will be killed without dumping a core.

	Fixed a typo in the definition of XFSDUMP in config.h-irix.

	Removed the extra option.s-* and copied options.h to
	options.h-vanilla.

	Moved the amrestore manual page into the man directory so it
	would get installed.

Version 2.3.0.1

	amindex-0.1 written by Alan McIvor <alan@kauri.auck.irl.cri.nz>
	installed.  amindex generates an index of all of the files that
	were dumped.  It is nice to see what files were dumped before
	you restore a whole bunch of tapes looking for a file.  I
	patched some of this code.  Here are some of the changes:

		Switched the Imakefile to Makefile and Makefile.in to
		be more consistent with the system used by the rest of
		amanda.

		Moved the configuration #defines out of the specific
		files (such as amrecover.c) into options.h, so that
		people installing this version of amanda would be able
		to see the required changes more easily and not have to
		edit multiple files.

		Made some changes to the codes to remove #include's
		where amanda.h would include them and also check if the
		system had the particular include file.

		Added code to set_commands.c and amgetidx.c to change
		/'s in disk names to _'s.

		Added code to amrecover.c to properly compile on
		Solaris hosts.

		With the -Xc compiler option on Solaris and with
		amindex, the sigaction structure was not being
		declared.  Added -D__EXTENSIONS__ to config.h-sunos5 so
		that sigaction would be declared.

		I changed a bunch of fprintf to perrors.

	Include Sean Kelly's <kelly@fsl.noaa.gov> patch for tools/munge
	for FreeBSD-2.1.5.

	Used Peter Lackner's <plo@came.sbg.ac.at> patches for DU 4.0.

	Installed Ken Laprade's <klaprade@harris.com> patches for
	amanda to handle both EFS and XFs file systems on the same
	client.  The only change from his patch is to #ifdef XFSDUMP
	the kill(-dumppid, SIGTERM) so the SIGTERM signal will be used
	on other systems, while SIGQUIT will be used on Irix systems.

	Installed Marion Hakanson's <hakanson@cse.ogi.edu> patches for
	the main config file to include subsidiary config files.

	On Solaris, sometimes the hdr->handle variable in amandad.c
	would be null, causing core dumps when it was used in a sprintf
	statement.  The code now checks if hdr->handle is null and
	prints a "" if it is null.  This was only done in amandad.c.

	Fix a problem where new disks would be added but not backed up
	concurrently.  Changes to diskfile.c.  I forgot who put this
	patch up on the mailing list.

	I made some changes to options.h to allow the user to more
	easily install the programs under a different user.  This meant
	defining two new #defines, MK_AMANDA_USER and
	MK_QUOTED_AMANDA_USER which are used in the appropriate
	Makefiles.

	Used Marion Hakanson's <hakanson@cse.ogi.edu> patch for taper.c
	for multiple tapes.

	Included Joachim Loehr's <Joachim.Loeh@stadt-mh.de>
	script to automatically figure out which kind of HP-UX file
	system is being dumped.  Look in tools for the script and a
	README.

Local Variables:
mode: change-log
left-margin: 8
fill-column: 76
End:

.\"
.de EX
.if t .ft C
.nf
..
.de EE
.fi
.if t .ft
..
.TH AMFLUSH 8
.SH NAME
amflush \- flush Amanda backup files from holding disk to tape
.SH SYNOPSIS
.B amflush
[
.B -b
] [
.B -f
] [
.B -s
] [
.B -D
.I datestamp
]*
.I config
[
.I host
[
.I disk
]*
]*
.SH DESCRIPTION
.B Amflush
writes Amanda backups from the holding disks to tape,
and updates the Amanda info database and tape list accordingly.
Backups may stay in a holding disk when something is wrong with the tape
at the time
.B amdump
is run.
When this happens, the problem must be corrected and
.B amflush
run by hand.
.SH OPTIONS
.TP
.B \-b
Run
.B amflush
in batch mode. All datestamp are selected unless specified.
The flush is started without confirmation.
.TP
.B \-f
Run
.B amflush
in foreground.
.B Amflush
normally detaches itself from the tty and runs as a background process.
With the
.B -f
option,
.B amflush
stays in the foreground.
This is useful if
.B amflush
is run as part of another script that, for example, advances the tape
after the flush is completed.
.TP
.B \-s
Write log to stdout/stderr instead of the amflush log file. Require the
.B \-f
option.
.TP
.B \-D datestamp
specify a  datestamp expression you want to flush, see the 
"DATASTAMP EXPRESSION" section of
.IR amanda (8)
for a description.
.B -D 20001225-7
will flush all
dump from 25 december 2000 to 27 december 2000.
.LP
You can specify many host/disk expressions, only disks that
match an expression will be flushed. All disk are flushed if no
expression are given. see the "HOST & DISK EXPRESSION" section of
.IR amanda (8)
for a description.
.PP
.B Amflush
will look in the holding disks specified by the
.I amanda.conf
file in @CONFIG_DIR@/\fIconfig\fR
for any non-empty Amanda work directories.
It then prompts you to select a directory
or to process all of the directories.
The work directories in the holding disks are named by the date at the time
.B amdump
was run, e.g.\&
.IR 19910215 .
.PP
.LP
See the
.IR amanda (8)
man page for more details about Amanda.
.SH EXAMPLE
.B Amflush
will search for holding areas associated with the
.I PUCC
configuration.
After you select which holding area to flush,
.B amflush
writes the data to tape, updates the databases and sends
a mail report similar to
.IR amdump (8).
.LP
.RS
.EX
% amflush @DEFAULT_CONFIG@
Scanning /amanda-hold...
  20001113: found Amanda directory.
  20001114: found Amanda directory.

Multiple Amanda directories, please pick one by letter:
  A. 20001113
  B. 20001114
Select directories to flush [A..B]: [ALL] all

Flushing dumps in 20001113, 20001114,
today: 20001117
to tape drive /dev/rmt/0mn.
Expecting tape DMP014 or a new tape.  (The last dumps were to tape DMP013)
Are you sure you want to do this? yes
Running in background, you can log off now.
You'll get mail when amflush is finished.
.EE
.RE
.SH AUTHOR
James da Silva <jds@cs.umd.edu>
.br
University of Maryland, College Park
.SH "SEE ALSO"
amanda(8),
amdump(8)

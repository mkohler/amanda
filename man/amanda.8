.\"Generated by db2man.xsl. Don't modify this, modify the source.
.de Sh \" Subsection
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Ip \" List item
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.TH "AMANDA" 8 "" "" ""
.SH NAME
amanda \- Advanced Maryland Automatic Network Disk Archiver
.SH "SYNOPSIS"
.ad l
.hy 0
.HP 7
\fBamdump\fR \fIconfig\fR
.ad
.hy
.ad l
.hy 0
.HP 8
\fBamflush\fR [\-f] \fIconfig\fR
.ad
.hy
.ad l
.hy 0
.HP 10
\fBamcleanup\fR \fIconfig\fR
.ad
.hy
.ad l
.hy 0
.HP 10
\fBamrecover\fR [\fIconfig\fR] [\fIoptions\fR]
.ad
.hy
.ad l
.hy 0
.HP 10
\fBamrestore\fR [\fIoptions\fR] \fItapedevice\fR [\fIhostname\fR\ [\fIdiskname\fR]]
.ad
.hy
.ad l
.hy 0
.HP 8
\fBamlabel\fR \fIconfig\fR \fIlabel\fR [\fIslot\fR\ \fIslot\fR]
.ad
.hy
.ad l
.hy 0
.HP 8
\fBamcheck\fR [\fIoptions\fR] \fIconfig\fR
.ad
.hy
.ad l
.hy 0
.HP 8
\fBamadmin\fR \fIconfig\fR \fIcommand\fR [\fIoptions\fR]
.ad
.hy
.ad l
.hy 0
.HP 7
\fBamtape\fR \fIconfig\fR \fIcommand\fR [\fIoptions\fR]
.ad
.hy
.ad l
.hy 0
.HP 9
\fBamverify\fR \fIconfig\fR
.ad
.hy
.ad l
.hy 0
.HP 9
\fBamrmtape\fR [\fIoptions\fR] \fIconfig\fR \fIlabel\fR
.ad
.hy
.ad l
.hy 0
.HP 9
\fBamstatus\fR \fIconfig\fR [\fIoptions\fR]
.ad
.hy
.ad l
.hy 0
.HP 11
\fBamoverview\fR \fIconfig\fR [\fIoptions\fR]
.ad
.hy
.ad l
.hy 0
.HP 7
\fBamplot\fR [\fIoptions\fR] \fIamdump\-files\fR
.ad
.hy
.ad l
.hy 0
.HP 9
\fBamreport\fR [\fIconfig\fR] [\fIoptions\fR]
.ad
.hy
.ad l
.hy 0
.HP 6
\fBamtoc\fR [\fIoptions\fR] \fIlogfile\fR
.ad
.hy
.ad l
.hy 0
.HP 10
\fBamcheckdb\fR \fIconfig\fR
.ad
.hy
.ad l
.hy 0
.HP 10
\fBamgetconf\fR [\fIconfig\fR] \fIparameter\fR
.ad
.hy

.SH "DESCRIPTION"

.PP
\fBAMANDA\fR is the ``\fBAdvanced Maryland Automatic Network Disk Archiver\fR''\&. This manual page gives an overview of the \fBAMANDA\fR commands and configuration files for quick reference\&.

.PP
Here are all the \fBAMANDA\fR commands\&. Each one has its own manual page\&. See them for all the gory details\&.

.TP
\fBamdump\fR
Take care of automatic \fBAMANDA\fR backups\&. This is normally executed by \fBcron\fR on a computer called the \fBtape server host\fR and requests backups of file systems located on \fBbackup\fR  \fBclients\fR\&. \fBAmdump\fR backs up all disks in the \fBdisklist\fR file (discussed below) to tape or, if there is a problem, to a special \fBholding\fR  \fBdisk\fR\&. After all backups are done, \fBamdump\fR sends mail reporting failures and successes\&.

.TP
\fBamflush\fR
Flush backups from the holding disk to tape\&. \fBAmflush\fR is used after \fBamdump\fR has reported it could not write backups to tape for some reason\&. When this happens, backups stay in the holding disk\&. Run \fBamflush\fR after the tape problem is corrected to write backups from the holding disk to tape\&.

.TP
\fBamcleanup\fR
Clean up after an interrupted \fBamdump\fR\&. This command is only needed if \fBamdump\fR was unable to complete for some reason, usually because the tape server host crashed while \fBamdump\fR was running\&.

.TP
\fBamrecover\fR
Provides an interactive interface to browse the \fBAMANDA\fR index files (backup image catalogues) and select which tapes to recover files from\&. It can also run \fBamrestore\fR and a restore program (e\&.g\&. \fBtar\fR) to actually recover the files\&.

.TP
\fBamrestore\fR
Read an \fBAMANDA\fR tape, searching for requested backups\&. \fBAmrestore\fR is suitable for everything from interactive restores of single files to a full restore of all partitions on a failed disk\&.

.TP
\fBamlabel\fR
Write an \fBAMANDA\fR format label onto a tape\&. All \fBAMANDA\fR tapes must be labeled with \fBamlabel\fR\&. \fBAmdump\fR and \fBamflush\fR will not write to an unlabeled tape (see TAPE MANAGEMENT below)\&.

.TP
\fBamcheck\fR
Verify the correct tape is mounted and all file systems on all backup client systems are ready to be backed up\&. Often run by \fBcron\fR before \fBamdump\fR to generate a mail warning that backups might fail unless corrective action is taken\&.

.TP
\fBamadmin\fR
Take care of administrative tasks like finding out which tapes are needed to restore a filesystem, forcing hosts to do full backups of selected disks and looking at schedule balance information\&.

.TP
\fBamtape\fR
Take care of tape changer control operations like loading particular tapes, ejecting tapes and scanning the tape storage slots\&.

.TP
\fBamverify\fR
Check \fBAMANDA\fR backup tapes for errors\&.

.TP
\fBamrmtape\fR
Delete a tape from the \fBAMANDA\fR databases\&.

.TP
\fBamstatus\fR
Report the status of a running or completed \fBamdump\fR\&.

.TP
\fBamoverview\fR
Display a chart of hosts and file systems backed up every run\&.

.TP
\fBamplot\fR
Generate utilization plots of \fBAMANDA\fR runs for performance tuning\&.

.TP
\fBamreport\fR
Generate an \fBAMANDA\fR summary E\-mail report\&.

.TP
\fBamtoc\fR
Generate table of content files for \fBAMANDA\fR tapes\&.

.TP
\fBamcheckdb\fR
Verify every tape \fBAMANDA\fR knows about is consistent in the database\&.

.TP
\fBamgetconf\fR
Look up parameters in the \fBAMANDA\fR configuration file\&.

.SH "CONFIGURATION"

.PP
There are three user\-editable files that control the behavior of \fBAMANDA\fR\&. The first is \fBamanda\&.conf\fR, the main configuration file\&. It contains parameters to customize \fBAMANDA\fR for the site\&. Second is the \fBdisklist\fR file, which lists hosts and disk partitions to back up\&. Third is the \fBtapelist\fR file, which lists tapes that are currently active\&. These files are described in more detail in the following sections\&.

.PP
All files are stored in individual configuration directories under \fI/usr/local/etc/amanda/\fR\&. A site will often have more than one configuration\&. For example, it might have a \fBnormal\fR configuration for everyday backups and an \fBarchive\fR configuration for infrequent full archival backups\&. The configuration files would be stored under directories \fI/usr/local/etc/amanda/normal/\fR and \fI/usr/local/etc/amanda/archive/\fR, respectively\&. Part of the job of an \fBAMANDA\fR administrator is to create, populate and maintain these directories\&.

.PP
All log and database files generated by \fBAMANDA\fR go in corresponding directories somewhere\&. The exact location is controlled by entries in \fBamanda\&.conf\fR\&. A typical location would be under \fI/var/adm/amanda\fR\&. For the above example, the files might go in \fI/var/adm/amanda/normal/\fR and \fI/var/adm/amanda/archive/\fR\&.

.PP
As log files are no longer needed (no longer contain relevant information), \fBAMANDA\fR cycles them out in various ways, depending on the type of file\&.

.PP
Detailed information about \fBamdump\fR runs are stored in files named \fBamdump\&.\fR\fBNN\fR where \fBNN\fR is a sequence number, with 1 being the most recent file\&. \fBAmdump\fR rotates these files each run, keeping roughly the last \fBtapecycle\fR (see below) worth of them\&.

.PP
The file used by \fBamreport\fR to generate the mail summary is named \fBlog\&.\fR\fBYYYYMMDD\&.NN\fR where \fBYYYYMMDD\fR is the datestamp of the start of the \fBamdump\fR run and \fBNN\fR is a sequence number started at 0\&. At the end of each \fBamdump\fR run, log files for runs whose tapes have been reused are renamed into a subdirectory of the main log directory (see the \fBlogdir\fR parameter below) named \fBoldlog\fR\&. It is up to the \fBAMANDA\fR administrator to remove them from this directory when desired\&.

.PP
Index (backup image catalogue) files older than the full dump matching the oldest backup image for a given client and disk are removed by \fBamdump\fR at the end of each run\&.

.SH "CONFIG FILE PARAMETERS"

.PP
There are a number of configuration parameters that control the behavior of the \fBAMANDA\fR programs\&. All have default values, so you need not specify the parameter in \fBamanda\&.conf\fR if the default is suitable\&.

.PP
Lines starting with # are ignored, as are blank lines\&. Comments may be placed on a line with a directive by starting the comment with a #\&. The remainder of the line is ignored\&.

.PP
Keywords are case insensitive, i\&.e\&. \fBmailto\fR and \fBMailTo\fR are treated the same\&.

.PP
Integer arguments may have one of the following (case insensitive) suffixes, some of which have a multiplier effect:

.TP
\fBb byte bytes\fR
Some number of bytes\&.

.TP
\fBbps\fR
Some number of bytes per second\&.

.TP
\fBk kb kbyte kbytes kilobyte kilobytes\fR
Some number of kilobytes (bytes*1024)\&.

.TP
\fBkps kbps\fR
Some number of kilobytes per second (bytes*1024)\&.

.TP
\fBm mb meg mbyte mbytes megabyte megabytes\fR
Some number of megabytes (bytes*1024*1024)\&.

.TP
\fBmps mbps\fR
Some number of megabytes per second (bytes*1024*1024)\&.

.TP
\fBg gb gbyte gbytes gigabyte gigabytes\fR
Some number of gigabytes (bytes*1024*1024*1024)\&.

.TP
\fBtape tapes\fR
Some number of tapes\&.

.TP
\fBday days\fR
Some number of days\&.

.TP
\fBweek weeks\fR
Some number of weeks (days*7)\&.

 .RS .Sh "Note" The value \fBinf\fR may be used in most places where an integer is expected to mean an infinite amount\&. Boolean arguments may have any of the values \fBy\fR, \fByes\fR, \fBt\fR, \fBtrue\fR or \fBon\fR to indicate a true state, or \fBn\fR, \fBno\fR, \fBf\fR, \fBfalse\fR or \fBoff\fR to indicate a false state\&. If no argument is given, \fBtrue\fR is assumed\&. .RE 

.TP
\fBorg\fR \fB string\fR
Default: \fBdaily\fR\&. A descriptive name for the configuration\&. This string appears in the Subject line of mail reports\&. Each \fBAMANDA\fR configuration should have a different string to keep mail reports distinct\&.

.TP
\fBmailto\fR \fB string\fR
Default: \fBoperators\fR\&. A space separated list of recipients for mail reports\&.

.TP
\fBdumpcycle\fR \fB int\fR
Default: \fB10 days\fR\&. The number of days in the backup cycle\&. Each disk will get a full backup at least this often\&. Setting this to zero tries to do a full backup each run\&.

 .RS .Sh "Note" This parameter may also be set in a specific \fBdumptype\fR (see below)\&. This value sets the default for all \fBdumptype\fRs so must appear in \fBamanda\&.conf\fR before any \fBdumptype\fRs are defined\&. .RE 

.TP
\fBrunspercycle\fR \fB int\fR
Default: \fBsame as dumpcycle\fR\&. The number of amdump runs in \fBdumpcycle\fR days\&. A value of 0 means the same value as \fBdumpcycle\fR\&. A value of \-1 means guess the number of runs from the \fBtapelist\fR file, which is the number of tapes used in the last \fBdumpcycle\fR days / \fBruntapes\fR\&.

.TP
\fBtapecycle\fR \fB int\fR
Default: \fB15 tapes\fR\&. Typically tapes are used by \fBAMANDA\fR in an ordered rotation\&. The \fBtapecycle\fR parameter defines the size of that rotation\&. The number of tapes in rotation must be larger than the number of tapes required for a complete dump cycle (see the \fBdumpcycle\fR parameter)\&.

This is calculated by multiplying the number of \fBamdump\fR runs per dump cycle (\fBrunspercycle\fR parameter) times the number of tapes used per run (\fBruntapes\fR parameter)\&. Typically two to four times this calculated number of tapes are in rotation\&. While \fBAMANDA\fR is always willing to use a new tape in its rotation, it refuses to reuse a tape until at least '\fBtapecycle\fR \-1' number of other tapes have been used\&.

It is considered good administrative practice to set the \fBtapecycle\fR parameter slightly lower than the actual number of tapes in rotation\&. This allows the administrator to more easily cope with damaged or misplaced tapes or schedule adjustments that call for slight adjustments in the rotation order\&.

.TP
\fBdumpuser\fR \fB string\fR
Default: \fBamanda\fR\&. The login name \fBAMANDA\fR uses to run the backups\&. The backup client hosts must allow access from the tape server host as this user via \&.rhosts or \&.amandahosts, depending on how the \fBAMANDA\fR software was built\&.

.TP
\fBprinter\fR string
Printer to use when doing tape labels\&. See the \fBlbl\-templ\fR  \fBtapetype\fR option\&.

.TP
\fBtapedev\fR string
Default: \fI/dev/nst0\fR\&. The path name of the non\-rewinding tape device\&. Non\-rewinding tape device names often have an 'n' in the name, e\&.g\&. \fI/dev/rmt/0mn\fR, however this is operating system specific and you should consult that documentation for detailed naming information\&.

If a tape changer is configured (see the \fBtpchanger\fR option), this option might not be used\&.

If the \fBnull\fR output driver is selected (see the OUTPUT DRIVERS section later for more information), programs such as \fBamdump\fR will run normally but all images will be thrown away\&. This should only be used for debugging and testing, and probably only with the \fBrecord\fR option set to \fBno\fR\&.

.TP
\fBrawtapedev\fR string
Default: \fI/dev/null\fR\&. The path name of the raw tape device\&. This is only used if \fBAMANDA\fR is compiled for Linux machines with floppy tapes and is needed for QIC volume table operations\&.

.TP
\fBtpchanger\fR string
Default: \fBnone\fR\&. The name of the tape changer\&. If a tape changer is not configured, this option is not used and should be commented out of the configuration file\&.

If a tape changer is configured, choose one of the changer scripts (e\&.g\&. \fBchg\-scsi\fR) and enter that here\&.

.TP
\fBchangerdev\fR string
Default: \fI/dev/null\fR\&. A tape changer configuration parameter\&. Usage depends on the particular changer defined with the \fBtpchanger\fR option\&.

.TP
\fBchangerfile\fR string
Default: \fI/usr/adm/amanda/log/changer\-status\fR\&. A tape changer configuration parameter\&. Usage depends on the particular changer defined with the \fBtpchanger\fR option\&.

.TP
\fBruntapes\fR int
Default: 1\&. The maximum number of tapes used in a single run\&. If a tape changer is not configured, this option is not used and should be commented out of the configuration file\&.

If a tape changer is configured, this may be set larger than one to let \fBAMANDA\fR write to more than one tape\&.

Note that this is an upper bound on the number of tapes, and \fBAMANDA\fR may use less\&.

Also note that as of this release, \fBAMANDA\fR does not support true tape overflow\&. When it reaches the end of one tape, the backup image \fBAMANDA\fR was processing starts over again on the next tape\&.

.TP
\fBmaxdumpsize\fR int
Default: \fBruntapes\fR*\fBtape_length\fR\&. Maximum number of bytes the planner will schedule for a run\&.

.TP
\fBtaperalgo\fR [first|firstfit|largest|largestfit|smallest|last]
Default: \fBfirst\fR\&. The algorithm used to choose which dump image to send to the taper\&.

.RS

.TP
\fBfirst\fR
First in, first out\&.

.TP
\fBfirstfit\fR
The first dump image that will fit on the current tape\&.

.TP
\fBlargest\fR
The largest dump image\&.

.TP
\fBlargestfit\fR
The largest dump image that will fit on the current tape\&.

.TP
\fBsmallest\fR
The smallest dump image\&.

.TP
\fBlast\fR
Last in, first out\&.

.RE
.IP

.TP
\fBlabelstr\fR \fB string\fR
Default: \fB\&.*\fR\&. The tape label constraint regular expression\&. All tape labels generated (see \fBamlabel(8)\fR) and used by this configuration must match the regular expression\&. If multiple configurations are run from the same tape server host, it is helpful to set their labels to different strings (for example, ``\fBDAILY[0\-9][0\-9]*\fR'' vs\&. ``\fBARCHIVE[0\-9][0\-9]*\fR'') to avoid overwriting each other's tapes\&.

.TP
\fBtapetype\fR \fB string\fR
Default: \fBEXABYTE\fR\&. The type of tape drive associated with \fBtapedev\fR or \fBtpchanger\fR\&. This refers to one of the defined \fBtapetype\fRs in the config file (see below), which specify various tape parameters, like the \fBlength\fR, \fBfilemark\fR size, and \fBspeed\fR of the tape media and device\&.

.TP
\fBctimeout\fR int
Default: \fB30 seconds\fR\&. Maximum amount of time that \fBamcheck\fR will wait for each client host\&.

.TP
\fBdtimeout\fR int
Default: \fB1800 seconds\fR\&. Amount of idle time per disk on a given client that a \fBdumper\fR running from within \fBamdump\fR will wait before it fails with a data timeout error\&.

.TP
\fBetimeout\fR int
Default: \fB300 seconds\fR\&. Amount of time per disk on a given client that the \fBplanner\fR step of \fBamdump\fR will wait to get the dump size estimates\&. For instance, with the default of 300 seconds and four disks on client A, \fBplanner\fR will wait up to 20 minutes for that machine\&. A negative value will be interpreted as a total amount of time to wait per client instead of per disk\&.

.TP
\fBnetusage\fR int
Default: \fB300 Kbps\fR\&. The maximum network bandwidth allocated to \fBAMANDA\fR, in Kbytes per second\&. See also the \fBinterface\fR section\&.

.TP
\fBinparallel\fR int
Default: 10\&. The maximum number of backups that \fBAMANDA\fR will attempt to run in parallel\&. \fBAMANDA\fR will stay within the constraints of network bandwidth and holding disk space available, so it doesn't hurt to set this number a bit high\&. Some contention can occur with larger numbers of backups, but this effect is relatively small on most systems\&.

.TP
\fBdisplayunit\fR "k|m|g|t"
Default: "k"\&. The unit used to print many numbers, k=kilo, m=mega, g=giga, t=tera\&.

.TP
\fBdumporder\fR string
Default: \fBtttTTTTTTT\fR\&. The priority order of each dumper:

.RS
.TP 3
\(bu
s: smallest size
.TP
\(bu
S: largest size
.TP
\(bu
t: smallest time
.TP
\(bu
T: largest time
.TP
\(bu
b: smallest bandwidth
.TP
\(bu
B: largest bandwidth
.LP
.RE
.IP

.TP
\fBmaxdumps\fR int
Default: 1\&. The maximum number of backups from a single host that \fBAMANDA\fR will attempt to run in parallel\&. See also the \fBinparallel\fR option\&.

Note that this parameter may also be set in a specific \fBdumptype\fR (see below)\&. This value sets the default for all \fBdumptype\fRs so must appear in \fBamanda\&.conf\fR before any \fBdumptype\fRs are defined\&.

.TP
\fBbumpsize\fR int
Default: \fB10 Mbytes\fR\&. The minimum savings required to trigger an automatic bump from one incremental level to the next\&. If \fBAMANDA\fR determines that the next higher backup level will be this much smaller than the current level, it will do the next level\&. See also the \fBbumpmult\fR option\&.

.TP
\fBbumpmult\fR \fB float\fR
Default: 1\&.5\&. The bump size multiplier\&. \fBAMANDA\fR multiplies \fBbumpsize\fR by this factor for each level\&. This prevents active filesystems from bumping too much by making it harder to bump to the next level\&. For example, with the default \fBbumpsize\fR and \fBbumpmult\fR set to 2\&.0, the bump threshold will be 10 Mbytes for level one, 20 Mbytes for level two, 40 Mbytes for level three, and so on\&.

.TP
\fBbumpdays\fR \fB int\fR
Default: \fB2 days\fR\&. To insure redundancy in the dumps, \fBAMANDA\fR keeps filesystems at the same incremental level for at least \fBbumpdays\fR days, even if the other bump threshold criteria are met\&.

.TP
\fBdiskfile\fR \fB string\fR
Default: \fBdisklist\fR\&. The file name for the \fBdisklist\fR file holding client hosts, disks and other client dumping information\&.

.TP
\fBinfofile\fR \fB string\fR
Default: \fI/usr/adm/amanda/curinfo\fR\&. The file or directory name for the historical information database\&. If \fBAMANDA\fR was configured to use DBM databases, this is the base file name for them\&. If it was configured to use text formated databases (the default), this is the base directory and within here will be a directory per client, then a directory per disk, then a text file of data\&.

.TP
\fBlogdir\fR \fB string\fR
Default: \fI/usr/adm/amanda\fR\&. The directory for the \fBamdump\fR and \fBlog\fR files\&.

.TP
\fBindexdir\fR \fB string\fR
Default \fI/usr/adm/amanda/index\fR\&. The directory where index files (backup image catalogues) are stored\&. Index files are only generated for filesystems whose \fBdumptype\fR has the \fBindex\fR option enabled\&.

.TP
\fBtapelist\fR \fB string\fR
Default: \fBtapelist\fR\&. The file name for the active \fBtapelist\fR file\&. \fBAMANDA\fR maintains this file with information about the active set of tapes\&.

.TP
\fBtapebufs\fR \fB int\fR
Default: 20\&. The number of buffers used by the \fBtaper\fR process run by \fBamdump\fR and \fBamflush\fR to hold data as it is read from the network or disk before it is written to tape\&. Each buffer is a little larger than 32 KBytes and is held in a shared memory region\&.

.TP
\fBreserve\fR \fB number\fR
Default: 100\&. The part of holding\-disk space that should be reserved for incremental backups if no tape is available, expressed as a percentage of the available holding\-disk space (0\-100)\&. By default, when there is no tape to write to, degraded mode (incremental) backups will be performed to the holding disk\&. If full backups should also be allowed in this case, the amount of holding disk space reserved for incrementals should be lowered\&.

.TP
\fBautoflush\fR \fB bool\fR
Default: \fBoff\fR\&. Whether an amdump run will flush the dump already on holding disk to tape\&.

.TP
\fBamrecover_do_fsf\fR \fB bool\fR
Default: \fBoff\fR\&. Amrecover will call amrestore with the \-f flag for faster positioning of the tape\&.

.TP
\fBamrecover_check_label\fR \fB bool\fR
Default: \fBoff\fR\&. Amrecover will call amrestore with the \-l flag to check the label\&.

.TP
\fBamrecover_changer\fR \fB string\fR
Default: ''\&. Amrecover will use the changer if you use 'settape <string>' and that string is the same as the amrecover_changer setting\&.

.TP
\fBcolumnspec\fR \fB string\fR
Defines the width of columns \fBamreport\fR should use\&. \fBString\fR is a comma (',') separated list of triples\&. Each triple consists of three parts which are separated by a equal sign ('=') and a colon (':') (see the example)\&. These three parts specify:


.RS
.TP 3
\(bu
the name of the column, which may be:

.RS
.TP 3
\(bu
Compress (compression ratio)
.TP
\(bu
Disk (client disk name)
.TP
\(bu
DumpRate (dump rate in KBytes/sec)
.TP
\(bu
DumpTime (total dump time in hours:minutes)
.TP
\(bu
HostName (client host name)
.TP
\(bu
Level (dump level)
.TP
\(bu
OrigKB (original image size in KBytes)
.TP
\(bu
OutKB (output image size in KBytes)
.TP
\(bu
TapeRate (tape writing rate in KBytes/sec)
.TP
\(bu
TapeTime (total tape time in hours:minutes)
.LP
.RE
.IP
.TP
\(bu
the amount of space to display before the column (used to get whitespace between columns)\&.
.TP
\(bu
the width of the column itself\&. If set to a negative value, the width will be calculated on demand to fit the largest entry in this column\&.
.LP
.RE
.IP
Here is an example:

.nf

columnspec "Disk=1:18,HostName=0:10,OutKB=1:7"
.fi
The above will display the disk information in 18 characters and put one space before it\&. The hostname column will be 10 characters wide with no space to the left\&. The output KBytes column is seven characters wide with one space before it\&.

.TP
\fBincludefile\fR \fB string\fR
Default: \fBnone\fR\&. The name of an \fBAMANDA\fR configuration file to include within the current file\&. Useful for sharing dumptypes, tapetypes and interface definitions among several configurations\&.

.SH "HOLDINGDISK SECTION"

.PP
The \fBamanda\&.conf\fR file may define one or more holding disks used as buffers to hold backup images before they are written to tape\&. The syntax is:
.nf

holdingdisk \fBname\fR {
    \fBholdingdisk\-option\fR \fBholdingdisk\-value\fR
    \&.\&.\&.
}
.fi

.PP
\fBName\fR is a logical name for this holding disk\&.

.PP
The options and values are:

.TP
\fBcomment\fR \fB string\fR
Default: \fBnone\fR\&. A comment string describing this holding disk\&.

.TP
\fBdirectory\fR \fB disk\fR
Default: \fI/dumps/amanda\fR\&. The path to this holding area\&.

.TP
\fBuse\fR \fB int\fR
Default: \fB0 Gb\fR\&. Amount of space that can be used in this holding disk area\&. If the value is zero, all available space on the file system is used\&. If the value is negative, \fBAMANDA\fR will use all available space minus that value\&.

.TP
\fBchunksize\fR \fB int\fR
Default: \fB1 Gb\fR\&. Holding disk chunk size\&. Dumps larger than the specified size will be stored in multiple holding disk files\&. The size of each chunk will not exceed the specified value\&. However, even though dump images are split in the holding disk, they are concatenated as they are written to tape, so each dump image still corresponds to a single continuous tape section\&.

If 0 is specified, \fBAMANDA\fR will create holding disk chunks as large as ((INT_MAX/1024)\-64) Kbytes\&.

Each holding disk chunk includes a 32 Kbyte header, so the minimum chunk size is 64 Kbytes (but that would be really silly)\&.

Operating systems that are limited to a maximum file size of 2 Gbytes actually cannot handle files that large\&. They must be at least one byte less than 2 Gbytes\&. Since \fBAMANDA\fR works with 32 Kbyte blocks, and to handle the final read at the end of the chunk, the chunk size should be at least 64 Kbytes (2 * 32 Kbytes) smaller than the maximum file size, e\&.g\&. 2047 Mbytes\&.

.SH "DUMPTYPE SECTION"

.PP
The \fBamanda\&.conf\fR file may define multiple sets of backup options and refer to them by name from the \fBdisklist\fR file\&. For instance, one set of options might be defined for file systems that can benefit from high compression, another set that does not compress well, another set for file systems that should always get a full backup and so on\&.

.PP
A set of backup options are entered in a \fBdumptype\fR section, which looks like this:
.nf

define dumptype \fBname\fR {
    \fBdumptype\-option\fR \fBdumptype\-value\fR
    \&.\&.\&.
}
.fi

.PP
\fBName\fR is the name of this set of backup options\&. It is referenced from the \fBdisklist\fR file\&.

.PP
Some of the options in a \fBdumptype\fR section are the same as those in the main part of \fBamanda\&.conf\fR\&. The main option value is used to set the default for all \fBdumptype\fR sections\&. For instance, setting \fBdumpcycle\fR to 50 in the main part of the config file causes all following \fBdumptype\fR sections to start with that value, but the value may be changed on a section by section basis\&. Changes to variables in the main part of the config file must be done before (earlier in the file) any \fBdumptype\fRs are defined\&.

.PP
The dumptype options and values are:

.TP
\fBauth\fR \fB string\fR
Default: \fBbsd\fR\&. Type of authorization to perform between tape server and backup client hosts\&. May be \fBkrb4\fR to use Kerberos\-IV authorization\&.

.TP
\fBcomment\fR \fB string\fR
Default: \fBnone\fR\&. A comment string describing this set of backup options\&.

.TP
\fBcomprate\fR \fBfloat\fR [, \fBfloat\fR ]
Default: 0\&.50, 0\&.50\&. The expected full and incremental compression factor for dumps\&. It is only used if \fBAMANDA\fR does not have any history information on compression rates for a filesystem, so should not usually need to be set\&. However, it may be useful for the first time a very large filesystem that compresses very little is backed up\&.

.TP
\fBcompress [client|server]\fR \fB string\fR
Default: \fBclient fast\fR\&. If \fBAMANDA\fR does compression of the backup images, it can do so either on the backup client host before it crosses the network or on the tape server host as it goes from the network into the holding disk or to tape\&. Which place to do compression (if at all) depends on how well the dump image usually compresses, the speed and load on the client or server, network capacity, holding disk capacity, availability of tape hardware compression, etc\&.

For either type of compression, \fBAMANDA\fR also allows the selection of two styles of compression\&. \fBBest\fR is the best compression available, often at the expense of CPU overhead\&. \fBFast\fR is often not as good a compression as \fBbest\fR, but usually less CPU overhead\&.

So the \fBcompress\fR options line may be one of:


.RS
.TP 3
\(bu
compress none
.TP
\(bu
compress [client] fast
.TP
\(bu
compress [client] best
.TP
\(bu
compress server fast
.TP
\(bu
compress server best
.LP
.RE
.IP
Note that some tape devices do compression and this option has nothing to do with whether that is used\&. If hardware compression is used (usually via a particular tape device name or \fBmt\fR option), \fBAMANDA\fR (software) compression should be disabled\&.

.TP
\fBdumpcycle\fR \fB int\fR
Default: \fB10 days\fR\&. The number of days in the backup cycle\&. Each disk using this set of options will get a full backup at least this often\&. Setting this to zero tries to do a full backup each run\&.

.TP
\fBexclude\fR [ \fBlist|file\fR ][[optional][ \fBappend\fR ][ \fB string\fR ]+]
Default: \fBfile\fR\&. There are two exclude lists, \fBexclude file\fR and \fBexclude list\&.\fR With \fBexclude file\fR , the \fBstring\fR is a \fBGNU\-tar\fR exclude expression\&. With \fBexclude list\fR , the \fBstring\fR is a file name on the client containing \fBGNU\-tar\fR exclude expressions\&.

All exclude expressions are concatenated in one file and passed to \fBGNU\-tar\fR as an \fB\-\-exclude\-from\fR argument\&.

With the \fBappend\fR keyword, the \fBstring\fR is appended to the current list, without it, the \fBstring\fR overwrites the list\&.

If \fBoptional\fR is specified for \fBexclude list\fR, then amcheck will not complain if the file doesn't exist or is not readable\&.

For \fBexclude list\fR, if the file name is relative, the disk name being backed up is prepended\&. So if this is entered:

.nf

    exclude list ``\fB\&.amanda\&.excludes\fR''
.fi
the actual file used would be \fI/var/\&.amanda\&.excludes\fR for a backup of \fI/var\fR, \fI/usr/local/\&.amanda\&.excludes\fR for a backup of \fI/usr/local\fR, and so on\&.

.TP
\fBholdingdisk\fR \fB boolean\fR
Default: \fByes\fR\&. Whether a holding disk should be used for these backups or whether they should go directly to tape\&. If the holding disk is a portion of another file system that \fBAMANDA\fR is backing up, that file system should refer to a dumptype with \fBholdingdisk\fR set to \fBno\fR to avoid backing up the holding disk into itself\&.

.TP
\fBignore\fR \fB boolean\fR
Default: \fBno\fR\&. Whether disks associated with this backup type should be backed up or not\&. This option is useful when the \fBdisklist\fR file is shared among several configurations, some of which should not back up all the listed file systems\&.

.TP
\fBinclude\fR [ \fBlist|file\fR ][[optional][ \fBappend\fR ][ \fB string\fR ]+]
Default: \fBfile\fR "\&."\&. There are two include lists, \fBinclude file\fR and \fBinclude list\&.\fR With \fBinclude file\fR , the \fBstring\fR is a glob expression\&. With \fBinclude list\fR , the \fBstring\fR is a file name on the client containing glob expressions\&.

All include expressions are expanded by \fBAMANDA\fR, concatenated in one file and passed to \fBGNU\-tar\fR as a \fB\-\-files\-from\fR argument\&. They must start with "\&./" and contain no other "/"\&.

With the \fBappend\fR keyword, the \fBstring\fR is appended to the current list, without it, the \fBstring\fR overwrites the list\&.

If \fBoptional\fR is specified for \fBinclude list,\fR then amcheck will not complain if the file doesn't exist or is not readable\&.

For \fBinclude list\fR, If the file name is relative, the disk name being backed up is prepended\&.

.TP
\fBindex\fR \fB boolean\fR
Default: \fBno\fR\&. Whether an index (catalogue) of the backup should be generated and saved in \fBindexdir\fR\&. These catalogues are used by the \fBamrecover\fR utility\&.

.TP
\fBkencrypt\fR \fB boolean\fR
Default: \fBno\fR\&. Whether the backup image should be encrypted by Kerberos as it is sent across the network from the backup client host to the tape server host\&.

.TP
\fBmaxdumps\fR \fB int\fR
Default: 1\&. The maximum number of backups from a single host that \fBAMANDA\fR will attempt to run in parallel\&. See also the main section parameter \fBinparallel\fR\&.

.TP
\fBmaxpromoteday\fR \fB int\fR
Default: 10000\&. The maximum number of day for a promotion, set it 0 if you don't want promotion, set it to 1 or 2 if your disks get overpromoted\&.

.TP
\fBpriority\fR \fB string\fR
Default: \fBmedium\fR\&. When there is no tape to write to, \fBAMANDA\fR will do incremental backups in priority order to the holding disk\&. The priority may be high (2)\&. medium (1), low (0) or a number of your choice\&.

.TP
\fBprogram\fR \fB string\fR
Default: \fBDUMP\fR\&. The type of backup to perform\&. Valid values are \fBDUMP\fR for the native operating system backup program, and \fBGNUTAR\fR to use \fBGNU\-tar\fR or to do PC backups using Samba\&.

.TP
\fBrecord\fR \fB boolean\fR
Default: \fByes\fR\&. Whether to ask the backup program to update its database (e\&.g\&. \fI/etc/dumpdates\fR for DUMP or \fI/usr/local/var/amanda/gnutar\-lists\fR for GNUTAR) of time stamps\&. This is normally enabled for daily backups and turned off for periodic archival runs\&.

.TP
\fBskip\-full\fR \fB boolean\fR
Default: \fBno\fR\&. If \fBtrue\fR and \fBplanner\fR has scheduled a full backup, these disks will be skipped, and full backups should be run off\-line on these days\&. It was reported that \fBAMANDA\fR only schedules level 1 incrementals in this configuration; this is probably a bug\&.

.TP
\fBskip\-incr\fR \fB boolean\fR
Default: \fBno\fR\&. If \fBtrue\fR and \fBplanner\fR has scheduled an incremental backup, these disks will be skipped\&.

.TP
\fBstarttime\fR \fB int\fR
Default: \fBnone\fR\&. Backups will not start until after this time of day\&. The value should be hh*100+mm, e\&.g\&. 6:30PM (18:30) would be entered as 1830\&.

.TP
\fBstrategy\fR \fB string\fR
Default: \fBstandard\fR\&. Strategy to use when planning what level of backup to run next\&. Values are:

.TP
\fBstandard\fR
The standard \fBAMANDA\fR schedule\&.

.TP
\fBnofull\fR
Never do full backups, only level 1 incrementals\&.

.TP
\fBnoinc\fR
Never do incremental backups, only full dumps\&.

.TP
\fBskip\fR
Never do backups (useful when sharing the \fBdisklist\fR file)\&.

.TP
\fBincronly\fR
Only do incremental dumps\&. \fBamadmin force\fR should be used to tell \fBAMANDA\fR that a full dump has been performed off\-line, so that it resets to level 1\&. It is similar to skip\-full, but with incronly full dumps may be scheduled manually\&. Unfortunately, it appears that \fBAMANDA\fR will perform full backups with this configuration, which is probably a bug\&.

.PP
The following \fBdumptype\fR entries are predefined by \fBAMANDA\fR:
.nf

define dumptype no\-compress {
    compress none
}
define dumptype compress\-fast {
    compress client fast
}
define dumptype compress\-best {
    compress client best
}
define dumptype srvcompress {
    compress server fast
}
define dumptype bsd\-auth {
    auth bsd
}
define dumptype krb4\-auth {
    auth krb4
}
define dumptype no\-record {
    record no
}
define dumptype no\-hold {
    holdingdisk no
}
define dumptype no\-full {
    skip\-full yes
} 
.fi

.PP
In addition to options in a \fBdumptype\fR section, one or more other \fBdumptype\fR names may be entered, which make this \fBdumptype\fR inherit options from other previously defined \fBdumptype\fRs\&. For instance, two sections might be the same except for the \fBrecord\fR option:
.nf

define dumptype normal {
    comment "Normal backup, no compression, do indexing"
    no\-compress
    index yes
    maxdumps 2
}
define dumptype testing {
    comment "Test backup, no compression, do indexing, no recording"
    normal
    record no
}
.fi

.PP
\fBAMANDA\fR provides a \fBdumptype\fR named \fBglobal\fR in the sample \fBamanda\&.conf\fR file that all \fBdumptype\fRs should reference\&. This provides an easy place to make changes that will affect every \fBdumptype\fR\&.

.SH "TAPETYPE SECTION"

.PP
The \fBamanda\&.conf\fR file may define multiple types of tape media and devices\&. The information is entered in a \fBtapetype\fR section, which looks like this in the config file:
.nf

define tapetype \fBname\fR {
    \fBtapetype\-option\fR \fBtapetype\-value\fR
    \&.\&.\&.
}
.fi

.PP
\fBName\fR is the name of this type of tape medium/device\&. It is referenced from the \fBtapetype\fR option in the main part of the config file\&.

.PP
The tapetype options and values are:

.TP
\fBcomment\fR \fB string\fR
Default: \fBnone\fR\&. A comment string describing this set of tape information\&.

.TP
\fBfilemark\fR \fB int\fR
Default: \fB1000 bytes\fR\&. How large a file mark (tape mark) is, measured in bytes\&. If the size is only known in some linear measurement (e\&.g\&. inches), convert it to bytes using the device density\&.

.TP
\fBlength\fR \fB int\fR
Default: \fB2000 kbytes\fR\&. How much data will fit on a tape\&.

Note that this value is only used by \fBAMANDA\fR to schedule which backups will be run\&. Once the backups start, \fBAMANDA\fR will continue to write to a tape until it gets an error, regardless of what value is entered for \fBlength\fR (but see the OUTPUT DRIVERS section later for exceptions)\&.

.TP
\fBblocksize\fR \fB int\fR
Default: \fB32\fR\&. How much data will be written in each tape record expressed in KiloBytes\&. The tape record size (= blocksize) can not be reduced below the default 32 KBytes\&. The parameter blocksize can only be raised if \fBAMANDA\fR was compiled with the configure option \-\-with\-maxtapeblocksize=N set with "N" greater than 32 during \fBconfigure\fR\&.

.TP
\fBfile\-pad\fR \fB boolean\fR
Default: \fBtrue\fR\&. If true, every record, including the last one in the file, will have the same length\&. This matches the way \fBAMANDA\fR wrote tapes prior to the availability of this parameter\&. It may also be useful on devices that only support a fixed blocksize\&.

Note that the last record on the tape probably includes trailing null byte padding, which will be passed back to \fBgzip\fR, \fBcompress\fR or the restore program\&. Most programs just ignore this (although possibly with a warning)\&.

If this parameter is false, the last record in a file may be shorter than the block size\&. The file will contain the same amount of data the dump program generated, without trailing null byte padding\&. When read, the same amount of data that was written will be returned\&.

.TP
\fBspeed\fR \fB int\fR
Default: \fB200 bps\fR\&. How fast the drive will accept data, in bytes per second\&. This parameter is NOT currently used by \fBAMANDA\fR\&.

.TP
\fBlbl\-templ\fR \fB string\fR
A PostScript template file used by \fBamreport\fR to generate labels\&. Several sample files are provided with the \fBAMANDA\fR sources in the \fBexample\fR directory\&. See the \fBamreport\fR(8) man page for more information\&.

.PP
In addition to options, another \fBtapetype\fR name may be entered, which makes this \fBtapetype\fR inherit options from another \fBtapetype\fR\&. For instance, the only difference between a DLT4000 tape drive using Compact\-III tapes and one using Compact\-IV tapes is the length of the tape\&. So they could be entered as:
.nf

define tapetype DLT4000\-III {
    comment "DLT4000 tape drives with Compact\-III tapes"
    length 12500 mbytes         # 10 Gig tapes with some compression
    filemark 2000 kbytes
    speed 1536 kps
}
define tapetype DLT4000\-IV {
    DLT4000\-III
    comment "DLT4000 tape drives with Compact\-IV tapes"
    length 25000 mbytes         # 20 Gig tapes with some compression
}
.fi

.SH "INTERFACE SECTION"

.PP
The \fBamanda\&.conf\fR file may define multiple types of network interfaces\&. The information is entered in an \fBinterface\fR section, which looks like this:
.nf

define interface \fBname\fR {
    \fBinterface\-option\fR \fBinterface\-value\fR
    \&.\&.\&.
}
.fi

.PP
\fBname\fR is the name of this type of network interface\&. It is referenced from the \fBdisklist\fR file\&.

.PP
Note that these sections define network interface characteristics, not the actual interface that will be used\&. Nor do they impose limits on the bandwidth that will actually be taken up by \fBAMANDA\fR\&. \fBAMANDA\fR computes the estimated bandwidth each file system backup will take based on the estimated size and time, then compares that plus any other running backups with the limit as another of the criteria when deciding whether to start the backup\&. Once a backup starts, \fBAMANDA\fR will use as much of the network as it can leaving throttling up to the operating system and network hardware\&.

.PP
The interface options and values are:

.TP
\fBcomment\fR \fB string\fR
Default: \fBnone\fR\&. A comment string describing this set of network information\&.

.TP
\fBuse\fR \fB int\fR
Default: \fB300 Kbps\fR\&. The speed of the interface in Kbytes per second\&.

.PP
In addition to options, another \fBinterface\fR name may be entered, which makes this \fBinterface\fR inherit options from another \fBinterface\fR\&. At the moment, this is of little use\&.

.SH "DISKLIST FILE"

.PP
The \fBdisklist\fR file determines which disks will be backed up by \fBAMANDA\fR\&. The file usually contains one line per disk:
.nf

\fBhostname diskname\fR [\fBdiskdevice\fR] \fBdumptype\fR [\fBspindle\fR [\fBinterface\fR] ]
.fi

.PP
All pairs [ \fBhostname diskname\fR ] must be unique\&.

.PP
Lines starting with # are ignored, as are blank lines\&. The fields have the following meanings:

.TP
\fBhostname\fR
The name of the host to be backed up\&. If \fBdiskdevice\fR refers to a PC share, this is the host \fBAMANDA\fR will run the Samba \fBsmbclient\fR program on to back up the share\&.

.TP
\fBdiskname\fR
The name of the disk (a label)\&. In most case, you set your \fBdiskname\fR to the \fBdiskdevice\fR and you don't set the \fBdiskdevice\&.\fR If you want multiple entries with the same \fBdiskdevice\fR, you must set a different \fBdiskname\fR for each entry\&. It's the \fBdiskname\fR that you use on the commandline for any \fBAMANDA\fR command\&. Look at the example/disklist file for example\&.

.TP
\fBdiskdevice\fR
Default: same as diskname\&. The name of the disk device to be backed up\&. It may be a full device name, a device name without the \fI/dev/\fR prefix, e\&.g\&. \fBsd0a\fR, or a mount point such as \fI/usr\fR\&.

It may also refer to a PC share by starting the name with two (forward) slashes, e\&.g\&. \fI//some\-pc/home\fR\&. In this case, the \fBprogram\fR option in the associated \fBdumptype\fR must be entered as \fBGNUTAR\fR\&. It is the combination of the double slash disk name and \fBprogram GNUTAR\fR in the \fBdumptype\fR that triggers the use of Samba\&.

.TP
\fBdumptype\fR
Refers to a \fBdumptype\fR defined in the \fBamanda\&.conf\fR file\&. \fBDumptype\fRs specify backup related parameters, such as whether to compress the backups, whether to record backup results in \fI/etc/dumpdates\fR, the disk's relative priority, etc\&.

.TP
\fBspindle\fR
Default: \fB\-1\fR\&. A number used to balance backup load on a host\&. \fBAMANDA\fR will not run multiple backups at the same time on the same spindle, unless the spindle number is \-1, which means there is no spindle restriction\&.

.TP
\fBinterface\fR
Default: \fBlocal\fR\&. The name of a network interface definition in the \fBamanda\&.conf\fR file, used to balance network load\&.

.PP
Instead of naming a \fBdumptype\fR, it is possible to define one in\-line, enclosing \fBdumptype\fR options within curly braces, one per line, just like a \fBdumptype\fR definition in \fBamanda\&.conf\fR\&. Since pre\-existing \fBdumptype\fRs are valid option names, this syntax may be used to customize \fBdumptype\fRs for particular disks\&.

.PP
A line break \fBmust\fR follow the left curly bracket\&.

.PP
For instance, if a \fBdumptype\fR named \fBnormal\fR is used for most disks, but use of the holding disk needs to be disabled for the file system that holds it, this would work instead of defining a new dumptype:
.nf

\fBhostname diskname\fR [ \fBdiskdevice\fR ] {
  normal
  holdingdisk no
} [ \fBspindle\fR [ \fBinterface\fR ] ]
.fi

.SH "TAPE MANAGEMENT"

.PP
The \fBtapelist\fR file contains the list of tapes in active use\&. This file is maintained entirely by \fBAMANDA\fR and should not be created or edited during normal operation\&. It contains lines of the form:

.PP

.nf
YYYYMMDD label flags
.fi


.PP
Where \fBYYYYMMDD\fR is the date the tape was written, \fBlabel\fR is a label for the tape as written by \fBamlabel\fR and \fBflags\fR tell \fBAMANDA\fR whether the tape may be reused, etc (see the \fBreuse\fR options of \fBamadmin\fR)\&.

.PP
\fBAmdump\fR and \fBamflush\fR will refuse to write to an unlabeled tape, or to a labeled tape that is considered active\&. There must be more tapes in active rotation (see the \fBtapecycle\fR option) than there are runs in the backup cycle (see the \fBdumpcycle\fR option) to prevent overwriting a backup image that would be needed to do a full recovery\&.

.SH "OUTPUT DRIVERS"

.PP
The normal value for the \fBtapedev\fR parameter, or for what a tape changer returns, is a full path name to a non\-rewinding tape device, such as \fI/dev/nst0\fR or \fI/dev/rmt/0mn\fR or \fI/dev/nst0\&.1\fR or whatever conventions the operating system uses\&. \fBAMANDA\fR provides additional application level drivers that support non\-traditional tape\-simulations or features\&. To access a specific output driver, set \fBtapedev\fR (or configure your changer to return) a string of the form \fBdriver\fR:\fBdriver\-info\fR where \fBdriver\fR is one of the supported drivers and \fBdriver\-info\fR is optional additional information needed by the driver\&.

.PP
The supported drivers are:

.TP
\fBtape\fR
This is the default driver\&. The \fBdriver\-info\fR is the tape device name\&. Entering 
.nf
tapedev /dev/rmt/0mn
.fi
 is really a short hand for 
.nf
tapedev tape:/dev/rmt/0mn
.fi
\&.

.TP
\fBnull\fR
This driver throws away anything written to it and returns EOF for any reads except a special case is made for reading a label, in which case a ``\fBfake\fR'' value is returned that \fBAMANDA\fR checks for and allows through regardless of what you have set in \fBlabelstr\fR\&. The \fBdriver\-info\fR field is not used and may be left blank:


.nf
tapedev null:
.fi


The \fBlength\fR value from the associated \fBtapetype\fR is used to limit the amount of data written\&. When the limit is reached, the driver will simulate end of tape\&.

.RS
.Sh "Note"
This driver should only be used for debugging and testing,
and probably only with the
\fBrecord\fR
option set to
\fBno\fR\&.
.RE

.TP
\fBrait\fR
\fBR\fRedundant \fBA\fRrray of \fBI\fRnexpensive (?) \fBT\fRapes\&. Reads and writes tapes mounted on multiple drives by spreading the data across N\-1 drives and using the last drive for a checksum\&. See docs/RAIT for more information\&.

The \fBdriver\-info\fR field describes the devices to use\&. Curly braces indicate multiple replacements in the string\&. For instance:


.nf
tapedev rait:/dev/rmt/tps0d{4,5,6}n
.fi


would use the following devices:

\fI/dev/rmt/tps0d4n\fR  \fI/dev/rmt/tps0d5n\fR  \fI/dev/rmt/tps0d6n\fR 

.TP
\fBfile\fR
This driver emulates a tape device with a set of files in a directory\&. The \fBdriver\-info\fR field must be the name of an existing directory\&. The driver will test for a subdirectory of that named \fBdata\fR and return \fBoffline\fR until it is present\&. When present, the driver uses two files in the \fBdata\fR subdirectory for each tape file\&. One contains the actual data\&. The other contains record length information\&.

The driver uses a file named \fBstatus\fR in the \fBfile\fR device directory to hold driver status information, such as tape position\&. If not present, the driver will create it as though the device is rewound\&.

The \fBlength\fR value from the associated \fBtapetype\fR is used to limit the amount of data written\&. When the limit is reached, the driver will simulate end of tape\&.

One way to use this driver with a real device such as a CD\-writer is to create a directory for the \fBfile\fR device and one or more other directories for the actual data\&. Create a symlink named \fBdata\fR in the \fBfile\fR directory to one of the data directories\&. Set the \fBtapetype\fR length to whatever the medium will hold\&.

When \fBAMANDA\fR fills the \fBfile\fR device, remove the symlink and (optionally) create a new symlink to another data area\&. Use a CD writer software package to burn the image from the first data area\&.

To read the CD, mount it and create the \fBdata\fR symlink in the \fBfile\fR device directory\&.

.SH "AUTHORIZATION"

.PP
\fBAMANDA\fR processes on the tape server host run as the \fBdumpuser\fR user listed in \fBamanda\&.conf\fR\&. When they connect to a backup client, they do so with an \fBAMANDA\fR\-specific protocol\&. They do not, for instance, use \fBrsh\fR or \fBssh\fR directly\&.

.PP
On the client side, the \fBamandad\fR daemon validates the connection using one of several methods, depending on how it was compiled and on options it is passed:

.TP
\&.rhosts
Even though \fBAMANDA\fR does not use \fBrsh\fR, it can use \&.rhosts\-style authentication and a \&.rhosts file\&.

.TP
\&.amandahosts
This is essentially the same as \&.rhosts authentication except a different file, with almost the same format, is used\&. This is the default mechanism built into \fBAMANDA\fR\&.

The format of the \fI\&.amandahosts\fR file is:

\fBhostname\fR [ \fBusername\fR ]

If \fBusername\fR is ommitted, it defaults to the user running \fBamandad\fR, i\&.e\&. the user listed in the \fBinetd\fR or \fBxinetd\fR configuration file\&.

.TP
Kerberos
\fBAMANDA\fR may use the Kerberos authentication system\&. Further information is in the \fBdocs/KERBEROS\fR   file that comes with an \fBAMANDA\fR distribution\&.

For Samba access, \fBAMANDA\fR needs a file on the Samba server (which may or may not also be the tape server) named \fI/etc/amandapass\fR with share names, (clear text) passwords and (optional) domain names, in that order, one per line, whitespace separated\&. By default, the user used to connect to the PC is the same for all PC's and is compiled into \fBAMANDA\fR\&. It may be changed on a host by host basis by listing it first in the password field followed by a percent sign and then the password\&. For instance:

.nf

  //some\-pc/home normalpw
  //another\-pc/disk otheruser%otherpw
  .fi
With clear text passwords, this file should obviously be tightly protected\&. It only needs to be readable by the \fBAMANDA\fR\-user on the Samba server\&.

You can find further information in the \fBdocs/SAMBA\fR   file that comes with an \fBAMANDA\fR distribution\&.

.SH "HOST & DISK EXPRESSION"

.PP
All host and disk arguments to programs are special expressions\&. The command applies to all disks that match your arguments\&. This section describes the matcher\&.

.PP
The matcher matches by word, each word is a glob expression, words are separated by the separator '\&.' for host and '/' for disk\&. You can anchor the expression at left with a '^'\&. You can anchor the expression at right with a '$'\&. The matcher is case insensitive for host but is case sensitive for disk\&. A match succeeds if all words in your expression match contiguous words in the host or disk\&.
.nf

 \&.   word separator for a host
 /   word separator for a disk
 ^   anchor at left
 $   anchor at right
 ?   match exactly one character except the separator
 *   match zero or more characters except the separator
 **  match zero or more characters including the separator
.fi

.PP
Some examples:
.nf

  EXPRESSION      WILL MATCH              WILL NOT MATCH
  hosta           hosta                   hostb
                  hoSTA\&.dOMAIna\&.ORG
                  foo\&.hosta\&.org
  host            host                    hosta
  host?           hosta                   host
                  hostb
  ho*na           hoina                   ho\&.aina\&.org
  ho**na          hoina
                  ho\&.aina\&.org
  ^hosta          hosta                   foo\&.hosta\&.org
  sda*            /dev/sda1
                  /dev/sda12
  /opt/           opt (disk)              opt (host)
  \&.opt\&.           opt (host)              opt (disk)
  /               /                       any other disk
  /usr            /usr
                  /usr/opt
  /usr$           /usr                    /usr/opt 
.fi

.SH "DATESTAMP EXPRESSION"

.PP
A \fBdatestamp\fR expression is a range expression where we only match the prefix\&. Leading ^ is removed\&. Trailing $ forces an exact match\&.
.nf

  20001212\-14  match all dates beginning with 20001212, 20001213 or 20001214
  20001212\-4   same as previous
  20001212\-24  match all dates between 20001212 and 20001224
  2000121      match all dates that start with 2000121 (20001210\-20001219)
  2            match all dates that start with 2 (20000101\-29991231)
  2000\-10      match all dates between 20000101\-20101231
  200010$      match only 200010 
.fi

.SH "AUTHOR"

.PP
James da Silva, <jds@amanda\&.org> : Original text

.PP
Stefan G\&. Weichinger, <sgw@amanda\&.org>, maintainer of the \fBAMANDA\fR\-documentation: XML\-conversion,major update

.SH "SEE ALSO"

.PP
\fBamadmin\fR(8), \fBamcheck\fR(8), \fBamcheckdb\fR(8), \fBamcleanup\fR(8), \fBamdd\fR(8), \fBamdump\fR(8), \fBamflush\fR(8), \fBamgetconf\fR(8), \fBamlabel\fR(8), \fBammt\fR(8), \fBamoverview\fR(8), \fBamplot\fR(8), \fBamrecover\fR(8), \fBamreport\fR(8), \fBamrestore\fR(8), \fBamrmtape\fR(8), \fBamstatus\fR(8), \fBamtape\fR(8), \fBamtoc\fR(8), \fBamverify\fR(8), \fBamverifyrun\fR(8)


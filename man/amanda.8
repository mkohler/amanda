'\" t
.\"     Title: amanda
.\"    Author: James da Silva <jds@amanda.org>
.\" Generator: DocBook XSL Stylesheets vsnapshot_8273 <http://docbook.sf.net/>
.\"      Date: 11/05/2009
.\"    Manual: System Administration Commands
.\"    Source: Amanda 2.6.1p2
.\"  Language: English
.\"
.TH "AMANDA" "8" "11/05/2009" "Amanda 2\&.6\&.1p2" "System Administration Commands"
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
amanda \- The Open Source Backup Platform
.SH "DESCRIPTION"
.PP
This manual page gives an overview of the
\fIAmanda\fR
commands and configuration files for quick reference\&.
.SS "COMMANDS"
.PP
Here are all the
\fIAmanda\fR
commands\&. Each one has its own manual page\&. See them for all the gory details\&.
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamaddclient\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamadmin\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamaespipe\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamcheck\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamcheckdb\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamcheckdump\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamcleanup\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamcrypt-ossl-asym\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamcrypt-ossl\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamcrypt\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamcryptsimple\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamdd\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamdevcheck\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamdump\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamfetchdump\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamflush\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamgetconf\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamgpgcrypt\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamgtar\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamlabel\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBammt\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamoverview\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamplot\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamrecover\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamreport\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamrestore\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamrmtape\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamsamba\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamserverconfig\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamservice\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamstar\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamstatus\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamtape\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamtapetype\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamtoc\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamvault\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamzfs-sendrecv\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamzfs-snapshot\fR(8),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBscript-email\fR(8),
.RE
.SS "CONFIGURATION FILES"
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamanda.conf\fR(5),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamanda-client.conf\fR(5),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBdisklist\fR(5),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBtapelist\fR(5),
.RE
.SS "DATA FORMATS"
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamanda-archive-format\fR(5),
.RE
.SS "CONCEPTS"
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamanda-applications\fR(7),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamanda-auth\fR(7),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamanda-changers\fR(7),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamanda-devices\fR(7),
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBamanda-scripts\fR(7),
.RE
.SH "CONFIGURATION"
.PP
There are four user\-editable files that control the behavior of
\fIAmanda\fR\&.
.PP
The first two are
\fBamanda.conf\fR(5)
and
\fBamanda-client.conf\fR(5), the main configuration files for the server and client, respectively\&. They contain parameters to customize
\fIAmanda\fR
for the site\&.
.PP
Next is the
\fBdisklist\fR(5)
file, which lists hosts and disk partitions to back up\&.
.PP
Last is the seldom\-edited
\fBtapelist\fR(5)
file, which lists tapes that are currently active\&. These files are described in more detail in the following sections\&.
.PP
All files are stored in individual configuration directories, usually under
/etc/amanda/\&. A site will often have more than one configuration\&. For example, it might have a
\fInormal\fR
configuration for everyday backups and an
\fIarchive\fR
configuration for infrequent full archival backups\&. The configuration files would be stored under directories
/etc/amanda/normal/
and
/etc/amanda/archive/, respectively\&. Part of the job of an
\fIAmanda\fR
administrator is to create, populate and maintain these directories\&.
.SH "LOG FILES"
.PP
All log and database files generated by
\fIAmanda\fR
go in corresponding directories somewhere\&. The exact location is controlled by entries in
\fBamanda.conf\fR(5)\&. A typical location would be under
/var/adm/amanda\&. For the above example, the files might go in
/var/adm/amanda/normal/
and
/var/adm/amanda/archive/\&.
.PP
As log files are no longer needed (no longer contain relevant information),
\fIAmanda\fR
cycles them out in various ways, depending on the type of file\&.
.PP
Detailed information about
\fBamdump\fR
runs are stored in dump logs \-\- files named
\fBamdump\&.\fR\fINN\fR
where
\fINN\fR
is a sequence number, with 1 being the most recent file\&.
\fBAmdump\fR
rotates these files each run, keeping roughly the last
\fBtapecycle\fR
(see below) worth of them\&.
.PP
The file used by
\fBamreport\fR
to generate the mail summary is the trace log\&. This file constitutes the "catalog" describing the data on the tapes written in a run\&. It is named
\fBlog\&.\fR\fIYYYYMMDDHHMMSS\&.NN\fR
where
\fIYYYYMMDDHHMMSS\fR
is the datestamp of the start of the
\fBamdump\fR
or
\fBamflush\fR
run and
\fINN\fR
is a sequence number started at 0\&. At the end of each
\fBamdump\fR
run, log files for runs whose tapes have been reused are renamed into a subdirectory of the main log directory (see the
\fBlogdir\fR
parameter below) named
\fBoldlog\fR\&. It is up to the
\fIAmanda\fR
administrator to remove them from this directory when desired\&.
.PP
Index (backup image catalogue) files older than the full dump matching the oldest backup image for a given client and disk are removed by
\fBamdump\fR
at the end of each run\&.
.SH "USING SAMBA"
.PP
For Samba access,
\fIAmanda\fR
needs a file on the Samba server (which may or may not also be the tape server) named
/etc/amandapass
with share names, (clear text) passwords and (optional) domain names, in that order, one per line, whitespace separated\&. By default, the user used to connect to the PC is the same for all PC\'s and is compiled into
\fIAmanda\fR\&. It may be changed on a host by host basis by listing it first in the password field followed by a percent sign and then the password\&. For instance:
.nf
  //some\-pc/home normalpw
  //another\-pc/disk otheruser%otherpw
.fi
.PP
With clear text passwords, this file should obviously be tightly protected\&. It only needs to be readable by the
\fIAmanda\fR\-user on the Samba server\&.
.SH "HOST & DISK EXPRESSION"
.PP
All host and disk arguments to programs are special expressions\&. The command applies to all disks that match your arguments\&. This section describes the matcher\&.
.PP
The matcher matches by word, each word is a glob expression, words are separated by the separator \'\&.\' for host and \'/\' for disk\&. You can anchor the expression at left with a \'^\'\&. You can anchor the expression at right with a \'$\'\&. The matcher is case insensitive for host but is case sensitive for disk\&. A match succeeds if all words in your expression match contiguous words in the host or disk\&.
.PP
dot (\&.)
.RS 4
word separator for a host
.RE
.PP
/
.RS 4
word separator for a disk
.RE
.PP
^
.RS 4
anchor at left
.RE
.PP
$
.RS 4
anchor at right
.RE
.PP
?
.RS 4
match exactly one character except the separator
.RE
.PP
*
.RS 4
match zero or more characters except the separator
.RE
.PP
**
.RS 4
match zero or more characters including the separator
.RE
.PP
Some examples:
.PP
hosta
.RS 4
Will match
hosta,
foo\&.hosta\&.org, and
hoSTA\&.dOMAIna\&.ORG
but not
hostb\&.
.RE
.PP
host
.RS 4
Will match
host
but not
hosta\&.
.RE
.PP
host?
.RS 4
Will match
hosta
and
hostb, but not
host\&.
.RE
.PP
ho*na
.RS 4
Will match
hoina
but not
ho\&.aina\&.org\&.
.RE
.PP
ho**na
.RS 4
Will match
hoina
and
ho\&.aina\&.org\&.
.RE
.PP
^hosta
.RS 4
Will match
hosta
but not
foo\&.hosta\&.org\&.
.RE
.PP
sda*
.RS 4
Will match
/dev/sda1
and
/dev/sda12\&.
.RE
.PP
/opt
.RS 4
Will match the disk
opt
but not the host
opt\&.
.RE
.PP
(note dots:) \&.opt\&.
.RS 4
Will match the host
opt
but not the disk
opt\&.
.RE
.PP
/
.RS 4
Will match the disk
/
but no other disk\&.
.RE
.PP
/usr
.RS 4
Will match the disks
/usr
and
/usr/local\&.
.RE
.PP
/usr$
.RS 4
Will match the disks
/usr
but not
/usr/local\&.
.RE
.SH "DATESTAMP EXPRESSION"
.PP
A
\fIdatestamp\fR
expression is a range expression where we only match the prefix\&. Leading ^ is removed\&. Trailing $ forces an exact match\&.
.PP
20001212\-14
.RS 4
match all dates beginning with 20001212, 20001213 or 20001214
.RE
.PP
20001212\-4
.RS 4
same as previous
.RE
.PP
20001212\-24
.RS 4
match all dates between 20001212 and 20001224
.RE
.PP
2000121
.RS 4
match all dates that start with 2000121 (20001210\-20001219)
.RE
.PP
2
.RS 4
match all dates that start with 2 (20000101\-29991231)
.RE
.PP
2000\-10
.RS 4
match all dates between 20000101\-20101231
.RE
.PP
200010$
.RS 4
match only 200010
.RE
.SH "DUMP SPECIFICATIONS"
.PP
A dump specification selects one or more dumps\&. It has the form
\fI[host][:disk][@datestamp]\fR, where each component is a pattern as described above\&. If a component is missing, it is treated as a wildcard\&. The characters \':\', \'@\', and \'\e\' may be escaped within any component by preceding them with a \'\e\'\&.
.PP
Some examples:
.PP
client17
.RS 4
all dumps of client17
.RE
.PP
@20080615
.RS 4
All dumps on with datestamps matching 20080615
.RE
.PP
webserver:/var/www
.RS 4
All dumps of /var/www on host webserver
.RE
.PP
webserver:/var/www@200806150317
.RS 4
The dump of webserver with datestamp 200806150317
.RE
.PP
:/var/www
.RS 4
All dumps of /var/www on any host
.RE
.SH "CONFIGURATION OVERRIDE"
.PP
Most commands allow the override of specific configuration options on the command line, using the
\-o
option\&. This option has the form
\-o\fIname\fR=\fIvalue\fR\&. An optional space is allowed after the
\-o\&. Each configuration option should be specified in a separate command\-line option\&.
.PP
For global options,
\fIname\fR
is simply the name of the option, e\&.g\&.,
.sp
.nf
amdump \-oruntapes=2
.fi
For options in a named section of the configuration,
\fIname\fR
has the form
\fISECTION\fR:\fIsection_name\fR:\fIname\fR, where
\fISECTION\fR
is one of TAPETYPE, DUMPTYPE, HOLDINGDISK, or INTERFACE, and
\fIsection_name\fR
is the name of the tapetype, dumptype, holdingdisk, or interface\&. Examples:
.sp
.nf
amdump \-o TAPETYPE:HP\-DAT:length=2000m
amdump \-o DUMPTYPE:no\-compress:compress="server fast"
amdump \-o HOLDINGDISK:hd1:use="\-100 mb"
amdump \-o INTERFACE:local:use="2000 kbps"
.fi
.PP
When overriding device properties, one must carefully quote the command line to simulate the syntax of real configuration files\&. The following example should serve as a guide:
.sp
.nf
amdump \-o \'device\-property="PROPERTY_MAX_VOLUME_USAGE" "100000"\'
.fi
.PP
Note that configuration overrides are not effective for tape changers, which supply a tapedev based on their own configuration\&. In order to override
\fItapedev\fR, you must also disable any changer:
.sp
.nf
amdump \-otapedev=/dev/nst1 \-otpchanger=\'\'
.fi
.SH "AUTHORS"
.PP
\fBJames da Silva\fR <\&jds@amanda\&.org\&>
.PP
\fBStefan G\&. Weichinger\fR <\&sgw@amanda\&.org\&>

.\"Generated by db2man.xsl. Don't modify this, modify the source.
.de Sh \" Subsection
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Ip \" List item
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.TH "AMADMIN" 8 "" "" ""
.SH NAME
amadmin \- administrative interface to control AMANDA backups
.SH "SYNOPSIS"
.ad l
.hy 0
.HP 8
\fBamadmin\fR \fIconfig\fR \fIcommand\fR [\fIcommand\fR\ \fIoptions\fR]
.ad
.hy

.SH "DESCRIPTION"

.PP
\fBAmadmin\fR performs various administrative tasks on the \fBconfig\fR  \fBAMANDA\fR configuration\&.

.PP
See the \fBamanda\fR(8) man page for more details about \fBAMANDA\fR\&.

.SH "COMMANDS"

.PP
Commands that take a \fBhostname\fR [ \fBdisks\fR ] parameter pair operate on all disks in the \fBdisklist\fR for that \fBhostname\fR if no disks are specified\&. Where \fBhostname\fR is also marked as being optional, the command operates on all hosts and disks in the \fBdisklist\fR\&. Both \fBhostname\fR and \fBdisks\fR are special expressions, see the ``\fBHOST & DISK EXPRESSION\fR'' section of \fBamanda\fR(8) for a description\&.

.TP
\fBversion\fR
Show the current version and some compile time and runtime parameters\&. The \fBconfig\fR parameter must be present but is ignored\&.

.TP
\fBforce\-bump\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]+
Force the \fBdisks\fR on \fBhostname\fR to bump to a new incremental level during the next \fBAMANDA\fR run\&.

.TP
\fBforce\-no\-bump\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]+
Force the \fBdisks\fR on \fBhostname\fR to not bump to a new incremental level during the next \fBAMANDA\fR run\&.

.TP
\fBunforce\-bump\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]+
Undo a previous \fBforce\-bump\fR or \fBforce\-no\-bump\fR command\&.

.TP
\fBforce\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]+
Force the \fBdisks\fR on \fBhostname\fR to do a full (level 0) backup during the next \fBAMANDA\fR run\&.

.TP
\fBunforce\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]+
Undo a previous \fBforce\fR command\&.

.TP
\fBreuse\fR \fBtapelabel\fR [ \&.\&.\&. ]
The tapes listed will be available for reuse at their point in the tape cycle\&.

.TP
\fBno\-reuse\fR \fBtapelabel\fR [ \&.\&.\&. ]
The tapes listed will not be reused when their turn comes up again in the tape cycle\&. Note that if this causes the number of reusable tapes to drop below the \fBamanda\&.conf\fR  \fBtapecycle\fR value, \fBAMANDA\fR will request new tapes until the count is satisfied again\&.

.TP
\fBdue\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]*
Show when the next full dump is due\&.

.TP
\fBfind\fR [ \fB\-\-sort\fR \fIhkdlb\fR ]\fB\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]*
Display all backups currently on tape or in the holding disk\&. The tape label or holding disk filename, file number, and status are displayed\&.

The \fB\-\-sort\fR option changes the sort order using the following flags:

\fBh\fRhost name \fBk\fRdisk name \fBd\fRdump date \fBl\fRbackup level \fBb\fRtape label

An uppercase letter reverses the sort order for that key\&. The default sort order is \fBhkdlb\fR\&.

.TP
\fBdelete\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]+
Delete the specified \fBdisks\fR on \fBhostname\fR from the \fBAMANDA\fR database\&.

.RS
.Sh "Note"
If you do not also remove the disk from the
\fBdisklist\fR
file, \fBAMANDA\fR will treat it as a new disk during the next run\&.
.RE

.TP
\fBtape\fR
Display the tape(s) \fBAMANDA\fR expects to write to during the next run\&. See also \fBamcheck\fR(8)\&.

.TP
\fBbumpsize\fR
Display the current bump threshold parameters, calculated for all backup levels\&.

.TP
\fBbalance\fR [ \fB\-\-days\fR \fI<num>\fR ]\fB\fR \fB\fR \fB\fR
Display the distribution of full backups throughout the dump schedule\&.

.TP
\fBexport\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]*
Convert records from the \fBAMANDA\fR database to a text format that may be transmitted to another \fBAMANDA\fR machine and \fBimport\fRed\&.

.TP
\fBimport\fR
Convert \fBexport\fRed records read from standard input to a form \fBAMANDA\fR uses and insert them into the database on this machine\&.

.TP
\fBdisklist\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]*
Display the \fBdisklist\fR information for each of the \fBdisks\fR on \fBhostname\fR (or all hosts)\&. Mostly used for debugging\&.

.TP
\fBinfo\fR [ \fBhostname\fR [ \fBdisks\fR ]* ]*
Display the database record for each of the \fBdisks\fR on \fBhostname\fR (or all hosts)\&. Mostly used for debugging\&.

.SH "EXAMPLES"

.PP
Request three specific file systems on \fBmachine\-a\fR get a full level 0 backup during the next \fBAMANDA\fR run\&.
.nf

$ amadmin daily force machine\-a / /var /usr
amadmin: machine\-a:/ is set to a forced level 0 tonight\&.
amadmin: machine\-a:/var is set to a forced level 0 tonight\&.
amadmin: machine\-a:/usr is set to a forced level 0 tonight\&.
.fi

.PP
Request all file systems on \fBmachine\-b\fR get a full level 0 backup during the next \fBAMANDA\fR run\&.
.nf

$ amadmin daily force machine\-b
amadmin: machine\-b:/ is set to a forced level 0 tonight\&.
amadmin: machine\-b:/var is set to a forced level 0 tonight\&.
amadmin: machine\-b:/usr is set to a forced level 0 tonight\&.
amadmin: machine\-b:/home is set to a forced level 0 tonight\&.
.fi

.PP
Undo the previous \fBforce\fR request for \fI/home\fR on \fBmachine\-b\fR\&. The other file systems will still get a full level 0 backup\&.
.nf

$ amadmin daily unforce machine\-b /home
amadmin: force command for machine\-b:/home cleared\&.
.fi

.PP
Locate backup images of \fI/var\fR from \fBmachine\-c\fR\&. The \fBtape or file\fR column displays either a tape label or a filename depending on whether the image is on tape or is still in the holding disk\&. If the image is on tape, the \fBfile\fR column tells you which file on the tape has the image (file number zero is a tape label)\&. This column shows zero and is not meaningful if the image is still in the holding disk\&. The \fBstatus\fR column tells you whether the backup was successful or had some type of error\&.
.nf

$ amadmin daily find machine\-c /var
date        host      disk lv tape or file                    file status
2000\-11\-09  machine\-c /var  0 000110                             9 OK
2000\-11\-08  machine\-c /var  2 000109                             2 OK
2000\-11\-07  machine\-c /var  2 /amanda/20001107/machine\-c\&._var\&.2  0 OK
2000\-11\-06  machine\-c /var  2 000107                             2 OK
2000\-11\-05  machine\-c /var  2 000106                             3 OK
2000\-11\-04  machine\-c /var  2 000105                             2 OK
2000\-11\-03  machine\-c /var  2 000104                             2 OK
2000\-11\-02  machine\-c /var  2 000103                             2 OK
2000\-11\-01  machine\-c /var  1 000102                             5 OK
2000\-10\-31  machine\-c /var  1 000101                             3 OK
.fi

.PP
Forget about the \fI/workspace\fR disk on \fBmachine\-d\fR\&. If you do not also remove the disk from the \fBdisklist\fR file, \fBAMANDA\fR will treat it as a new disk during the next run\&.
.nf

$ amadmin daily delete machine\-d /workspace
amadmin: machine\-d:/workspace deleted from database\&.
amadmin: NOTE: you'll have to remove these from the disklist yourself\&.
.fi

.PP
Find the next tape \fBAMANDA\fR will use (in this case, 123456)\&.
.nf

$ amadmin daily tape
The next \fBAMANDA\fR run should go onto tape 123456 or a new tape\&.
.fi

.PP
Show how well full backups are balanced across the dump cycle\&. The \fBdue\-date\fR column is the day the backups are due for a full backup\&. \fB#fs\fR shows the number of filesystems doing full backups that night, and \fBorig KB\fR and \fBout KB\fR show the estimated total size of the backups before and after any compression, respectively\&.

.PP
The \fBbalance\fR column shows how far off that night's backups are from the average size (shown at the bottom of the balance column)\&. \fBAMANDA\fR tries to keep the backups within +/\- 5%, but since the amount of data on each filesystem is always changing, and \fBAMANDA\fR will never delay backups just to rebalance the schedule, it is common for the schedule to fluctuate by larger percentages\&. In particular, in the case of a tape or backup failure, a bump will occur the following night, which will not be smoothed out until the next pass through the schedule\&.

.PP
The last line also shows an estimate of how many \fBAMANDA\fR runs will be made between full backups for a file system\&. In the example, a file system will probably have a full backup done every eight times \fBAMANDA\fR is run (e\&.g\&. every eight days)\&.
.nf

$ amadmin daily balance
 due\-date  #fs   orig KB    out KB  balance
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
11/10 Mon   21    930389    768753    +5\&.1%
11/11 Tue   29   1236272    733211    +0\&.2%
11/12 Wed   31   1552381    735796    +0\&.6%
11/13 Thu   23   1368447    684552    \-6\&.4%
11/14 Fri   32   1065603    758155    +3\&.6%
11/15 Sat   14   1300535    738430    +0\&.9%
11/16 Sun   31   1362696    740365    +1\&.2%
11/17 Mon   30   1427936    773397    +5\&.7%
11/18 Tue   11   1059191    721786    \-1\&.3%
11/19 Wed   19   1108737    661867    \-9\&.5%
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
TOTAL      241  12412187   7316312   731631  (estimated 8 runs per dumpcycle)
.fi

.SH "FILES"

.PP
/usr/local/etc/amanda/\fBconfig\fR/amanda\&.conf

.SH "AUTHOR"

.PP
James da Silva, <jds@amanda\&.org> : Original text

.PP
Stefan G\&. Weichinger, <sgw@amanda\&.org>, maintainer of the \fBAMANDA\fR\-documentation: XML\-conversion

.SH "SEE ALSO"

.PP
\fBamanda\fR(8), \fBamcheck\fR(8), \fBamdump\fR(8), \fBamrestore\fR(8)


.\"
.de EX
.if t .ft C
.nf
..
.de EE
.fi
.if t .ft
..
.de P1
\fB\\$1\fP \\$2 \fI\\$3\fP \\$4 \fI\\$5\fP \\$6 "\fI\\$7\fP" \\$8
..
.TH AMANDA 8
.SH NAME
amanda \- Advanced Maryland Automatic Network Disk Archiver
.SH SYNOPSIS
.B amdump
.I config
.br
.B amflush
[
.B \-f
]
.I config
.br
.B amcleanup
.I config
.br
.B amrecover
[
.I config
] [
.I options
]
.br
.B amrestore
[
.I options
]
.I tapedevice
[
.I hostname
[
.I diskname
]]
.br
.B amlabel
.I config label
[
.B slot
.I slot
]
.br
.B amcheck
[
.I options
]
.I config
.br
.B amadmin
.I config
.I command
[
.I options
]
.br
.B amtape
.I config
.I command
[
.I options
]
.br
.B amverify
.I config
.br
.B amrmtape
[
.I options
]
.I config label
.br
.B amstatus
.I config
[
.I options
]
.br
.B amoverview
.I config
[
.I options
]
.br
.B amplot
[
.I options
]
.I amdump-files
.br
.B amreport
[
.I config
]
[
.I options
]
.br
.B amtoc
[
.I options
]
.I logfile
.br
.B amcheckdb
.I config
.br
.B amgetconf
[
.I config
]
.I parameter
.br
.SH DESCRIPTION
Amanda is the "Advanced Maryland Automatic Network Disk Archiver".
This manual page gives an overview of the Amanda commands and
configuration files for quick reference.
.LP
Here are all the Amanda commands.
Each one has its own manual page.
See them for all the gory details.
.TP
.B amdump
Take care of automatic Amanda backups.
This is normally executed by
.B cron
on a computer called the
.I tape server host
and requests backups of file systems located on
.I backup
.IR clients .
.B Amdump
backs up all disks in the
.I disklist
file (discussed below) to tape or, if there is a problem, to a special
.I holding
.IR disk .
After all backups are done,
.B amdump
sends mail reporting failures and successes.
.TP
.B amflush
Flush backups from the holding disk to tape.
.B Amflush
is used after
.B amdump
has reported it could not write backups to tape for some reason.
When this happens, backups stay in the holding disk.
Run
.B amflush
after the tape problem is corrected
to write backups from the holding disk to tape.
.TP
.B amcleanup
Clean up after an interrupted
.BR amdump .
This command is only needed if
.B amdump
was unable to complete for some reason, usually because the
tape server host crashed while
.B amdump
was running.
.TP
.B amrecover
Provides an interactive interface to browse the Amanda index files
(backup image catalogues)
and select which tapes to recover files from.
It can also run
.B amrestore
and a restore program (e.g.\&
.BR tar )
to actually recover the files.
.TP
.B amrestore
Read an Amanda tape, searching for requested backups.
.B Amrestore
is suitable for everything from interactive restores of single files
to a full restore of all partitions on a failed disk.
.TP
.B amlabel
Write an Amanda format label onto a tape.
All Amanda tapes must be labeled with
.BR amlabel .
.B Amdump
and
.B amflush
will not write to an unlabeled tape (see TAPE MANAGEMENT below).
.TP
.B amcheck
Verify the correct tape is mounted
and all file systems on all backup client systems
are ready to be backed up.
Often run by
.B cron
before
.B amdump
to generate a mail warning that backups might fail
unless corrective action is taken.
.TP
.B amadmin
Take care of administrative tasks like finding out which
tapes are needed to restore a filesystem,
forcing hosts to do full backups of selected disks
and looking at schedule balance information.
.TP
.B amtape
Take care of tape changer control operations like loading particular tapes,
ejecting tapes
and scanning the tape storage slots.
.TP
.B amverify
Check Amanda backup tapes for errors.
.TP
.B amrmtape
Delete a tape from the Amanda databases.
.TP
.B amstatus
Report the status of a running or completed
.BR amdump .
.TP
.B amoverview
Display a chart of hosts and file systems backed up every run.
.TP
.B amplot
Generate utilization plots of Amanda runs for performance tuning.
.TP
.B amreport
Generate an Amanda summary E-mail report.
.TP
.B amtoc
Generate table of content files for Amanda tapes.
.TP
.B amcheckdb
Verify every tape Amanda knows about is consistent in the database.
.TP
.B amgetconf
Look up parameters in the Amanda configuration file.
.SH CONFIGURATION
There are three user\-editable files that control the behavior of Amanda.
The first is
.B amanda.conf,
the main configuration file.
It contains parameters to customize Amanda for the site.
Second is the
.I disklist
file, which lists hosts and disk partitions to back up.
Third is the
.I tapelist
file, which lists tapes that are currently active.
These files are described in more detail in the following sections.
.LP
All files are stored in individual configuration
directories under @CONFIG_DIR@.
A site will often have more than
one configuration.
For example, it might have a
.I normal
configuration for everyday backups and an
.I archive
configuration for infrequent full archival backups.
The configuration files would be stored under directories
@CONFIG_DIR@/normal/ and
@CONFIG_DIR@/archive/, respectively.
Part of the job of an Amanda administrator is to create,
populate and maintain these directories.
.LP
All log and database files generated by Amanda go in corresponding
directories somewhere.
The exact location is controlled by entries in
.BR amanda.conf .
A typical location would be under /var/adm/amanda.
For the above example, the files might go in
/var/adm/amanda/normal/ and /var/adm/amanda/archive/.
.LP
As log files are no longer needed (no longer contain relevant information),
Amanda cycles them out in various ways, depending on the type of file.
.LP
Detailed information about
.B amdump
runs are stored in files named
.BI amdump. NN
where
.I NN
is a sequence number, with 1 being the most recent file.
.B Amdump
rotates these files each run, keeping roughly the last
.B tapecycle
(see below)
worth of them.
.LP
The file used by
.B amreport
to generate the mail summary is named
.BI log. YYYYMMDD.NN
where
.I YYYYMMDD
is the datestamp of the start of the
.B amdump
run and
.I NN
is a sequence number started at 0.
At the end of each
.B amdump
run,
log files for runs whose tapes have been reused are renamed
into a subdirectory of the main log directory (see the
.B logdir
parameter below)
named
.BR oldlog .
It is up to the Amanda administrator to remove them from this
directory when desired.
.LP
Index (backup image catalogue) files older than the full dump
matching the oldest backup image for a given client and disk
are removed by
.B amdump
at the end of each run.
.SH CONFIG FILE PARAMETERS
.de BS
\fB\\$1\fP\ \fI"\\$2"\fP
..
.de BN
\fB\\$1\fP\ \fI\\$2\fP
..
There are a number of configuration parameters that control the
behavior of the Amanda programs.
All have default values,
so you need not specify the parameter in
.B amanda.conf
if the default is suitable.
.LP
Lines starting with # are ignored, as are blank lines.
Comments may be placed on a line with a directive by starting
the comment with a #.
The remainder of the line is ignored.
.LP
Keywords are case insensitive, i.e.\&
.B mailto
and
.B MailTo
are treated the same.
.LP
Integer arguments may have one of the following (case insensitive) suffixes,
some of which have a multiplier effect:
.RS
.TP
.B "b byte bytes"
Some number of bytes.
.TP
.B "bps"
Some number of bytes per second.
.TP
.B "k kb kbyte kbytes kilobyte kilobytes"
Some number of kilobytes (bytes*1024).
.TP
.B "kps kbps"
Some number of kilobytes per second (bytes*1024).
.TP
.B "m mb meg mbyte mbytes megabyte megabytes"
Some number of megabytes (bytes*1024*1024).
.TP
.B "mps mbps"
Some number of megabytes per second (bytes*1024*1024).
.TP
.B "g gb gbyte gbytes gigabyte gigabytes"
Some number of gigabytes (bytes*1024*1024*1024).
.TP
.B "tape tapes"
Some number of tapes.
.TP
.B "day days"
Some number of days.
.TP
.B "week weeks"
Some number of weeks (days*7).
.RE
.LP
The value
.B inf
may be used in most places where an integer is expected
to mean an infinite amount.
.LP
Boolean arguments may have any of the values
.BR y ,
.BR yes ,
.BR t ,
.B true
or
.B on
to indicate a true state, or
.BR n ,
.BR no ,
.BR f ,
.BR false
or
.B off
to indicate a false state.
If no argument is given,
.B true
is assumed.
.LP
.TP
.BS org string
Default:
.IR @DEFAULT_CONFIG@ .
A descriptive name for the configuration.
This string appears in the Subject line of mail reports.
Each Amanda configuration should have a different string to keep
mail reports distinct.
.TP
.BS mailto string
Default:
.IR operators .
A space separated list of recipients for mail reports.
.TP
.BN dumpcycle int
Default:
.IR "10 days" .
The number of days in the backup cycle.
Each disk will get a full backup at least this often.
Setting this to zero tries to do a full backup each run.
.IP
Note that this parameter may also be set in a specific
.B dumptype
(see below).
This value sets the default for all
.BR dumptype s
so must appear in
.B amanda.conf
before any
.BR dumptype s
are defined.
.TP
.BN runspercycle int
Default:
.IR "same as dumpcycle" .
The number of amdump runs in 
.B dumpcycle
days.
A value of 0 means the same value as 
.BR dumpcycle .
A value of -1 means guess the number of runs from the
.I tapelist
file, 
which is the number of tapes used in the last 
.B dumpcycle
days / 
.BR runtapes .
.TP
.BN tapecycle int
Default:
.IR "15 tapes" .
The mininum number of tapes in the active tape cycle.
You can have more tapes in your active tape cycle.
It means that you must write at least
.B tapecycle
tape before a tape
is overwritten.
A tape marked as 
.B no-reuse
is not in the active tape cycle.
.IP
Amanda will accept any tape for writting if it is not in the last
.B tapecycle
tapes used.
.IP
This must be at least one larger than the
number of Amanda runs done during a dump cycle
(see the
.B dumpcycle
parameter)
times the number of tapes used per run
(see the
.B runtapes
parameter).
.IP
For instance, if
.B dumpcycle
is set to 14 days,
one Amanda run is done every day (Sunday through Saturday),
and
.B runtapes
is set to one,
then
.B tapecycle
must be at least 15 (14 days * one run/day * one tape/run + one tape).
.IP
In practice, there should be several extra tapes
to allow for schedule adjustments or disaster recovery.
.TP
.BS dumpuser string
Default:
.IR @CLIENT_LOGIN@ .
The login name Amanda uses to run the backups.
The backup client hosts must allow access
from the tape server host as this user via
.I .rhosts
or
.IR .amandahosts ,
depending on how the Amanda software was built.
.TP
.BS printer string
Printer to use when doing tape labels.
See the
.B lbl-templ
.B tapetype
option.
.TP
.BS tapedev string
Default:
.IR @DEFAULT_TAPE_DEVICE@ .
The path name of the non-rewinding tape device.
Non-rewinding tape device names often have an 'n' in the name,
e.g.
.IR /dev/rmt/0mn ,
however this is operating system specific and you should consult
that documentation for detailed naming information.
.IP
If a tape changer is configured
(see the
.B tpchanger
option), this option might not be used.
.IP
If the
.B null
output driver is selected
(see the
.B OUTPUT DRIVERS
section later for more information),
programs such as
.B amdump
will run normally but all images will be thrown away.
This should only be used for debugging and testing,
and probably only with the
.B record
option set to
.IR no .
.TP
.BS rawtapedev string
Default:
.IR @DEFAULT_RAW_TAPE_DEVICE@ .
The path name of the raw tape device.
This is only used if Amanda is compiled for Linux machines with floppy tapes
and is needed for QIC volume table operations.
.TP
.BS tpchanger string
Default:
.IR none .
The name of the tape changer.
If a tape changer is not configured, this option is not used
and should be commented out of the configuration file.
.IP
If a tape changer is configured, choose one of the changer scripts
(e.g.\&
.BR chg-scsi )
and enter that here.
.TP
.BS changerdev string
Default:
.IR @DEFAULT_CHANGER_DEVICE@ .
A tape changer configuration parameter.
Usage depends on the particular changer defined with the
.B tpchanger
option.
.TP
.BS changerfile string
Default:
.IR /usr/adm/amanda/log/changer\-status .
A tape changer configuration parameter.
Usage depends on the particular changer defined with the
.B tpchanger
option.
.TP
.BN runtapes int
Default:
.IR 1 .
The maximum number of tapes used in a single run.
If a tape changer is not configured, this option is not used
and should be commented out of the configuration file.
.IP
If a tape changer is configured, this may be set larger than one to
let Amanda write to more than one tape.
.IP
Note that this is an upper bound on the number of tapes,
and Amanda may use less.
.IP
Also note that as of this release, Amanda does not support true tape overflow.
When it reaches the end of one tape,
the backup image Amanda was processing starts over again on the next tape.
.TP
.BN maxdumpsize int
Default:
.IR runtapes * tape_length .
Maximum number of bytes the planner will schedule for a run.
.TP
.BN taperalgo [first|firstfit|largest|largestfit|smallest|last]
Default:
.IR first .
The algorithm use to choose which dump image to send to the taper.
.RS
.TP
.B first
First in first out.
.TP
.B firstfit
The first dump image that will fit on the current tape.
.TP
.B largest
The largest dump image.
.TP
.B largestfit
The largest dump image that will fit on the current tape.
.TP
.B smallest
The smallest dump image.
.TP
.B last
Last in first out.
.RE
.LP
.BS labelstr string
Default:
.IR .* .
The tape label constraint regular expression.
All tape labels
generated (see
.BR amlabel(8) )
and used by this configuration must match the regular expression.
If multiple configurations are run from the same tape server host,
it is helpful to set their labels to different strings
(for example, "DAILY[0\-9][0\-9]*" vs.\& "ARCHIVE[0\-9][0\-9]*")
to avoid overwriting each other's tapes.
.TP
.BS tapetype string
Default:
.IR EXABYTE .
The type of tape drive associated with
.B tapedev
or
.BR tpchanger .
This refers to one of the defined
.BR tapetype s
in the config file (see below),
which specify various tape parameters,
like the
.BR length ,
.B filemark
size, and
.B speed
of the tape media and device.
.TP
.BN ctimeout int
Default:
.IR "30 seconds" .
Maximum amount of time that
.B amcheck 
will wait for each client host.
.TP
.BN dtimeout int
Default:
.IR "1800 seconds" .
Amount of idle time per disk on a given client that a
.B dumper
running from within
.B amdump
will wait before it fails with a data timeout error.
.TP
.BN etimeout int
Default:
.IR "300 seconds" .
Amount of time per disk on a given client that the
.B planner
step of
.B amdump
will wait to get the dump size estimates.
For instance, with the default of 300 seconds and four disks on client A, 
.B planner
will wait up to 20 minutes for that machine.
A negative value will be interpreted as a total amount of time to wait
per client instead of per disk.
.TP
.BN netusage int
Default:
.IR "300 Kbps" .
The maximum network bandwidth allocated to Amanda, in Kbytes per second.
See also the
.B interface
section.
.TP
.BN inparallel int
Default:
.IR 10 .
The maximum number of backups that Amanda will attempt to run in parallel.
Amanda will stay within the constraints of network bandwidth and
holding disk space available, so it doesn't hurt to set
this number a bit high.
Some contention can occur with larger numbers
of backups, but this effect is relatively small on most systems.
.TP
.BS dumporder string
Default:
.IR "tttTTTTTTT" .
The priority order of each dumper:
.RS
.RS
.nf
s: smallest size
S: largest size
t: smallest time
T: largest time
b: smallest bandwidth
B: largest bandwidth
.fi
.RE
.RE
.TP
.BN maxdumps int
Default:
.IR 1 .
The maximum number of backups from a single host that Amanda will
attempt to run in parallel.
See also the
.B inparallel
option.
.IP
Note that this parameter may also be set in a specific
.B dumptype
(see below).
This value sets the default for all
.BR dumptype s
so must appear in
.B amanda.conf
before any
.BR dumptype s
are defined.
.TP
.BN bumpsize int
Default:
.IR "10 Mbytes" .
The minimum savings required to trigger an automatic
bump from one incremental level to the next.
If Amanda determines that the next higher backup level
will be this much smaller than the current level,
it will do the next level.
See also the
.B bumpmult
option.
.TP
.BN bumpmult float
Default:
.IR 1.5 .
The bump size multiplier.
Amanda multiplies
.B bumpsize
by this factor for each level.
This prevents active filesystems from
bumping too much by making it harder to bump to the next level.
For example, with the default
.B bumpsize
and
.BR bumpmult
set to 2.0, the bump threshold will be 10 Mbytes for level one, 20
Mbytes for level two, 40 Mbytes for level three, and so on.
.TP
.BN bumpdays int
Default:
.IR "2 days" .
To insure redundancy in the dumps, Amanda keeps filesystems at the
same incremental level for at least
.B bumpdays
days, even if the other bump threshold criteria are met.
.TP
.BS diskfile string
Default:
.IR disklist .
The file name for the
.I disklist
file holding client hosts, disks and other client dumping information.
.TP
.BS infofile string
Default:
.IR /usr/adm/amanda/curinfo .
The file or directory name for the historical information database.
If Amanda was configured to use DBM databases, this is the base file
name for them.
If it was configured to use text formated databases (the default),
this is the base directory and within here will be a directory per
client, then a directory per disk, then a text file of data.
.TP
.BS logdir string
Default:
.IR /usr/adm/amanda .
The directory for the
.B amdump
and
.B log
files.
.TP
.BS indexdir string
Default
.IR /usr/adm/amanda/index .
The directory where index files (backup image catalogues) are stored.
Index files are
only generated for filesystems whose
.B dumptype
has the
.B index
option enabled.
.TP
.BS tapelist string
Default:
.IR tapelist .
The file name for the active
.I tapelist
file.
Amanda maintains this file with information about the active set of tapes.
.TP
.BN tapebufs int
Default:
.IR 20 .
The number of buffers used by the
.B taper
process run by
.B amdump
and
.B amflush
to hold data as it
is read from the network or disk before it is written to tape.
Each buffer is a little larger than 32 KBytes and is held in
a shared memory region.
.TP
.BN reserve number
Default:
.IR 100 (percent).
The amount of holding-disk space that should not be used for full
backups if no tape is available.
By default, when there is no tape to write to,
degraded mode (incremental) backups will be performed to the holding disk.
If full backups should also be allowed in this case,
the amount of holding disk space reserved for incrementals should be lowered.
.TP
.BN autoflush bool
Default:
.IR off .
Whether an amdump run will flush the dump already on holding disk to tape.
.TP
.BN amrecover_do_fsf bool
Default:
.IR off .
Amrecover will call amrestore with the -f flag for faster positioning of the tape.
.TP
.BN amrecover_check_label bool
Default:
.IR off .
Amrecover will call amrestore with the -l flag to check the label.
.TP
.BS amrecover_changer string
Default: ''.
Amrecover will use the changer if you use 'settape <STRING>' and that string
is the same as the amrecover_changer setting.
.TP
.BS columnspec string
Defines the width of columns
.B amreport
should use.
.I String
is a comma (',') separated list of triples.
Each triple consists
of three parts which are separated by a equal sign ('=') and a colon
(':') (see the example).
These three parts specify:
.RS
.IP + 2
the name of the column, which may be:
.LP
.RS
.nf
Compress (compression ratio)
Disk (client disk name)
DumpRate (dump rate in KBytes/sec)
DumpTime (total dump time in hours:minutes)
HostName (client host name)
Level (dump level)
OrigKB (original image size in KBytes)
OutKB (output image size in KBytes)
TapeRate (tape writing rate in KBytes/sec)
TapeTime (total tape time in hours:minutes)
.fi
.RE
.IP + 2
the amount of space to display before the column (used to get whitespace
between columns).
.IP + 2
the width of the column itself.
If set to a negative value,
the width will be calculated on demand to fit the largest entry in
this column.
.RE
.LP
.RS
Here is an example:
.LP
.EX
     columnspec "Disk=1:18,HostName=0:10,OutKB=1:7"
.EE
.LP
The above will display the disk information in 18 characters
and put one space before it.
The hostname column will be 10 characters wide with
no space to the left.
The output KBytes column is seven characters wide
with one space before it.
.RE
.TP
.BS includefile string
Default:
.IR none .
The name of an amanda configuration file to include within
the current file.
Useful for sharing dumptypes, tapetypes and
interface definitions among several configurations.
.SH "HOLDINGDISK SECTION"
The
.B amanda.conf
file may define one or more holding disks used as buffers to hold
backup images before they are written to tape.
The syntax is:
.LP
.RS
.EX
holdingdisk \fIname\fP {
    \fIholdingdisk\-option\fP \fIholdingdisk\-value\fP
    \fI...\fP
}
.EE
.RE
.LP
.I Name
is a logical name for this holding disk.
.LP
The options and values are:
.LP
.TP
.BS comment string
Default:
.IR none .
A comment string describing this holding disk.
.TP
.BS directory disk
Default:
.IR /dumps/amanda .
The path to this holding area.
.TP
.BN use int
Default:
.IR "0 Gb" .
Amount of space that can be used in this holding disk area.
If the value is zero, all available space on the file system is used.
If the value is negative,
Amanda will use all available space minus that value.
.TP
.BN chunksize int
Default:
.IR "1 Gb" .
Holding disk chunk size.
Dumps larger than the specified size will be stored in multiple
holding disk files.
The size of each chunk will not exceed the
specified value.
However, even though dump images are split in the
holding disk, they are concatenated as they are written to tape, so
each dump image still corresponds to a single continuous tape section.
.IP
If 0 is specified, Amanda will create holding disk chunks as large as
((INT_MAX/1024)-64) Kbytes.
.IP
Each holding disk chunk includes a 32 Kbyte header, so the minimum
chunk size is 64 Kbytes (but that would be really silly).
.IP
Operating systems that are limited to a maximum file size of 2 Gbytes
actually cannot handle files that large.
They must be at least one byte less than 2 Gbytes.
Since Amanda works with 32 Kbyte blocks, and
to handle the final read at the end of the chunk, the chunk size
should be at least 64 Kbytes (2 * 32 Kbytes) smaller than the maximum
file size, e.g.\& 2047 Mbytes.
.SH "DUMPTYPE SECTION"
The
.B amanda.conf
file may define multiple sets of backup options and
refer to them by name from the
.B disklist
file.
For instance, one set of options might be defined for file systems
that can benefit from high compression,
another set that does not compress well,
another set for file systems that should always get a full backup
and so on.
.LP
A set of backup options are entered in a
.B dumptype
section, which looks like this:
.LP
.RS
.EX
define dumptype \fIname\fP {
    \fIdumptype\-option\fP \fIdumptype\-value\fP
    \fI...\fP
}
.EE
.RE
.LP
.I Name
is the name of this set of backup options.
It is referenced from the
.I disklist
file.
.LP
Some of the options in a
.B dumptype
section are the same as those in the main part of
.BR amanda.conf .
The main option value is used to set the default for all
.B dumptype
sections.
For instance, setting
.B dumpcycle
to 50 in the main part of the config file causes all following
.B dumptype
sections to start with that value,
but the value may be changed on a section by section basis.
Changes to variables in the main part of the config file must be
done before (earlier in the file) any
.BR dumptype s
are defined.
.LP
The dumptype options and values are:
.LP
.TP
.BS auth string
Default:
.IR bsd .
Type of authorization to perform between tape server and backup client hosts.
May be
.B krb4
to use Kerberos\-IV authorization.
.TP
.BS comment string
Default:
.IR none .
A comment string describing this set of backup options.
.TP
\fBcomprate\fP \fIfloat\fP [, \fIfloat\fP ]
Default:
.IR 0.50 ,
.IR 0.50 .
The expected full and incremental compression factor for dumps.
It is only used if Amanda does not have any history information on
compression rates for a filesystem, so should not usually need to
be set.
However, it may be useful for the first time a
very large filesystem that compresses very little is backed up.
.TP
.BS "compress [client|server]" string
Default:
.IR "client fast" .
If Amanda does compression of the backup images,
it can do so either on the backup client host before it crosses the network
or on the tape server host as it goes from the
network into the holding disk or to tape.
Which place to do compression (if at all) depends on how well the
dump image usually compresses, the speed and load on the client or
server, network capacity, holding disk capacity,
availability of tape hardware compression, etc.
.IP
For either type of compression, Amanda also allows the selection
of two styles of compression.
.B Best
is the best compression available, often at the expense of CPU overhead.
.B Fast
is often not as good a compression as
.BR best ,
but usually less CPU overhead.
.IP
So the
.B compress
options line may be one of:
.LP
.RS
.RS
.nf
compress none
compress [client] fast
compress [client] best
compress server fast
compress server best
.fi
.RE
.RE
.IP
Note that some tape devices do compression and this option has nothing
to do with whether that is used.
If hardware compression is used (usually via a particular tape device name
or
.B mt
option),
Amanda (software) compression should be disabled.
.TP
.BN dumpcycle int
Default:
.IR "10 days" .
The number of days in the backup cycle.
Each disk using this set of options
will get a full backup at least this often.
Setting this to zero tries to do a full backup each run.
.TP
.P1 exclude [ list|file ][[optional][ append ][ "string" ]+]
Default:
.IR file .
There is two exclude list
.B exclude file
and
.B exclude list.
With
.B exclude file
, the
.I string
is a gnutar exclude expression. With
.B exclude list
, the
.I string
is a file name on the client containing gnutar exclude expression.
.IP
All exclude expression are concatenated in one file and passed to gnutar as a
.B \-\-exclude\-from
argument.
.IP
With the
.B append
keyword, the
.I string
are appended to the current value of the list, without it, the
.I string
overwrite the list.
.IP
If
.B optional
is specified for
.B exclude list,
then amcheck will not complain if the file doesn't exist or is not readable.
.IP
For
.B exclude list,
If the file name is relative,
the disk name being backed up is prepended.
So if this is entered:
.LP
.EX
    exclude list ".amanda.excludes"
.EE
.IP
the actual file use would be
.I /var/.amanda.excludes
for a backup of
.IR /var ,
.I /usr/local/.amanda.excludes
for a backup of
.IR /usr/local ,
and so on.
.TP
.BS holdingdisk boolean
Default:
.IR yes .
Whether a holding disk should be used for these backups or whether
they should go directly to tape.
If the holding disk is a portion of another file system that Amanda
is backing up, that file system should refer to a dumptype with
.B holdingdisk
set to
.I no
to avoid backing up the holding disk into itself.
.TP
.BS ignore boolean
Default:
.IR no .
Whether disks associated with this backup type should be backed up or not.
This option is useful when the
.I disklist
file is shared among several configurations,
some of which should not back up all the listed file systems.
.TP
.P1 include [ list|file ][[optional][ append ][ "string" ]+]
Default:
.I file
".".
There is two include list
.B include file
and
.B include list.
With
.B include file
, the
.I string
is a glob expression. With
.B include list
, the
.I string
is a file name on the client containing glob expression.
.IP
All include expression are expanded by amanda and concatenated in one file and passed to gnutar as a
.B \-\-files\-from
argument. They must start with "./" and containing no other "/".
.IP
With the
.B append
keyword, the
.I string
are appended to the current value of the list, without it, the
.I string
overwrite the list.
.IP
If
.B optional
is specified for
.B include list,
then amcheck will not complain if the file doesn't exist or is not readable.
.IP
For
.B include list,
If the file name is relative,
the disk name being backed up is prepended.
.TP
.BS index boolean
Default:
.IR no .
Whether an index (catalogue) of the backup should be generated and
saved in
.BR indexdir .
These catalogues are used by the
.B amrecover
utility.
.TP
.BS kencrypt boolean
Default:
.IR no .
Whether the backup image should be encrypted by Kerberos as it is sent
across the network from the backup client host to the tape server host.
.TP
.BS maxdumps int
Default:
.IR 1 .
The maximum number of backups from a single host that Amanda will
attempt to run in parallel.
See also the main section
.B inparallel
option.
.TP
.BS maxpromoteday int
Default:
.IR 10000 .
The Maximum number of day for a promotion, set it 0 if you don't want
promotion, set it to 1 or 2 if your disk get overpromoted.
.TP
.BS priority string
Default:
.IR medium .
When there is no tape to write to, Amanda will do incremental backups
in priority order to the holding disk.
The priority may be
.BR high (2),
.BR medium (1),
.BR low (0)
or a number of your choice.
.TP
.BS program string
Default:
.IR DUMP .
The type of backup to perform.
Valid values are
.B DUMP
for the native operating system backup program, and
.B GNUTAR
to use GNU tar or to do Samba PC backups.
.TP
.BS record boolean
Default:
.IR yes .
Whether to ask the backup program to update its
database (e.g.\&
.IR /etc/dumpdates
for DUMP or 
.IR @GNUTAR_LISTED_INCREMENTAL_DIRX@
for GNUTAR) of time stamps.
This is normally enabled for daily backups and turned off
for periodic archival runs.
.TP
.BS skip\-full boolean
Default:
.IR no .
If
.I true
and
.B planner
has scheduled a full backup, these disks will be skipped, and
full backups should be run off-line on these days.
It was reported that
Amanda only schedules level 1 incrementals in this configuration; this
is probably a bug.
.TP
.BS skip\-incr boolean
Default:
.IR no .
If
.I true
and
.B planner
has scheduled an incremental backup, these disks will be skipped.
.TP
.BS starttime int
Default:
.IR none .
Backups will not start until after this time of day.
The value should be hh*100+mm, e.g.\& 6:30PM (18:30) would be entered as
.BR 1830 .
.TP
.BS strategy string
Default:
.IR standard .
Strategy to use when planning what level of backup to run next.
Values are:
.LP
.RS
.TP
.B standard
The standard Amanda schedule.
.TP
.B nofull
Never do full backups, only level 1 incrementals.
.TP
.B noinc
Never do incremental backups, only full dumps.
.TP
.B skip
Never do backups (useful when sharing the
.I disklist
file).
.TP
.B incronly
Only do incremental dumps.
`amadmin force' should be used to tell
Amanda that a full dump has been performed off-line, so that it resets
to level 1.
It is similar to skip-full, but with incronly
full dumps may be scheduled manually.
Unfortunately, it appears that Amanda
will perform full backups with this configuration, which is probably a
bug.
.RE
.LP
The following
.B dumptype
entries are predefined by Amanda:
.LP
.RS
.EX
define dumptype no-compress {
    compress none
}
define dumptype compress-fast {
    compress client fast
}
define dumptype compress-best {
    compress client best
}
define dumptype srvcompress {
    compress server fast
}
define dumptype bsd-auth {
    auth bsd
}
define dumptype krb4-auth {
    auth krb4
}
define dumptype no-record {
    record no
}
define dumptype no-hold {
    holdingdisk no
}
define dumptype no-full {
    skip-full yes
}
.EE
.RE
.LP
In addition to options in a
.B dumptype
section, one or more other
.B dumptype
names may be entered, which make this
.B dumptype
inherit options from other
previously defined
.BR dumptype s.
For instance, two sections might be the same except for the
.B record
option:
.LP
.RS
.EX
define dumptype normal {
    comment "Normal backup, no compression, do indexing"
    no-compress
    index yes
    maxdumps 2
}
define dumptype testing {
    comment "Test backup, no compression, do indexing, no recording"
    normal
    record no
}
.EE
.RE
.LP
Amanda provides a
.B dumptype
named
.I global
in the sample
.B amanda.conf
file that all
.BR dumptype s
should reference.
This provides an easy place to make changes that will affect
every
.BR dumptype .
.SH "TAPETYPE SECTION"
The
.B amanda.conf
file may define multiple types of tape media and devices.
The information is entered in a
.B tapetype
section, which looks like this in the config file:
.LP
.RS
.EX
define tapetype \fIname\fP {
    \fItapetype\-option\fP \fItapetype\-value\fP
    \fI...\fP
}
.EE
.RE
.LP
.I Name
is the name of this type of tape medium/device.
It is referenced from the
.B tapetype
option in the main part of the config file.
.LP
The tapetype options and values are:
.TP
.BS comment string
Default:
.IR none .
A comment string describing this set of tape information.
.TP
.BS filemark int
Default:
.IR "1000 bytes" .
How large a file mark (tape mark) is, measured in bytes.
If the size is only known in some linear measurement (e.g.\& inches),
convert it to bytes using the device density.
.TP
.BS length int
Default:
.IR "2000 kbytes" .
How much data will fit on a tape.
.IP
Note that this value is only used by Amanda to schedule which backups
will be run.
Once the backups start, Amanda will continue to write to a tape until
it gets an error, regardless of what value is entered for
.B length
(but see the
.B OUTPUT DRIVERS
section later for exceptions).
.TP
.BS blocksize int
Default:
.IR "32 kbytes" .
How much data will be written in each tape record.
The minimum blocksize value is 32 KBytes.
The maximum blocksize value is @MAXTAPEBLOCKSIZE@ KBytes.
The maximum is set during configure with --with-maxtapeblocksize.
.TP
.BS file-pad boolean
Default:
.IR "true" .
If true, every record, including the last one in the
file, will have the same length.
This matches the way Amanda wrote tapes prior to the availability
of this parameter.
It may also be useful on devices that only support a fixed blocksize.
.IP
Note that the last record on the tape probably includes trailing
null byte padding, which will be passed back to
.BR gzip ,
.B compress
or the restore program.
Most programs just ignore this (although possibly with a warning).
.IP
If this parameter is false, the last record in a file may be shorter
than the block size.
The file will contain the same amount of data the dump program generated,
without trailing null byte padding.
When read, the same amount of data that was written will be returned.
.TP
.BS speed int
Default:
.IR "200 bps" .
How fast the drive will accept data, in bytes per second.
This parameter is not currently used by Amanda.
.TP
.BS lbl-templ string
A PostScript template file used by
.B amreport
to generate labels.
Several sample files are provided with the Amanda sources in the
.I example
directory.
See the
.IR amreport (8)
man page for more information.
.LP
In addition to options, another
.B tapetype
name may be entered, which makes this
.B tapetype
inherit options from another
.BR tapetype .
For instance, the only difference between a DLT4000 tape drive using
Compact\-III tapes and one using Compact\-IV tapes is the length of
the tape.
So they could be entered as:
.LP
.RS
.EX
define tapetype DLT4000\-III {
    comment "DLT4000 tape drives with Compact\-III tapes"
    length 12500 mbytes         # 10 Gig tapes with some compression
    filemark 2000 kbytes
    speed 1536 kps
}
define tapetype DLT4000\-IV {
    DLT4000\-III
    comment "DLT4000 tape drives with Compact\-IV tapes"
    length 25000 mbytes         # 20 Gig tapes with some compression
}
.EE
.RE
.SH "INTERFACE SECTION"
The
.B amanda.conf
file may define multiple types of network interfaces.
The information is entered in an
.B interface
section, which looks like this:
.LP
.RS
.EX
define interface \fIname\fP {
    \fIinterface\-option\fP \fIinterface\-value\fP
    \fI...\fP
}
.EE
.RE
.LP
.I Name
is the name of this type of network interface.
It is referenced from the
.I disklist
file.
.LP
Note that these sections define network interface characteristics,
not the actual interface that will be used.
Nor do they impose limits on the bandwidth that will actually be
taken up by Amanda.
Amanda computes the estimated bandwidth each file system backup will take
based on the estimated size and time,
then compares that plus any other running
backups with the limit as another of the criteria when deciding whether
to start the backup.
Once a backup starts, Amanda will use as much of the network as it can
leaving throttling up to the operating system and network hardware.
.LP
The interface options and values are:
.TP
.BS comment string
Default:
.IR none .
A comment string describing this set of network information.
.TP
.BS use int
Default:
.IR "300 Kbps" .
The speed of the interface in Kbytes per second.
.LP
In addition to options, another
.B interface
name may be entered, which makes this
.B interface
inherit options from another
.BR interface .
At the moment, this is of little use.
.SH "DISKLIST FILE"
The
.I disklist
file determines which disks will be backed up by Amanda.
The file usually contains one line per disk:
.LP
.RS
.I hostname diskname
[
.I diskdevice
]
.I dumptype
[
.I spindle
[
.I interface
] ]
.RE
.LP
All pair [
.B hostname diskname
] must be unique.
.LP
Lines starting with # are ignored, as are blank lines.
The fields have the following meanings:
.TP
.I hostname
The name of the host to be backed up.
If
.B diskdevice
refers to a PC share, this is the host Amanda will
run the Samba
.B smbclient
program on to back up the share.
.TP
.I diskname
The name of the disk (a label).
In most case, you set your
.B diskname
to the
.B diskdevice
and you don't set the
.B diskdevice.
If you want multiple entry with the same
.B diskdevice,
you must set a different
.B diskname
for each entry. It's the
.B diskname
that you use on command line for any amanda command.
Look at the example/disklist file for example.
.TP
.I diskdevice
Default: same as diskname.
The name of the disk device to be backed up.
It may be a full device name,
a device name without the
.I /dev/
prefix, e.g.\&
.IR sd0a ,
or a mount point such as
.IR /usr .
.IP
It may also refer to a PC share by starting the name with two (forward)
slashes, e.g.\&
.IR //some-pc/home .
In this case, the
.B program
option in the associated
.B dumptype
must be entered as
.BR GNUTAR .
It is the combination of the double slash disk name and
.B program GNUTAR
in the
.B dumptype
that triggers the use of Samba.
.TP
.I dumptype
Refers to a
.B dumptype
defined in the
.B amanda.conf
file.
.IR Dumptype s
specify backup related parameters,
such as whether to compress the backups,
whether to record backup results in
.IR /etc/dumpdates ,
the disk's relative priority,
etc.
.TP
.I spindle
Default:
.IR \-1 .
A number used to balance backup load on a host.
Amanda will not run multiple backups at the same time
on the same spindle, unless the spindle number is -1,
which means there is no spindle restriction.
.TP
.I interface
Default:
.IR local .
The name of a network interface definition in the
.B amanda.conf
file, used to balance network load.
.LP
Instead of naming a
.BR dumptype ,
it is possible to define one in-line, enclosing
.B dumptype
options within curly braces, one per line, just like a
.B dumptype
definition in
.BR amanda.conf .
Since pre-existing
.BR dumptype s
are valid option names, this syntax may be used to customize
.BR dumptype s
for particular disks.
.LP
A line break
.B must
follow the left curly bracket.
.LP
For instance, if a
.B dumptype
named
.I normal
is used for most disks, but use of the holding disk needs to be disabled
for the file system that holds it, this would work instead of defining
a new dumptype:
.RS
.EX
\fIhostname diskname\fP [ \fIdiskdevice\fP ] {
  normal
  holdingdisk no
} [ \fIspindle\fP [ \fIinterface\fP ] ]
.EE
.RE
.LP
.SH "TAPE MANAGEMENT"
The
.I tapelist
file contains the list of tapes in active use.
This file is maintained entirely by Amanda and should not be created
or edited during normal operation.
It contains lines of the form:
.LP
.RS
.I YYYYMMDD label flags
.RE
.LP
Where
.I YYYYMMDD
is the date the tape was written,
.I label
is a label for the tape as written by
.B amlabel
and
.I flags
tell Amanda whether the tape may be reused, etc (see
the
.B reuse
options of
.BR amadmin ).
.LP
.B Amdump
and
.B amflush
will refuse to write to an unlabeled tape,
or to a labeled tape that is considered active.
There must be more tapes in active rotation
(see the
.B tapecycle
option)
than there are runs in the backup cycle
(see the
.B dumpcycle
option)
to prevent overwriting a backup image that would be needed to
do a full recovery.
.SH "OUTPUT DRIVERS"
The normal value for the
.B tapedev
parameter,
or for what a tape changer returns,
is a full path name to a non-rewinding tape device,
such as
.I /dev/nst0
or
.I /dev/rmt/0mn
or
.I /dev/nst0.1
or whatever conventions the operating system uses.
Amanda provides additional application level drivers that
support non-tradition tape simulatation or features.
To access a specific output driver, set
.B tapedev
(or configure your changer to return)
a string of the form
.I driver\fR:\fIdriver-info
where
.I driver
is one of the supported drivers and
.I driver-info
is optional additional information needed by the driver.
.LP
The supported drivers are:
.TP 10
.I tape
This is the default driver.
The
.I driver-info
is the tape device name.
Entering
.I /dev/rmt/0mn
is really a short hand for
.IR tape:/dev/rmt/0mn .
.TP
.I null
This driver throws away anything written to it and returns EOF
for any reads except a special case is made for reading a label,
in which case a "fake" value is returned that Amanda checks for
and allows through regardless of what you have set in
.BR labelstr .
The
.I driver-info
field is not used and may be left blank:
.RS
.IP
.BS tapedev null:
.RE
.IP
The
.I length
value from the associated
.B tapetype
is used to limit the amount of data written.
When the limit is reached, the driver will simulate end of tape.
.IP
NOTE: this driver should only be used for debugging and testing,
and probably only with the
.B record
option set to
.IR no .
.TP
.I rait
\fIR\fRedundant
\fIA\fRrray
of
\fII\fRnexpensive (?)
\fIT\fRapes.
Reads and writes tapes mounted on multiple drives by spreading
the data across N-1 drives and using the last drive for a checksum.
See docs/RAIT for more information.
.IP
The
.I driver-info
field describes the devices to use.
Curly braces indicate multiple replacements in the string.
For instance:
.RS
.IP
.BS tapedev rait:/dev/rmt/tps0d{4,5,6}n
.RE
.IP
would use the following devices:
.RS
.IP
/dev/rmt/tps0d4n
.br
/dev/rmt/tps0d5n
.br
/dev/rmt/tps0d6n
.RE
.TP
.I file
This driver emulates a tape device with a set of files in a directory.
The
.I driver-info
field must be the name of an existing directory.
The driver will test for a subdirectory of that named
.I data
and return
.B offline
until it is present.
When present, the driver uses two files in the
.I data
subdirectory for each tape file.
One contains the actual data.
The other contains record length information.
.IP
The driver uses a file named
.I status
in the
.B file
device directory to hold driver status information,
such as tape position.
If not present, the driver will create it as though the device is rewound.
.IP
The
.I length
value from the associated
.B tapetype
is used to limit the amount of data written.
When the limit is reached, the driver will simulate end of tape.
.IP
One way to use this driver with a real device such as a CD is to
create a directory for the
.B file
device and one or more other directories
for the actual data.
Create a symlink named
.I data
in the
.B file
directory to one of the data directories.
Set the
.B tapetype
length to whatever the medium will hold.
.IP
When Amanda fills the
.B file
device,
remove the symlink and (optionally) create a new symlink to another
data area.
Use a CD writer software package to burn the image from the first data area.
.IP
To read the CD,
mount it and create the
.I data
symlink in the
.B file
device directory.
.SH AUTHORIZATION
Amanda processes on the tape server host run as the
.B dumpuser
user listed in
.BR amanda.conf .
When they connect to a backup client, they do so with an Amanda-specific
protocol.
They do not, for instance, use
.B rsh
or
.B ssh
directly.
.LP
On the client side, the
.B amandad
daemon validates the connection using one of several methods,
depending on how it was compiled and on options it is passed:
.LP
.IP .rhosts
Even though Amanda does not use
.BR rsh ,
it can use
.BR .rhosts -style
authentication and a
.B .rhosts
file.
.IP .amandahosts
This is essentially the same as
.B .rhosts
authentication except a different file, with almost the same format, is used.
This is the default mechanism built into Amanda.
.IP
The format of the
.B .amandahosts
file is:
.RS
.IP
.I hostname
[
.I username
]
.RE
.IP
If
.I username
is ommitted, it defaults to the user running
.BR amandad ,
i.e. the user listed in the
.B inetd
or
.B xinetd
configuration file.
.IP Kerberos
Amanda may use the Kerberos authentication system.
Further information is in the
.B docs/KERBEROS
file that comes with an Amanda distribution.
.LP
For Samba access,
Amanda needs a file on the Samba server (which may
or may not also be the tape server) named
.B /etc/amandapass
with share names, (clear text) passwords and (optional) domain names,
in that order, one per line, whitespace separated.
By default, the user used to connect to the PC is the same for all
PC's and is compiled into Amanda.
It may be changed on a host by host basis
by listing it first in the password field followed
by a percent sign and then the password.
For instance:
.LP
.EX
  //some-pc/home	normalpw
  //another-pc/disk	otheruser%otherpw
.EE
.LP
With clear text passwords, this file should obviously be tightly protected.
It only needs to be readable by the Amanda user on the Samba server.
.LP
Further information is in the
.B docs/SAMBA
file that comes with an Amanda distribution.
.SH HOST & DISK EXPRESSION
All host and disk arguments to programs are special expression.
The command apply to all disk that match your arguments.
This section describe the matcher.
.LP
The matcher match by word, each word is a glob expression, word
are separated by the separator '.' for host and '/' for disk. You
can anchor the expression at left with a '^'. You can
anchor the expression at right with a '$'. The matcher
is case insensitive for host but is case sensitive for disk. A match
succeed if all word in your expression match contiguous word in 
the host or disk.
.LP
.EX
 .   word separator for a host
 /   word separator for a disk
 ^   anchor at left
 $   anchor at right
 ?   match exactly one character except the separator
 *   match zero or more characters except the separator
 **  match zero or more characters including the separator
.EE
.LP
.LP
Some examples:
.LP
.EX
  EXPRESSION      WILL MATCH              WILL NOT MATCH
  hosta           hosta                   hostb
                  hoSTA.dOMAIna.ORG
                  foo.hosta.org
  host            host                    hosta
  host?           hosta                   host
                  hostb
  ho*na           hoina                   ho.aina.org
  ho**na          hoina
                  ho.aina.org
  ^hosta          hosta                   foo.hosta.org
  sda*            /dev/sda1
                  /dev/sda12
  /opt/           opt (disk)              opt (host)
  .opt.           opt (host)              opt (disk)
  /               /                       any other disk
  /usr            /usr
                  /usr/opt
  /usr$           /usr                    /usr/opt

.EE
.SH DATESTAMP EXPRESSION
A
.I datestamp
expression is a range expression where we only match the prefix.
Leading ^ is removed. Trailing $ force an exact match.
.LP
.EX
  20001212-14  match all dates beginning with 20001212, 20001213 or 20001214
  20001212-4   same as previous
  20001212-24  match all dates between 20001212 and 20001224
  2000121      match all dates that start with 2000121 (20001210-20001219)
  2            match all dates that start with 2 (20000101-29991231)
  2000-10      match all dates between 20000101-20101231
  200010$      match only 200010
.EE
.SH AUTHOR
James da Silva <jds@cs.umd.edu>
.br
University of Maryland, College Park
.SH "SEE ALSO"
amadmin(8),
amcheck(8),
amcheckdb(8),
amcleanup(8),
amdd(8),
amdump(8),
amflush(8),
amgetconf(8),
amlabel(8),
ammt(8),
amoverview(8),
amplot(8),
amrecover(8),
amreport(8),
amrestore(8),
amrmtape(8),
amstatus(8),
amtape(8),
amtoc(8),
amverify(8),
amverifyrun(8)
